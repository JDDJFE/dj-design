{"remainingRequest":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js!/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangjunxia/work-github/dj-design/packages/popover/src/popover.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangjunxia/work-github/dj-design/packages/popover/src/popover.vue","mtime":1676537858400},{"path":"/Users/wangjunxia/work-github/dj-design/babel.config.js","mtime":1660011372032},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KZnVuY3Rpb24gcmVtb3ZlUG9wKHNlbGYpIHsKICAvLyBjb25zb2xlLmxvZyh0aGlzLCBzZWxmLCd0aGlzJyk7CiAgLy8gY29uc29sZS5sb2coc2VsZi50b29sdGlwSWQsIHNlbGYudG9vbHRpcElkUGFyZW50LCAnaGFuZGxlRG9jdW1lbnRDbGljaycpOwogIC8vIGNvbnNvbGUubG9nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGYudG9vbHRpcElkUGFyZW50KSwgJ2hhbmRsZURvY3VtZW50Q2xpY2snKTsKICBpZiAoIWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGYudG9vbHRpcElkUGFyZW50KSAmJiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxmLnRvb2x0aXBJZCkpIHsKICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZi50b29sdGlwSWQpKTsgLy8gY29uc29sZS5sb2coJ3JlbW92ZUV2ZW50TGlzdGVuZXInKTsKICAgIC8vIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVtb3ZlUG9wKHNlbGYpLCBmYWxzZSk7CiAgfQp9CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ2RqUG9wb3ZlcicsCiAgcHJvcHM6IHsKICAgIHRpdGxlOiBTdHJpbmcsCiAgICBjb250ZW50OiBTdHJpbmcsCiAgICByZWZlcmVuY2U6IHt9LAogICAgcG9wcGVyOiB7fSwKICAgIGRpc2FibGVkOiBCb29sZWFuLAogICAgd2lkdGg6IHt9LAogICAgY2xhc3NOYW1lOiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJycKICAgIH0sCiAgICB6SW5kZXg6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiA3OQogICAgfSwKICAgIHBsYWNlbWVudDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICd0b3AnCiAgICB9LAogICAgdmlzaWJsZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIHRyaWdnZXI6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnY2xpY2snLAogICAgICB2YWxpZGF0b3I6IHZhbHVlID0+IFsnY2xpY2snLCAnZm9jdXMnLCAnaG92ZXInLCAnbWFudWFsJ10uaW5kZXhPZih2YWx1ZSkgPiAtMSB8fCB2YWx1ZSA9PT0gJycKICAgIH0sCiAgICBvcGVuRGVsYXk6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAwCiAgICB9LAogICAgY2xvc2VEZWxheTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDIwMAogICAgfSwKICAgIC8vIOaYr+WQpuaPkuWFpeWIsGJvZHkKICAgIGFwcGVuZFRvQm9keTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIHRhYmluZGV4OiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMAogICAgfSwKICAgIG5vdFBhcmVudENsYXNzOiB7CiAgICAgIC8vIOS4uuS6huiuqeiHquWumuS5ieeahOeItue6p+aciW92ZXJmbG93IGF1dG/ml7bvvIzorqnku5bkuI3kuLrniLbnuqflhYPntKAKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfSAvLyBjb250cmFyeVZlcnRpY2FsOiB7CiAgICAvLyAgIHR5cGU6IE51bWJlciwKICAgIC8vICAgZGVmYXVsdDogMTAwCiAgICAvLyB9LAogICAgLy8gY29udHJhcnlIb3Jpem9udGFsOiB7CiAgICAvLyAgIHR5cGU6IE51bWJlciwKICAgIC8vICAgZGVmYXVsdDogMjUwCiAgICAvLyB9CgogIH0sCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwb3BTdHlsZToge30sCiAgICAgIHBvcFdIU3R5bGU6IHt9LAogICAgICBhcnJvd1N0eWxlOiB7fSwKICAgICAgc2hvd1BvcHBlcjogZmFsc2UsCiAgICAgIG9wYWNpdHk6IDAsCiAgICAgIGRpc3BsYXlTdGF0dXM6ICdub25lJywKICAgICAgY29udGVudE1heEhlaWdodDogJycsCiAgICAgIHBsYWNlbWVudFN0cjogJycsCiAgICAgIHRhZ05hbWU6ICcnLAogICAgICB0YXJnZXQ6IG51bGwsCiAgICAgIGNvbnRyYXJ5VmVydGljYWw6IDEwMCwKICAgICAgY29udHJhcnlIb3Jpem9udGFsOiAyNTAsCiAgICAgIHBvcHBlckluaXRpYWxXaWR0aDogJycsCiAgICAgIHBvcHBlckluaXRpYWxIZWlnaHQ6ICcnCiAgICB9OwogIH0sCgogIGNvbXBvbmVudHM6IHt9LAogIGNvbXB1dGVkOiB7CiAgICB0b29sdGlwSWQoKSB7CiAgICAgIHJldHVybiBgZGotcG9wb3Zlci0ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKX1gOwogICAgfSwKCiAgICB0b29sdGlwSWRQYXJlbnQoKSB7CiAgICAgIHJldHVybiBgZGotcG9wb3Zlci0ke01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKX0tcGFyZW50YDsKICAgIH0KCiAgfSwKICB3YXRjaDogewogICAgdmlzaWJsZTogewogICAgICBpbW1lZGlhdGU6IHRydWUsCgogICAgICBoYW5kbGVyKHZhbCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbCwgJ3Zpc2libGUnKTsKICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gdmFsOwogICAgICB9CgogICAgfSwKICAgIHNob3dQb3BwZXI6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAoKICAgICAgaGFuZGxlcih2YWwpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZyh2YWwsICdzaG93UG9wcGVyJyk7CiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZTp2aXNpYmxlJywgdmFsKTsKCiAgICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5KSB7CiAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRET00oKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8qIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgdGhpcy5yZW1vdmVET00oKTsKICAgICAgICAgICAgIH0sIDMwMCk7Ki8KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiB2YWwpIHsKICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gdGhpcy5wbGFjZW1lbnQ7CiAgICAgICAgICB0aGlzLmRpc3BsYXlTdGF0dXMgPSAnYmxvY2snOwogICAgICAgICAgbGV0IHJlZmVyZW5jZTsKICAgICAgICAgIGNvbnN0IHBvcHBlciA9IHRoaXMucG9wcGVyIHx8IHRoaXMuJHJlZnMucG9wcGVyOwogICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgIHJlZmVyZW5jZSA9IHRoaXMuZ2V0UmVmZXJlbmNlKCk7IC8vIGNvbnNvbGUubG9nKHJlZmVyZW5jZSwncmVmZXJlbmNl6L+Z6YeM5ZWKJyk7CgogICAgICAgICAgICBpZiAoIXRoaXMucG9wcGVySW5pdGlhbFdpZHRoICYmICF0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQpIHsKICAgICAgICAgICAgICB0aGlzLnBvcHBlckluaXRpYWxXaWR0aCA9IHBvcHBlciA9PT0gbnVsbCB8fCBwb3BwZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBvcHBlci5vZmZzZXRXaWR0aDsKICAgICAgICAgICAgICB0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQgPSBwb3BwZXIgPT09IG51bGwgfHwgcG9wcGVyID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwb3BwZXIub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKHRoaXMucG9wcGVySW5pdGlhbFdpZHRoLCB0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQsICdwb3BwZXJJbml0aWFsV2lkdGgnKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocG9wcGVyLmNsaWVudEhlaWdodCk7CgogICAgICAgICAgfSk7IC8vIHJldHVybjsKCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHJGdW4ocmVmZXJlbmNlLCBwb3BwZXIpOwogICAgICAgICAgfSwgMik7CgogICAgICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5KSB7CiAgICAgICAgICAgIC8vIHRoaXMub3BhY2l0eSA9IDE7CiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgIHRoaXMucG9wV2lkdGhIZWlnaHRGdW4ocmVmZXJlbmNlLCBwb3BwZXIpOwogICAgICAgICAgICB9LCA1KTsKICAgICAgICAgIH0KCiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5vcGFjaXR5ID0gMTsKICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgICB9LCAxMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub3BhY2l0eSA9IDA7CiAgICAgICAgICAvKiBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICB0aGlzLmRpc3BsYXlTdGF0dXMgPSAnbm9uZSc7CiAgICAgICAgICAgLy8gY29uc29sZS5sb2codmFsLCdkaXNwbGF5Om5vbmUnKTsKICAgICAgICAgICB9LCAzMDApOyovCiAgICAgICAgfQogICAgICB9CgogICAgfQogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncG9wc3RhdGUnLCB0aGlzLnBvcHN0YXRlLCBmYWxzZSk7CiAgfSwKCiAgbW91bnRlZCgpIHsKICAgIHZhciBfdGFyZ2V0OwoKICAgIC8vIGNvbnNvbGUubG9nKCdtb3VudGVkJyk7CiAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgIGxldCByZWZlcmVuY2UgPSB0aGlzLmdldFJlZmVyZW5jZSgpOwogICAgbGV0IHRhcmdldCA9IHRoaXMuZ2V0U2Nyb2xsUGFyZW50KHJlZmVyZW5jZSk7IC8vIGNvbnNvbGUubG9nKHJlZmVyZW5jZSwgcG9wcGVyLCAnPT09PSBtb3VudGVkJyk7CiAgICAvLyBjb25zb2xlLmxvZyh0YXJnZXQsIHRhcmdldD8udGFnTmFtZSwgdGhpcy4kc2xvdHMsICc9PT09IG1vdW50ZWQnKTsKCiAgICB0aGlzLnRhZ05hbWUgPSAoKF90YXJnZXQgPSB0YXJnZXQpID09PSBudWxsIHx8IF90YXJnZXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90YXJnZXQudGFnTmFtZSkgfHwgJyc7CiAgICB0aGlzLnRhcmdldCA9IHRhcmdldCB8fCBudWxsOwoKICAgIGlmICh0aGlzLnRhZ05hbWUgPT09ICdIVE1MJykgewogICAgICB0YXJnZXQgPSB3aW5kb3c7IC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKS5jbGFzc0xpc3QuYWRkKCJwb3NBIik7CiAgICB9IC8vIGNvbnNvbGUubG9nKHRhcmdldCwgdGhpcy50YXJnZXQsICc9PT09IG1vdW50ZWQyMicpOwogICAgLy8g5Y+v6K6/6Zeu5oCnCgoKICAgIGlmIChyZWZlcmVuY2UpIHsKICAgICAgLy8gcmVmZXJlbmNlLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCB0aGlzLnRhYmluZGV4KTsgLy8gdGFi5bqP5YiXCiAgICAgIHRoaXMucG9zaXRpb25GdW4ocmVmZXJlbmNlLCBwb3BwZXIpOwoKICAgICAgaWYgKHRoaXMudHJpZ2dlciAhPT0gJ2NsaWNrJykgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlZmVyZW5jZSwgJ+a1i+ivlTAwMDAnKTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2ZvY3VzaW4nLCAoKSA9PiB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMjIyMjIyMjIyJyk7CiAgICAgICAgICB0aGlzLmhhbmRsZUZvY3VzKCk7CiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHJlZmVyZW5jZS5fX3Z1ZV9fOwoKICAgICAgICAgIGlmIChpbnN0YW5jZSAmJiB0eXBlb2YgaW5zdGFuY2UuZm9jdXMgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgaW5zdGFuY2UuZm9jdXMoKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLm9uKHBvcHBlciwgJ2ZvY3VzaW4nLCB0aGlzLmhhbmRsZUZvY3VzKTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2ZvY3Vzb3V0JywgdGhpcy5oYW5kbGVCbHVyKTsKICAgICAgICB0aGlzLm9uKHBvcHBlciwgJ2ZvY3Vzb3V0JywgdGhpcy5oYW5kbGVCbHVyKTsgLy8gY29uc29sZS5sb2coJ+a1i+ivlTExMTEnKTsKICAgICAgfQoKICAgICAgdGhpcy5vbihyZWZlcmVuY2UsICdrZXlkb3duJywgdGhpcy5oYW5kbGVLZXlkb3duKTsKICAgICAgdGhpcy5vbihyZWZlcmVuY2UsICdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spOwogICAgfQoKICAgIHRoaXMub24odGFyZ2V0LCAnc2Nyb2xsJywgKCkgPT4gdGhpcy5oYW5kbGVTY3JvbGwocmVmZXJlbmNlLCBwb3BwZXIpKTsKCiAgICBpZiAodGhpcy50cmlnZ2VyID09PSAnY2xpY2snKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCcxMTExJyk7CiAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnY2xpY2snLCB0aGlzLmRvVG9nZ2xlKTsgLy8gY29uc29sZS5sb2coMjIyMixkb2N1bWVudCx0aGlzKTsKCiAgICAgIHRoaXMub24oZG9jdW1lbnQsICdjbGljaycsIHRoaXMuaGFuZGxlRG9jdW1lbnRDbGljayk7IC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVtb3ZlUG9wKHRoaXMpLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKHRoaXMudHJpZ2dlciA9PT0gJ2hvdmVyJykgewogICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgICB0aGlzLm9uKHBvcHBlciwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNlbGVhdmUnLCB0aGlzLmhhbmRsZU1vdXNlTGVhdmUpOwogICAgICB0aGlzLm9uKHBvcHBlciwgJ21vdXNlbGVhdmUnLCB0aGlzLmhhbmRsZU1vdXNlTGVhdmUpOwogICAgfSBlbHNlIGlmICh0aGlzLnRyaWdnZXIgPT09ICdmb2N1cycpIHsKICAgICAgaWYgKHJlZmVyZW5jZS5xdWVyeVNlbGVjdG9yKCdpbnB1dCwgdGV4dGFyZWEnKSkgewogICAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnZm9jdXNpbicsIHRoaXMuZG9TaG93KTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2ZvY3Vzb3V0JywgdGhpcy5kb0Nsb3NlKTsgLy8gY29uc29sZS5sb2coJ2lucHV0LCB0ZXh0YXJlYScpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCcxMTExMTEnKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNlZG93bicsIHRoaXMuZG9TaG93KTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNldXAnLCB0aGlzLmRvQ2xvc2UpOyAvLyBjb25zb2xlLmxvZygnMjIyMjIyJyk7CiAgICAgIH0KICAgIH0KICB9LAoKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5jbGVhbnVwKCk7CiAgICByZW1vdmVQb3AodGhpcyk7CiAgICBsZXQgcmVmZXJlbmNlID0gdGhpcy5nZXRSZWZlcmVuY2UoKTsgLy8gY29uc29sZS5sb2cocmVmZXJlbmNlLCdyZWZlcmVuY2UnKTsKCiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdjbGljaycsIHRoaXMuZG9Ub2dnbGUpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2V1cCcsIHRoaXMuZG9DbG9zZSk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdtb3VzZWRvd24nLCB0aGlzLmRvU2hvdyk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdmb2N1c2luJywgdGhpcy5kb1Nob3cpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnZm9jdXNvdXQnLCB0aGlzLmRvQ2xvc2UpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2Vkb3duJywgdGhpcy5kb1Nob3cpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2V1cCcsIHRoaXMuZG9DbG9zZSk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdtb3VzZWxlYXZlJywgdGhpcy5oYW5kbGVNb3VzZUxlYXZlKTsKICAgIHRoaXMub2ZmKHJlZmVyZW5jZSwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgdGhpcy5vZmYoZG9jdW1lbnQsICdjbGljaycsIHRoaXMuaGFuZGxlRG9jdW1lbnRDbGljayk7IC8vIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVtb3ZlUG9wKHRoaXMpLCBmYWxzZSk7CgogICAgdGhpcy5vZmYod2luZG93LCAnc2Nyb2xsJywgdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIC8vIOiOt+WPlnJlZmVyZW5jZQogICAgZ2V0UmVmZXJlbmNlKCkgewogICAgICBsZXQgcmVmZXJlbmNlID0gdGhpcy5yZWZlcmVuY2UgfHwgdGhpcy4kcmVmcy5yZWZlcmVuY2U7CgogICAgICBpZiAoIXJlZmVyZW5jZSAmJiB0aGlzLiRzbG90cy5kZWZhdWx0ICYmIHRoaXMuJHNsb3RzLmRlZmF1bHRbMF0pIHsKICAgICAgICAvLyByZWZlcmVuY2UgPSB0aGlzLiRzbG90cy5kZWZhdWx0WzBdLmVsbTsKICAgICAgICBmb3IgKGxldCBpIGluIHRoaXMuJHNsb3RzLmRlZmF1bHQpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuJHNsb3RzLmRlZmF1bHRbaV0uZWxtIGluc3RhbmNlb2YgRWxlbWVudCwgJ3Nzc3MnLGkpOwogICAgICAgICAgaWYgKHRoaXMuJHNsb3RzLmRlZmF1bHRbaV0uZWxtIGluc3RhbmNlb2YgRWxlbWVudCkgewogICAgICAgICAgICByZWZlcmVuY2UgPSB0aGlzLiRzbG90cy5kZWZhdWx0W2ldLmVsbTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gcmVmZXJlbmNlOwogICAgfSwKCiAgICBwb3BzdGF0ZSgpIHsKICAgICAgLy8gdGhpcy5zaG93UG9wcGVyPWZhbHNlOwogICAgICBsZXQgZWxzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGotcG9wb3Zlci1wb3NGJyk7IC8vIGNvbnNvbGUubG9nKGVscywnZWxzJyk7CgogICAgICBpZiAoZWxzKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGVsc1tpXS5wYXJlbnROb2RlLCfniLbnuqcnKTsKICAgICAgICAgIGlmIChlbHNbaV0ucGFyZW50Tm9kZS50YWdOYW1lID09PSAnQk9EWScpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ2JvZHnniLbnuqcnKTsKICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChlbHNbaV0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICAvLyDojrflj5bmn5DlhYPntKDku6XmtY/op4jlmajlt6bkuIrop5LkuLrljp/ngrnnmoTlnZDmoIcKICAgIGdldFBvaW50KGVsKSB7CiAgICAgIGxldCBvZmZzZXRUb3AgPSAwOwogICAgICBsZXQgb2Zmc2V0TGVmdCA9IDA7CgogICAgICB3aGlsZSAoZWwgJiYgZWwudGFnTmFtZSAhPT0gJ0JPRFknKSB7CiAgICAgICAgb2Zmc2V0VG9wICs9IGVsLm9mZnNldFRvcDsKICAgICAgICBvZmZzZXRMZWZ0ICs9IGVsLm9mZnNldExlZnQ7CiAgICAgICAgZWwgPSBlbC5vZmZzZXRQYXJlbnQ7CiAgICAgIH0KCiAgICAgIGxldCBvZmZzZXRPYmogPSB7CiAgICAgICAgb2Zmc2V0VG9wOiBvZmZzZXRUb3AsCiAgICAgICAgb2Zmc2V0TGVmdDogb2Zmc2V0TGVmdAogICAgICB9OyAvLyBjb25zb2xlLmxvZyhvZmZzZXRPYmosICdnZXRQb2ludCcpOwoKICAgICAgcmV0dXJuIG9mZnNldE9iajsKICAgIH0sCgogICAgLy8g55So5LqO6I635Y+W5p+Q5Liq5YWD57Sg55u45a+55LqOcGFyZW5055qE5L2N572u6ZuG5ZCICiAgICBnZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0N1c3RvbVBhcmVudChlbGVtZW50LCBwYXJlbnQsIGZpeGVkKSB7CiAgICAgIHZhciBlbGVtZW50UmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihlbGVtZW50KTsKICAgICAgdmFyIHBhcmVudFJlY3QgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocGFyZW50KTsKCiAgICAgIGlmIChmaXhlZCkgewogICAgICAgIHZhciBzY3JvbGxQYXJlbnQgPSB0aGlzLmdldFNjcm9sbFBhcmVudChwYXJlbnQpOwogICAgICAgIHBhcmVudFJlY3QudG9wICs9IHNjcm9sbFBhcmVudC5zY3JvbGxUb3A7CiAgICAgICAgcGFyZW50UmVjdC5ib3R0b20gKz0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcDsKICAgICAgICBwYXJlbnRSZWN0LmxlZnQgKz0gc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQ7CiAgICAgICAgcGFyZW50UmVjdC5yaWdodCArPSBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdDsKICAgICAgfQoKICAgICAgdmFyIHJlY3QgPSB7CiAgICAgICAgdG9wOiBlbGVtZW50UmVjdC50b3AgLSBwYXJlbnRSZWN0LnRvcCwKICAgICAgICBsZWZ0OiBlbGVtZW50UmVjdC5sZWZ0IC0gcGFyZW50UmVjdC5sZWZ0LAogICAgICAgIGJvdHRvbTogZWxlbWVudFJlY3QudG9wIC0gcGFyZW50UmVjdC50b3AgKyBlbGVtZW50UmVjdC5oZWlnaHQsCiAgICAgICAgcmlnaHQ6IGVsZW1lbnRSZWN0LmxlZnQgLSBwYXJlbnRSZWN0LmxlZnQgKyBlbGVtZW50UmVjdC53aWR0aCwKICAgICAgICB3aWR0aDogZWxlbWVudFJlY3Qud2lkdGgsCiAgICAgICAgaGVpZ2h0OiBlbGVtZW50UmVjdC5oZWlnaHQKICAgICAgfTsgLy8gY29uc29sZS5sb2cocmVjdCwgZWxlbWVudFJlY3QsIHBhcmVudFJlY3QsICdnZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0N1c3RvbVBhcmVudCcpOwoKICAgICAgcmV0dXJuIHJlY3Q7CiAgICB9LAoKICAgIC8vIOiOt+WPlua7muWKqOeItue6pwogICAgZ2V0U2Nyb2xsUGFyZW50KGVsZW1lbnQpIHsKICAgICAgdmFyIHJvb3QgPSB3aW5kb3c7CiAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQucGFyZW50Tm9kZTsgLy8gY29uc29sZS5sb2coZWxlbWVudCwgcGFyZW50LCAnZ2V0U2Nyb2xsUGFyZW50Jyk7CgogICAgICBpZiAoIXBhcmVudCkgewogICAgICAgIHJldHVybiBlbGVtZW50OwogICAgICB9CgogICAgICBpZiAocGFyZW50ID09PSByb290LmRvY3VtZW50KSB7CiAgICAgICAgLy8gRmlyZWZveCBwdXRzIHRoZSBzY3JvbGxUT3AgdmFsdWUgb24gYGRvY3VtZW50RWxlbWVudGAgaW5zdGVhZCBvZiBgYm9keWAsIHdlIHRoZW4gY2hlY2sgd2hpY2ggb2YgdGhlbSBpcwogICAgICAgIC8vIGdyZWF0ZXIgdGhhbiAwIGFuZCByZXR1cm4gdGhlIHByb3BlciBlbGVtZW50CiAgICAgICAgaWYgKHJvb3QuZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgcm9vdC5kb2N1bWVudC5ib2R5LnNjcm9sbExlZnQpIHsKICAgICAgICAgIHJldHVybiByb290LmRvY3VtZW50LmJvZHk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gcm9vdC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICAgIH0gLy8gRmlyZWZveCB3YW50IHVzIHRvIGNoZWNrIGAteGAgYW5kIGAteWAgdmFyaWF0aW9ucyBhcyB3ZWxsCgoKICAgICAgaWYgKFsnc2Nyb2xsJywgJ2F1dG8nXS5pbmRleE9mKHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KHBhcmVudCwgJ292ZXJmbG93JykpICE9PSAtMSB8fCBbJ3Njcm9sbCcsICdhdXRvJ10uaW5kZXhPZih0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eShwYXJlbnQsICdvdmVyZmxvdy14JykpICE9PSAtMSB8fCBbJ3Njcm9sbCcsICdhdXRvJ10uaW5kZXhPZih0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eShwYXJlbnQsICdvdmVyZmxvdy15JykpICE9PSAtMSkgewogICAgICAgIC8vIElmIHRoZSBkZXRlY3RlZCBzY3JvbGxQYXJlbnQgaXMgYm9keSwgd2UgcGVyZm9ybSBhbiBhZGRpdGlvbmFsIGNoZWNrIG9uIGl0cyBwYXJlbnROb2RlCiAgICAgICAgLy8gaW4gdGhpcyB3YXkgd2UnbGwgZ2V0IGJvZHkgaWYgdGhlIGJyb3dzZXIgaXMgQ2hyb21lLWlzaCwgb3IgZG9jdW1lbnRFbGVtZW50IG90aGVyd2lzZQogICAgICAgIC8vIGZpeGVzIGlzc3VlICM2NQogICAgICAgIC8vIGNvbnNvbGUubG9nKCBwYXJlbnQ/LmNsYXNzTmFtZSwncGFyZW50IGNsYXNzTmFtZScpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCBwYXJlbnQ/LmNsYXNzTGlzdCwncGFyZW50IGNsYXNzTGlzdCcpOwogICAgICAgIGxldCBjbGFzc05hbWUgPSBwYXJlbnQgPT09IG51bGwgfHwgcGFyZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwYXJlbnQuZ2V0QXR0cmlidXRlKCdjbGFzcycpOwoKICAgICAgICBpZiAoKGNsYXNzTmFtZSA9PT0gbnVsbCB8fCBjbGFzc05hbWUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGNsYXNzTmFtZS5pbmRleE9mKCdkai10YWJsZS1wYW5lbCcpKSA+IC0xIHx8IChjbGFzc05hbWUgPT09IG51bGwgfHwgY2xhc3NOYW1lID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjbGFzc05hbWUuaW5kZXhPZignZGotbW9kYWwtY29udGVudCcpKSA+IC0xKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnPT09PT0nKTsKICAgICAgICAgIHJldHVybiB0aGlzLmdldFNjcm9sbFBhcmVudChwYXJlbnQpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMubm90UGFyZW50Q2xhc3MgJiYgKHBhcmVudCA9PT0gbnVsbCB8fCBwYXJlbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHBhcmVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJykpID09PSB0aGlzLm5vdFBhcmVudENsYXNzKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnPT09PT0nKTsKICAgICAgICAgIHJldHVybiB0aGlzLmdldFNjcm9sbFBhcmVudChwYXJlbnQpOwogICAgICAgIH0gLy8gY29uc29sZS5sb2cocGFyZW50LCAncGFyZW50MjIyJyk7CgoKICAgICAgICByZXR1cm4gcGFyZW50OwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxQYXJlbnQoZWxlbWVudCA9PT0gbnVsbCB8fCBlbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbGVtZW50LnBhcmVudE5vZGUpOwogICAgfSwKCiAgICAvLyDojrflj5bot53nprvor6XlrZDlhYPntKDmnIDov5HnmoTov5vooYzov4flrprkvY3nmoTniLblhYPntKAKICAgIGdldE9mZnNldFBhcmVudChlbGVtZW50KSB7CiAgICAgIHZhciBfcm9vdCRkb2N1bWVudCwgX3Jvb3QkZG9jdW1lbnQyOwoKICAgICAgLy8gTk9URTogMSBET00gYWNjZXNzIGhlcmUKICAgICAgdmFyIHJvb3QgPSB3aW5kb3c7CiAgICAgIHZhciBvZmZzZXRQYXJlbnQgPSBlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQub2Zmc2V0UGFyZW50OyAvLyBjb25zb2xlLmxvZyhlbGVtZW50LCBvZmZzZXRQYXJlbnQsIG9mZnNldFBhcmVudCA9PT0gcm9vdC5kb2N1bWVudC5ib2R5IHx8ICFvZmZzZXRQYXJlbnQgPyByb290LmRvY3VtZW50LmRvY3VtZW50RWxlbWVudCA6IG9mZnNldFBhcmVudCwgJ2dldE9mZnNldFBhcmVudCcpOwoKICAgICAgcmV0dXJuIG9mZnNldFBhcmVudCA9PT0gKHJvb3QgPT09IG51bGwgfHwgcm9vdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9yb290JGRvY3VtZW50ID0gcm9vdC5kb2N1bWVudCkgPT09IG51bGwgfHwgX3Jvb3QkZG9jdW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yb290JGRvY3VtZW50LmJvZHkpIHx8ICFvZmZzZXRQYXJlbnQgPyByb290ID09PSBudWxsIHx8IHJvb3QgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfcm9vdCRkb2N1bWVudDIgPSByb290LmRvY3VtZW50KSA9PT0gbnVsbCB8fCBfcm9vdCRkb2N1bWVudDIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9yb290JGRvY3VtZW50Mi5kb2N1bWVudEVsZW1lbnQgOiBvZmZzZXRQYXJlbnQ7CiAgICB9LAoKICAgIC8vIOiOt+WPluWFg+e0oOacgOe7iOagt+W8j++8jOWMheaLrOS6huWGheiBlOagt+W8j+OAgeW1jOWFpeagt+W8j+WSjOWklumDqOagt+W8jwogICAgZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGVsZW1lbnQsIHByb3BlcnR5KSB7CiAgICAgIC8vIE5PVEU6IDEgRE9NIGFjY2VzcyBoZXJlCiAgICAgIHZhciByb290ID0gd2luZG93OwogICAgICB2YXIgY3NzID0gcm9vdC5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQsIG51bGwpOwogICAgICByZXR1cm4gY3NzW3Byb3BlcnR5XTsKICAgIH0sCgogICAgLy8g55So5LqO6I635Y+W5p+Q5Liq5YWD57Sg55u45a+55LqO6KeG56qX55qE5L2N572u6ZuG5ZCICiAgICBnZXRCb3VuZGluZ0NsaWVudFJlY3QyKGVsZW1lbnQpIHsKICAgICAgbGV0IHJlY3QgPSBlbGVtZW50ID09PSBudWxsIHx8IGVsZW1lbnQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7IC8vIGNvbnNvbGUubG9nKGVsZW1lbnQsIHJlY3QsICdyZWN0Jyk7CiAgICAgIC8vIHdoZXRoZXIgdGhlIElFIHZlcnNpb24gaXMgbG93ZXIgdGhhbiAxMQoKICAgICAgbGV0IGlzSUUgPSBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ01TSUUnKSAhPSAtMTsgLy8gZml4IGllIGRvY3VtZW50IGJvdW5kaW5nIHRvcCBhbHdheXMgMCBidWcKCiAgICAgIGxldCByZWN0VG9wID0gaXNJRSAmJiAoZWxlbWVudCA9PT0gbnVsbCB8fCBlbGVtZW50ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlbGVtZW50LnRhZ05hbWUpID09PSAnSFRNTCcgPyAtKGVsZW1lbnQgPT09IG51bGwgfHwgZWxlbWVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogZWxlbWVudC5zY3JvbGxUb3ApIDogcmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LnRvcDsKICAgICAgbGV0IHBhcmFtID0gewogICAgICAgIGxlZnQ6IHJlY3QgPT09IG51bGwgfHwgcmVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVjdC5sZWZ0LAogICAgICAgIHRvcDogcmVjdFRvcCwKICAgICAgICByaWdodDogcmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LnJpZ2h0LAogICAgICAgIGJvdHRvbTogcmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LmJvdHRvbSwKICAgICAgICB3aWR0aDogKHJlY3QgPT09IG51bGwgfHwgcmVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVjdC5yaWdodCkgLSAocmVjdCA9PT0gbnVsbCB8fCByZWN0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiByZWN0LmxlZnQpLAogICAgICAgIGhlaWdodDogKHJlY3QgPT09IG51bGwgfHwgcmVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVjdC5ib3R0b20pIC0gcmVjdFRvcAogICAgICB9OyAvLyBjb25zb2xlLmxvZyhwYXJhbSwgJ2dldEJvdW5kaW5nQ2xpZW50UmVjdDInKTsKICAgICAgLy8gY29uc29sZS5sb2coZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0LCAnZ2V0Qm91bmRpbmdDbGllbnRSZWN0Jyk7CgogICAgICByZXR1cm4gcGFyYW07CiAgICB9LAoKICAgIC8vIOiOt+WPlnRpdGxl5a696auYCiAgICBnZXRUaXRsZVN0eWxlKCkgewogICAgICBsZXQgZG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLXRpdGxlJyk7CgogICAgICBpZiAoZG9tKSB7CiAgICAgICAgbGV0IGRpdk9mZnNldFdpZHRoID0gZG9tLm9mZnNldFdpZHRoOyAvLyDlhYPntKDnmoTlrr3luqbljIXlkKtwYWRkaW5n5ZKMYm9yZGVyCgogICAgICAgIGxldCBkaXZPZmZzZXRIZWlnaHQgPSBkb20ub2Zmc2V0SGVpZ2h0OyAvLyDlhYPntKDnmoTlrr3luqbljIXlkKtwYWRkaW5n5ZKMYm9yZGVyCiAgICAgICAgLy8gY29uc29sZS5sb2coZGl2T2Zmc2V0V2lkdGgsIGRpdk9mZnNldEhlaWdodCwgJ2dldFRpdGxlU3R5bGUnKTsKCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHdpZHRoOiBkaXZPZmZzZXRXaWR0aCwKICAgICAgICAgIGhlaWdodDogZGl2T2Zmc2V0SGVpZ2h0CiAgICAgICAgfTsKICAgICAgfQogICAgfSwKCiAgICAvLyDojrflj5Zwb3DmnIDlpKfmnIDlsI/lrr3luqYKICAgIHBvcFdpZHRoSGVpZ2h0RnVuKHJlZmVyZW5jZSwgcG9wcGVyKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdwb3BXaWR0aEhlaWdodEZ1bicpOwogICAgICBsZXQgb2Zmc2V0T2JqMiA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihyZWZlcmVuY2UpOwoKICAgICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gJ0hUTUwnKSB7CiAgICAgICAgb2Zmc2V0T2JqMiA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihyZWZlcmVuY2UpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIG9mZnNldE9iajIgPSBnZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0N1c3RvbVBhcmVudChyZWZlcmVuY2UsIGdldE9mZnNldFBhcmVudChwb3BwZXIpLCBmYWxzZSk7CiAgICAgICAgb2Zmc2V0T2JqMiA9IHRoaXMuZ2V0T2Zmc2V0UmVjdFJlbGF0aXZlVG9DdXN0b21QYXJlbnQocmVmZXJlbmNlLCB0aGlzLnRhcmdldCwgZmFsc2UpOwogICAgICB9CgogICAgICBsZXQgbWF4V2lkdGgsIG1heEhlaWdodDsKCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJykgewogICAgICAgIG1heFdpZHRoID0gb2Zmc2V0T2JqMi5sZWZ0IC0gMTA7CiAgICAgICAgbWF4SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIDEwOwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodEJvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodFRvcCcpIHsKICAgICAgICBtYXhXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIG9mZnNldE9iajIucmlnaHQgLSAxMDsKICAgICAgICBtYXhIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gMTA7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgIG1heFdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gMTA7CiAgICAgICAgbWF4SGVpZ2h0ID0gb2Zmc2V0T2JqMi50b3AgLSAxNTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbUxlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgbWF4V2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSAxMDsKICAgICAgICBtYXhIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gb2Zmc2V0T2JqMi5ib3R0b20gLSAxMDsKICAgICAgfQoKICAgICAgdGhpcy5wb3BXSFN0eWxlID0gewogICAgICAgIG1heFdpZHRoOiBtYXhXaWR0aCwKICAgICAgICBtYXhIZWlnaHQ6IG1heEhlaWdodAogICAgICB9OwogICAgfSwKCiAgICAvLyDojrflj5Zwb3AgY29udGVudOW6lOivpeWHj+eahOWAvAogICAgZ2V0Q29udGVudENoYSgpIHsKICAgICAgdmFyIF90aGlzJGdldFN0eWxlQ29tcHV0ZSwgX3RoaXMkZ2V0U3R5bGVDb21wdXRlMiwgX3RoaXMkZ2V0U3R5bGVDb21wdXRlMywgX2RvY3VtZW50JGdldEVsZW1lbnRCLCBfdGhpcyRnZXRTdHlsZUNvbXB1dGU0LCBfZG9jdW1lbnQkZ2V0RWxlbWVudEIyLCBfdGhpcyRnZXRTdHlsZUNvbXB1dGU1LCBfZG9jdW1lbnQkZ2V0RWxlbWVudEIzLCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI0LCBfdGhpcyRnZXRTdHlsZUNvbXB1dGU2LCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI1LCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI2OwoKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5nZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKS5wYXJlbnROb2RlLnBhcmVudE5vZGUsJ2JvcmRlci1ib3R0b20td2lkdGgnKSwnLS0tJyk7CiAgICAgIGxldCBQVCA9ICgoX3RoaXMkZ2V0U3R5bGVDb21wdXRlID0gdGhpcy5nZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpLCAncGFkZGluZy10b3AnKSkgPT09IG51bGwgfHwgX3RoaXMkZ2V0U3R5bGVDb21wdXRlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfdGhpcyRnZXRTdHlsZUNvbXB1dGUuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBQQiA9ICgoX3RoaXMkZ2V0U3R5bGVDb21wdXRlMiA9IHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKSwgJ3BhZGRpbmctYm90dG9tJykpID09PSBudWxsIHx8IF90aGlzJGdldFN0eWxlQ29tcHV0ZTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGdldFN0eWxlQ29tcHV0ZTIuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBjb250ZW50UFQgPSAoKF90aGlzJGdldFN0eWxlQ29tcHV0ZTMgPSB0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eSgoX2RvY3VtZW50JGdldEVsZW1lbnRCID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKSkgPT09IG51bGwgfHwgX2RvY3VtZW50JGdldEVsZW1lbnRCID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZG9jdW1lbnQkZ2V0RWxlbWVudEIucGFyZW50Tm9kZSwgJ3BhZGRpbmctdG9wJykpID09PSBudWxsIHx8IF90aGlzJGdldFN0eWxlQ29tcHV0ZTMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGdldFN0eWxlQ29tcHV0ZTMuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBjb250ZW50UEIgPSAoKF90aGlzJGdldFN0eWxlQ29tcHV0ZTQgPSB0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eSgoX2RvY3VtZW50JGdldEVsZW1lbnRCMiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50JykpID09PSBudWxsIHx8IF9kb2N1bWVudCRnZXRFbGVtZW50QjIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9kb2N1bWVudCRnZXRFbGVtZW50QjIucGFyZW50Tm9kZSwgJ3BhZGRpbmctYm90dG9tJykpID09PSBudWxsIHx8IF90aGlzJGdldFN0eWxlQ29tcHV0ZTQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGdldFN0eWxlQ29tcHV0ZTQuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBiYncgPSAoKF90aGlzJGdldFN0eWxlQ29tcHV0ZTUgPSB0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eSgoX2RvY3VtZW50JGdldEVsZW1lbnRCMyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50JykpID09PSBudWxsIHx8IF9kb2N1bWVudCRnZXRFbGVtZW50QjMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZG9jdW1lbnQkZ2V0RWxlbWVudEI0ID0gX2RvY3VtZW50JGdldEVsZW1lbnRCMy5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZG9jdW1lbnQkZ2V0RWxlbWVudEI0LnBhcmVudE5vZGUsICdib3JkZXItYm90dG9tLXdpZHRoJykpID09PSBudWxsIHx8IF90aGlzJGdldFN0eWxlQ29tcHV0ZTUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGdldFN0eWxlQ29tcHV0ZTUuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBidHcgPSAoKF90aGlzJGdldFN0eWxlQ29tcHV0ZTYgPSB0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eSgoX2RvY3VtZW50JGdldEVsZW1lbnRCNSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50JykpID09PSBudWxsIHx8IF9kb2N1bWVudCRnZXRFbGVtZW50QjUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IChfZG9jdW1lbnQkZ2V0RWxlbWVudEI2ID0gX2RvY3VtZW50JGdldEVsZW1lbnRCNS5wYXJlbnROb2RlKSA9PT0gbnVsbCB8fCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI2ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZG9jdW1lbnQkZ2V0RWxlbWVudEI2LnBhcmVudE5vZGUsICdib3JkZXItdG9wLXdpZHRoJykpID09PSBudWxsIHx8IF90aGlzJGdldFN0eWxlQ29tcHV0ZTYgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJGdldFN0eWxlQ29tcHV0ZTYuc3BsaXQoJ3B4JylbMF0pIHx8IDA7CiAgICAgIGxldCBjb250ZW50Q2hhID0gTnVtYmVyKFBUKSArIE51bWJlcihQQikgKyBOdW1iZXIoY29udGVudFBUKSArIE51bWJlcihjb250ZW50UEIpICsgTnVtYmVyKGJidykgKyBOdW1iZXIoYnR3KTsgLy8gY29uc29sZS5sb2coUFQsUEIsY29udGVudENoYSwgJ2NvbnRlbnRDaGEnKTsKCiAgICAgIHJldHVybiBjb250ZW50Q2hhOwogICAgfSwKCiAgICAvLyDlrprkvY0KICAgIHBvc2l0aW9uRnVuKHJlZmVyZW5jZSwgcG9wcGVyLCBzY3JvbGxUb3AsIHNjcm9sbExlZnQpIHsKICAgICAgaWYgKCFyZWZlcmVuY2UgfHwgIXBvcHBlcikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5ICYmIHRoaXMudGFnTmFtZSAhPT0gJ0hUTUwnKSB7CiAgICAgICAgdmFyIF9kb2N1bWVudCRnZXRFbGVtZW50QjcsIF9kb2N1bWVudCRnZXRFbGVtZW50Qjg7CgogICAgICAgIC8vIGNvbnNvbGUubG9nKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKSwgJ2NsYXNzTGlzdCcpOwogICAgICAgIChfZG9jdW1lbnQkZ2V0RWxlbWVudEI3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpKSA9PT0gbnVsbCB8fCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI3ID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2RvY3VtZW50JGdldEVsZW1lbnRCOCA9IF9kb2N1bWVudCRnZXRFbGVtZW50QjcuY2xhc3NMaXN0KSA9PT0gbnVsbCB8fCBfZG9jdW1lbnQkZ2V0RWxlbWVudEI4ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZG9jdW1lbnQkZ2V0RWxlbWVudEI4LmFkZCgncG9zQScpOwogICAgICB9CgogICAgICBsZXQgb2Zmc2V0T2JqID0gdGhpcy5nZXRQb2ludChyZWZlcmVuY2UpOwogICAgICBsZXQgb2Zmc2V0T2JqMyA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihyZWZlcmVuY2UpOwogICAgICBsZXQgb2Zmc2V0T2JqMjsKCiAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09ICdIVE1MJykgewogICAgICAgIG9mZnNldE9iajIgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocmVmZXJlbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvZmZzZXRPYmoyID0gdGhpcy5nZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0N1c3RvbVBhcmVudChyZWZlcmVuY2UsIHRoaXMuZ2V0T2Zmc2V0UGFyZW50KHBvcHBlciksIGZhbHNlKTsKICAgICAgfSAvLyBjb25zb2xlLmxvZyhvZmZzZXRPYmozLCAnb2Zmc2V0T2JqMycpOwogICAgICAvLyBjb25zb2xlLmxvZyhvZmZzZXRPYmoyLCAnb2Zmc2V0T2JqMicpOwoKCiAgICAgIGxldCByZWZlcmVuY2VPZmZzZXRMZWZ0ID0gdGhpcy5hcHBlbmRUb0JvZHkgPyBvZmZzZXRPYmoyLmxlZnQgOiByZWZlcmVuY2Uub2Zmc2V0TGVmdDsKICAgICAgbGV0IHJlZmVyZW5jZU9mZnNldFRvcCA9IHRoaXMuYXBwZW5kVG9Cb2R5ID8gb2Zmc2V0T2JqMi50b3AgOiByZWZlcmVuY2Uub2Zmc2V0VG9wOyAvLyBjb25zb2xlLmxvZyhgXG4gcmVmZXJlbmNlOiBvZmZzZXRMZWZ077yab2Zmc2V0TGVmdO+8miR7cmVmZXJlbmNlLm9mZnNldExlZnR9LCR7b2Zmc2V0T2JqLm9mZnNldExlZnR9LCAgb2Zmc2V0T2JqMi5sZWZ077yaJHtvZmZzZXRPYmoyLmxlZnR9YCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGBcbiByZWZlcmVuY2U6IG9mZnNldFRvcO+8mm9mZnNldFRvcO+8miR7cmVmZXJlbmNlLm9mZnNldFRvcH0sJHtvZmZzZXRPYmoub2Zmc2V0VG9wfSwgIG9mZnNldE9iajIudG9w77yaJHtvZmZzZXRPYmoyLnRvcH1gKTsKICAgICAgLy8gY29uc29sZS5sb2cocmVmZXJlbmNlT2Zmc2V0VG9wLCByZWZlcmVuY2VPZmZzZXRMZWZ0LCAnPT09PT09PT09PT09PT09PT09PT09Jyk7CgogICAgICBsZXQgbGVmdCwgdG9wOyAvLyBjb25zb2xlLmxvZyh0aGlzLnBvcFdIU3R5bGUubWF4SGVpZ2h0LCB0aGlzLnBvcFdIU3R5bGUubWF4V2lkdGgsIHBvcHBlci5vZmZzZXRXaWR0aCwgJ3RoaXMucG9wV0hTdHlsZS5tYXhIZWlnaHQnKTsKCiAgICAgIGxldCBjb250ZW50Q2hhID0gdGhpcy5nZXRDb250ZW50Q2hhKCk7CiAgICAgIGxldCBoZWlnaHQxOwoKICAgICAgaWYgKHRoaXMudGl0bGUpIHsKICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodEJvdHRvbScpIHsKICAgICAgICAgIGhlaWdodDEgPSBOdW1iZXIodGhpcy5nZXRUaXRsZVN0eWxlKCkuaGVpZ2h0ICsgMjQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoZWlnaHQxID0gTnVtYmVyKHRoaXMuZ2V0VGl0bGVTdHlsZSgpLmhlaWdodCArIGNvbnRlbnRDaGEpOwogICAgICAgIH0gLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKS5zdHlsZS5tYXhIZWlnaHQgPSAnY2FsYygxMDB2aCAtICcgKyBoZWlnaHQxICsgJ3B4JzsKCiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVpZ2h0MSA9IGNvbnRlbnRDaGE7CiAgICAgIH0gLy8gaGVpZ2h0MSA9IDE1OwoKCiAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2x0aXBJZCArICctY29udGVudCcpKSB7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKS5zdHlsZS5tYXhIZWlnaHQgPSB0aGlzLnBvcFdIU3R5bGUubWF4SGVpZ2h0IC0gaGVpZ2h0MSA8IGNvbnRlbnRDaGEgPyBjb250ZW50Q2hhICsgJ3B4JyA6IHRoaXMucG9wV0hTdHlsZS5tYXhIZWlnaHQgLSBoZWlnaHQxICsgJ3B4JzsKICAgICAgfQoKICAgICAgbGV0IHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCA9IHBvcHBlci5vZmZzZXRXaWR0aDsKICAgICAgbGV0IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgPSBwb3BwZXIub2Zmc2V0SGVpZ2h0OwogICAgICBsZXQgd2lkdGhEaWZmZXJlbmNlID0gTWF0aC5hYnMocmVmZXJlbmNlLm9mZnNldFdpZHRoIC0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoKTsKICAgICAgbGV0IGhlaWdodERpZmZlcmVuY2UgPSBNYXRoLmFicyhyZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCk7IC8vIGNvbnNvbGUubG9nKGBwb3BwZXI6IG9mZnNldExlZnTvvJoke3BvcHBlci5vZmZzZXRMZWZ0fSAgb2Zmc2V0VG9w77yaJHtwb3BwZXIub2Zmc2V0VG9wfSAgb2Zmc2V0V2lkdGjvvJoke3BvcHBlci5vZmZzZXRXaWR0aH0scG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoOiAke3BvcHBlclJlYWxpdHlPZmZzZXRXaWR0aH0sICBvZmZzZXRIZWlnaHTvvJoke3BvcHBlci5vZmZzZXRIZWlnaHR9LCBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0OiR7cG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodH1gKTsKICAgICAgLy8gY29uc29sZS5sb2coYFxuIHJlZmVyZW5jZTogb2Zmc2V0TGVmdO+8miR7cmVmZXJlbmNlT2Zmc2V0TGVmdH0gIG9mZnNldFRvcO+8miR7cmVmZXJlbmNlT2Zmc2V0VG9wfSAgb2Zmc2V0V2lkdGjvvJoke3JlZmVyZW5jZS5vZmZzZXRXaWR0aH0gIG9mZnNldEhlaWdodO+8miR7cmVmZXJlbmNlLm9mZnNldEhlaWdodH1gKTsKCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcCAtIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQ7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21MZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcCArIHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQ7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b20nKSB7CiAgICAgICAgbGVmdCA9IHJlZmVyZW5jZU9mZnNldExlZnQgLSBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggLyAyICsgcmVmZXJlbmNlLm9mZnNldFdpZHRoIC8gMjsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wTGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgIGxlZnQgPSByZWZlcmVuY2VPZmZzZXRMZWZ0OwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BSaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICBpZiAocG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoID4gcmVmZXJlbmNlLm9mZnNldFdpZHRoKSB7CiAgICAgICAgICBsZWZ0ID0gcmVmZXJlbmNlT2Zmc2V0TGVmdCAtIHdpZHRoRGlmZmVyZW5jZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGVmdCA9IHJlZmVyZW5jZU9mZnNldExlZnQgKyB3aWR0aERpZmZlcmVuY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJykgewogICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcDsKICAgICAgfQoKICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdCcpIHsKICAgICAgICB0b3AgPSByZWZlcmVuY2VPZmZzZXRUb3AgLSBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0IC8gMiArIHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQgLyAyOwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodEJvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0Qm90dG9tJykgewogICAgICAgIGlmIChwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0ID4gcmVmZXJlbmNlLm9mZnNldEhlaWdodCkgewogICAgICAgICAgdG9wID0gcmVmZXJlbmNlT2Zmc2V0VG9wIC0gaGVpZ2h0RGlmZmVyZW5jZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdG9wID0gcmVmZXJlbmNlT2Zmc2V0VG9wICsgaGVpZ2h0RGlmZmVyZW5jZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0Qm90dG9tJykgewogICAgICAgIGxlZnQgPSByZWZlcmVuY2VPZmZzZXRMZWZ0ICsgcmVmZXJlbmNlLm9mZnNldFdpZHRoOwogICAgICB9CgogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScpIHsKICAgICAgICBsZWZ0ID0gcmVmZXJlbmNlT2Zmc2V0TGVmdCAtIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aDsKICAgICAgfSAvLyDliqjmgIHorqHnrpflrr3pq5jml7bvvIzlrr0v6auY55qE6ZyA6KaB5Yqg5LiK55qE5beu5YC8CgoKICAgICAgbGV0IGhlaWdodENoYUxSID0gMDsKICAgICAgbGV0IGxlZnRDaGFMUiA9IDA7CiAgICAgIGxldCB0b3AxLCBsZWZ0MTsKCiAgICAgIGlmICh0aGlzLnRhZ05hbWUgIT09ICdIVE1MJykgewogICAgICAgIHRvcDEgPSBvZmZzZXRPYmozLnRvcCAtIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgLyAyICsgcmVmZXJlbmNlLm9mZnNldEhlaWdodCAvIDI7IC8vIGxlZnQxID0gb2Zmc2V0T2JqMy5sZWZ0IC0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC8gMiArIHJlZmVyZW5jZS5vZmZzZXRXaWR0aCAvIDI7CgogICAgICAgIGxlZnQxID0gbGVmdDsKCiAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wTGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgICAgbGVmdDEgPSBsZWZ0IC0gNTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG9wMSA9IHRvcDsKICAgICAgICBsZWZ0MSA9IGxlZnQ7CiAgICAgIH0KCiAgICAgIGxldCB0b3BQb3MgPSB0aGlzLnRhZ05hbWUgPT09ICdIVE1MJyA/IHRvcCA6IHRvcDE7CiAgICAgIGxldCBsZWZ0UG9zID0gdGhpcy50YWdOYW1lID09PSAnSFRNTCcgPyBsZWZ0IDogbGVmdDE7CgogICAgICBpZiAodGhpcy5hcHBlbmRUb0JvZHkpIHsKICAgICAgICBpZiAodG9wUG9zICsgcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gNCkgewogICAgICAgICAgaGVpZ2h0Q2hhTFIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdG9wUG9zIC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCAtIDU7IC8vIGNvbnNvbGUubG9nKCdoZWlnaHRDaGFMUiAxMTEnKTsKICAgICAgICB9IGVsc2UgaWYgKHRvcFBvcyA8PSA0KSB7CiAgICAgICAgICBoZWlnaHRDaGFMUiA9IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgLyAyIC0gcmVmZXJlbmNlLm9mZnNldEhlaWdodCAvIDIgLSBvZmZzZXRPYmozLnRvcCArIDU7IC8vIGNvbnNvbGUubG9nKCdoZWlnaHRDaGFMUiAyMjInKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGVpZ2h0Q2hhTFIgPSAwOyAvLyBjb25zb2xlLmxvZygnaGVpZ2h0Q2hhTFIgMzMzJyk7CiAgICAgICAgfQoKICAgICAgICBpZiAobGVmdFBvcyArIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkgewogICAgICAgICAgbGVmdENoYUxSID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gbGVmdFBvcyAtIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCAtIDU7IC8vIGNvbnNvbGUubG9nKGxlZnRDaGFMUiwnbGVmdENoYUxSIDExJykKICAgICAgICB9IGVsc2UgaWYgKGxlZnRQb3MgPD0gMCkgewogICAgICAgICAgbGVmdENoYUxSID0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC8gMiAtIHJlZmVyZW5jZS5vZmZzZXRXaWR0aCAvIDIgLSBvZmZzZXRPYmozLmxlZnQgKyA1OwogICAgICAgICAgLyogIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMTExMS0tJykKICAgICAgICAgICBsZWZ0Q2hhTFIgPSAtIG9mZnNldE9iajMubGVmdCArIDUgLy8g5bem5L6ncG9w6KKr6YGu5oyh55qE6Led56a7KzUKICAgICAgICAgICB9Ki8KCiAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbUxlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wUmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCcxMTExLS0nKQogICAgICAgICAgICBsZWZ0Q2hhTFIgPSAtbGVmdFBvcyArIDU7IC8vIOW3puS+p3BvcOiiq+mBruaMoeeahOi3neemuys1CiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKG9mZnNldE9iajMubGVmdCxsZWZ0UG9zLGxlZnRDaGFMUiwnbGVmdENoYUxSIDIyJykKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxlZnRDaGFMUiA9IDA7IC8vIGNvbnNvbGUubG9nKGxlZnRDaGFMUixsZWZ0UG9zLCdsZWZ0Q2hhTFIgMzMnKQogICAgICAgIH0KICAgICAgfSAvLyBjb25zb2xlLmxvZyhoZWlnaHRDaGFMUiwgbGVmdENoYUxSLCAnaGVpZ2h0Q2hhTFIsbGVmdENoYUxSJyk7CgoKICAgICAgbGV0IG92ZXJGbG93SGVpZ2h0ID0gb2Zmc2V0T2JqMy50b3AgPj0gMTAgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gb2Zmc2V0T2JqMy50b3AgOiBvZmZzZXRPYmozLmJvdHRvbTsKICAgICAgbGV0IG92ZXJGbG93V2lkdGggPSBvZmZzZXRPYmozLmxlZnQgPj0gMTAgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSBvZmZzZXRPYmozLmxlZnQgOiBvZmZzZXRPYmozLnJpZ2h0OyAvLyBjb25zb2xlLmxvZygnZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCcsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsICdvZmZzZXRPYmoyLnRvcO+8micsIG9mZnNldE9iajIudG9wLCAnb3ZlckZsb3dIZWlnaHTvvJonLCBvdmVyRmxvd0hlaWdodCwgJ292ZXJGbG93V2lkdGjvvJonLCBvdmVyRmxvd1dpZHRoLCAncG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodO+8micsIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQsICdwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGjvvJonLCBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGgsICcwMDAnLCBvdmVyRmxvd0hlaWdodCA8IHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQpOwogICAgICAvLyByZWZlcmVuY2Xooqvpga7nm5bnmoTpq5jluqYKCiAgICAgIGxldCBoaWRlSGVpZ2h0ID0gb2Zmc2V0T2JqMy50b3AgPj0gMCA/IG9mZnNldE9iajMuYm90dG9tIC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA6IC1vZmZzZXRPYmozLnRvcDsKICAgICAgbGV0IGhpZGVXaWR0aCA9IG9mZnNldE9iajMubGVmdCA+PSAwID8gb2Zmc2V0T2JqMy5yaWdodCAtIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCA6IC1vZmZzZXRPYmozLmxlZnQ7IC8vIGNvbnNvbGUubG9nKGhpZGVIZWlnaHQsIGhpZGVXaWR0aCwgJ2hpZGVIZWlnaHQnKTsKICAgICAgLy8g5paH5qGj6aG26YOo5YiwcmVmZXJlbmNl5bqV6YOo55qE6Led56a7CgogICAgICBsZXQgc2Nyb2xsSGVpZ2h0VXAgPSBvZmZzZXRPYmoub2Zmc2V0VG9wICsgcmVmZXJlbmNlLm9mZnNldEhlaWdodDsgLy8g5paH5qGj6aG26YOo5YiwcmVmZXJlbmNl6aG26YOoLeWPr+inhuWMuuWfn+eahOmrmOW6pgoKICAgICAgbGV0IHNjcm9sbEhlaWdodERvd24gPSBvZmZzZXRPYmoub2Zmc2V0VG9wIC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsgLy8g5paH5qGj5bem5L6n5YiwcmVmZXJlbmNl5pyA5Y+z5L6n55qE6Led56a7CgogICAgICBsZXQgc2Nyb2xsV2lkdGhVcCA9IG9mZnNldE9iai5vZmZzZXRMZWZ0ICsgcmVmZXJlbmNlLm9mZnNldFdpZHRoOyAvLyDmlofmoaPpobbpg6jliLByZWZlcmVuY2Xlt6bkvqct5Y+v6KeG5Yy65Z+f55qE5a695bqmCgogICAgICBsZXQgc2Nyb2xsV2lkdGhEb3duID0gb2Zmc2V0T2JqLm9mZnNldExlZnQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGg7CiAgICAgIGxldCBzY3JvbGxIZWlnaHQsIHNjcm9sbFdpZHRoOwoKICAgICAgaWYgKG9mZnNldE9iajMudG9wIDwgLXJlZmVyZW5jZS5vZmZzZXRIZWlnaHQpIHsKICAgICAgICBzY3JvbGxIZWlnaHQgPSBzY3JvbGxUb3AgLSBzY3JvbGxIZWlnaHRVcCB8fCAwOwogICAgICB9IGVsc2UgewogICAgICAgIHNjcm9sbEhlaWdodCA9IHNjcm9sbFRvcCAtIHNjcm9sbEhlaWdodERvd24gfHwgMDsKICAgICAgfQoKICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA8IC1yZWZlcmVuY2Uub2Zmc2V0V2lkdGggKyAyMCkgewogICAgICAgIHNjcm9sbFdpZHRoID0gc2Nyb2xsTGVmdCAtIHNjcm9sbFdpZHRoVXAgfHwgMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBzY3JvbGxXaWR0aCA9IHNjcm9sbExlZnQgLSBzY3JvbGxXaWR0aERvd24gfHwgMDsKICAgICAgfSAvLyBjb25zb2xlLmxvZyhsZWZ0LCBsZWZ0MSwgJ2xlZnQsbGVmdDEnKTsKICAgICAgLy8gY29uc29sZS5sb2codG9wLCB0b3AxLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCd0b3AsdG9wMScpOwogICAgICAvLyBjb25zb2xlLmxvZyhzY3JvbGxUb3AsIHNjcm9sbEhlaWdodFVwLCBzY3JvbGxIZWlnaHREb3duLCBzY3JvbGxIZWlnaHQsICdzY3JvbGxUb3Asc2Nyb2xsSGVpZ2h0Jyk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGxlZnQgKyBsZWZ0Q2hhTFIgLSBzY3JvbGxXaWR0aCwgbGVmdCArIGxlZnRDaGFMUiwgbGVmdENoYUxSLCBzY3JvbGxXaWR0aCwgbGVmdCwgJz09PTAwJyk7CgoKICAgICAgbGV0IGxlZnROdW0sIHRvcE51bTsKCiAgICAgIGlmICh0aGlzLmFwcGVuZFRvQm9keSkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKCdwbGFjZW1lbnRTdHInLHRoaXMucGxhY2VtZW50U3RyKQogICAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0Qm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRUb3AnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0Qm90dG9tJykgewogICAgICAgICAgbGVmdE51bSA9IGxlZnQ7CgogICAgICAgICAgaWYgKG9mZnNldE9iajMudG9wIDwgLXJlZmVyZW5jZS5vZmZzZXRIZWlnaHQgfHwgb2Zmc2V0T2JqMy50b3AgPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnRhZ05hbWUgIT09ICdIVE1MJykgewogICAgICAgICAgICAgIHRvcE51bSA9IHRvcDEgKyBoZWlnaHRDaGFMUiAtIHNjcm9sbEhlaWdodCArICdweCc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG9wTnVtID0gdG9wICsgaGVpZ2h0Q2hhTFIgLSBzY3JvbGxIZWlnaHQgKyAncHgnOwogICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKCd0b3BOdW0xMTE9PT0nLCB0b3BOdW0pCgogICAgICAgICAgfSBlbHNlIGlmIChvdmVyRmxvd0hlaWdodCA8IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgfHwgdGhpcy5hcHBlbmRUb0JvZHkgJiYgdG9wIDwgMCB8fCB0aGlzLmFwcGVuZFRvQm9keSAmJiB0b3AxIDwgMCB8fCB0b3AgKyBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCB0b3AxICsgcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgb2Zmc2V0T2JqMy50b3AgPD0gMCB8fCBvZmZzZXRPYmozLmJvdHRvbSA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnRhZ05hbWUgIT09ICdIVE1MJykgewogICAgICAgICAgICAvLyAgIHRvcE51bSA9IHRvcDEgKyBoZWlnaHRDaGFMUiArICdweCc7CiAgICAgICAgICAgIC8vIH1lbHNlIHsKICAgICAgICAgICAgdG9wTnVtID0gdG9wICsgaGVpZ2h0Q2hhTFIgKyAncHgnOyAvLyB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0b3BOdW0yMicsIHRvcE51bSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvcE51bSA9IHRvcCArICdweCc7IC8vIGNvbnNvbGUubG9nKCczMycpCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcFJpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21MZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgdG9wTnVtID0gdG9wICsgJ3B4JzsgLy8gY29uc29sZS5sb2cob3ZlckZsb3dXaWR0aCxwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGgsbGVmdCkKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBvdmVyRmxvd1dpZHRo77yaJHtvdmVyRmxvd1dpZHRofSAgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRo77yaJHtwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGh9ICBsZWZ077yaJHtsZWZ0fSxsZWZ0MTogJHtsZWZ0MX0sYCk7CgogICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA8IC1yZWZlcmVuY2Uub2Zmc2V0V2lkdGggKyAyMCB8fCBvZmZzZXRPYmozLmxlZnQgPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSAxMykgewogICAgICAgICAgICAvKiBpZiAodGhpcy50YWdOYW1lICE9PSAnSFRNTCcpIHsKICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0MSArIGxlZnRDaGFMUiAtIHNjcm9sbFdpZHRoOwogICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0ICsgbGVmdENoYUxSIC0gc2Nyb2xsV2lkdGg7CiAgICAgICAgICAgICB9Ki8KICAgICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA8IC1yZWZlcmVuY2Uub2Zmc2V0V2lkdGggKyAyMCkgewogICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0ICsgbGVmdENoYUxSIC0gc2Nyb2xsV2lkdGggLSAyMDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIDEzKSB7CiAgICAgICAgICAgICAgbGVmdE51bSA9IGxlZnQgKyBsZWZ0Q2hhTFIgLSBzY3JvbGxXaWR0aCArIDEzOwogICAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKGxlZnQsbGVmdENoYUxSLHNjcm9sbFdpZHRoLCdsZWZ0TnVtIDExMT09PT09PT09PT09PT0nKTsKCiAgICAgICAgICB9IGVsc2UgaWYgKG92ZXJGbG93V2lkdGggPCBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggfHwgdGhpcy5hcHBlbmRUb0JvZHkgJiYgbGVmdCA8IDAgfHwgdGhpcy5hcHBlbmRUb0JvZHkgJiYgbGVmdDEgPCAwIHx8IGxlZnQgKyBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgbGVmdDEgKyBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggfHwgb2Zmc2V0T2JqMy5sZWZ0IDw9IDAgfHwgb2Zmc2V0T2JqMy5yaWdodCA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobGVmdCxsZWZ0Q2hhTFIsJ2xlZnROdW0gMjI9PT09PT09PT09PT09JykKICAgICAgICAgICAgbGVmdE51bSA9IGxlZnQgKyBsZWZ0Q2hhTFI7IC8vIGNvbnNvbGUubG9nKCcyMicsbGVmdE51bSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdsZWZ0TnVtIDMzJykKICAgICAgICAgICAgbGVmdE51bSA9IGxlZnQ7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnBvcFN0eWxlID0gewogICAgICAgICAgbGVmdDogbGVmdE51bSArICdweCcsCiAgICAgICAgICB0b3A6IHRvcE51bQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3BwcHBwcHAnKQogICAgICAgIHRoaXMucG9wU3R5bGUgPSB7CiAgICAgICAgICBsZWZ0OiBsZWZ0ICsgJ3B4JywKICAgICAgICAgIHRvcDogdG9wICsgJ3B4JwogICAgICAgIH07CiAgICAgIH0gLy8gY29uc29sZS5sb2coJzExMScsb3ZlckZsb3dIZWlnaHQsZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCxvZmZzZXRPYmozLnRvcCA8PSAwLG9mZnNldE9iajMuYm90dG9tID49IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpCgoKICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5ICYmIChvdmVyRmxvd0hlaWdodCA8IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgfHwgb3ZlckZsb3dXaWR0aCA8IHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCB8fCB0b3AxIDwgMCB8fCBsZWZ0MSA8IDAgfHwgdG9wMSArIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgPCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IHx8IGxlZnQxICsgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIDwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IG9mZnNldE9iajMudG9wIDw9IDAgfHwgb2Zmc2V0T2JqMy5sZWZ0IDw9IDAgfHwgb2Zmc2V0T2JqMy5ib3R0b20gPj0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBvZmZzZXRPYmozLnJpZ2h0ID49IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCkpIHsKICAgICAgICAvLyBjb25zb2xlLmxvZygnMTEx566t5aS0JykKICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodEJvdHRvbScpIHsKICAgICAgICAgIGxldCBhcnJvd0hlaWdodExSOwoKICAgICAgICAgIGlmIChvZmZzZXRPYmozLnRvcCA+PSAwKSB7CiAgICAgICAgICAgIGFycm93SGVpZ2h0TFIgPSBoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSA/IC0ocG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCAvIDIgLSAxMCkgOiBoZWlnaHRDaGFMUjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFycm93SGVpZ2h0TFIgPSBoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSA/IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgLyAyIC0gMTAgOiBoZWlnaHRDaGFMUjsgLy8gY29uc29sZS5sb2coJzIyMicsaGlkZUhlaWdodCxoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSxoZWlnaHRDaGFMUikKICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coaGlkZUhlaWdodCA+IDIwLCBvdmVyRmxvd0hlaWdodCA8IHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQsIGFycm93SGVpZ2h0TFIsICdhcnJvd0hlaWdodExSJyk7CgoKICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0Qm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRCb3R0b20nKSB7CiAgICAgICAgICAgIHRoaXMuYXJyb3dTdHlsZSA9IHsKICAgICAgICAgICAgICBib3R0b206IG92ZXJGbG93SGVpZ2h0IDwgcmVmZXJlbmNlLm9mZnNldEhlaWdodCA/IGBjYWxjKDUwJSAtICR7YXJyb3dIZWlnaHRMUn1weClgIDogYGNhbGMoNTAlIC0gJHtoZWlnaHRDaGFMUn1weClgCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmFycm93U3R5bGUgPSB7CiAgICAgICAgICAgICAgdG9wOiBvdmVyRmxvd0hlaWdodCA8IHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQgPyBgY2FsYyg1MCUgLSAke2Fycm93SGVpZ2h0TFJ9cHgpYCA6IGBjYWxjKDUwJSAtICR7aGVpZ2h0Q2hhTFJ9cHgpYAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZXQgYXJyb3dEaXNwbGFjZW1lbnQ7CiAgICAgICAgICBsZXQgbGVmdFVuY2hhbmdlZDsKCiAgICAgICAgICBpZiAob2Zmc2V0T2JqMy5sZWZ0ID49IDApIHsKICAgICAgICAgICAgYXJyb3dEaXNwbGFjZW1lbnQgPSBoaWRlV2lkdGggPiAwICYmIHJlZmVyZW5jZS5vZmZzZXRXaWR0aCAvIDIgLSBoaWRlV2lkdGggPCAxNSA/IC0ocG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC8gMiAtIDEwKSA6IGxlZnRDaGFMUjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFycm93RGlzcGxhY2VtZW50ID0gaGlkZVdpZHRoID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0V2lkdGggLyAyIC0gaGlkZVdpZHRoIDwgMTUgPyBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggLyAyIC0gMTAgOiBsZWZ0Q2hhTFI7IC8vIGNvbnNvbGUubG9nKCcyMjInLGhpZGVXaWR0aCxoaWRlV2lkdGggPiAwICYmIHJlZmVyZW5jZS5vZmZzZXRXaWR0aCAvIDIgLSBoaWRlV2lkdGggPCAxNSxsZWZ0Q2hhTFIpCiAgICAgICAgICB9IC8vIGNvbnNvbGUubG9nKGBoaWRlV2lkdGg6ICR7aGlkZVdpZHRofSBsZWZ0TnVtOiR7bGVmdE51bX0sb3ZlckZsb3dXaWR0aDoke292ZXJGbG93V2lkdGh9LHJlZmVyZW5jZS5vZmZzZXRXaWR0aDoke3JlZmVyZW5jZS5vZmZzZXRXaWR0aH0sbGVmdENoYUxSOiR7bGVmdENoYUxSfSwgYXJyb3dEaXNwbGFjZW1lbnQ6JHthcnJvd0Rpc3BsYWNlbWVudH1gLCAnPT09PScpOwoKCiAgICAgICAgICBsZXQgaW5pdGlhbExlZnQgPSAnNTAlJzsKCiAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbUxlZnQnKSB7CiAgICAgICAgICAgIGxldCBpbml0aWFsTGVmdDEgPSAxNjsKICAgICAgICAgICAgaW5pdGlhbExlZnQgPSBpbml0aWFsTGVmdDEgKyAncHgnOwogICAgICAgICAgICBhcnJvd0Rpc3BsYWNlbWVudCA9IGhpZGVXaWR0aCA+IDAgJiYgbGVmdE51bSA8IDE1ID8gaW5pdGlhbExlZnQxIC0gMTAgOiBsZWZ0Q2hhTFI7IC8vIGNvbnNvbGUubG9nKCcyMjItLS0nLCBvdmVyRmxvd1dpZHRoIDwgaW5pdGlhbExlZnQxICsgMSArIDUsaGlkZVdpZHRoLCBoaWRlV2lkdGggPiAwICYmIGxlZnROdW0gPCAxNSwgbGVmdENoYUxSKTsKICAgICAgICAgICAgLy8g5YWD57Sg6LaF6L+H5p+Q5Y+v6KeG6IyD5Zu05Yy65Z+f566t5aS05LiN56e75YqoCgogICAgICAgICAgICBpZiAob3ZlckZsb3dXaWR0aCA8IGluaXRpYWxMZWZ0MSArIDEyICsgMSArIDUpIHsKICAgICAgICAgICAgICBsZWZ0VW5jaGFuZ2VkID0gaW5pdGlhbExlZnQxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wUmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICAgIGxldCBpbml0aWFsTGVmdDEgPSBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggLSAxNiAtIDEyOwogICAgICAgICAgICBpbml0aWFsTGVmdCA9IGluaXRpYWxMZWZ0MSArICdweCc7CiAgICAgICAgICAgIGFycm93RGlzcGxhY2VtZW50ID0gbGVmdENoYUxSOyAvLyDlhYPntKDlj7PkvqfotoXov4flj6/op4bojIPlm7TljLrln5/miJblt6bkvqfljLrln5/lhoXlrr3luqblsI/kuo7mn5DlgLzml7Yg566t5aS05LiN56e75YqoCgogICAgICAgICAgICBpZiAob2Zmc2V0T2JqMy5yaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBvdmVyRmxvd1dpZHRoIDwgNSArIDE2ICsgMTIgKyAxMCkgewogICAgICAgICAgICAgIGxlZnRVbmNoYW5nZWQgPSBpbml0aWFsTGVmdDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8gY29uc29sZS5sb2coJ2luaXRpYWxMZWZ0JywgaW5pdGlhbExlZnQsICcgbGVmdFVuY2hhbmdlZDonLCBsZWZ0VW5jaGFuZ2VkLCAnIGFycm93RGlzcGxhY2VtZW50OicsIGFycm93RGlzcGxhY2VtZW50LCBvdmVyRmxvd1dpZHRoIDwgcmVmZXJlbmNlLm9mZnNldFdpZHRoLCBoaWRlV2lkdGggPiAwICYmIGxlZnROdW0gPCAxNSk7CgoKICAgICAgICAgIGxldCBhcnJvd0xlZnQgPSBsZWZ0VW5jaGFuZ2VkID8gbGVmdFVuY2hhbmdlZCA6IG92ZXJGbG93V2lkdGggPCByZWZlcmVuY2Uub2Zmc2V0V2lkdGggPyBgY2FsYygke2luaXRpYWxMZWZ0fSAtICR7YXJyb3dEaXNwbGFjZW1lbnR9cHgpYCA6IGBjYWxjKCR7aW5pdGlhbExlZnR9IC0gJHtsZWZ0Q2hhTFJ9cHgpYDsKCiAgICAgICAgICBpZiAobGVmdFBvcykgewogICAgICAgICAgICB0aGlzLmFycm93U3R5bGUgPSB7CiAgICAgICAgICAgICAgbGVmdDogYXJyb3dMZWZ0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIC8vIOWKqOaAgeWIpOaWrXBsYWNlbWVudOivpeS4uuS7gOS5iOWAvAogICAgcGxhY2VtZW50U3RyRnVuKHJlZmVyZW5jZSwgcG9wcGVyKSB7CiAgICAgIHZhciBfb2Zmc2V0T2JqLCBfb2Zmc2V0T2JqMiwgX29mZnNldE9iajMsIF9vZmZzZXRPYmo0OwoKICAgICAgLy8gY29uc29sZS5sb2cocG9wcGVyLCAncG9wcGVyLS0nKTsKICAgICAgLy8gbGV0IG9mZnNldE9iajIgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocmVmZXJlbmNlKTsKICAgICAgbGV0IG9mZnNldE9iajI7CgogICAgICBpZiAodGhpcy50YWdOYW1lID09PSAnSFRNTCcpIHsKICAgICAgICBvZmZzZXRPYmoyID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QyKHJlZmVyZW5jZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2Zmc2V0T2JqMiA9IHRoaXMuZ2V0T2Zmc2V0UmVjdFJlbGF0aXZlVG9DdXN0b21QYXJlbnQocmVmZXJlbmNlLCB0aGlzLmdldE9mZnNldFBhcmVudChwb3BwZXIpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGxldCBzcGFjZVRvcCA9IChfb2Zmc2V0T2JqID0gb2Zmc2V0T2JqMikgPT09IG51bGwgfHwgX29mZnNldE9iaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX29mZnNldE9iai50b3A7CiAgICAgIGxldCBzcGFjZUJvdHRvbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSAoKF9vZmZzZXRPYmoyID0gb2Zmc2V0T2JqMikgPT09IG51bGwgfHwgX29mZnNldE9iajIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9vZmZzZXRPYmoyLmJvdHRvbSk7CiAgICAgIGxldCBzcGFjZUxlZnQgPSAoX29mZnNldE9iajMgPSBvZmZzZXRPYmoyKSA9PT0gbnVsbCB8fCBfb2Zmc2V0T2JqMyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX29mZnNldE9iajMubGVmdDsKICAgICAgbGV0IHNwYWNlUmlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSAoKF9vZmZzZXRPYmo0ID0gb2Zmc2V0T2JqMikgPT09IG51bGwgfHwgX29mZnNldE9iajQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9vZmZzZXRPYmo0LnJpZ2h0KTsgLy8gY29uc29sZS5sb2cob2Zmc2V0T2JqMiwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0LCAnb2Zmc2V0T2JqMicpOwogICAgICAvLyBjb25zb2xlLmxvZygnIHNwYWNlVG9wOicsIHNwYWNlVG9wLCAnIHNwYWNlQm90dG9tOicsIHNwYWNlQm90dG9tLCAnIHNwYWNlTGVmdDonLCBzcGFjZUxlZnQsICcgc3BhY2VSaWdodDonLCBzcGFjZVJpZ2h0LCAnIHRoaXMucG9wcGVySW5pdGlhbFdpZHRoOicsIHRoaXMucG9wcGVySW5pdGlhbFdpZHRoLCAnIHRoaXMucG9wcGVySW5pdGlhbEhlaWdodDonLCB0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQsICctLS0tLScpOwoKICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5KSB7CiAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAncmlnaHRUb3AnIHx8IHRoaXMucGxhY2VtZW50ID09PSAncmlnaHQnIHx8IHRoaXMucGxhY2VtZW50ID09PSAncmlnaHRCb3R0b20nKSB7CiAgICAgICAgICAvLyB0aGlzLnBsYWNlbWVudFN0ciA9ICdyaWdodCc7CiAgICAgICAgICAvLyBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gb2Zmc2V0T2JqMi5yaWdodCA8IHRoaXMuY29udHJhcnlIb3Jpem9udGFsKSB7CiAgICAgICAgICAvLyAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2xlZnQnOwogICAgICAgICAgLy8gfQogICAgICAgICAgaWYgKHRoaXMucG9wcGVySW5pdGlhbFdpZHRoID4gc3BhY2VSaWdodCAtIDE1KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxXaWR0aCA8PSBzcGFjZUxlZnQgKyAxNSkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlIb3Jpem9udGFsID0gc3BhY2VMZWZ0OwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2xlZnQnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNwYWNlTGVmdCA+IHNwYWNlUmlnaHQpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCA9IHNwYWNlTGVmdDsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdsZWZ0JzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCA9IHNwYWNlUmlnaHQ7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAncmlnaHQnOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2xlZnRUb3AnIHx8IHRoaXMucGxhY2VtZW50ID09PSAnbGVmdCcgfHwgdGhpcy5wbGFjZW1lbnQgPT09ICdsZWZ0Qm90dG9tJykgewogICAgICAgICAgLy8gdGhpcy5wbGFjZW1lbnRTdHIgPSAnbGVmdCc7CiAgICAgICAgICAvLyBpZiAob2Zmc2V0T2JqMi5sZWZ0IDwgdGhpcy5jb250cmFyeUhvcml6b250YWwpIHsKICAgICAgICAgIC8vICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAncmlnaHQnOwogICAgICAgICAgLy8gfQogICAgICAgICAgaWYgKHRoaXMucG9wcGVySW5pdGlhbFdpZHRoID4gc3BhY2VMZWZ0IC0gMTUpIHsKICAgICAgICAgICAgaWYgKHRoaXMucG9wcGVySW5pdGlhbFdpZHRoIDw9IHNwYWNlUmlnaHQgKyAxNSkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlIb3Jpem9udGFsID0gc3BhY2VSaWdodDsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdyaWdodCc7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BhY2VSaWdodCA+IHNwYWNlTGVmdCkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlIb3Jpem9udGFsID0gc3BhY2VSaWdodDsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdyaWdodCc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5jb250cmFyeUhvcml6b250YWwgPSBzcGFjZUxlZnQ7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnbGVmdCc7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGxhY2VtZW50ID09PSAndG9wJyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50ID09PSAndG9wUmlnaHQnKSB7CiAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3AnOwoKICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcExlZnQnKSB7CiAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcExlZnQnOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BSaWdodCc7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMucG9wcGVySW5pdGlhbEhlaWdodCA+IHNwYWNlVG9wIC0gMTUpIHsKICAgICAgICAgICAgaWYgKHRoaXMucG9wcGVySW5pdGlhbEhlaWdodCA8PSBzcGFjZUJvdHRvbSArIDE1KSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzExMS0tLS0tLS0tLS0tLS0tLS09PT09PT09PT09PT09JykKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5VmVydGljYWwgPSBzcGFjZUJvdHRvbTsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdib3R0b20nOwoKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzcGFjZUJvdHRvbSA+IHNwYWNlVG9wKSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzIyMi0tLS0tLS0tLS0tLS0tLS09PT09PT09PT09PT09JykKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5VmVydGljYWwgPSBzcGFjZUJvdHRvbTsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdib3R0b20nOwoKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMzMzLS0tLS0tLS0tLS0tLS0tLT09PT09PT09PT09PT0nKQogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlVG9wOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcCc7CgogICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcExlZnQnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BMZWZ0JzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGxhY2VtZW50ID09PSAndG9wUmlnaHQnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BSaWdodCc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21MZWZ0JyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tJzsKCiAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdib3R0b21MZWZ0JzsKICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tUmlnaHQnOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQgPiBzcGFjZUJvdHRvbSAtIDE1KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQgPD0gc3BhY2VUb3AgKyAxNSkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlVG9wOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcCc7CgogICAgICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbUxlZnQnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BMZWZ0JzsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BSaWdodCc7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHNwYWNlQm90dG9tID4gc3BhY2VUb3ApIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5VmVydGljYWwgPSBzcGFjZUJvdHRvbTsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdib3R0b20nOwoKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5VmVydGljYWwgPSBzcGFjZVRvcDsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3AnOwoKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gLy8gY29uc29sZS5sb2codGhpcy5wbGFjZW1lbnRTdHIsICd0aGlzLnBsYWNlbWVudFN0cicpOwoKCiAgICAgICAgaWYgKG9mZnNldE9iajIucmlnaHQgPj0gMCAmJiBvZmZzZXRPYmoyLmxlZnQgPD0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoICYmIG9mZnNldE9iajIudG9wIDw9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgJiYgb2Zmc2V0T2JqMi5ib3R0b20gPj0gMCkgewogICAgICAgICAgdGhpcy5wb3BXaWR0aEhlaWdodEZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgfSAvLyBjb25zb2xlLmxvZyh0aGlzLnBsYWNlbWVudFN0ciwgJ3BsYWNlbWVudFN0cicpOwoKICAgICAgfQogICAgfSwKCiAgICBjb21wdXRlUG9zaXRpb24oKSB7CiAgICAgIGxldCByZWZlcmVuY2UgPSB0aGlzLmdldFJlZmVyZW5jZSgpOwogICAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgICAgdGhpcy5oYW5kbGVTY3JvbGwocmVmZXJlbmNlLCBwb3BwZXIpOwogICAgfSwKCiAgICAvLyDmtY/op4jlmajmu5rliqjkuovku7YKICAgIGhhbmRsZVNjcm9sbChyZWZlcmVuY2UsIHBvcHBlcikgewogICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlU2Nyb2xsJyxyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgIGlmICghdGhpcy5kaXNhYmxlZCAmJiB0aGlzLnNob3dQb3BwZXIpIHsKICAgICAgICBsZXQgc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsKICAgICAgICBsZXQgc2Nyb2xsTGVmdCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0IHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdDsKCiAgICAgICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gJ0RJVicpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudGFyZ2V0LnNjcm9sbFRvcCx0aGlzLnRhcmdldC5zY3JvbGxMZWZ0LCdoYW5kbGVTY3JvbGwnKTsKICAgICAgICAgIHNjcm9sbFRvcCA9IHRoaXMudGFyZ2V0LnNjcm9sbFRvcDsKICAgICAgICAgIHNjcm9sbExlZnQgPSB0aGlzLnRhcmdldC5zY3JvbGxMZWZ0OwogICAgICAgIH0gLy8gY29uc29sZS5sb2coJ2hhbmRsZVNjcm9sbCcsICBzY3JvbGxUb3AsIHNjcm9sbExlZnQpOwoKCiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ckZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgfSwgMCk7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlU2Nyb2xsJyxkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2x0aXBJZCkpOwogICAgICAgICAgaWYgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKSkgewogICAgICAgICAgICB0aGlzLnBvc2l0aW9uRnVuKHJlZmVyZW5jZSwgcG9wcGVyLCBzY3JvbGxUb3AsIHNjcm9sbExlZnQpOwogICAgICAgICAgfQogICAgICAgIH0sIDUpOwogICAgICB9CiAgICB9LAoKICAgIGRvVG9nZ2xlKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZG9Ub2dnbGUnKTsKICAgICAgdGhpcy5zaG93UG9wcGVyID0gIXRoaXMuc2hvd1BvcHBlcjsKICAgIH0sCgogICAgY3JlYXRET00oKSB7CiAgICAgIGNvbnN0IGFOb2RlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpOyAvLyDnhLblkI7liKTmlq3or6XlhYPntKDoioLngrnmmK/kuI3mmK/lvZPliY3mlofmoaPpobXpnaJib2R56IqC54K555qE5ZCO5LujCiAgICAgIC8vIGNvbnNvbGUubG9nKGFOb2RlLCBhTm9kZS5wYXJlbnROb2RlLnRhZ05hbWUsICdhTm9kZScpOwoKICAgICAgaWYgKGFOb2RlLnBhcmVudE5vZGUudGFnTmFtZS50b1VwcGVyQ2FzZSgpICE9PSAnQk9EWScpIHsKICAgICAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBvcHBlcik7CiAgICAgIH0KICAgIH0sCgogICAgcmVtb3ZlRE9NKCkgewogICAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsgLy8gY29uc29sZS5sb2cocG9wcGVyLCAncG9wcGVyIHJlbW92ZURPTScpOwoKICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChwb3BwZXIpOwogICAgfSwKCiAgICBkb1Nob3coKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdkb1Nob3ctLS0tLS0tLScpOwogICAgICB0aGlzLnNob3dQb3BwZXIgPSB0cnVlOwogICAgfSwKCiAgICBkb0Nsb3NlKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZG9DbG9zZS0tLS0tLS0tJyk7CiAgICAgIHRoaXMuc2hvd1BvcHBlciA9IGZhbHNlOwogICAgfSwKCiAgICBoYW5kbGVGb2N1cygpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZUZvY3VzLS0tLS0tLS0nKTsKICAgICAgaWYgKHRoaXMudHJpZ2dlciA9PT0gJ2NsaWNrJyB8fCB0aGlzLnRyaWdnZXIgPT09ICdmb2N1cycpIHRoaXMuc2hvd1BvcHBlciA9IHRydWU7CiAgICB9LAoKICAgIGhhbmRsZUNsaWNrKCkge30sCgogICAgaGFuZGxlQmx1cigpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZUJsdXItLS0tLS0tLScpOwogICAgICBpZiAodGhpcy50cmlnZ2VyID09PSAnY2xpY2snIHx8IHRoaXMudHJpZ2dlciA9PT0gJ2ZvY3VzJykgdGhpcy5zaG93UG9wcGVyID0gZmFsc2U7CiAgICB9LAoKICAgIGhhbmRsZUtleWRvd24oZXYpIHsKICAgICAgaWYgKGV2LmtleUNvZGUgPT09IDI3ICYmIHRoaXMudHJpZ2dlciAhPT0gJ21hbnVhbCcpIHsKICAgICAgICAvLyBlc2MKICAgICAgICB0aGlzLmRvQ2xvc2UoKTsKICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVNb3VzZUVudGVyKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlTW91c2VFbnRlci0tLS0tLS0tJyk7CiAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lcik7CgogICAgICBpZiAodGhpcy5vcGVuRGVsYXkpIHsKICAgICAgICB0aGlzLl90aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgICAgICB9LCB0aGlzLm9wZW5EZWxheSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVNb3VzZUxlYXZlKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlTW91c2VMZWF2ZS0tLS0tLS0nKTsKICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTsKCiAgICAgIGlmICh0aGlzLmNsb3NlRGVsYXkpIHsKICAgICAgICB0aGlzLl90aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gZmFsc2U7CiAgICAgICAgfSwgdGhpcy5jbG9zZURlbGF5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNob3dQb3BwZXIgPSBmYWxzZTsKICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVEb2N1bWVudENsaWNrKGUpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZURvY3VtZW50Q2xpY2snKTsKICAgICAgbGV0IHJlZmVyZW5jZSA9IHRoaXMuZ2V0UmVmZXJlbmNlKCk7CiAgICAgIGNvbnN0IHBvcHBlciA9IHRoaXMucG9wcGVyIHx8IHRoaXMuJHJlZnMucG9wcGVyOwogICAgICBpZiAoIXRoaXMuJGVsIHx8ICFyZWZlcmVuY2UgfHwgdGhpcy4kZWwuY29udGFpbnMoZS50YXJnZXQpIHx8IHJlZmVyZW5jZS5jb250YWlucyhlLnRhcmdldCkgfHwgIXBvcHBlciB8fCBwb3BwZXIuY29udGFpbnMoZS50YXJnZXQpKSByZXR1cm47CiAgICAgIHRoaXMuc2hvd1BvcHBlciA9IGZhbHNlOwogICAgfSwKCiAgICBjbGVhbnVwKCkgewogICAgICBpZiAodGhpcy5vcGVuRGVsYXkgfHwgdGhpcy5jbG9zZURlbGF5KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTsKICAgICAgfQogICAgfSwKCiAgICBvZmYoZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIpIHsKICAgICAgLy8gY29uc29sZS5sb2coZWxlbWVudCwnb2ZmJyk7CiAgICAgIGlmIChlbGVtZW50ICYmIGV2ZW50KSB7CiAgICAgICAgZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBmYWxzZSk7CiAgICAgIH0KICAgIH0sCgogICAgb24oZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIpIHsKICAgICAgLy8gY29uc29sZS5sb2coZWxlbWVudCwgZXZlbnQsIGhhbmRsZXIsICdvbicpOwogICAgICBpZiAoZWxlbWVudCAmJiBldmVudCAmJiBoYW5kbGVyKSB7CiAgICAgICAgZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBoYW5kbGVyLCBmYWxzZSk7CiAgICAgIH0KICAgIH0KCiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;EACA;EACA;EACA;EACA;IACAA,mEADA,CAEA;IACA;EACA;AACA;;AAEA;EACAC,iBADA;EAEAC;IACAC,aADA;IAEAC,eAFA;IAGAC,aAHA;IAIAC,UAJA;IAKAC,iBALA;IAMAC,SANA;IAOAC;MACAC,YADA;MAEAC;IAFA,CAPA;IAWAC;MACAF,YADA;MAEAC;IAFA,CAXA;IAeAE;MACAH,YADA;MAEAC;IAFA,CAfA;IAmBAG;MACAJ,aADA;MAEAC;IAFA,CAnBA;IAuBAI;MACAL,YADA;MAEAC,gBAFA;MAGAK;IAHA,CAvBA;IA4BAC;MACAP,YADA;MAEAC;IAFA,CA5BA;IAgCAO;MACAR,YADA;MAEAC;IAFA,CAhCA;IAoCA;IACAQ;MACAT,aADA;MAEAC;IAFA,CArCA;IAyCAS;MACAV,YADA;MAEAC;IAFA,CAzCA;IA6CAU;MAAA;MACAX,YADA;MAEAC;IAFA,CA7CA,CAiDA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;;EAxDA,CAFA;;EA4DAW;IACA;MACAC,YADA;MAEAC,cAFA;MAGAC,cAHA;MAIAC,iBAJA;MAKAC,UALA;MAMAC,qBANA;MAOAC,oBAPA;MAQAC,gBARA;MASAC,WATA;MAUAC,YAVA;MAWAC,qBAXA;MAYAC,uBAZA;MAaAC,sBAbA;MAcAC;IAdA;EAgBA,CA7EA;;EA8EAC,cA9EA;EA+EAC;IACAC;MACA;IACA,CAHA;;IAIAC;MACA;IACA;;EANA,CA/EA;EAuFAC;IACA3B;MACA4B,eADA;;MAEAC;QACA;QACA;UACA;QACA;;QACA;MACA;;IARA,CADA;IAWAjB;MACAgB,eADA;;MAEAC;QACA;QACA;UACA;QACA;;QACA;;QACA;UACA;YACA;UACA,CAFA,MAEA;YACA;AACA;AACA;UACA;QACA;;QACA;UACA;UACA;UACA;UACA;UACAC;YACAvC,gCADA,CAEA;;YACA;cACA;cACA;YACA,CANA,CAOA;YACA;;UACA,CATA,EALA,CAeA;;UACAuC;YACA;UACA,CAFA,EAEA,CAFA;;UAGA;YACA;YACAA;cACA;YACA,CAFA,EAEA,CAFA;UAGA;;UACAA;YACA;YACA;UACA,CAHA,EAGA,EAHA;QAIA,CA7BA,MA6BA;UACA;UACA;AACA;AACA;AACA;QACA;MACA;;IArDA;EAXA,CAvFA;;EA0JAC;IACAC;EACA,CA5JA;;EA6JAC;IAAA;;IACA;IACA;IACA;IACA,6CAJA,CAKA;IACA;;IACA;IACA;;IACA;MACAf,gBADA,CAEA;IACA,CAZA,CAaA;IACA;;;IACA;MACA;MACA;;MACA;QACA;QACA;UACA;UACA;UACA;;UACA;YACAgB;UACA;QACA,CAPA;QAQA;QACA;QACA,6CAZA,CAaA;MACA;;MACA;MACA;IACA;;IACA;;IACA;MACA;MACA,2CAFA,CAGA;;MACA,qDAJA,CAKA;IACA,CANA,MAMA;MACA;MACA;MACA;MACA;IACA,CALA,MAKA;MACA;QACA;QACA,6CAFA,CAGA;QACA;MACA,CALA,MAKA;QACA;QACA,4CAFA,CAGA;MACA;IACA;EACA,CAzNA;;EA0NAC;IACA;IACAC;IACA,oCAHA,CAIA;;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA,sDAdA,CAeA;;IACA;EACA,CA3OA;;EA4OAC;IACA;IACAC;MACA;;MACA;QACA;QACA;UACA;UACA;YACA/C;YACA;UACA;QACA;MACA;;MACA;IACA,CAfA;;IAgBAgD;MACA;MACA,6DAFA,CAGA;;MACA;QACA;UACA;UACA;YACA;YACArD;UACA;QACA;MACA;IACA,CA7BA;;IA8BA;IACAsD;MACA;MACA;;MACA;QACAC;QACAC;QACAC;MACA;;MACA;QACAF,oBADA;QAEAC;MAFA,EARA,CAYA;;MACA;IACA,CA7CA;;IA8CA;IACAE;MACA;MACA;;MAEA;QACA;QACAC;QACAA;QACAA;QACAA;MACA;;MAEA;QACAC,qCADA;QAEAC,wCAFA;QAGAC,6DAHA;QAIAC,6DAJA;QAKAvD,wBALA;QAMAwD;MANA,EAZA,CAoBA;;MACA;IACA,CArEA;;IAsEA;IACAC;MACA;MACA,kFAFA,CAGA;;MAEA;QACA;MACA;;MAEA;QACA;QACA;QACA;UACA;QACA;;QACA;MACA,CAhBA,CAkBA;;;MACA,IACA,wFACA,sFADA,IAEA,sFAHA,EAIA;QACA;QACA;QACA;QACA;QACA;QACA;;QACA;UACA;UACA;QACA;;QACA;UACA;UACA;QACA,CAdA,CAeA;;;QACA;MACA;;MACA;IACA,CAjHA;;IAkHA;IACAC;MAAA;;MACA;MACA;MACA,0FAHA,CAIA;;MACA;IACA,CAzHA;;IA0HA;IACAC;MACA;MACA;MACA;MACA;IACA,CAhIA;;IAiIA;IACAC;MACA,6FADA,CAEA;MACA;;MACA,qDAJA,CAMA;;MACA;MAEA;QACAP,2DADA;QAEAD,YAFA;QAGAG,6DAHA;QAIAD,+DAJA;QAKAtD,yHALA;QAMAwD;MANA,EATA,CAiBA;MACA;;MACA;IACA,CAtJA;;IAuJA;IACAK;MACA;;MACA;QACA,qCADA,CACA;;QACA,uCAFA,CAEA;QACA;;QACA;UACA7D,qBADA;UAEAwD;QAFA;MAIA;IACA,CAnKA;;IAoKA;IACAM;MACA;MACA;;MACA;QACAC;MACA,CAFA,MAEA;QACA;QACAA;MACA;;MACA;;MACA;QACAC;QACAC;MACA;;MACA;QACAD;QACAC;MACA;;MACA;QACAD;QACAC;MACA;;MACA;QACAD;QACAC;MACA;;MACA;QACAD,kBADA;QAEAC;MAFA;IAIA,CAnMA;;IAoMA;IACAC;MAAA;;MACA;MACA,wMACAC,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,8MACAA,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,kVACAA,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,wVACAA,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,6cACAA,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,0cACAA,KADA,CACA,IADA,EACA,CADA,MACA,CADA;MAEA,6GAdA,CAeA;;MACA;IACA,CAtNA;;IAuNA;IACAC;MACA;QACA;MACA;;MACA;QAAA;;QACA;QACA;MACA;;MACA;MACA;MACA;;MACA;QACAL;MACA,CAFA,MAEA;QACAA;MACA,CAfA,CAgBA;MACA;;;MACA;MACA,kFAnBA,CAoBA;MACA;MACA;;MACA,cAvBA,CAwBA;;MACA;MACA;;MACA;QACA;UACAM;QACA,CAFA,MAEA;UACAA;QACA,CALA,CAMA;;MACA,CAPA,MAOA;QACAA;MACA,CApCA,CAqCA;;;MACA;QACA7E;MACA;;MACA;MACA;MACA;MACA,oFA5CA,CA6CA;MACA;;MACA;QACA4D;MACA;;MACA;QACAA;MACA;;MACA;QACAC;MACA;;MACA;QACAA;MACA;;MACA;QACA;UACAA;QACA,CAFA,MAEA;UACAA;QACA;MACA;;MACA;QACAD;MACA;;MACA;QACAA;MACA;;MACA;QACA;UACAA;QACA,CAFA,MAEA;UACAA;QACA;MACA;;MACA;QACAC;MACA;;MACA;QACAA;MACA,CApFA,CAqFA;;;MACA;MACA;MACA;;MACA;QACAiB,mFADA,CAEA;;QACAC;;QACA;UACAA;QACA;MACA,CAPA,MAOA;QACAD;QACAC;MACA;;MACA;MACA;;MACA;QACA;UACAC,6FADA,CAEA;QACA,CAHA,MAGA;UACAA,8FADA,CAEA;QACA,CAHA,MAGA;UACAA,gBADA,CAEA;QACA;;QACA;UACAC,0FADA,CAEA;QACA,CAHA,MAGA;UACAA;UACA;AACA;AACA;AACA;;UACA;YACA;YACAA,yBAFA,CAEA;UACA,CATA,CAUA;;QACA,CAXA,MAWA;UACAA,cADA,CAEA;QACA;MACA,CAnIA,CAoIA;;;MACA;MACA,sHAtIA,CAuIA;MACA;;MACA;MACA,kHA1IA,CA2IA;MACA;;MACA,kEA7IA,CA8IA;;MACA,mFA/IA,CAgJA;;MACA,iEAjJA,CAkJA;;MACA;MACA;;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA;;MACA;QACAC;MACA,CAFA,MAEA;QACAA;MACA,CA9JA,CA+JA;MACA;MACA;MACA;;;MACA;;MACA;QACA;QACA;UACAC;;UACA;YACA;cACAC;YACA,CAFA,MAEA;cACAA;YACA,CALA,CAMA;;UACA,CAPA,MAOA;YACA;YACA;YACA;YACAA,kCAJA,CAKA;YACA;UACA,CAPA,MAOA;YACAA,oBADA,CAEA;UACA;QACA,CApBA,MAoBA;UACAA,oBADA,CAEA;UACA;;UACA;YACA;AACA;AACA;AACA;AACA;YACA;cACAD;YACA;;YACA;cACAA;YACA,CAXA,CAYA;;UACA,CAbA,MAaA;YACA;YACAA,2BAFA,CAGA;UACA,CAJA,MAIA;YACA;YACAA;UACA;QACA;;QACA;UACAvB,oBADA;UAEAD;QAFA;MAIA,CApDA,MAoDA;QACA;QACA;UACAC,iBADA;UAEAD;QAFA;MAIA,CA9NA,CA+NA;;;MACA;QACA;QACA;UACA;;UACA;YACA0B;UACA,CAFA,MAEA;YACAA,kIADA,CAEA;UACA,CAPA,CAQA;;;UACA;YACA;cACAxB;YADA;UAGA,CAJA,MAIA;YACA;cACAF;YADA;UAGA;QACA,CAlBA,MAkBA;UACA;UACA;;UACA;YACA2B;UACA,CAFA,MAEA;YACAA,gIADA,CAEA;UACA,CARA,CASA;;;UACA;;UACA;YACA;YACAC;YACAD,kFAHA,CAIA;YACA;;YACA;cACAE;YACA;UACA;;UACA;YACA;YACAD;YACAD,8BAHA,CAIA;;YACA;cACAE;YACA;UACA,CA7BA,CA8BA;;;UACA;;UACA;YACA;cACA5B;YADA;UAGA;QACA;MACA;IACA,CAnfA;;IAofA;IACA6B;MAAA;;MACA;MACA;MACA;;MACA;QACAnB;MACA,CAFA,MAEA;QACAA;MACA;;MACA;MACA;MACA;MACA,qJAZA,CAaA;MACA;;MACA;QACA;UACA;UACA;UACA;UACA;UACA;YACA;cACA;cACA;YACA,CAHA,MAGA;cACA;cACA;YACA,CAHA,MAGA;cACA;cACA;YACA;UACA;QACA,CAjBA,MAiBA;UACA;UACA;UACA;UACA;UACA;YACA;cACA;cACA;YACA,CAHA,MAGA;cACA;cACA;YACA,CAHA,MAGA;cACA;cACA;YACA;UACA;QACA,CAjBA,MAiBA;UACA;;UACA;YACA;UACA,CAFA,MAEA;YACA;UACA;;UACA;YACA;cACA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA,CATA,MASA;cACA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA,CATA,MASA;cACA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA;UACA;QACA,CArCA,MAqCA;UACA;;UACA;YACA;UACA,CAFA,MAEA;YACA;UACA;;UACA;YACA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA,CARA,MAQA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA,CARA,MAQA;cACA;cACA;;cACA;gBACA;cACA,CAFA,MAEA;gBACA;cACA;YACA;UACA;QACA,CA1GA,CA2GA;;;QACA;UACA;QACA,CA9GA,CA+GA;;MACA;IACA,CArnBA;;IAsnBAoB;MACA;MACA;MACA;IACA,CA1nBA;;IA2nBA;IACAC;MACA;MACA;QACA;QACA;;QACA;UACA;UACAC;UACAC;QACA,CAPA,CAQA;;;QACAlD;UACA;QACA,CAFA,EAEA,CAFA;QAGAA;UACA;UACA;YACA;UACA;QACA,CALA,EAKA,CALA;MAMA;IACA,CAjpBA;;IAkpBAmD;MACA;MACA;IACA,CArpBA;;IAspBAC;MACA,sDADA,CAEA;MACA;;MACA;QACA;QACAhG;MACA;IACA,CA9pBA;;IA+pBAiG;MACA,gDADA,CAEA;;MACAjG;IACA,CAnqBA;;IAoqBAkG;MACA;MACA;IACA,CAvqBA;;IAwqBAC;MACA;MACA;IACA,CA3qBA;;IA4qBAC;MACA;MACA;IACA,CA/qBA;;IAgrBAC,eACA,CAjrBA;;IAkrBAC;MACA;MACA;IACA,CArrBA;;IAsrBAC;MACA;QAAA;QACA;MACA;IACA,CA1rBA;;IA2rBAC;MACA;MACAC;;MACA;QACA;UACA;QACA,CAFA,EAEA,cAFA;MAGA,CAJA,MAIA;QACA;MACA;IACA,CArsBA;;IAssBAC;MACA;MACAD;;MACA;QACA;UACA;QACA,CAFA,EAEA,eAFA;MAGA,CAJA,MAIA;QACA;MACA;IACA,CAhtBA;;IAitBAE;MACA;MACA;MACA;MACA,iBACA,UADA,IAEA,2BAFA,IAGAtG,4BAHA,IAIA,OAJA,IAKAC,yBALA,EAKA;MACA;IACA,CA5tBA;;IA6tBAsG;MACA;QACAH;MACA;IACA,CAjuBA;;IAkuBAI;MACA;MACA;QACAC;MACA;IACA,CAvuBA;;IAwuBAC;MACA;MACA;QACAD;MACA;IACA;;EA7uBA;AA5OA","names":["document","name","props","title","content","reference","popper","disabled","width","className","type","default","zIndex","placement","visible","trigger","validator","openDelay","closeDelay","appendToBody","tabindex","notParentClass","data","popStyle","popWHStyle","arrowStyle","showPopper","opacity","displayStatus","contentMaxHeight","placementStr","tagName","target","contraryVertical","contraryHorizontal","popperInitialWidth","popperInitialHeight","components","computed","tooltipId","tooltipIdParent","watch","immediate","handler","setTimeout","created","window","mounted","instance","beforeDestroy","removePop","methods","getReference","popstate","getPoint","offsetTop","offsetLeft","el","getOffsetRectRelativeToCustomParent","parentRect","top","left","bottom","right","height","getScrollParent","getOffsetParent","getStyleComputedProperty","getBoundingClientRect2","getTitleStyle","popWidthHeightFun","offsetObj2","maxWidth","maxHeight","getContentCha","split","positionFun","height1","top1","left1","heightChaLR","leftChaLR","scrollHeight","scrollWidth","leftNum","topNum","arrowHeightLR","arrowDisplacement","initialLeft","leftUnchanged","placementStrFun","computePosition","handleScroll","scrollTop","scrollLeft","doToggle","creatDOM","removeDOM","doShow","doClose","handleFocus","handleClick","handleBlur","handleKeydown","handleMouseEnter","clearTimeout","handleMouseLeave","handleDocumentClick","cleanup","off","element","on"],"sourceRoot":"packages/popover/src","sources":["popover.vue"],"sourcesContent":["<template>\n  <div :class=\"['disInB', appendToBody ? '' : 'posR']\" :id=\"tooltipIdParent\">\n    <div\n      :id=\"tooltipId\" ref=\"popper\"\n      :class=\"[\n          'dj-popover',\n          'dj-popover-placement-' + placementStr,\n          appendToBody ? 'posF dj-popover-posF' : '',\n          className\n        ]\"\n      :style=\"{\n        width: width + 'px',\n        ...popStyle ,\n        maxWidth:popWHStyle.maxWidth + 'px',\n        maxHeight:popWHStyle.maxHeight + 'px',\n        visibility: !disabled && showPopper? 'unset' : 'hidden',\n        display: displayStatus,\n        opacity: opacity,\n        zIndex: zIndex,\n        pointerEvents: opacity ? 'auto' : 'none'\n      }\"\n    >\n      <!--opacity: !disabled && showPopper ? 1 : 0-->\n      <div class=\"dj-popover-content\"\n           :style=\"{\n             maxWidth:popWHStyle.maxWidth + 'px',\n             maxHeight:popWHStyle.maxHeight - 10 + 'px'\n           }\"\n      >\n        <div class=\"dj-popover-arrow\" :style=\"{...arrowStyle}\"><span class=\"dj-popover-arrow-content\"></span></div>\n        <div class=\"dj-popover-inner\" role=\"tooltip\"\n             :style=\"{\n               maxWidth:popWHStyle.maxWidth + 'px',\n               maxHeight:popWHStyle.maxHeight - 10 + 'px'\n             }\"\n        >\n          <!--<div class=\"dj-popover-title\">{{title}}</div>-->\n          <div class=\"dj-popover-title\" :id=\"tooltipId + '-title'\" v-if=\"title\" v-text=\"title\"></div>\n          <div class=\"dj-popover-inner-content\">\n            <div class=\"overY\" :id=\"tooltipId + '-content'\">\n              <slot name=\"content\">\n                <div class=\"dj-popover-desc\">{{content}}</div>\n              </slot>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <slot name=\"default\"></slot>\n  </div>\n</template>\n\n<script>\nfunction removePop(self) {\n  // console.log(this, self,'this');\n  // console.log(self.tooltipId, self.tooltipIdParent, 'handleDocumentClick');\n  // console.log(document.getElementById(self.tooltipIdParent), 'handleDocumentClick');\n  if (!document.getElementById(self.tooltipIdParent) && document.getElementById(self.tooltipId)) {\n    document.body.removeChild(document.getElementById(self.tooltipId));\n    // console.log('removeEventListener');\n    // document.removeEventListener('click', removePop(self), false);\n  }\n}\n\nexport default {\n  name: 'djPopover',\n  props: {\n    title: String,\n    content: String,\n    reference: {},\n    popper: {},\n    disabled: Boolean,\n    width: {},\n    className: {\n      type: String,\n      default: ''\n    },\n    zIndex: {\n      type: Number,\n      default: 79\n    },\n    placement: {\n      type: String,\n      default: 'top'\n    },\n    visible: {\n      type: Boolean,\n      default: false\n    },\n    trigger: {\n      type: String,\n      default: 'click',\n      validator: value => ['click', 'focus', 'hover', 'manual'].indexOf(value) > -1 || value === ''\n    },\n    openDelay: {\n      type: Number,\n      default: 0\n    },\n    closeDelay: {\n      type: Number,\n      default: 200\n    },\n    // 是否插入到body\n    appendToBody: {\n      type: Boolean,\n      default: false\n    },\n    tabindex: {\n      type: Number,\n      default: 0\n    },\n    notParentClass: {// 为了让自定义的父级有overflow auto时，让他不为父级元素\n      type: String,\n      default: ''\n    }\n    // contraryVertical: {\n    //   type: Number,\n    //   default: 100\n    // },\n    // contraryHorizontal: {\n    //   type: Number,\n    //   default: 250\n    // }\n  },\n  data() {\n    return {\n      popStyle: {},\n      popWHStyle: {},\n      arrowStyle: {},\n      showPopper: false,\n      opacity: 0,\n      displayStatus: 'none',\n      contentMaxHeight: '',\n      placementStr: '',\n      tagName: '',\n      target: null,\n      contraryVertical: 100,\n      contraryHorizontal: 250,\n      popperInitialWidth: '',\n      popperInitialHeight: ''\n    };\n  },\n  components: {},\n  computed: {\n    tooltipId() {\n      return `dj-popover-${Math.floor(Math.random() * 10000)}`;\n    },\n    tooltipIdParent() {\n      return `dj-popover-${Math.floor(Math.random() * 10000)}-parent`;\n    }\n  },\n  watch: {\n    visible: {\n      immediate: true,\n      handler(val) {\n        // console.log(val, 'visible');\n        if (this.disabled) {\n          return;\n        }\n        this.showPopper = val;\n      }\n    },\n    showPopper: {\n      immediate: true,\n      handler(val) {\n        // console.log(val, 'showPopper');\n        if (this.disabled) {\n          return;\n        }\n        this.$emit('update:visible', val);\n        if (this.appendToBody) {\n          if (val) {\n            this.creatDOM();\n          } else {\n            /* setTimeout(() => {\n             this.removeDOM();\n             }, 300);*/\n          }\n        }\n        if (!this.disabled && val) {\n          this.placementStr = this.placement;\n          this.displayStatus = 'block';\n          let reference;\n          const popper = this.popper || this.$refs.popper;\n          setTimeout(() => {\n            reference = this.getReference();\n            // console.log(reference,'reference这里啊');\n            if (!this.popperInitialWidth && !this.popperInitialHeight) {\n              this.popperInitialWidth = popper?.offsetWidth;\n              this.popperInitialHeight = popper?.offsetHeight;\n            }\n            // console.log(this.popperInitialWidth, this.popperInitialHeight, 'popperInitialWidth');\n            // console.log(popper.clientHeight);\n          });\n          // return;\n          setTimeout(() => {\n            this.placementStrFun(reference, popper);\n          }, 2);\n          if (this.appendToBody) {\n            // this.opacity = 1;\n            setTimeout(() => {\n              this.popWidthHeightFun(reference, popper);\n            }, 5);\n          }\n          setTimeout(() => {\n            this.opacity = 1;\n            this.positionFun(reference, popper);\n          }, 10);\n        } else {\n          this.opacity = 0;\n          /* setTimeout(() => {\n           this.displayStatus = 'none';\n           // console.log(val,'display:none');\n           }, 300);*/\n        }\n      }\n    }\n  },\n  created() {\n    window.addEventListener('popstate', this.popstate, false);\n  },\n  mounted() {\n    // console.log('mounted');\n    const popper = this.popper || this.$refs.popper;\n    let reference = this.getReference();\n    let target = this.getScrollParent(reference);\n    // console.log(reference, popper, '==== mounted');\n    // console.log(target, target?.tagName, this.$slots, '==== mounted');\n    this.tagName = target?.tagName || '';\n    this.target = target || null;\n    if (this.tagName === 'HTML') {\n      target = window;\n      // document.getElementById(this.tooltipId).classList.add(\"posA\");\n    }\n    // console.log(target, this.target, '==== mounted22');\n    // 可访问性\n    if (reference) {\n      // reference.setAttribute('tabindex', this.tabindex); // tab序列\n      this.positionFun(reference, popper);\n      if (this.trigger !== 'click') {\n        // console.log(reference, '测试0000');\n        this.on(reference, 'focusin', () => {\n          // console.log('222222222');\n          this.handleFocus();\n          const instance = reference.__vue__;\n          if (instance && typeof instance.focus === 'function') {\n            instance.focus();\n          }\n        });\n        this.on(popper, 'focusin', this.handleFocus);\n        this.on(reference, 'focusout', this.handleBlur);\n        this.on(popper, 'focusout', this.handleBlur);\n        // console.log('测试1111');\n      }\n      this.on(reference, 'keydown', this.handleKeydown);\n      this.on(reference, 'click', this.handleClick);\n    }\n    this.on(target, 'scroll', () => this.handleScroll(reference, popper));\n    if (this.trigger === 'click') {\n      // console.log('1111');\n      this.on(reference, 'click', this.doToggle);\n      // console.log(2222,document,this);\n      this.on(document, 'click', this.handleDocumentClick);\n      // document.addEventListener('click', removePop(this), false);\n    } else if (this.trigger === 'hover') {\n      this.on(reference, 'mouseenter', this.handleMouseEnter);\n      this.on(popper, 'mouseenter', this.handleMouseEnter);\n      this.on(reference, 'mouseleave', this.handleMouseLeave);\n      this.on(popper, 'mouseleave', this.handleMouseLeave);\n    } else if (this.trigger === 'focus') {\n      if (reference.querySelector('input, textarea')) {\n        this.on(reference, 'focusin', this.doShow);\n        this.on(reference, 'focusout', this.doClose);\n        // console.log('input, textarea');\n        // console.log('111111');\n      } else {\n        this.on(reference, 'mousedown', this.doShow);\n        this.on(reference, 'mouseup', this.doClose);\n        // console.log('222222');\n      }\n    }\n  },\n  beforeDestroy() {\n    this.cleanup();\n    removePop(this);\n    let reference = this.getReference();\n    // console.log(reference,'reference');\n    this.off(reference, 'click', this.doToggle);\n    this.off(reference, 'mouseup', this.doClose);\n    this.off(reference, 'mousedown', this.doShow);\n    this.off(reference, 'focusin', this.doShow);\n    this.off(reference, 'focusout', this.doClose);\n    this.off(reference, 'mousedown', this.doShow);\n    this.off(reference, 'mouseup', this.doClose);\n    this.off(reference, 'mouseleave', this.handleMouseLeave);\n    this.off(reference, 'mouseenter', this.handleMouseEnter);\n    this.off(document, 'click', this.handleDocumentClick);\n    // document.removeEventListener('click', removePop(this), false);\n    this.off(window, 'scroll', this.handleScroll);\n  },\n  methods: {\n    // 获取reference\n    getReference() {\n      let reference = this.reference || this.$refs.reference;\n      if (!reference && this.$slots.default && this.$slots.default[0]) {\n        // reference = this.$slots.default[0].elm;\n        for (let i in this.$slots.default) {\n          // console.log(this.$slots.default[i].elm instanceof Element, 'ssss',i);\n          if (this.$slots.default[i].elm instanceof Element) {\n            reference = this.$slots.default[i].elm;\n            break;\n          }\n        }\n      }\n      return reference;\n    },\n    popstate() {\n      // this.showPopper=false;\n      let els = document.getElementsByClassName('dj-popover-posF');\n      // console.log(els,'els');\n      if (els) {\n        for (let i = 0; i < els.length; i++) {\n          // console.log(els[i].parentNode,'父级');\n          if (els[i].parentNode.tagName === 'BODY') {\n            // console.log('body父级');\n            document.body.removeChild(els[i]);\n          }\n        }\n      }\n    },\n    // 获取某元素以浏览器左上角为原点的坐标\n    getPoint(el) {\n      let offsetTop = 0;\n      let offsetLeft = 0;\n      while (el && el.tagName !== 'BODY') {\n        offsetTop += el.offsetTop;\n        offsetLeft += el.offsetLeft;\n        el = el.offsetParent;\n      }\n      let offsetObj = {\n        offsetTop: offsetTop,\n        offsetLeft: offsetLeft\n      };\n      // console.log(offsetObj, 'getPoint');\n      return offsetObj;\n    },\n    // 用于获取某个元素相对于parent的位置集合\n    getOffsetRectRelativeToCustomParent(element, parent, fixed) {\n      var elementRect = this.getBoundingClientRect2(element);\n      var parentRect = this.getBoundingClientRect2(parent);\n\n      if (fixed) {\n        var scrollParent = this.getScrollParent(parent);\n        parentRect.top += scrollParent.scrollTop;\n        parentRect.bottom += scrollParent.scrollTop;\n        parentRect.left += scrollParent.scrollLeft;\n        parentRect.right += scrollParent.scrollLeft;\n      }\n\n      var rect = {\n        top: elementRect.top - parentRect.top,\n        left: elementRect.left - parentRect.left,\n        bottom: elementRect.top - parentRect.top + elementRect.height,\n        right: elementRect.left - parentRect.left + elementRect.width,\n        width: elementRect.width,\n        height: elementRect.height\n      };\n      // console.log(rect, elementRect, parentRect, 'getOffsetRectRelativeToCustomParent');\n      return rect;\n    },\n    // 获取滚动父级\n    getScrollParent(element) {\n      var root = window;\n      var parent = element?.parentNode;\n      // console.log(element, parent, 'getScrollParent');\n\n      if (!parent) {\n        return element;\n      }\n\n      if (parent === root.document) {\n        // Firefox puts the scrollTOp value on `documentElement` instead of `body`, we then check which of them is\n        // greater than 0 and return the proper element\n        if (root.document.body.scrollTop || root.document.body.scrollLeft) {\n          return root.document.body;\n        }\n        return root.document.documentElement;\n      }\n\n      // Firefox want us to check `-x` and `-y` variations as well\n      if (\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow')) !== -1 ||\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow-x')) !== -1 ||\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow-y')) !== -1\n      ) {\n        // If the detected scrollParent is body, we perform an additional check on its parentNode\n        // in this way we'll get body if the browser is Chrome-ish, or documentElement otherwise\n        // fixes issue #65\n        // console.log( parent?.className,'parent className');\n        // console.log( parent?.classList,'parent classList');\n        let className = parent?.getAttribute('class');\n        if (className?.indexOf('dj-table-panel') > -1 || className?.indexOf('dj-modal-content') > -1) {\n          // console.log('=====');\n          return this.getScrollParent(parent);\n        }\n        if (this.notParentClass && parent?.getAttribute('class') === this.notParentClass) {\n          // console.log('=====');\n          return this.getScrollParent(parent);\n        }\n        // console.log(parent, 'parent222');\n        return parent;\n      }\n      return this.getScrollParent(element?.parentNode);\n    },\n    // 获取距离该子元素最近的进行过定位的父元素\n    getOffsetParent(element) {\n      // NOTE: 1 DOM access here\n      var root = window;\n      var offsetParent = element?.offsetParent;\n      // console.log(element, offsetParent, offsetParent === root.document.body || !offsetParent ? root.document.documentElement : offsetParent, 'getOffsetParent');\n      return offsetParent === root?.document?.body || !offsetParent ? root?.document?.documentElement : offsetParent;\n    },\n    // 获取元素最终样式，包括了内联样式、嵌入样式和外部样式\n    getStyleComputedProperty(element, property) {\n      // NOTE: 1 DOM access here\n      var root = window;\n      var css = root.getComputedStyle(element, null);\n      return css[property];\n    },\n    // 用于获取某个元素相对于视窗的位置集合\n    getBoundingClientRect2(element) {\n      let rect = element?.getBoundingClientRect();\n      // console.log(element, rect, 'rect');\n      // whether the IE version is lower than 11\n      let isIE = navigator.userAgent.indexOf('MSIE') != -1;\n\n      // fix ie document bounding top always 0 bug\n      let rectTop = isIE && element?.tagName === 'HTML' ? -element?.scrollTop : rect?.top;\n\n      let param = {\n        left: rect?.left,\n        top: rectTop,\n        right: rect?.right,\n        bottom: rect?.bottom,\n        width: rect?.right - rect?.left,\n        height: rect?.bottom - rectTop\n      };\n      // console.log(param, 'getBoundingClientRect2');\n      // console.log(document.documentElement.clientWidth, document.documentElement.clientHeight, window.innerWidth, window.innerHeight, 'getBoundingClientRect');\n      return param;\n    },\n    // 获取title宽高\n    getTitleStyle() {\n      let dom = document.getElementById(this.tooltipId + '-title');\n      if (dom) {\n        let divOffsetWidth = dom.offsetWidth; // 元素的宽度包含padding和border\n        let divOffsetHeight = dom.offsetHeight; // 元素的宽度包含padding和border\n        // console.log(divOffsetWidth, divOffsetHeight, 'getTitleStyle');\n        return {\n          width: divOffsetWidth,\n          height: divOffsetHeight\n        };\n      }\n    },\n    // 获取pop最大最小宽度\n    popWidthHeightFun(reference, popper) {\n      // console.log('popWidthHeightFun');\n      let offsetObj2 = this.getBoundingClientRect2(reference);\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        // offsetObj2 = getOffsetRectRelativeToCustomParent(reference, getOffsetParent(popper), false);\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.target, false);\n      }\n      let maxWidth, maxHeight;\n      if (this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'leftTop') {\n        maxWidth = offsetObj2.left - 10;\n        maxHeight = document.documentElement.clientHeight - 10;\n      }\n      if (this.placementStr === 'right' || this.placementStr === 'rightBottom' || this.placementStr === 'rightTop') {\n        maxWidth = document.documentElement.clientWidth - offsetObj2.right - 10;\n        maxHeight = document.documentElement.clientHeight - 10;\n      }\n      if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight') {\n        maxWidth = document.documentElement.clientWidth - 10;\n        maxHeight = offsetObj2.top - 15;\n      }\n      if (this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n        maxWidth = document.documentElement.clientWidth - 10;\n        maxHeight = document.documentElement.clientHeight - offsetObj2.bottom - 10;\n      }\n      this.popWHStyle = {\n        maxWidth: maxWidth,\n        maxHeight: maxHeight\n      };\n    },\n    // 获取pop content应该减的值\n    getContentCha() {\n      // console.log(this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content').parentNode.parentNode,'border-bottom-width'),'---');\n      let PT = this.getStyleComputedProperty(document.getElementById(this.tooltipId), 'padding-top')\n        ?.split('px')[0] || 0;\n      let PB = this.getStyleComputedProperty(document.getElementById(this.tooltipId), 'padding-bottom')\n        ?.split('px')[0] || 0;\n      let contentPT = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode, 'padding-top')\n        ?.split('px')[0] || 0;\n      let contentPB = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode, 'padding-bottom')\n        ?.split('px')[0] || 0;\n      let bbw = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode?.parentNode, 'border-bottom-width')\n        ?.split('px')[0] || 0;\n      let btw = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode?.parentNode, 'border-top-width')\n        ?.split('px')[0] || 0;\n      let contentCha = Number(PT) + Number(PB) + Number(contentPT) + Number(contentPB) + Number(bbw) + Number(btw);\n      // console.log(PT,PB,contentCha, 'contentCha');\n      return contentCha;\n    },\n    // 定位\n    positionFun(reference, popper, scrollTop, scrollLeft) {\n      if (!reference || !popper) {\n        return false;\n      }\n      if (this.appendToBody && this.tagName !== 'HTML') {\n        // console.log(document.getElementById(this.tooltipId), 'classList');\n        document.getElementById(this.tooltipId)?.classList?.add('posA');\n      }\n      let offsetObj = this.getPoint(reference);\n      let offsetObj3 = this.getBoundingClientRect2(reference);\n      let offsetObj2;\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.getOffsetParent(popper), false);\n      }\n      // console.log(offsetObj3, 'offsetObj3');\n      // console.log(offsetObj2, 'offsetObj2');\n      let referenceOffsetLeft = this.appendToBody ? offsetObj2.left : reference.offsetLeft;\n      let referenceOffsetTop = this.appendToBody ? offsetObj2.top : reference.offsetTop;\n      // console.log(`\\n reference: offsetLeft：offsetLeft：${reference.offsetLeft},${offsetObj.offsetLeft},  offsetObj2.left：${offsetObj2.left}`);\n      // console.log(`\\n reference: offsetTop：offsetTop：${reference.offsetTop},${offsetObj.offsetTop},  offsetObj2.top：${offsetObj2.top}`);\n      // console.log(referenceOffsetTop, referenceOffsetLeft, '=====================');\n      let left, top;\n      // console.log(this.popWHStyle.maxHeight, this.popWHStyle.maxWidth, popper.offsetWidth, 'this.popWHStyle.maxHeight');\n      let contentCha = this.getContentCha();\n      let height1;\n      if (this.title) {\n        if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n          height1 = Number(this.getTitleStyle().height + 24);\n        } else {\n          height1 = Number(this.getTitleStyle().height + contentCha);\n        }\n        // document.getElementById(this.tooltipId + '-content').style.maxHeight = 'calc(100vh - ' + height1 + 'px';\n      } else {\n        height1 = contentCha;\n      }\n      // height1 = 15;\n      if (document.getElementById(this.tooltipId + '-content')) {\n        document.getElementById(this.tooltipId + '-content').style.maxHeight = this.popWHStyle.maxHeight - height1 < contentCha ? contentCha + 'px' : this.popWHStyle.maxHeight - height1 + 'px';\n      }\n      let popperRealityOffsetWidth = popper.offsetWidth;\n      let popperRealityOffsetHeight = popper.offsetHeight;\n      let widthDifference = Math.abs(reference.offsetWidth - popperRealityOffsetWidth);\n      let heightDifference = Math.abs(reference.offsetHeight - popperRealityOffsetHeight);\n      // console.log(`popper: offsetLeft：${popper.offsetLeft}  offsetTop：${popper.offsetTop}  offsetWidth：${popper.offsetWidth},popperRealityOffsetWidth: ${popperRealityOffsetWidth},  offsetHeight：${popper.offsetHeight}, popperRealityOffsetHeight:${popperRealityOffsetHeight}`);\n      // console.log(`\\n reference: offsetLeft：${referenceOffsetLeft}  offsetTop：${referenceOffsetTop}  offsetWidth：${reference.offsetWidth}  offsetHeight：${reference.offsetHeight}`);\n      if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight') {\n        top = referenceOffsetTop - popperRealityOffsetHeight;\n      }\n      if (this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n        top = referenceOffsetTop + reference.offsetHeight;\n      }\n      if (this.placementStr === 'top' || this.placementStr === 'bottom') {\n        left = referenceOffsetLeft - popperRealityOffsetWidth / 2 + reference.offsetWidth / 2;\n      }\n      if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n        left = referenceOffsetLeft;\n      }\n      if (this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n        if (popperRealityOffsetWidth > reference.offsetWidth) {\n          left = referenceOffsetLeft - widthDifference;\n        } else {\n          left = referenceOffsetLeft + widthDifference;\n        }\n      }\n      if (this.placementStr === 'rightTop' || this.placementStr === 'leftTop') {\n        top = referenceOffsetTop;\n      }\n      if (this.placementStr === 'right' || this.placementStr === 'left') {\n        top = referenceOffsetTop - popperRealityOffsetHeight / 2 + reference.offsetHeight / 2;\n      }\n      if (this.placementStr === 'rightBottom' || this.placementStr === 'leftBottom') {\n        if (popperRealityOffsetHeight > reference.offsetHeight) {\n          top = referenceOffsetTop - heightDifference;\n        } else {\n          top = referenceOffsetTop + heightDifference;\n        }\n      }\n      if (this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n        left = referenceOffsetLeft + reference.offsetWidth;\n      }\n      if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom') {\n        left = referenceOffsetLeft - popperRealityOffsetWidth;\n      }\n      // 动态计算宽高时，宽/高的需要加上的差值\n      let heightChaLR = 0;\n      let leftChaLR = 0;\n      let top1, left1;\n      if (this.tagName !== 'HTML') {\n        top1 = offsetObj3.top - popperRealityOffsetHeight / 2 + reference.offsetHeight / 2;\n        // left1 = offsetObj3.left - popperRealityOffsetWidth / 2 + reference.offsetWidth / 2;\n        left1 = left;\n        if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n          left1 = left - 5;\n        }\n      } else {\n        top1 = top;\n        left1 = left;\n      }\n      let topPos = this.tagName === 'HTML' ? top : top1;\n      let leftPos = this.tagName === 'HTML' ? left : left1;\n      if (this.appendToBody) {\n        if (topPos + popperRealityOffsetHeight >= document.documentElement.clientHeight - 4) {\n          heightChaLR = document.documentElement.clientHeight - topPos - popperRealityOffsetHeight - 5;\n          // console.log('heightChaLR 111');\n        } else if (topPos <= 4) {\n          heightChaLR = popperRealityOffsetHeight / 2 - reference.offsetHeight / 2 - offsetObj3.top + 5;\n          // console.log('heightChaLR 222');\n        } else {\n          heightChaLR = 0;\n          // console.log('heightChaLR 333');\n        }\n        if (leftPos + popperRealityOffsetWidth > document.documentElement.clientWidth) {\n          leftChaLR = document.documentElement.clientWidth - leftPos - popperRealityOffsetWidth - 5;\n          // console.log(leftChaLR,'leftChaLR 11')\n        } else if (leftPos <= 0) {\n          leftChaLR = popperRealityOffsetWidth / 2 - reference.offsetWidth / 2 - offsetObj3.left + 5;\n          /*  if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n           // console.log('1111--')\n           leftChaLR = - offsetObj3.left + 5 // 左侧pop被遮挡的距离+5\n           }*/\n          if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft' || this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n            // console.log('1111--')\n            leftChaLR = -leftPos + 5;// 左侧pop被遮挡的距离+5\n          }\n          // console.log(offsetObj3.left,leftPos,leftChaLR,'leftChaLR 22')\n        } else {\n          leftChaLR = 0;\n          // console.log(leftChaLR,leftPos,'leftChaLR 33')\n        }\n      }\n      // console.log(heightChaLR, leftChaLR, 'heightChaLR,leftChaLR');\n      let overFlowHeight = offsetObj3.top >= 10 ? document.documentElement.clientHeight - offsetObj3.top : offsetObj3.bottom;\n      let overFlowWidth = offsetObj3.left >= 10 ? document.documentElement.clientWidth - offsetObj3.left : offsetObj3.right;\n      // console.log('document.documentElement.clientHeight', document.documentElement.clientHeight, 'offsetObj2.top：', offsetObj2.top, 'overFlowHeight：', overFlowHeight, 'overFlowWidth：', overFlowWidth, 'popperRealityOffsetHeight：', popperRealityOffsetHeight, 'popperRealityOffsetWidth：', popperRealityOffsetWidth, '000', overFlowHeight < reference.offsetHeight);\n      // reference被遮盖的高度\n      let hideHeight = offsetObj3.top >= 0 ? offsetObj3.bottom - document.documentElement.clientHeight : -offsetObj3.top;\n      let hideWidth = offsetObj3.left >= 0 ? offsetObj3.right - document.documentElement.clientWidth : -offsetObj3.left;\n      // console.log(hideHeight, hideWidth, 'hideHeight');\n      // 文档顶部到reference底部的距离\n      let scrollHeightUp = offsetObj.offsetTop + reference.offsetHeight;\n      // 文档顶部到reference顶部-可视区域的高度\n      let scrollHeightDown = offsetObj.offsetTop - document.documentElement.clientHeight;\n      // 文档左侧到reference最右侧的距离\n      let scrollWidthUp = offsetObj.offsetLeft + reference.offsetWidth;\n      // 文档顶部到reference左侧-可视区域的宽度\n      let scrollWidthDown = offsetObj.offsetLeft - document.documentElement.clientWidth;\n      let scrollHeight, scrollWidth;\n      if (offsetObj3.top < -reference.offsetHeight) {\n        scrollHeight = scrollTop - scrollHeightUp || 0;\n      } else {\n        scrollHeight = scrollTop - scrollHeightDown || 0;\n      }\n      if (offsetObj3.left < -reference.offsetWidth + 20) {\n        scrollWidth = scrollLeft - scrollWidthUp || 0;\n      } else {\n        scrollWidth = scrollLeft - scrollWidthDown || 0;\n      }\n      // console.log(left, left1, 'left,left1');\n      // console.log(top, top1, document.documentElement.clientHeight,'top,top1');\n      // console.log(scrollTop, scrollHeightUp, scrollHeightDown, scrollHeight, 'scrollTop,scrollHeight');\n      // console.log(left + leftChaLR - scrollWidth, left + leftChaLR, leftChaLR, scrollWidth, left, '===00');\n      let leftNum, topNum;\n      if (this.appendToBody) {\n        // console.log('placementStr',this.placementStr)\n        if (this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom' || this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom') {\n          leftNum = left;\n          if (offsetObj3.top < -reference.offsetHeight || offsetObj3.top > document.documentElement.clientHeight) {\n            if (this.tagName !== 'HTML') {\n              topNum = top1 + heightChaLR - scrollHeight + 'px';\n            } else {\n              topNum = top + heightChaLR - scrollHeight + 'px';\n            }\n            // console.log('topNum111===', topNum)\n          } else if (overFlowHeight < popperRealityOffsetHeight || this.appendToBody && top < 0 || this.appendToBody && top1 < 0 || top + popperRealityOffsetHeight > document.documentElement.clientHeight || top1 + popperRealityOffsetHeight > document.documentElement.clientHeight || offsetObj3.top <= 0 || offsetObj3.bottom >= document.documentElement.clientHeight) {\n            // if (this.tagName !== 'HTML') {\n            //   topNum = top1 + heightChaLR + 'px';\n            // }else {\n            topNum = top + heightChaLR + 'px';\n            // }\n            // console.log('topNum22', topNum)\n          } else {\n            topNum = top + 'px';\n            // console.log('33')\n          }\n        } else if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight' || this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n          topNum = top + 'px';\n          // console.log(overFlowWidth,popperRealityOffsetWidth,left)\n          // console.log(`overFlowWidth：${overFlowWidth}  popperRealityOffsetWidth：${popperRealityOffsetWidth}  left：${left},left1: ${left1},`);\n          if (offsetObj3.left < -reference.offsetWidth + 20 || offsetObj3.left > document.documentElement.clientWidth - 13) {\n            /* if (this.tagName !== 'HTML') {\n             leftNum = left1 + leftChaLR - scrollWidth;\n             } else {\n             leftNum = left + leftChaLR - scrollWidth;\n             }*/\n            if (offsetObj3.left < -reference.offsetWidth + 20) {\n              leftNum = left + leftChaLR - scrollWidth - 20;\n            }\n            if (offsetObj3.left > document.documentElement.clientWidth - 13) {\n              leftNum = left + leftChaLR - scrollWidth + 13;\n            }\n            // console.log(left,leftChaLR,scrollWidth,'leftNum 111=============');\n          } else if (overFlowWidth < popperRealityOffsetWidth || this.appendToBody && left < 0 || this.appendToBody && left1 < 0 || left + popperRealityOffsetWidth > document.documentElement.clientWidth || left1 + popperRealityOffsetWidth > document.documentElement.clientWidth || offsetObj3.left <= 0 || offsetObj3.right >= document.documentElement.clientWidth) {\n            // console.log(left,leftChaLR,'leftNum 22=============')\n            leftNum = left + leftChaLR;\n            // console.log('22',leftNum)\n          } else {\n            // console.log('leftNum 33')\n            leftNum = left;\n          }\n        }\n        this.popStyle = {\n          left: leftNum + 'px',\n          top: topNum\n        };\n      } else {\n        // console.log('ppppppp')\n        this.popStyle = {\n          left: left + 'px',\n          top: top + 'px'\n        };\n      }\n      // console.log('111',overFlowHeight,document.documentElement.clientHeight,offsetObj3.top <= 0,offsetObj3.bottom >= document.documentElement.clientHeight)\n      if (this.appendToBody && (overFlowHeight < popperRealityOffsetHeight || overFlowWidth < popperRealityOffsetWidth || top1 < 0 || left1 < 0 || top1 + popperRealityOffsetHeight < document.documentElement.clientHeight || left1 + popperRealityOffsetWidth < document.documentElement.clientWidth || offsetObj3.top <= 0 || offsetObj3.left <= 0 || offsetObj3.bottom >= document.documentElement.clientHeight || offsetObj3.right >= document.documentElement.clientWidth)) {\n        // console.log('111箭头')\n        if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n          let arrowHeightLR;\n          if (offsetObj3.top >= 0) {\n            arrowHeightLR = hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15 ? -(popperRealityOffsetHeight / 2 - 10) : heightChaLR;\n          } else {\n            arrowHeightLR = hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15 ? popperRealityOffsetHeight / 2 - 10 : heightChaLR;\n            // console.log('222',hideHeight,hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15,heightChaLR)\n          }\n          // console.log(hideHeight > 20, overFlowHeight < reference.offsetHeight, arrowHeightLR, 'arrowHeightLR');\n          if (this.placementStr === 'rightBottom' || this.placementStr === 'leftBottom') {\n            this.arrowStyle = {\n              bottom: overFlowHeight < reference.offsetHeight ? `calc(50% - ${arrowHeightLR}px)` : `calc(50% - ${heightChaLR}px)`\n            };\n          } else {\n            this.arrowStyle = {\n              top: overFlowHeight < reference.offsetHeight ? `calc(50% - ${arrowHeightLR}px)` : `calc(50% - ${heightChaLR}px)`\n            };\n          }\n        } else {\n          let arrowDisplacement;\n          let leftUnchanged;\n          if (offsetObj3.left >= 0) {\n            arrowDisplacement = hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15 ? -(popperRealityOffsetWidth / 2 - 10) : leftChaLR;\n          } else {\n            arrowDisplacement = hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15 ? popperRealityOffsetWidth / 2 - 10 : leftChaLR;\n            // console.log('222',hideWidth,hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15,leftChaLR)\n          }\n          // console.log(`hideWidth: ${hideWidth} leftNum:${leftNum},overFlowWidth:${overFlowWidth},reference.offsetWidth:${reference.offsetWidth},leftChaLR:${leftChaLR}, arrowDisplacement:${arrowDisplacement}`, '====');\n          let initialLeft = '50%';\n          if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n            let initialLeft1 = 16;\n            initialLeft = initialLeft1 + 'px';\n            arrowDisplacement = hideWidth > 0 && leftNum < 15 ? initialLeft1 - 10 : leftChaLR;\n            // console.log('222---', overFlowWidth < initialLeft1 + 1 + 5,hideWidth, hideWidth > 0 && leftNum < 15, leftChaLR);\n            // 元素超过某可视范围区域箭头不移动\n            if (overFlowWidth < initialLeft1 + 12 + 1 + 5) {\n              leftUnchanged = initialLeft1;\n            }\n          }\n          if (this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n            let initialLeft1 = popperRealityOffsetWidth - 16 - 12;\n            initialLeft = initialLeft1 + 'px';\n            arrowDisplacement = leftChaLR;\n            // 元素右侧超过可视范围区域或左侧区域内宽度小于某值时 箭头不移动\n            if (offsetObj3.right > document.documentElement.clientWidth || overFlowWidth < 5 + 16 + 12 + 10) {\n              leftUnchanged = initialLeft1;\n            }\n          }\n          // console.log('initialLeft', initialLeft, ' leftUnchanged:', leftUnchanged, ' arrowDisplacement:', arrowDisplacement, overFlowWidth < reference.offsetWidth, hideWidth > 0 && leftNum < 15);\n          let arrowLeft = leftUnchanged ? leftUnchanged : overFlowWidth < reference.offsetWidth ? `calc(${initialLeft} - ${arrowDisplacement}px)` : `calc(${initialLeft} - ${leftChaLR}px)`;\n          if (leftPos) {\n            this.arrowStyle = {\n              left: arrowLeft\n            };\n          }\n        }\n      }\n    },\n    // 动态判断placement该为什么值\n    placementStrFun(reference, popper) {\n      // console.log(popper, 'popper--');\n      // let offsetObj2 = this.getBoundingClientRect2(reference);\n      let offsetObj2;\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.getOffsetParent(popper), false);\n      }\n      let spaceTop = offsetObj2?.top;\n      let spaceBottom = document.documentElement.clientHeight - offsetObj2?.bottom;\n      let spaceLeft = offsetObj2?.left;\n      let spaceRight = document.documentElement.clientWidth - offsetObj2?.right;\n      // console.log(offsetObj2, document.documentElement.clientWidth, document.documentElement.clientHeight, 'offsetObj2');\n      // console.log(' spaceTop:', spaceTop, ' spaceBottom:', spaceBottom, ' spaceLeft:', spaceLeft, ' spaceRight:', spaceRight, ' this.popperInitialWidth:', this.popperInitialWidth, ' this.popperInitialHeight:', this.popperInitialHeight, '-----');\n      if (this.appendToBody) {\n        if (this.placement === 'rightTop' || this.placement === 'right' || this.placement === 'rightBottom') {\n          // this.placementStr = 'right';\n          // if (document.documentElement.clientWidth - offsetObj2.right < this.contraryHorizontal) {\n          //   this.placementStr = 'left';\n          // }\n          if (this.popperInitialWidth > spaceRight - 15) {\n            if (this.popperInitialWidth <= spaceLeft + 15) {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            } else if (spaceLeft > spaceRight) {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            } else {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            }\n          }\n        } else if (this.placement === 'leftTop' || this.placement === 'left' || this.placement === 'leftBottom') {\n          // this.placementStr = 'left';\n          // if (offsetObj2.left < this.contraryHorizontal) {\n          //   this.placementStr = 'right';\n          // }\n          if (this.popperInitialWidth > spaceLeft - 15) {\n            if (this.popperInitialWidth <= spaceRight + 15) {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            } else if (spaceRight > spaceLeft) {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            } else {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            }\n          }\n        } else if (this.placement === 'top' || this.placement === 'topLeft' || this.placement === 'topRight') {\n          this.placementStr = 'top';\n          if (this.placement === 'topLeft') {\n            this.placementStr = 'topLeft';\n          } else if (this.placement === 'topRight') {\n            this.placementStr = 'topRight';\n          }\n          if (this.popperInitialHeight > spaceTop - 15) {\n            if (this.popperInitialHeight <= spaceBottom + 15) {\n              // console.log('111----------------=============')\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else if (spaceBottom > spaceTop) {\n              // console.log('222----------------=============')\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else {\n              // console.log('333----------------=============')\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'topRight';\n              }\n            }\n          }\n        } else if (this.placement === 'bottom' || this.placement === 'bottomLeft' || this.placement === 'bottomRight') {\n          this.placementStr = 'bottom';\n          if (this.placement === 'bottomLeft') {\n            this.placementStr = 'bottomLeft';\n          } else if (this.placement === 'bottomRight') {\n            this.placementStr = 'bottomRight';\n          }\n          if (this.popperInitialHeight > spaceBottom - 15) {\n            if (this.popperInitialHeight <= spaceTop + 15) {\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'topRight';\n              }\n            } else if (spaceBottom > spaceTop) {\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else {\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'topRight';\n              }\n            }\n          }\n        }\n        // console.log(this.placementStr, 'this.placementStr');\n        if (offsetObj2.right >= 0 && offsetObj2.left <= document.documentElement.clientWidth && offsetObj2.top <= document.documentElement.clientHeight && offsetObj2.bottom >= 0) {\n          this.popWidthHeightFun(reference, popper);\n        }\n        // console.log(this.placementStr, 'placementStr');\n      }\n    },\n    computePosition() {\n      let reference = this.getReference();\n      const popper = this.popper || this.$refs.popper;\n      this.handleScroll(reference, popper);\n    },\n    // 浏览器滚动事件\n    handleScroll(reference, popper) {\n      // console.log('handleScroll',reference, popper);\n      if (!this.disabled && this.showPopper) {\n        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n        let scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;\n        if (this.tagName === 'DIV') {\n          // console.log(this.target.scrollTop,this.target.scrollLeft,'handleScroll');\n          scrollTop = this.target.scrollTop;\n          scrollLeft = this.target.scrollLeft;\n        }\n        // console.log('handleScroll',  scrollTop, scrollLeft);\n        setTimeout(() => {\n          this.placementStrFun(reference, popper);\n        }, 0);\n        setTimeout(() => {\n          // console.log('handleScroll',document.getElementById(this.tooltipId));\n          if (document.getElementById(this.tooltipId)) {\n            this.positionFun(reference, popper, scrollTop, scrollLeft);\n          }\n        }, 5);\n      }\n    },\n    doToggle() {\n      // console.log('doToggle');\n      this.showPopper = !this.showPopper;\n    },\n    creatDOM() {\n      const aNode = document.getElementById(this.tooltipId);\n      // 然后判断该元素节点是不是当前文档页面body节点的后代\n      // console.log(aNode, aNode.parentNode.tagName, 'aNode');\n      if (aNode.parentNode.tagName.toUpperCase() !== 'BODY') {\n        const popper = this.popper || this.$refs.popper;\n        document.body.appendChild(popper);\n      }\n    },\n    removeDOM() {\n      const popper = this.popper || this.$refs.popper;\n      // console.log(popper, 'popper removeDOM');\n      document.body.removeChild(popper);\n    },\n    doShow() {\n      // console.log('doShow--------');\n      this.showPopper = true;\n    },\n    doClose() {\n      // console.log('doClose--------');\n      this.showPopper = false;\n    },\n    handleFocus() {\n      // console.log('handleFocus--------');\n      if (this.trigger === 'click' || this.trigger === 'focus') this.showPopper = true;\n    },\n    handleClick() {\n    },\n    handleBlur() {\n      // console.log('handleBlur--------');\n      if (this.trigger === 'click' || this.trigger === 'focus') this.showPopper = false;\n    },\n    handleKeydown(ev) {\n      if (ev.keyCode === 27 && this.trigger !== 'manual') { // esc\n        this.doClose();\n      }\n    },\n    handleMouseEnter() {\n      // console.log('handleMouseEnter--------');\n      clearTimeout(this._timer);\n      if (this.openDelay) {\n        this._timer = setTimeout(() => {\n          this.showPopper = true;\n        }, this.openDelay);\n      } else {\n        this.showPopper = true;\n      }\n    },\n    handleMouseLeave() {\n      // console.log('handleMouseLeave-------');\n      clearTimeout(this._timer);\n      if (this.closeDelay) {\n        this._timer = setTimeout(() => {\n          this.showPopper = false;\n        }, this.closeDelay);\n      } else {\n        this.showPopper = false;\n      }\n    },\n    handleDocumentClick(e) {\n      // console.log('handleDocumentClick');\n      let reference = this.getReference();\n      const popper = this.popper || this.$refs.popper;\n      if (!this.$el ||\n        !reference ||\n        this.$el.contains(e.target) ||\n        reference.contains(e.target) ||\n        !popper ||\n        popper.contains(e.target)) return;\n      this.showPopper = false;\n    },\n    cleanup() {\n      if (this.openDelay || this.closeDelay) {\n        clearTimeout(this._timer);\n      }\n    },\n    off(element, event, handler) {\n      // console.log(element,'off');\n      if (element && event) {\n        element.removeEventListener(event, handler, false);\n      }\n    },\n    on(element, event, handler) {\n      // console.log(element, event, handler, 'on');\n      if (element && event && handler) {\n        element.addEventListener(event, handler, false);\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n\n</style>\n"]}]}