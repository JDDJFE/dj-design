{"remainingRequest":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js!/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangjunxia/work-github/dj-design/packages/upload/src/upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangjunxia/work-github/dj-design/packages/upload/src/upload.vue","mtime":1675737648908},{"path":"/Users/wangjunxia/work-github/dj-design/babel.config.js","mtime":1660011372032},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IGRyYWdnYWJsZSBmcm9tICd2dWVkcmFnZ2FibGUnOwppbXBvcnQgbG9hZGluZyBmcm9tICdAL21peGlucy9sb2FkaW5nJzsgLy8gaW1wb3J0IGFqYXggZnJvbSAnLi9hamF4JzsKCmltcG9ydCBtZXNzYWdlIGZyb20gJy4uLy4uL21lc3NhZ2UvaW5kZXgnOwppbXBvcnQgYXhpb3MgZnJvbSAnLi9heGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnZGpVcGxvYWQnLAogIGNvbXBvbmVudHM6IHsKICAgIGRyYWdnYWJsZQogIH0sCiAgcHJvcHM6IHsKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5XQogICAgfSwKICAgIGZpdDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdmaWxsJwogICAgfSwKICAgIGxpbWl0OiBbTnVtYmVyLCBTdHJpbmddLAogICAgLy8g6ZmQ5Yi25Liq5pWwCiAgICB0eXBlOiB7CiAgICAgIC8vIOaWh+S7tuexu+Wei+i/mOaYr+WbvueJhwogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdmaWxlJwogICAgfSwKICAgIGFjdGlvbjogewogICAgICAvLyDkuIrkvKDlnLDlnYAKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfSwKICAgIGZpbGVOYW1lOiB7CiAgICAgIC8vIOS4iuS8oOaWh+S7tuWQjeWPguaVsAogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdmaWxlJwogICAgfSwKICAgIHBhcmFtczogewogICAgICAvLyDkuIrkvKDlj4LmlbAKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgd2lkdGg6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgaGVpZ2h0OiB7CiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIHNpemU6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgbXVsdGlwbGU6IHsKICAgICAgLy8g5piv5ZCm5Y+v5Lul5LiK5Lyg5aSa5LiqCiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgZGlzYWJsZWQ6IHsKICAgICAgLy8g5piv5ZCm56aB55SoCiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgYWNjZXB0OiB7CiAgICAgIC8vIOS4iuS8oOexu+Wei+mZkOWItgogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnCiAgICB9LAogICAgc3VmZml4OiB7CiAgICAgIC8vIOS4iuS8oOWQjue8gOmZkOWItgogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdqcGcscG5nLGdpZixqcGVnJwogICAgfSwKICAgIGJveHdpZHRoOiB7CiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIGJveFdpZHRoOiB7CiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIGJveGhlaWdodDogewogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBib3hIZWlnaHQ6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgYXV0b3VwbG9hZDogewogICAgICAvLyDmmK/lkKboh6rliqjkuIrkvKAKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIGF1dG9VcGxvYWQ6IHsKICAgICAgLy8g5piv5ZCm6Ieq5Yqo5LiK5LygCiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICBkcmFnZ2FibGU6IHsKICAgICAgLy8g5piv5ZCm5Y+v5Lul5bem5Y+z5ouW5ou956e75YqoCiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgZHJhZ1VwbG9hZDogewogICAgICAvLyDmmK/lkKblvIDlkK/mi5bmi73kuIrkvKAKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBzaG93VXBsb2FkTGlzdDogewogICAgICAvLyDmlofku7bkuIrkvKDlkI7kuIrkvKDliJfooajmmK/lkKblsZXnpLoKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIG5hbWU6IHsKICAgICAgLy8KICAgICAgdHlwZTogU3RyaW5nCiAgICB9LAogICAgc2VwYXJhdGU6IHsKICAgICAgLy8g5piv5ZCm5pSv5oyB5YmN5ZCO5YiG56a7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgYmVmb3JlVXBsb2FkOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uLAogICAgICBkZWZhdWx0OiAoKSA9PiB0cnVlCiAgICB9LAogICAgLy8g5omL5Yqo5LiK5Lyg77yM5Yik5pat5oyJ6ZKu5piv5ZCmZGlzYWJsZWQKICAgIHdhaXRpbmc6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBodHRwUmVxdWVzdDogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfSwKICAgIG9uU3VjY2VzczogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfSwKICAgIG9uRXJyb3I6IHsKICAgICAgdHlwZTogRnVuY3Rpb24KICAgIH0sCiAgICB3aXRoQ3JlZGVudGlhbHM6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBoZWFkZXJzOiB7CiAgICAgIHR5cGU6IE9iamVjdAogICAgfSwKICAgIGF1dG9Ub2FzdDogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgc2hvd0Rvd25sb2FkOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgc2hvd0RlbGV0ZTogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgb25SZW1vdmU6IHsKICAgICAgdHlwZTogRnVuY3Rpb24KICAgIH0KICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgaW1nU3R5bGU6IHsKICAgICAgICB3aWR0aDogdGhpcy5ib3hXaWR0aCB8fCB0aGlzLmJveHdpZHRoID8gKHRoaXMuYm94V2lkdGggfHwgdGhpcy5ib3h3aWR0aCkgKyAncHgnIDogJzEyMHB4JywKICAgICAgICBoZWlnaHQ6IHRoaXMuYm94SGVpZ2h0IHx8IHRoaXMuYm94aGVpZ2h0ID8gKHRoaXMuYm94SGVpZ2h0IHx8IHRoaXMuYm94aGVpZ2h0KSArICdweCcgOiAnMTIwcHgnLAogICAgICAgIGxpbmVIZWlnaHQ6IHRoaXMuYm94SGVpZ2h0IHx8IHRoaXMuYm94aGVpZ2h0ID8gKHRoaXMuYm94SGVpZ2h0IHx8IHRoaXMuYm94aGVpZ2h0KSArICdweCcgOiAnMTIwcHgnCiAgICAgIH0sCiAgICAgIGZpbGVEZXRhaWxBcnJheTogW10sCiAgICAgIHJlYWR5VXBsb2FkQXJyYXk6IFtdLAogICAgICBoYW5kbGVQaWN0dXJlVXJsOiAnJywKICAgICAgZmlsZUxpc3Q6IEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlIDogW3RoaXMudmFsdWVdIHx8IFtdLAogICAgICBkcmFnb3ZlcjogZmFsc2UsCiAgICAgIG1vZGFsSW1nU3R5bGU6IHsKICAgICAgICB3aWR0aDogJycsCiAgICAgICAgaGVpZ2h0OiAnJwogICAgICB9LAogICAgICBmaWxlOiBudWxsLAogICAgICBJU0VNSVRPTlVQTE9BRDogZmFsc2UsCiAgICAgIGZpbGVJY29uOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LGlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCUUFBQUFXQ0FZQUFBREFRYndHQUFBQUFYTlNSMElBcnM0YzZRQUFBYlJKUkVGVU9FK2xsVXNvUkdFVXgzK2ZHRE1TTTFLWVFwSEZiTHdWRWd0a28yeFp5RXBpWTZIRVdqWldMSlN3czdHejBLd284bGlNUEVhUnlXTWFJby9HYXlhTkVsZDNibVBtR3NZMTk2dTd1T2YrLzcvdm5POTgzU09rUXd4Y000WkVKMW50R2FRVVFjQUROM1BFWEM0Y3ZOQWlobmlPMUFscG1YRWsrb1BCeWswdzE0TGZDWTZ5Mk1CZHdNOE9WcHBGSDQ4aHNaQ1d1QWN5Z29HS1ZiQTBnRzhidHFyK0JzcE9BL3ZrMGlSNjhNb0dHU2g5T1JPTUlEL0dQQVdPQUZjdjNNNUh3K1VNWmFDOGpCd0VvZDNjcW9FaFcyb0pWRHVWdDZNZXVKcU9CcDRBbm9pd0NSY0ZOS21CbGtZdzVjUEhHMWpxbFF5dlpzRG5pQWErQTI3QUYvRXBqVE0xOEQ5TitlV0V2d0hYd1Z3SHZqM1lLby9kRkUxQWd4V1N6SkJvQWR1VVV2THBNSGdYTmNQamI0cW1ERU9pWkN2WVpwVU16OGZnY1VWbmhwcnQwVUoxeVlXamtOMFJWcjBIWUw4TkFxZWF0L2o1MmtUYW5hM2d0ZXNBcHRlRXpVS0FicUI4VFo3V2xJYVUydUZ5VWsrR0crQWVVWUFpQVlvWDRHSUM3dU10T2FjTE1sdkRKWCs4d3ZFQXZOM0ZlWWFhYmI4TDFUOVkvY0FIOVFqUUN4Uk1DTldRQ28yQy80TWZFTXlSdytBbmRoQ3ZkT2pOdXdvQUFBQUFTVVZPUks1Q1lJST0nCiAgICB9OwogIH0sCgogIHdhdGNoOiB7CiAgICB2YWx1ZTogewogICAgICBoYW5kbGVyKCkgewogICAgICAgIHRoaXMuZmlsZUxpc3QgPSB0aGlzLmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlIDogdGhpcy52YWx1ZSA/IFt7CiAgICAgICAgICB1cmw6IHRoaXMudmFsdWUKICAgICAgICB9XSA6IFtdOwoKICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgIHRoaXMuZmlsZUxpc3QgPSB0aGlzLmZpbGVMaXN0LnNsaWNlKC0xKTsKICAgICAgICB9CgogICAgICAgIGlmICghdGhpcy5hY3Rpb24pIHsKICAgICAgICAgIHRoaXMuZmlsZUxpc3QubWFwKCh2YWwsIGkpID0+IHsKICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbCkgIT09ICd7fScpIHsKICAgICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAnc3RhdHVzJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0LnNwbGljZShpLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZGVlcDogdHJ1ZQogICAgfSwKICAgIGZpbGVMaXN0OiB7CiAgICAgIGhhbmRsZXIodikgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHYsICdmaWxlTGlzdCcpOwogICAgICAgIGlmICh2Lmxlbmd0aCkgewogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOndhaXRpbmcnLCB0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOndhaXRpbmcnLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9LAoKICAgICAgZGVlcDogdHJ1ZQogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC8vIG5hbWXlgLzmoKHpqowKICAgIHVwbG9hZENvbnRlbnQoKSB7CiAgICAgIGlmICghKHRoaXMuYXV0b1VwbG9hZCAmJiB0aGlzLmF1dG91cGxvYWQpKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZUxpc3QuZmlsdGVyKHZhbCA9PiB7CiAgICAgICAgICByZXR1cm4gdmFsLnN0YXR1cyA9PSAnc3VjY2Vzcyc7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzLmZpbGVMaXN0OwogICAgfQoKICB9LAoKICBtb3VudGVkKCkgewogICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAvLyDpu5jorqTlm57mmL7lgLwKICAgICAgdGhpcy5maWxlTGlzdCA9IHRoaXMuaXNBcnJheSh0aGlzLnZhbHVlKSA/IHRoaXMudmFsdWUgOiB0aGlzLnZhbHVlID8gW3sKICAgICAgICB1cmw6IHRoaXMudmFsdWUKICAgICAgfV0gOiBbXTsKICAgICAgdGhpcy5maWxlTGlzdC5tYXAoKHZhbCwgaSkgPT4gewogICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpICE9PSAne30nICYmIHZhbCkgewogICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMudmFsdWUuc3BsaWNlKGksIDEpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKICB9LAoKICBtZXRob2RzOiB7CiAgICBvbkRyYWdvdmVyKCkgewogICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHsKICAgICAgICB0aGlzLmRyYWdvdmVyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKCiAgICBkcm9wKGUpIHsKICAgICAgdmFyIF90aGlzJHZhbHVlOwoKICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjsKCiAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkgewogICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgW10pOwogICAgICB9CgogICAgICBjb25zdCBkYXRhRmlsZUxpc3QgPSBlLmRhdGFUcmFuc2Zlci5maWxlczsgLy8g6I635Y+W5paH5Lu25a+56LGhCgogICAgICBpZiAoZGF0YUZpbGVMaXN0Lmxlbmd0aCA8IDEpIHsKICAgICAgICByZXR1cm47IC8vIOajgOa1i+aYr+WQpuacieaWh+S7tuaLluaLveWIsOmhtemdogogICAgICB9CgogICAgICBjb25zdCBmaWxlTGlzdExlbiA9ICgoX3RoaXMkdmFsdWUgPSB0aGlzLnZhbHVlKSA9PT0gbnVsbCB8fCBfdGhpcyR2YWx1ZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkdmFsdWUubGVuZ3RoKSB8fCAwOwogICAgICBjb25zdCB0YXJnZXRGaWxlc0xlbiA9IGRhdGFGaWxlTGlzdC5sZW5ndGg7IC8vIOWmguaenCDnjrDmnInnmoTmlofku7bmlbAgKyDpgInkuK3nmoTmlofku7bmlbAgPiBsaW1pdOmZkOWItuaVsCDop6blj5EKCiAgICAgIGlmICh0aGlzLmxpbWl0ICYmIGZpbGVMaXN0TGVuICsgdGFyZ2V0RmlsZXNMZW4gPiB0aGlzLmxpbWl0KSB7CiAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdsaW1pdE51bScsIHRoaXMuZmlsZUxpc3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCB3YXJuID0gbWVzc2FnZS53YXJuaW5nOwogICAgICAgICAgd2Fybihg5b2T5YmN6ZmQ5Yi26YCJ5oupICR7dGhpcy5saW1pdH0g5Liq5paH5Lu277yM5pys5qyh6YCJ5oup5LqGICR7dGFyZ2V0RmlsZXNMZW59IOS4quaWh+S7tu+8jOWFsemAieaLqeS6hiAke2ZpbGVMaXN0TGVuICsgdGFyZ2V0RmlsZXNMZW59IOS4quaWh+S7tmApOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIGlmICh0aGlzLmxpbWl0ICYmIHRoaXMuZmlsZUxpc3QubGVuZ3RoPT10aGlzLmxpbWl0KXsKICAgICAgLy8gICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAvLyAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2xpbWl0TnVtJywgdGhpcy5maWxlTGlzdCk7CiAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgLy8gICAgIG1lc3NhZ2UuZXJyb3IoJ+acgOWkmuWFgeiuuOS4iuS8oCcrdGhpcy5saW1pdCsn5Liq5paH5Lu2Jyk7CiAgICAgIC8vICAgfQogICAgICAvLyAgIHJldHVybjsKICAgICAgLy8gfQoKCiAgICAgIGNvbnN0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKCiAgICAgIGlmICh0aGlzLnBhcmFtcykgewogICAgICAgIE9iamVjdC5rZXlzKHRoaXMucGFyYW1zKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgICBkYXRhLmFwcGVuZChrZXksIHRoaXMucGFyYW1zW2tleV0pOwogICAgICAgIH0pOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFGaWxlTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuZmlsZSA9IGRhdGFGaWxlTGlzdFtpXTsKICAgICAgICBkYXRhLmFwcGVuZCh0aGlzLmZpbGVOYW1lLCBkYXRhRmlsZUxpc3RbaV0pOwogICAgICAgIHRoaXMub25VcGxvYWQoZGF0YSwgZGF0YUZpbGVMaXN0W2ldLCBpKTsKICAgICAgfQogICAgfSwKCiAgICBzb3J0KCkgewogICAgICAvLyDmi5bmi73mlLnlj5jkvY3nva4KICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgIH0sCgogICAgLyoqCiAgICAgKiDngrnlh7vkuIrkvKDvvIjmnKrnoa7lrprku4XmiZPlvIDlvLnnqpfvvInml7bop6blj5HvvIwKICAgICAqLwogICAgdXBsb2FkKGV2ZW50KSB7CiAgICAgIGxldCBzZWxlY3RGaWxlID0gKCkgPT4gewogICAgICAgIHRoaXMuJGVsLmNoaWxkcmVuWzBdLnZhbHVlID0gJyc7IC8vIOino+WGs+S4pOasoeS4iuS8oOWQjOagt+aWh+S7tuS4jeinpuWPkWNoYW5nZemXrumimAoKICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHsKICAgICAgICAgIHRoaXMuJGVsLmNoaWxkcmVuWzBdLmNsaWNrKCk7CiAgICAgICAgfQogICAgICB9OwoKICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5jbGljaykgewogICAgICAgIHRoaXMuJGVtaXQoJ2NsaWNrJywgZXZlbnQsIHNlbGVjdEZpbGUpOwogICAgICB9IGVsc2UgewogICAgICAgIHNlbGVjdEZpbGUoKTsKICAgICAgfQogICAgfSwKCiAgICAvKioKICAgICAqIOeCueWHu+ehruiupOS4iuS8oOaXtuinpuWPkQogICAgICovCiAgICBjaGFuZ2UoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5jaGFuZ2UpIHsKICAgICAgICB0aGlzLiRlbWl0KCdjaGFuZ2UnLCBldmVudCwgdGhpcy5jaGFuZ2VGaWxlKTsKICAgICAgfQoKICAgICAgdGhpcy5jaGFuZ2VGaWxlKGV2ZW50KTsKICAgIH0sCgogICAgY2hhbmdlRmlsZShldmVudCkgewogICAgICB2YXIgX3RoaXMkdmFsdWUyLCBfZXZlbnQkdGFyZ2V0JGZpbGVzOwoKICAgICAgaWYgKHRoaXMuYXV0b3VwbG9hZCAmJiB0aGlzLmF1dG9VcGxvYWQpIHsKICAgICAgICBpZiAodGhpcy5maWxlTGlzdC5sZW5ndGggPT0gMCB8fCB0aGlzLmZpbGVMaXN0LmZpbHRlcih2YWwgPT4gdmFsLnN0YXR1cyA9PSAnc3VjY2VzcycpLmxlbmd0aCA9PSAwKSB7CiAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gW107CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoIXRoaXMubXVsdGlwbGUgJiYgKCEodGhpcy5hdXRvVXBsb2FkICYmIHRoaXMuYXV0b3VwbG9hZCkgfHwgdGhpcy50eXBlID09ICdpbWcnIHx8IHRoaXMudHlwZSA9PSAnZmlsZScpKSB7CiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBbXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGZpbGVMaXN0TGVuID0gKChfdGhpcyR2YWx1ZTIgPSB0aGlzLnZhbHVlKSA9PT0gbnVsbCB8fCBfdGhpcyR2YWx1ZTIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJHZhbHVlMi5sZW5ndGgpIHx8IDA7CiAgICAgIGNvbnN0IHRhcmdldEZpbGVzTGVuID0gKF9ldmVudCR0YXJnZXQkZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXMpID09PSBudWxsIHx8IF9ldmVudCR0YXJnZXQkZmlsZXMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9ldmVudCR0YXJnZXQkZmlsZXMubGVuZ3RoOyAvLyDlpoLmnpwg546w5pyJ55qE5paH5Lu25pWwICsg6YCJ5Lit55qE5paH5Lu25pWwID4gbGltaXTpmZDliLbmlbAg6Kem5Y+RCgogICAgICBpZiAodGhpcy5saW1pdCAmJiBmaWxlTGlzdExlbiArIHRhcmdldEZpbGVzTGVuID4gdGhpcy5saW1pdCkgewogICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnbGltaXROdW0nLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5YW85a656L+Q6JCl5bmz5Y+w5ZKM5ZWG5a625Lit5b+D55qEd2Fybu+8jFVJ5bqT55qE5pivd2FybmluZwogICAgICAgICAgY29uc3Qgd2FybiA9IG1lc3NhZ2Uud2FybmluZzsKICAgICAgICAgIHdhcm4oYOW9k+WJjemZkOWItumAieaLqSAke3RoaXMubGltaXR9IOS4quaWh+S7tu+8jOacrOasoemAieaLqeS6hiAke3RhcmdldEZpbGVzTGVufSDkuKrmlofku7bvvIzlhbHpgInmi6nkuoYgJHtmaWxlTGlzdExlbiArIHRhcmdldEZpbGVzTGVufSDkuKrmlofku7ZgKTsKICAgICAgICB9CgogICAgICAgIHJldHVybjsKICAgICAgfSAvLyDlpoLmnpwg546w5pyJ55qE5paH5Lu25pWwID0gbGltaXTpmZDliLbmlbAg6Kem5Y+RCiAgICAgIC8vIGlmICh0aGlzLmxpbWl0ICYmIGZpbGVMaXN0TGVuID09IHRoaXMubGltaXQpIHsKICAgICAgLy8gICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAvLyAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2xpbWl0TnVtJywgdGhpcy5maWxlTGlzdCk7CiAgICAgIC8vICAgfSBlbHNlIHsKICAgICAgLy8gICAgIG1lc3NhZ2UuZXJyb3IoJ+acgOWkmuWFgeiuuOS4iuS8oCcrdGhpcy5saW1pdCsn5Liq5paH5Lu2Jyk7CiAgICAgIC8vICAgfQogICAgICAvLyAgIHJldHVybjsKICAgICAgLy8gfQoKCiAgICAgIHZhciBkYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIHZhciBmaWxlID0gZXZlbnQudGFyZ2V0LmZpbGVzWzBdOwogICAgICB2YXIgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7IC8vIOS4iuS8oOS4lOagoemqjOaIkOWKn+S4pOS4quS7peS4iuaWh+S7tu+8jOi/m+WFpQogICAgICAvLyBsZXQgZmlsZXNDb3B5ID0gW107CgogICAgICBpZiAoZmlsZXMubGVuZ3RoID4gMSkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGxldCBkYXRhMSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgbGV0IHIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICAgICAgci5yZWFkQXNEYXRhVVJMKGZpbGVzW2ldKTsKCiAgICAgICAgICByLm9ubG9hZCA9IGUgPT4gewogICAgICAgICAgICAvLyDkuIrkvKDnmoTkuLrmlofku7bvvIjpnZ7lm77niYfvvIkKICAgICAgICAgICAgaWYgKHRoaXMudHlwZSA9PSAnZmlsZScpIHsKICAgICAgICAgICAgICBpZiAodGhpcy5zaXplICYmIHBhcnNlRmxvYXQodGhpcy5zaXplKSA8IChmaWxlLnNpemUgLyAxMDAwKS50b0ZpeGVkKDIpKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnZmlsZVNpemUnLCBmaWxlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOaWh+S7tuW6lOWwj+S6juetieS6jiR7dGhpcy5zaXplfUtCLOeOsOS4uu+8miR7KGZpbGUuc2l6ZSAvIDEwMDApLnRvRml4ZWQoMil9S0JgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gWy4uLnRoaXMuZmlsZUxpc3QsIHsKICAgICAgICAgICAgICAgIG5hbWU6IGZpbGVzW2ldLm5hbWUKICAgICAgICAgICAgICB9XTsKICAgICAgICAgICAgICB0aGlzLnJlYWR5VXBsb2FkQXJyYXkucHVzaCh7CiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhMSwKICAgICAgICAgICAgICAgIGZpbGU6IGZpbGVzW2ldCiAgICAgICAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKHRoaXMucmVhZHlVcGxvYWRBcnJheSk7CgogICAgICAgICAgICAgIGlmICh0aGlzLmF1dG91cGxvYWQgJiYgdGhpcy5hdXRvVXBsb2FkKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvblVwbG9hZCcsIGZpbGVzW2ldLCBmaWxlcyk7CgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgIGRhdGExLmFwcGVuZCh0aGlzLmZpbGVOYW1lLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIHRoaXMub25VcGxvYWQoZGF0YTEsIGZpbGVzW2ldKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIF90aGlzJHN1ZmZpeCwgX2ZpbGVzJGksIF9maWxlcyRpJHR5cGUsIF9maWxlcyRpJHR5cGUkc3BsaXQkOwoKICAgICAgICAgICAgICBsZXQgYWNjZXB0VHlwZUFycmF5ID0gKF90aGlzJHN1ZmZpeCA9IHRoaXMuc3VmZml4KSA9PT0gbnVsbCB8fCBfdGhpcyRzdWZmaXggPT09IHZvaWQgMCA/IHZvaWQgMCA6IF90aGlzJHN1ZmZpeC5zcGxpdCgnLCcpOwogICAgICAgICAgICAgIGxldCBmaWxlVHlwZSA9IChfZmlsZXMkaSA9IGZpbGVzW2ldKSA9PT0gbnVsbCB8fCBfZmlsZXMkaSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9maWxlcyRpJHR5cGUgPSBfZmlsZXMkaS50eXBlKSA9PT0gbnVsbCB8fCBfZmlsZXMkaSR0eXBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpbGVzJGkkdHlwZSRzcGxpdCQgPSBfZmlsZXMkaSR0eXBlLnNwbGl0KCcvJylbMV0pID09PSBudWxsIHx8IF9maWxlcyRpJHR5cGUkc3BsaXQkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZmlsZXMkaSR0eXBlJHNwbGl0JC50b0xvd2VyQ2FzZSgpOwoKICAgICAgICAgICAgICBpZiAoKGFjY2VwdFR5cGVBcnJheSA9PT0gbnVsbCB8fCBhY2NlcHRUeXBlQXJyYXkgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFjY2VwdFR5cGVBcnJheS5sZW5ndGgpID4gMCAmJiBhY2NlcHRUeXBlQXJyYXkuaW5kZXhPZihmaWxlVHlwZSkgPCAwKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnZmlsZVR5cGUnLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKGDor7fkuIrkvKDnsbvlnovkuLoke3RoaXMuc3VmZml4feeahOaWh+S7tiFgKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyDkuIrkvKDlm77niYcKCgogICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gZS5jdXJyZW50VGFyZ2V0LnJlc3VsdDsKICAgICAgICAgICAgICBpbWcuc3JjID0gYmFzZTY0VXJsOwoKICAgICAgICAgICAgICBjb25zdCBpbWdMb2FkRnVuYyA9IGUgPT4gewogICAgICAgICAgICAgICAgdmFyIF93ID0gZS5jdXJyZW50VGFyZ2V0LndpZHRoOwogICAgICAgICAgICAgICAgdmFyIF9oID0gZS5jdXJyZW50VGFyZ2V0LmhlaWdodDsgLy8g5p+l55yL5aSn5Zu+5by556qX5Zu+54mH5a696auY5q+UCgogICAgICAgICAgICAgICAgaWYgKF93IDwgX2gpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbEltZ1N0eWxlID0gewogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAnMTAwJScKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIHRoaXMubW9kYWxJbWdTdHlsZSA9IHsKICAgICAgICAgICAgICAgICAgICB3aWR0aDogJzEwMCUnLAogICAgICAgICAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nCiAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICB9IC8vIOWIpOaWreWuvemrmOaYr+WQpuespuWQiOinhOWumgoKCiAgICAgICAgICAgICAgICBpZiAodGhpcy53aWR0aCAmJiB0aGlzLmhlaWdodCAmJiAoX3cgIT0gdGhpcy53aWR0aCB8fCBfaCAhPSB0aGlzLmhlaWdodCkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5JU0VNSVRPTlVQTE9BRCA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICd3aWR0aCZoZWlnaHQnLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH5bqU5Li6JHt0aGlzLndpZHRofXB4KiR7dGhpcy5oZWlnaHR9cHgs546w5Li6JHtfd31weCoke19ofXB4YCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gLy8g5Yik5pat5a695bqm5piv5ZCm56ym5ZCI6KeE5a6aCgoKICAgICAgICAgICAgICAgIGlmICh0aGlzLndpZHRoICYmIF93ICE9IHRoaXMud2lkdGgpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5JU0VNSVRPTlVQTE9BRCA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICd3aWR0aCcsIGZpbGVzW2ldKTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKGDlm77niYflrr3luqblupTkuLoke3RoaXMud2lkdGh9cHgs546w5Li6JHtfd31weGApOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IC8vIOWIpOaWremrmOW6puaYr+WQpuespuWQiOinhOWumgoKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5oZWlnaHQgJiYgX2ggIT0gdGhpcy5oZWlnaHQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5JU0VNSVRPTlVQTE9BRCA9IHRydWU7CgogICAgICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdoZWlnaHQnLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH6auY5bqm5bqU5Li6JHt0aGlzLmhlaWdodH1weCznjrDkuLoke19ofXB4YCk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gLy8g5Yik5pat5paH5Lu25aSn5bCP5piv5ZCm56ym5ZCI6KeE5a6aCgoKICAgICAgICAgICAgICAgIGlmICh0aGlzLnNpemUgJiYgcGFyc2VGbG9hdCh0aGlzLnNpemUpIDwgKGZpbGVzW2ldLnNpemUgLyAxMDI0KS50b0ZpeGVkKDIpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuSVNFTUlUT05VUExPQUQgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnZmlsZVNpemUnLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH5bqU5bCP5LqOJHt0aGlzLnNpemV9S0Is546w5Li677yaJHsoZmlsZXNbaV0uc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMil9S0JgKTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAvLyBmaWxlc0NvcHkucHVzaChmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAvLyB0aGlzLmZpbGVMaXN0LnB1c2goe25hbWU6IGZpbGVzW2ldLm5hbWV9KTsKCgogICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0b3VwbG9hZCAmJiB0aGlzLmF1dG9VcGxvYWQpIHsKICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25VcGxvYWQnLCBmaWxlc1tpXSwgZmlsZXMpOwoKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgZGF0YTEuYXBwZW5kKHRoaXMuZmlsZU5hbWUsIGZpbGVzW2ldKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9uVXBsb2FkKGRhdGExLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpbWcub25sb2FkID0gZSA9PiB7CiAgICAgICAgICAgICAgICBpbWdMb2FkRnVuYyhlKTsKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpbWcub25lcnJvciA9IGUgPT4gewogICAgICAgICAgICAgICAgaW1nTG9hZEZ1bmMoZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9IC8vIHRoaXMuJGVtaXQoJ2lucHV0JywgdGhpcy5maWxlTGlzdCk7CgoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGRhdGEuYXBwZW5kKHRoaXMuZmlsZU5hbWUsIGZpbGUpOwogICAgICB0aGlzLmZpbGUgPSBmaWxlOwoKICAgICAgaWYgKHRoaXMucGFyYW1zKSB7CiAgICAgICAgT2JqZWN0LmtleXModGhpcy5wYXJhbXMpLmZvckVhY2goa2V5ID0+IHsKICAgICAgICAgIGRhdGEuYXBwZW5kKGtleSwgdGhpcy5wYXJhbXNba2V5XSk7CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIGxldCByID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgci5yZWFkQXNEYXRhVVJMKGZpbGUpOwoKICAgICAgci5vbmxvYWQgPSBlID0+IHsKICAgICAgICAvLyDkuIrkvKDnmoTkuLrmlofku7bvvIjpnZ7lm77niYfvvIkKICAgICAgICBpZiAodGhpcy50eXBlID09ICdmaWxlJykgewogICAgICAgICAgLy8g5Yik5pat5paH5Lu25aSn5bCP5piv5ZCm56ym5ZCI6KeE5a6aCiAgICAgICAgICBpZiAodGhpcy5zaXplICYmIHBhcnNlRmxvYXQodGhpcy5zaXplKSA8IChmaWxlLnNpemUgLyAxMDAwKS50b0ZpeGVkKDIpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2ZpbGVTaXplJywgZmlsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5paH5Lu25bqU5bCP5LqO562J5LqOJHt0aGlzLnNpemV9S0Is546w5Li677yaJHsoZmlsZS5zaXplIC8gMTAwMCkudG9GaXhlZCgyKX1LQmApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRoaXMuYXV0b1VwbG9hZCAmJiB0aGlzLmF1dG91cGxvYWQpIHsKICAgICAgICAgICAgLy8g6Ieq5Yqo5LiK5Lyg55qE5oOF5Ya1CiAgICAgICAgICAgIHRoaXMub25VcGxvYWQoZGF0YSwgZmlsZSk7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubXVsdGlwbGUpIHsKICAgICAgICAgICAgLy8g6Iul5piv5omL5Yqo5LiK5LygCiAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QucHVzaCh7CiAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLnJlYWR5VXBsb2FkQXJyYXkucHVzaCh7CiAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICBmaWxlOiBmaWxlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5maWxlTGlzdCA9IFt7CiAgICAgICAgICAgICAgbmFtZTogZmlsZS5uYW1lCiAgICAgICAgICAgIH1dOwogICAgICAgICAgICB0aGlzLnJlYWR5VXBsb2FkQXJyYXkgPSBbewogICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgZmlsZTogZmlsZQogICAgICAgICAgICB9XTsKICAgICAgICAgIH0gLy8gdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZhciBfdGhpcyRzdWZmaXgyLCBfZmlsZSR0eXBlLCBfZmlsZSR0eXBlJHNwbGl0JDsKCiAgICAgICAgICBsZXQgYWNjZXB0VHlwZUFycmF5ID0gKF90aGlzJHN1ZmZpeDIgPSB0aGlzLnN1ZmZpeCkgPT09IG51bGwgfHwgX3RoaXMkc3VmZml4MiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX3RoaXMkc3VmZml4Mi5zcGxpdCgnLCcpOwogICAgICAgICAgbGV0IGZpbGVUeXBlID0gZmlsZSA9PT0gbnVsbCB8fCBmaWxlID09PSB2b2lkIDAgPyB2b2lkIDAgOiAoX2ZpbGUkdHlwZSA9IGZpbGUudHlwZSkgPT09IG51bGwgfHwgX2ZpbGUkdHlwZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogKF9maWxlJHR5cGUkc3BsaXQkID0gX2ZpbGUkdHlwZS5zcGxpdCgnLycpWzFdKSA9PT0gbnVsbCB8fCBfZmlsZSR0eXBlJHNwbGl0JCA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2ZpbGUkdHlwZSRzcGxpdCQudG9Mb3dlckNhc2UoKTsgLy8g5Yik5pat5paH5Lu257G75Z6L5piv5ZCm56ym5ZCI6KeE5a6aCgogICAgICAgICAgaWYgKChhY2NlcHRUeXBlQXJyYXkgPT09IG51bGwgfHwgYWNjZXB0VHlwZUFycmF5ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY2NlcHRUeXBlQXJyYXkubGVuZ3RoKSA+IDAgJiYgYWNjZXB0VHlwZUFycmF5LmluZGV4T2YoZmlsZVR5cGUpIDwgMCkgewogICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdmaWxlVHlwZScsIGZpbGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOivt+S4iuS8oOexu+Wei+S4uiR7dGhpcy5zdWZmaXh955qE5paH5Lu2IWApOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9IC8vIOS4iuS8oOWbvueJhwoKCiAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICAgICAgICB2YXIgYmFzZTY0VXJsID0gZS5jdXJyZW50VGFyZ2V0LnJlc3VsdDsKICAgICAgICAgIGltZy5zcmMgPSBiYXNlNjRVcmw7IC8vIOWbvueJh+WKoOi9veeahOebkeWQrOWHveaVsAoKICAgICAgICAgIGNvbnN0IGltZ0xvYWRGdW5jID0gZSA9PiB7CiAgICAgICAgICAgIHZhciBfdyA9IGUuY3VycmVudFRhcmdldC53aWR0aDsKICAgICAgICAgICAgdmFyIF9oID0gZS5jdXJyZW50VGFyZ2V0LmhlaWdodDsgLy8g5p+l55yL5aSn5Zu+5by556qX5Zu+54mH5a696auY5q+UCgogICAgICAgICAgICBpZiAoX3cgPCBfaCkgewogICAgICAgICAgICAgIHRoaXMubW9kYWxJbWdTdHlsZSA9IHsKICAgICAgICAgICAgICAgIHdpZHRoOiAnYXV0bycsCiAgICAgICAgICAgICAgICBoZWlnaHQ6ICcxMDAlJwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5tb2RhbEltZ1N0eWxlID0gewogICAgICAgICAgICAgICAgd2lkdGg6ICcxMDAlJywKICAgICAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSAvLyDliKTmlq3lrr3pq5jmmK/lkKbnrKblkIjop4TlrpoKCgogICAgICAgICAgICBpZiAodGhpcy53aWR0aCAmJiB0aGlzLmhlaWdodCAmJiAoX3cgIT0gdGhpcy53aWR0aCB8fCBfaCAhPSB0aGlzLmhlaWdodCkpIHsKICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ3dpZHRoJmhlaWdodCcsIGZpbGUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKGDlm77niYflupTkuLoke3RoaXMud2lkdGh9cHgqJHt0aGlzLmhlaWdodH1weCznjrDkuLoke193fXB4KiR7X2h9cHhgKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSAvLyDliKTmlq3lrr3luqbmmK/lkKbnrKblkIjop4TlrpoKCgogICAgICAgICAgICBpZiAodGhpcy53aWR0aCAmJiBfdyAhPSB0aGlzLndpZHRoKSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICd3aWR0aCcsIGZpbGUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKGDlm77niYflrr3luqblupTkuLoke3RoaXMud2lkdGh9cHgs546w5Li6JHtfd31weGApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IC8vIOWIpOaWremrmOW6puaYr+WQpuespuWQiOinhOWumgoKCiAgICAgICAgICAgIGlmICh0aGlzLmhlaWdodCAmJiBfaCAhPSB0aGlzLmhlaWdodCkgewogICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnaGVpZ2h0JywgZmlsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+mrmOW6puW6lOS4uiR7dGhpcy5oZWlnaHR9cHgs546w5Li6JHtfaH1weGApOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IC8vIOWIpOaWreaWh+S7tuWkp+Wwj+aYr+WQpuespuWQiOinhOWumgoKCiAgICAgICAgICAgIGlmICh0aGlzLnNpemUgJiYgcGFyc2VGbG9hdCh0aGlzLnNpemUpIDwgKGZpbGUuc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMikpIHsKICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2ZpbGVTaXplJywgZmlsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+W6lOWwj+S6jiR7dGhpcy5zaXplfUtCLOeOsOS4uu+8miR7KGZpbGUuc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMil9S0JgKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5vblVwbG9hZChkYXRhLCBmaWxlKTsKICAgICAgICAgIH07CgogICAgICAgICAgaW1nLm9ubG9hZCA9IGUgPT4gewogICAgICAgICAgICBpbWdMb2FkRnVuYyhlKTsKICAgICAgICAgIH07CgogICAgICAgICAgaW1nLm9uZXJyb3IgPSBlID0+IHsKICAgICAgICAgICAgaW1nTG9hZEZ1bmMoZSk7CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfTsKICAgIH0sCgogICAgb25VcGxvYWQoZGF0YSwgZmlsZSwgaSkgewogICAgICBsZXQgdGhhdCA9IHRoaXM7CiAgICAgIGxldCBlbCA9IHRoaXMuJGVsOwoKICAgICAgaWYgKHRoaXMuZHJhZ1VwbG9hZCkgewogICAgICAgIGVsID0gdGhpcy4kcmVmcy5kcmFnVXBsb2FkOwogICAgICB9CgogICAgICBsZXQgdXBsb2FkID0gKCkgPT4gewogICAgICAgIGxldCBwYXJhbXMgPSB7fTsKCiAgICAgICAgaWYgKHRoaXMucGFyYW1zKSB7CiAgICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnBhcmFtcykuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICBwYXJhbXNba2V5XSA9IHRoaXMucGFyYW1zW2tleV07CiAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmFjdGlvbikgewogICAgICAgICAgdGhpcy4kZWwucXVlcnlTZWxlY3RvciAmJiBsb2FkaW5nLm1ldGhvZHMuc2hvd0xvYWRpbmcoewogICAgICAgICAgICBlbCwKICAgICAgICAgICAgd2hpdGU6IHRydWUKICAgICAgICAgIH0pOyAvLyBsZXQgaHR0cFJlcXVlc3QgPSB0aGlzLmh0dHBSZXF1ZXN0IHx8IGFqYXg7CiAgICAgICAgICAvLyBjb25zdCBpc0RqID0gd2luZG93LmxvY2F0aW9uLmhvc3QuZW5kc1dpdGgoJ2pkZGouY29tJyk7CiAgICAgICAgICAvLyBpZiAoaXNEaikgewoKICAgICAgICAgIGxldCBodHRwUmVxdWVzdCA9IHRoaXMuaHR0cFJlcXVlc3QgfHwgYXhpb3MudXBsb2FkOyAvLyB9CgogICAgICAgICAgaHR0cFJlcXVlc3QodGhpcy5hY3Rpb24sIHRoaXMuc2VwYXJhdGUgPyBwYXJhbXMgOiBkYXRhLCB0aGlzLnNlcGFyYXRlID8gZmlsZSA6IG51bGwpLnRoZW4ocmVzdWx0ID0+IHsKICAgICAgICAgICAgdGhhdC4kZWwucXVlcnlTZWxlY3RvciAmJiBsb2FkaW5nLm1ldGhvZHMuY2xvc2VMb2FkaW5nKHsKICAgICAgICAgICAgICBlbAogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChyZXN1bHQuY29kZSA9PSAwKSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5zdWNjZXNzKHJlc3VsdC5tc2cpOwogICAgICAgICAgICAgIHRoYXQuZmlsZURldGFpbEFycmF5LnB1c2goZmlsZSk7CiAgICAgICAgICAgICAgdGhhdC4kZW1pdCgnb25TdWNjZXNzJywgcmVzdWx0LCBmaWxlLCB0aGF0LmZpbGVEZXRhaWxBcnJheSk7CgogICAgICAgICAgICAgIGlmICh0aGlzLmF1dG91cGxvYWQgJiYgdGhpcy5hdXRvVXBsb2FkIHx8IHRoaXMuZHJhZ1VwbG9hZCkgewogICAgICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0Lm1hcCgoaXRlbSwgaSkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShpdGVtKSAhPT0gJ3t9JyAmJiBpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQoaXRlbSwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy5maWxlTGlzdC5wb3AoKTsKICAgICAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMuZmlsZUxpc3RbaV0pICE9PSAne30nICYmIHRoaXMuZmlsZUxpc3RbaV0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5maWxlTGlzdFtpXSwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKHJlc3VsdC5tc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICB9LCBlcnIgPT4gewogICAgICAgICAgICB0aGF0LiRlbC5xdWVyeVNlbGVjdG9yICYmIGxvYWRpbmcubWV0aG9kcy5jbG9zZUxvYWRpbmcoewogICAgICAgICAgICAgIGVsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB0aGlzLmZpbGVMaXN0LmZpbHRlcih2YWwgPT4gdmFsLnN0YXR1cyAhPSAnc3VjY2VzcycpLm1hcCh2YWwgPT4gewogICAgICAgICAgICAgIHRoaXMuJHNldCh2YWwsICdzdGF0dXMnLCAnZXJyb3InKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoYXQuJGVtaXQoJ29uRXJyb3InLCBlcnIsIGZpbGUsIHRoYXQuZmlsZUxpc3QpOwogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCBvcHRpb25zID0gewogICAgICAgICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsCiAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy53aXRoQ3JlZGVudGlhbHMsCiAgICAgICAgICAgIGZpbGU6IGZpbGUsCiAgICAgICAgICAgIGRhdGE6IHRoaXMucGFyYW1zLAogICAgICAgICAgICBmaWxlbmFtZTogdGhpcy5maWxlTmFtZSwKICAgICAgICAgICAgYWN0aW9uOiB0aGlzLmFjdGlvbiwKICAgICAgICAgICAgb25TdWNjZXNzOiByZXN1bHQgPT4gewogICAgICAgICAgICAgIHRoYXQuJGVsLnF1ZXJ5U2VsZWN0b3IgJiYgbG9hZGluZy5tZXRob2RzLmNsb3NlTG9hZGluZyh7CiAgICAgICAgICAgICAgICBlbAogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAodGhpcy5vblN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIGNvbnN0IHNvcmYgPSB0aGlzLm9uU3VjY2VzcyhyZXN1bHQsIGZpbGUpOwoKICAgICAgICAgICAgICAgIGlmIChzb3JmIHx8IHNvcmYgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICB0aGlzLmFmdGVyU3VjY2Vzc0Z1bihmaWxlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIOWFvOWuueWIsOWutuS4muWKoQoKCiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb2RlID09IDApIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc3VjY2VzcyhyZXN1bHQubXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuJGVtaXQoJ29uU3VjY2VzcycsIHJlc3VsdCwgZmlsZSwgdGhhdC5maWxlRGV0YWlsQXJyYXkpOwogICAgICAgICAgICAgICAgdGhpcy5hZnRlclN1Y2Nlc3NGdW4oZmlsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IocmVzdWx0Lm1zZyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LAogICAgICAgICAgICBvbkVycm9yOiBlcnIgPT4gewogICAgICAgICAgICAgIHRoYXQuJGVsLnF1ZXJ5U2VsZWN0b3IgJiYgbG9hZGluZy5tZXRob2RzLmNsb3NlTG9hZGluZyh7CiAgICAgICAgICAgICAgICBlbAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QuZmlsdGVyKHZhbCA9PiB2YWwuc3RhdHVzICE9ICdzdWNjZXNzJykubWFwKHZhbCA9PiB7CiAgICAgICAgICAgICAgICB0aGlzLiRzZXQodmFsLCAnc3RhdHVzJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMub25FcnJvcikgewogICAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKGVyciwgZmlsZSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0aGF0LiRlbWl0KCdvbkVycm9yJywgZXJyLCBmaWxlLCB0aGF0LmZpbGVMaXN0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIGNvbnN0IHJlcSA9IGh0dHBSZXF1ZXN0KG9wdGlvbnMpOwoKICAgICAgICAgIGlmIChyZXEgJiYgcmVxLnRoZW4pIHsKICAgICAgICAgICAgcmVxLnRoZW4ob3B0aW9ucy5vblN1Y2Nlc3MsIG9wdGlvbnMub25FcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ29uVXBsb2FkJywgdGhpcy5maWxlKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAodGhpcy5iZWZvcmVVcGxvYWQgJiYgdHlwZW9mIHRoaXMuYmVmb3JlVXBsb2FkID09PSAnZnVuY3Rpb24nICYmICF0aGlzLmJlZm9yZVVwbG9hZChmaWxlLCB1cGxvYWQpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICB1cGxvYWQoKTsKICAgIH0sCgogICAgYWZ0ZXJTdWNjZXNzRnVuKGZpbGUpIHsKICAgICAgdGhpcy5maWxlRGV0YWlsQXJyYXkucHVzaChmaWxlKTsKCiAgICAgIGlmICh0aGlzLmF1dG91cGxvYWQgJiYgdGhpcy5hdXRvVXBsb2FkIHx8IHRoaXMuZHJhZ1VwbG9hZCkgewogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuZmlsZUxpc3QubWFwKGl0ZW0gPT4gewogICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoaXRlbSkgIT09ICd7fScgJiYgaXRlbSkgewogICAgICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnc3RhdHVzJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5maWxlTGlzdCA9IHRoaXMuZmlsZUxpc3QucG9wKCk7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHRoaXMuZmlsZUxpc3RbaV0pICE9PSAne30nICYmIHRoaXMuZmlsZUxpc3RbaV0pIHsKICAgICAgICAgICAgdGhpcy4kc2V0KHRoaXMuZmlsZUxpc3RbaV0sICdzdGF0dXMnLCAnc3VjY2VzcycpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CgogICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMuZmlsZUxpc3QpOwogICAgfSwKCiAgICAvLyDmiYvliqjkuIrkvKAKICAgIGhhbmRVcGxvYWQoKSB7CiAgICAgIGxldCByZWFkeVVwbG9hZEZpbGVMaXN0ID0gdGhpcy5maWxlTGlzdC5maWx0ZXIoaXRlbSA9PiB7CiAgICAgICAgcmV0dXJuIGl0ZW0uc3RhdHVzICE9ICdzdWNjZXNzJzsKICAgICAgfSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlYWR5VXBsb2FkRmlsZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLm9uVXBsb2FkKHRoaXMucmVhZHlVcGxvYWRBcnJheVtpXS5kYXRhLCB0aGlzLnJlYWR5VXBsb2FkQXJyYXlbaV0uZmlsZSwgdGhpcy5maWxlTGlzdC5pbmRleE9mKHJlYWR5VXBsb2FkRmlsZUxpc3RbaV0pKTsKICAgICAgfQogICAgfSwKCiAgICBoYW5kbGVQaWN0dXJlUmVtb3ZlKGkpIHsKICAgICAgLy8g5aaC5p6c6YCa6L+HcHJvcHPkvKDlhaXkuoZvblJlbW92Ze+8jOaJp+ihjOatpOmAu+i+kQogICAgICBpZiAodGhpcy5vblJlbW92ZSkgewogICAgICAgIC8vIG9uUmVtb3Zl5Ye95pWw5LitcmV0dXJuIGZhbHNl5YiZ5Y+W5raI5Yig6Zmk5pON5L2cCiAgICAgICAgY29uc3QgYm9vbCA9IHRoaXMub25SZW1vdmUodGhpcy5maWxlTGlzdFtpXSwgaSk7CgogICAgICAgIGlmIChib29sICE9PSBmYWxzZSkgewogICAgICAgICAgdGhpcy5maWxlTGlzdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICB0aGlzLmZpbGVEZXRhaWxBcnJheS5zcGxpY2UoaSwgMSk7CgogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkpIHsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgJycpOwogICAgICAgICAgfQogICAgICAgIH0gLy8g5rKh5LygcHJvcHPvvJpvblJlbW92Ze+8jOaJp+ihjOatpOmAu+i+kQoKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmZpbGVMaXN0LnNwbGljZShpLCAxKTsKICAgICAgICB0aGlzLiRlbWl0KCdvblJlbW92ZScsIHRoaXMuZmlsZURldGFpbEFycmF5W2ldLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICB0aGlzLmZpbGVEZXRhaWxBcnJheS5zcGxpY2UoaSwgMSk7CgogICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMuZmlsZUxpc3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsICcnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCgogICAgLyoqCiAgICAgKiBAZGVzYyDliJfooajlvaLlvI/liKDpmaTlm57osIMKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCDntKLlvJUKICAgICAqLwogICAgaGFuZGxlTGlzdFJlbW92ZShpKSB7CiAgICAgIGNvbnN0IGJvb2wgPSB0aGlzLm9uUmVtb3ZlKHRoaXMuZmlsZUxpc3RbaV0sIGkpOwoKICAgICAgaWYgKGJvb2wgIT09IGZhbHNlKSB7CiAgICAgICAgdGhpcy5maWxlTGlzdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgdGhpcy5maWxlRGV0YWlsQXJyYXkuc3BsaWNlKGksIDEpOwoKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkgewogICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCAnJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAoKICAgIGhhbmRsZVBpY3R1cmVQcmV2aWV3KGkpIHsKICAgICAgaWYgKGkgIT09IG51bGwpIHsKICAgICAgICB0aGlzLiRyZWZzWydpbWcnICsgaV1bMF0uaW1hZ2VQcmV2aWV3RnVuKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcmVmc1snaW1nJ10uaW1hZ2VQcmV2aWV3RnVuKCk7CiAgICAgIH0KICAgIH0sCgogICAgaXNBcnJheShvKSB7CiAgICAgIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykgPT0gJ1tvYmplY3QgQXJyYXldJzsKICAgIH0sCgogICAgb25Eb3dubG9hZChmaWxlLCBpbmRleCkgewogICAgICB0aGlzLiRlbWl0KCdvbkRvd25sb2FkJywgZmlsZSwgaW5kZXgpOwogICAgfSwKCiAgICBvbkxpc3RJbWFnZUVycm9yKGluZGV4KSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLmZpbGVMaXN0W2luZGV4XSwgJ2ltZ1N0YXR1cycsIGZhbHNlKTsKICAgIH0KCiAgfQp9Ow=="},{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsMA;AACA,uC,CACA;;AACA;AACA;AACA;EACAA,gBADA;EAEAC;IACAC;EADA,CAFA;EAKAC;IACAC;MACAC;IADA,CADA;IAIAC;MACAD,YADA;MAEAE;IAFA,CAJA;IAQAC,uBARA;IAQA;IACAH;MACA;MACAA,YAFA;MAGAE;IAHA,CATA;IAcAE;MACA;MACAJ,YAFA;MAGAE;IAHA,CAdA;IAmBAG;MACA;MACAL,YAFA;MAGAE;IAHA,CAnBA;IAwBAI;MACA;MACAN;IAFA,CAxBA;IA4BAO;MACAP;IADA,CA5BA;IA+BAQ;MACAR;IADA,CA/BA;IAkCAS;MACAT;IADA,CAlCA;IAqCAU;MACA;MACAV,aAFA;MAGAE;IAHA,CArCA;IA0CAS;MACA;MACAX,aAFA;MAGAE;IAHA,CA1CA;IA+CAU;MACA;MACAZ,YAFA;MAGAE;IAHA,CA/CA;IAoDAW;MACA;MACAb,YAFA;MAGAE;IAHA,CApDA;IAyDAY;MACAd;IADA,CAzDA;IA4DAe;MACAf;IADA,CA5DA;IA+DAgB;MACAhB;IADA,CA/DA;IAkEAiB;MACAjB;IADA,CAlEA;IAqEAkB;MACA;MACAlB,aAFA;MAGAE;IAHA,CArEA;IA0EAiB;MACA;MACAnB,aAFA;MAGAE;IAHA,CA1EA;IA+EAL;MACA;MACAG,aAFA;MAGAE;IAHA,CA/EA;IAoFAkB;MACA;MACApB,aAFA;MAGAE;IAHA,CApFA;IAyFAmB;MACA;MACArB,aAFA;MAGAE;IAHA,CAzFA;IA8FAP;MACA;MACAK;IAFA,CA9FA;IAkGAsB;MACA;MACAtB,aAFA;MAGAE;IAHA,CAlGA;IAuGAqB;MACAvB,cADA;MAEAE;IAFA,CAvGA;IA2GA;IACAsB;MACAxB,aADA;MAEAE;IAFA,CA5GA;IAgHAuB;MACAzB;IADA,CAhHA;IAmHA0B;MACA1B;IADA,CAnHA;IAsHA2B;MACA3B;IADA,CAtHA;IAyHA4B;MACA5B,aADA;MAEAE;IAFA,CAzHA;IA6HA2B;MACA7B;IADA,CA7HA;IAgIA8B;MACA9B,aADA;MAEAE;IAFA,CAhIA;IAoIA6B;MACA/B,aADA;MAEAE;IAFA,CApIA;IAwIA8B;MACAhC,aADA;MAEAE;IAFA,CAxIA;IA4IA+B;MACAjC;IADA;EA5IA,CALA;;EAqJAkC;IACA;MACAC;QACA5B,yFADA;QAEAC,8FAFA;QAGA4B;MAHA,CADA;MAMAC,mBANA;MAOAC,oBAPA;MAQAC,oBARA;MASAC,qEATA;MAUAC,eAVA;MAWAC;QACAnC,SADA;QAEAC;MAFA,CAXA;MAeAmC,UAfA;MAgBAC,qBAhBA;MAiBAC;IAjBA;EAmBA,CAzKA;;EA0KAC;IACA/C;MACAgD;QACA;UAAAC;QAAA;;QACA;UACA;QACA;;QACA;UACA;YACA;cACA;YACA,CAFA,MAEA;cACA;YACA;UACA,CANA;QAOA;MACA,CAfA;;MAgBAC;IAhBA,CADA;IAmBAT;MACAO;QACA;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CARA;;MASAE;IATA;EAnBA,CA1KA;EAyMAC;IACA;IACAC;MACA;QACA;UACA;QACA,CAFA;MAGA;;MACA;IACA;;EATA,CAzMA;;EAoNAC;IACA;MACA;MACA;QAAAJ;MAAA;MACA;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CANA;IAOA,CAVA;EAWA,CAhOA;;EAiOAK;IACAC;MACA;QACA;MACA;IACA,CALA;;IAMAC;MAAA;;MACA;;MACA;QACA;MACA;;MACA,0CALA,CAKA;;MACA;QACA,OADA,CACA;MACA;;MACA;MACA,2CAVA,CAWA;;MACA;QACA;UACA;QACA,CAFA,MAEA;UACA;UACAC,KACA,6DACAC,4BACA,MAHA;QAKA;;QACA;MACA,CAxBA,CAyBA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;;MACA;;MACA;QACAC;UACAxB;QACA,CAFA;MAGA;;MACA;QACA;QACAA;QACA;MACA;IACA,CAlDA;;IAmDAyB;MACA;MACA;IACA,CAtDA;;IAuDA;AACA;AACA;IACAC;MACA;QACA,gCADA,CACA;;QACA;UACA;QACA;MACA,CALA;;MAMA;QACA;MACA,CAFA,MAEA;QACAC;MACA;IACA,CAtEA;;IAuEA;AACA;AACA;IACAC;MACA;QACA;MACA;;MACA;IACA,CA/EA;;IAgFAC;MAAA;;MACA;QACA;UACA;QACA;MACA;;MACA;QACA;MACA;;MACA;MACA,mJAVA,CAWA;;MACA;QACA;UACA;QACA,CAFA,MAEA;UACA;UACA;UACAP,KACA,6DACAC,4BACA,MAHA;QAKA;;QACA;MACA,CAzBA,CA0BA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACA;;;MACA;MACA;MACA,+BArCA,CAsCA;MACA;;MACA;QACA;UACA;UACA;UACAO;;UACAA;YACA;YACA;cACA;gBACA;kBACA;gBACA,CAFA,MAEA;kBACAC;gBACA;;gBACA;cACA;;cACA;gBAAAtE;cAAA;cACA;gBACAuC,WADA;gBAEAS;cAFA,GAVA,CAcA;;cACA;gBACA;;gBACA;kBACAuB;kBACA;gBACA;cACA;YACA,CAtBA,MAsBA;cAAA;;cACA;cACA;;cACA;gBACA;kBACA;gBACA,CAFA,MAEA;kBACAD;gBACA;;gBACA;cACA,CAVA,CAWA;;;cACA;cACA;cACAE;;cACA;gBACA;gBACA,gCAFA,CAGA;;gBACA;kBACA;oBAAA5D;oBAAAC;kBAAA;gBACA,CAFA,MAEA;kBACA;oBAAAD;oBAAAC;kBAAA;gBACA,CARA,CASA;;;gBACA;kBACA;;kBACA;oBACA;kBACA,CAFA,MAEA;oBACAyD;kBACA;;kBACA;gBACA,CAlBA,CAmBA;;;gBACA;kBACA;;kBACA;oBACA;kBACA,CAFA,MAEA;oBACAA;kBACA;;kBACA;gBACA,CA5BA,CA6BA;;;gBACA;kBACA;;kBACA;oBACA;kBACA,CAFA,MAEA;oBACAA;kBACA;;kBACA;gBACA,CAtCA,CAuCA;;;gBACA;kBACA;;kBACA;oBACA;kBACA,CAFA,MAEA;oBACAA;kBACA;;kBACA;gBACA,CAhDA,CAiDA;gBACA;;;gBACA;kBACA;;kBACA;oBACAC;oBACA;kBACA;gBACA;cACA,CA1DA;;cA2DAC;gBACAC;cACA,CAFA;;cAGAD;gBACAC;cACA,CAFA;YAGA;UACA,CAzGA;QA0GA,CA/GA,CAgHA;;;QACA;MACA;;MACAlC;MACA;;MACA;QACAwB;UACAxB;QACA,CAFA;MAGA;;MACA;MACA8B;;MACAA;QACA;QACA;UACA;UACA;YACA;cACA;YACA,CAFA,MAEA;cACAC;YACA;;YACA;UACA;;UACA;YACA;YACA;UACA,CAHA,MAGA;YACA;YACA;cAAAtE;YAAA;YACA;cACAuC,UADA;cAEAS;YAFA;UAIA,CAPA,MAOA;YACA;cAAAhD;YAAA;YACA,yBACA;cACAuC,UADA;cAEAS;YAFA,CADA;UAMA,CA5BA,CA6BA;;QACA,CA9BA,MA8BA;UAAA;;UACA;UACA,oQAFA,CAGA;;UACA;YACA;cACA;YACA,CAFA,MAEA;cACAsB;YACA;;YACA;UACA,CAXA,CAYA;;;UACA;UACA;UACAE,oBAfA,CAgBA;;UACA;YACA;YACA,gCAFA,CAGA;;YACA;cACA;gBAAA5D;gBAAAC;cAAA;YACA,CAFA,MAEA;cACA;gBAAAD;gBAAAC;cAAA;YACA,CARA,CASA;;;YACA;cACA;gBACA;cACA,CAFA,MAEA;gBACAyD;cACA;;cACA;YACA,CAjBA,CAkBA;;;YACA;cACA;gBACA;cACA,CAFA,MAEA;gBACAA;cACA;;cACA;YACA,CA1BA,CA2BA;;;YACA;cACA;gBACA;cACA,CAFA,MAEA;gBACAA;cACA;;cACA;YACA,CAnCA,CAoCA;;;YACA;cACA;gBACA;cACA,CAFA,MAEA;gBACAA;cACA;;cACA;YACA;;YACA;UACA,CA9CA;;UA+CAE;YACAC;UACA,CAFA;;UAGAD;YACAC;UACA,CAFA;QAGA;MACA,CAvGA;IAwGA,CA5VA;;IA6VAC;MACA;MACA;;MACA;QACAC;MACA;;MACA;QACA;;QACA;UACAZ;YACApD;UACA,CAFA;QAGA;;QACA;UACA;YAAAgE;YAAAC;UAAA,GADA,CAEA;UACA;UACA;;UACA,mDALA,CAMA;;UACA9C,0FACA+C;YACAC;cAAAH;YAAA;;YACA;cACAL;cACAQ;cACAA;;cACA;gBACA;kBACA;oBACA;sBACA;oBACA;kBACA,CAJA;gBAKA,CANA;cAOA,CARA,MAQA;gBACA;gBACA;kBACA;oBACA;kBACA;gBACA,CAJA;cAKA;YACA,CApBA,MAoBA;cACAR;YACA;UACA,CA1BA,EA2BAS;YACAD;cAAAH;YAAA;YACA,cACAK,MADA,CACAC,8BADA,EAEAC,GAFA,CAEAD;cACA;YACA,CAJA;YAKAH;UACA,CAnCA;UAqCA;YACA5C,qBADA;YAEAD,qCAFA;YAGAe,UAHA;YAIAT,iBAJA;YAKA4C,uBALA;YAMA1E,mBANA;YAOAsB;cACA+C;gBAAAH;cAAA;;cACA;gBACA;;gBACA;kBACA;kBACA;gBACA;;gBACA;cACA,CATA,CAWA;;;cACA;gBACAL;gBACAQ;gBACA;cACA,CAJA,MAIA;gBACAR;cACA;YACA,CA1BA;YA2BAtC;cACA8C;gBAAAH;cAAA;cACA,cACAK,MADA,CACAC,8BADA,EAEAC,GAFA,CAEAD;gBACA;cACA,CAJA;cAKA;;cACA;gBACA;gBACA;cACA;;cACAH;YACA;UAxCA;UA0CA;;UACA;YACAM;UACA;QACA,CA1FA,MA0FA;UACA;QACA;MACA,CApGA;;MAqGA;QACA;MACA;;MACAnB;IACA,CA5cA;;IA6cAoB;MACA;;MACA;QACA;UACA;YACA;cACA;YACA;UACA,CAJA;QAKA,CANA;MAOA,CARA,MAQA;QACA;QACA;UACA;YACA;UACA;QACA,CAJA;MAKA;;MACA;IACA,CAheA;;IAieA;IACAC;MACA;QACA;MACA,CAFA;;MAGA;QACA,cACA,6BADA,EAEA,6BAFA,EAGA,6CAHA;MAKA;IACA,CA7eA;;IA8eAC;MACA;MACA;QACA;QACA;;QACA;UACA;UACA;;UACA;YACA;UACA,CAFA,MAEA;YACA;UACA;QACA,CAXA,CAYA;;MACA,CAbA,MAaA;QACA;QACA;QACA;;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA;IACA,CAvgBA;;IAwgBA;AACA;AACA;AACA;IACAC;MACA;;MACA;QACA;QACA;;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA;IACA,CAvhBA;;IAwhBAC;MACA;QACA;MACA,CAFA,MAEA;QACA;MACA;IACA,CA9hBA;;IA+hBAC;MACA;IACA,CAjiBA;;IAkiBAC;MACA;IACA,CApiBA;;IAqiBAC;MACA;IACA;;EAviBA;AAjOA","names":["name","components","draggable","props","value","type","fit","default","limit","action","fileName","params","width","height","size","multiple","disabled","accept","suffix","boxwidth","boxWidth","boxheight","boxHeight","autoupload","autoUpload","dragUpload","showUploadList","separate","beforeUpload","waiting","httpRequest","onSuccess","onError","withCredentials","headers","autoToast","showDownload","showDelete","onRemove","data","imgStyle","lineHeight","fileDetailArray","readyUploadArray","handlePictureUrl","fileList","dragover","modalImgStyle","file","ISEMITONUPLOAD","fileIcon","watch","handler","url","deep","computed","uploadContent","mounted","methods","onDragover","drop","warn","fileListLen","Object","sort","upload","selectFile","change","changeFile","r","message","data1","img","imgLoadFunc","onUpload","el","white","result","that","err","filter","val","map","filename","req","afterSuccessFun","handUpload","handlePictureRemove","handleListRemove","handlePicturePreview","isArray","onDownload","onListImageError"],"sourceRoot":"packages/upload/src","sources":["upload.vue"],"sourcesContent":["<template>\n  <div class=\"dj-upload\">\n    <input type=\"file\" :accept=\"accept\" class=\"hide\" @change=\"change($event)\" :multiple=\"multiple\" />\n    <input v-model=\"uploadContent\" type=\"hidden\" :name=\"name\" />\n    <div v-if=\"type == 'file'\" class=\"dj-upload-demo\">\n      <div v-if=\"!dragUpload\">\n        <span @click=\"upload($event)\">\n          <slot>\n            <dj-button type=\"primary\" :class=\"disabled ? 'is-disabled' : ''\">{{\n              autoUpload && autoupload ? '上传' : '选择文件'\n            }}</dj-button>\n          </slot>\n        </span>\n        <slot name=\"handupload\" v-if=\"!(autoUpload && autoupload)\">\n          <dj-button type=\"success\" @click=\"handUpload\" :disabled=\"fileList.length == 0\" style=\"margin-left: 20px\">\n            <dj-icon icon=\"upload\"></dj-icon> 上传文件\n          </dj-button>\n        </slot>\n      </div>\n      <div\n        v-else\n        ref=\"dragUpload\"\n        class=\"dj-dragger\"\n        :class=\"disabled ? 'is-disabled' : ''\"\n        @drop.stop.prevent=\"drop\"\n        @dragleave.stop.prevent=\"dragover = false\"\n        @dragover.stop.prevent=\"onDragover\"\n        @click=\"upload($event)\"\n      >\n        <slot>\n          <dj-icon class=\"dj-icon-upload\" icon=\"cloud-upload\"></dj-icon>\n          <div class=\"dj-upload__text\">将文件拖到此处或者<a :class=\"disabled ? 'is-disabled' : ''\">点击上传</a></div>\n        </slot>\n      </div>\n      <ul v-if=\"showUploadList\">\n        <draggable v-model=\"fileList\" :options=\"{ disabled: !draggable }\" class=\"draggable\" @sort=\"sort\">\n          <li\n            v-for=\"(val, i) in fileList\"\n            :key=\"i\"\n            :class=\"[`dj-upload-item`, `line`, `dj-upload-item-${val.status}`, `dj-upload-draggable`]\"\n          >\n            <dj-icon class=\"linkIcon\" icon=\"enclosure\" fontSize=\"14px\"></dj-icon>\n            <a class=\"dj-upload-file_name\">{{ val.name }}</a>\n            <dj-icon icon=\"check-solid\" fontSize=\"14px\" v-if=\"val.status == 'success'\" class=\"success\"></dj-icon>\n            <dj-icon icon=\"garbage\" fontSize=\"14px\" v-if=\"val.status == 'error'\" class=\"error\"></dj-icon>\n            <dj-icon\n              icon=\"garbage\"\n              class=\"delete\"\n              v-if=\"!disabled\"\n              fontSize=\"14px\"\n              @click=\"handlePictureRemove(i)\"\n            ></dj-icon>\n          </li>\n        </draggable>\n      </ul>\n    </div>\n    <div v-if=\"type == 'img'\">\n      <ul class=\"imglist\">\n        <draggable v-model=\"fileList\" :options=\"{ disabled: !draggable }\" class=\"draggable\" @sort=\"sort\">\n          <li\n            v-if=\"multiple\"\n            v-for=\"(val, i) in fileList\"\n            :key=\"i\"\n            class=\"dj-upload-imgs dj-upload-draggable\"\n            :style=\"imgStyle\"\n            :class=\"val.url ? 'noborder' : 'border'\"\n          >\n            <dj-image\n              :src=\"val.url\"\n              :fit=\"fit\"\n              :preview-src-list=\"[val.url]\"\n              style=\"height: 100%; width: 100%\"\n              :ref=\"'img' + i\"\n            >\n              <slot name=\"imageMask\" :ind=\"i\" :file=\"val\">\n                <dj-image-mask>\n                  <dj-icon\n                    class=\"zoom-in\"\n                    @click=\"handlePicturePreview(i)\"\n                    font-color=\"#fff\"\n                    font-size=\"20px\"\n                    style=\"margin-right: 20px\"\n                  ></dj-icon>\n                  <dj-icon\n                    v-if=\"!disabled\"\n                    class=\"garbage\"\n                    @click=\"handlePictureRemove(i)\"\n                    font-size=\"20px\"\n                    font-color=\"#fff\"\n                  ></dj-icon>\n                </dj-image-mask>\n              </slot>\n            </dj-image>\n          </li>\n          <!-- 添加图片按钮 -->\n          <li\n            @click=\"upload($event)\"\n            v-if=\"(multiple && (fileList.length < limit || !limit)) || !multiple\"\n            :style=\"imgStyle\"\n            class=\"dj-upload-img\"\n            :class=\"`${disabled ? 'is-disabled' : ''} ${\n              multiple ? 'border' : !multiple && fileList.length > 0 && fileList[0].url ? 'noborder' : 'border'\n            }`\"\n          >\n            <dj-image\n              style=\"height: 100%; width: 100%\"\n              :fit=\"fit\"\n              :preview-src-list=\"[fileList[0].url]\"\n              v-if=\"!multiple && fileList.length > 0 && fileList[0].url\"\n              :src=\"fileList[0].url\"\n              ref=\"img\"\n            >\n              <slot name=\"imageMask\" :ind=\"null\" :file=\"value\">\n                <dj-image-mask>\n                  <label @click.stop=\"handlePicturePreview(null)\">\n                    <dj-icon class=\"zoom-in\" font-color=\"#fff\" font-size=\"20px\" style=\"margin-right: 20px\"></dj-icon>\n                  </label>\n                  <label @click.stop=\"handlePictureRemove(null)\" v-if=\"!disabled\">\n                    <dj-icon class=\"garbage\" font-color=\"#fff\" font-size=\"20px\"></dj-icon>\n                  </label>\n                </dj-image-mask>\n              </slot>\n            </dj-image>\n            <div\n              style=\"line-height: normal; text-align: center\"\n              v-if=\"!(!multiple && fileList.length > 0 && fileList[0].url)\"\n            >\n              <slot>\n                <dj-icon class=\"add icon\" style=\"position: inherit\" font-size=\"20px\"></dj-icon>\n              </slot>\n            </div>\n          </li>\n        </draggable>\n      </ul>\n    </div>\n    <div v-if=\"type == 'list'\">\n      <div>\n        <span @click=\"upload($event)\">\n          <slot>\n            <dj-button type=\"primary\" :class=\"disabled ? 'is-disabled' : ''\">{{\n              autoUpload && autoupload ? '上传' : '选择文件'\n            }}</dj-button>\n          </slot>\n        </span>\n        <slot name=\"handupload\" v-if=\"!(autoUpload && autoupload)\">\n          <dj-button type=\"success\" @click=\"handUpload\" :disabled=\"fileList.length == 0\" style=\"margin-left: 20px\">\n            <dj-icon icon=\"upload\"></dj-icon> 上传文件\n          </dj-button>\n        </slot>\n      </div>\n      <slot name=\"tips\">\n        <div v-if=\"suffix && size\" class=\"dj-upload-tips\">\n          <span>只能上传{{suffix.split(',').join('/')}}文件</span>\n          <span>，且不超过{{size}}KB</span>\n        </div>\n        <div v-else-if=\"suffix\" class=\"dj-upload-tips\">\n          <span>只能上传{{suffix.split(',').join('/')}}文件</span>\n        </div>\n        <div v-else-if=\"size\" class=\"dj-upload-tips\">\n          <span>只能上传不超过{{size}}KB的文件</span>\n        </div>\n      </slot>\n      <div class=\"dj-upload-list\">\n        <div v-for=\"(file, index) in fileList\" :key=\"index\" class=\"dj-upload-list-item\">\n          <dj-image\n            class=\"dj-upload-list-img\"\n            :src=\"file.url\"\n            :fit=\"fit\"\n            :preview-src-list=\"file.imgStatus === false ? [] : file.url ? [file.url] : []\"\n            style=\"height: 48px; width: 48px;\"\n            :ref=\"'img' + index\"\n            @onError=\"onListImageError(index)\"\n          >\n            <div slot=\"error\"\n              style=\"display: flex;justify-content: center;align-items: center;width: 100%;height: 100%;background: #f5f7fa;color: #909399;font-size: 14px;\">\n              <img :src=\"file.icon || fileIcon\" alt=\"\">\n            </div>\n          </dj-image>\n          <!-- <img class=\"dj-upload-list-img\" :src=\"file.url\" width=\"48\" height=\"48\" alt=\"\"> -->\n          <div class=\"dj-upload-list-font\" :title=\"file.name\">\n            <span class=\"dj-upload-list-font-name\">{{file.name}}</span>\n            <div class=\"dj-upload-list-slot\">\n              <slot name=\"after\" :row=\"{file, index}\">\n                <dj-link v-if=\"showDownload\" @click=\"onDownload(file, index)\" :disabled=\"disabled\" type=\"primary\">\n                  下载<dj-icon icon=\"download\" fontSize=\"14px\" style=\"verticalAlign: baseline;\"></dj-icon>\n                </dj-link>\n              </slot>\n            </div>\n          </div>\n          <div class=\"dj-upload-list-icon\">\n            <dj-icon v-if=\"showDelete && !disabled\" icon=\"garbage\" fontSize=\"12px\" @click=\"handleListRemove(index)\"></dj-icon>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport draggable from 'vuedraggable';\nimport loading from '@/mixins/loading';\n// import ajax from './ajax';\nimport message from '../../message/index';\nimport axios from './axios';\nexport default {\n  name: 'djUpload',\n  components: {\n    draggable\n  },\n  props: {\n    value: {\n      type: [String, Array]\n    },\n    fit: {\n      type: String,\n      default: 'fill'\n    },\n    limit: [Number, String], // 限制个数\n    type: {\n      // 文件类型还是图片\n      type: String,\n      default: 'file'\n    },\n    action: {\n      // 上传地址\n      type: String,\n      default: ''\n    },\n    fileName: {\n      // 上传文件名参数\n      type: String,\n      default: 'file'\n    },\n    params: {\n      // 上传参数\n      type: Object\n    },\n    width: {\n      type: Number\n    },\n    height: {\n      type: Number\n    },\n    size: {\n      type: Number\n    },\n    multiple: {\n      // 是否可以上传多个\n      type: Boolean,\n      default: false\n    },\n    disabled: {\n      // 是否禁用\n      type: Boolean,\n      default: false\n    },\n    accept: {\n      // 上传类型限制\n      type: String,\n      default: ''\n    },\n    suffix: {\n      // 上传后缀限制\n      type: String,\n      default: 'jpg,png,gif,jpeg'\n    },\n    boxwidth: {\n      type: Number\n    },\n    boxWidth: {\n      type: Number\n    },\n    boxheight: {\n      type: Number\n    },\n    boxHeight: {\n      type: Number\n    },\n    autoupload: {\n      // 是否自动上传\n      type: Boolean,\n      default: true\n    },\n    autoUpload: {\n      // 是否自动上传\n      type: Boolean,\n      default: true\n    },\n    draggable: {\n      // 是否可以左右拖拽移动\n      type: Boolean,\n      default: false\n    },\n    dragUpload: {\n      // 是否开启拖拽上传\n      type: Boolean,\n      default: false\n    },\n    showUploadList: {\n      // 文件上传后上传列表是否展示\n      type: Boolean,\n      default: true\n    },\n    name: {\n      //\n      type: String\n    },\n    separate: {\n      // 是否支持前后分离\n      type: Boolean,\n      default: false\n    },\n    beforeUpload: {\n      type: Function,\n      default: () => true\n    },\n    // 手动上传，判断按钮是否disabled\n    waiting: {\n      type: Boolean,\n      default: false\n    },\n    httpRequest: {\n      type: Function\n    },\n    onSuccess: {\n      type: Function\n    },\n    onError: {\n      type: Function\n    },\n    withCredentials: {\n      type: Boolean,\n      default: false\n    },\n    headers: {\n      type: Object\n    },\n    autoToast: {\n      type: Boolean,\n      default: true\n    },\n    showDownload: {\n      type: Boolean,\n      default: false\n    },\n    showDelete: {\n      type: Boolean,\n      default: true\n    },\n    onRemove: {\n      type: Function\n    }\n  },\n  data() {\n    return {\n      imgStyle: {\n        width: this.boxWidth || this.boxwidth ? (this.boxWidth || this.boxwidth) + 'px' : '120px',\n        height: this.boxHeight || this.boxheight ? (this.boxHeight || this.boxheight) + 'px' : '120px',\n        lineHeight: this.boxHeight || this.boxheight ? (this.boxHeight || this.boxheight) + 'px' : '120px'\n      },\n      fileDetailArray: [],\n      readyUploadArray: [],\n      handlePictureUrl: '',\n      fileList: Array.isArray(this.value) ? this.value : [this.value] || [],\n      dragover: false,\n      modalImgStyle: {\n        width: '',\n        height: ''\n      },\n      file: null,\n      ISEMITONUPLOAD: false,\n      fileIcon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAAAXNSR0IArs4c6QAAAbRJREFUOE+llUsoRGEUx3+fGDMSM1KYQpHFbLwVEgtko2xZyEpiY6HEWjZWLJSws7Gz0Kwo8liMPEaRyWMaIo/GayaNEld3bmPmGsY196u7uOf+/7/vnO983SOkQwxcM4ZEJ1ntGaQUQcADN3PEXC4cvNAihniO1AlpmXEk+oPByk0w14LfCY6y2MBdwM8OVppFH48hsZCWuAcygoGKVbA0gG8btqr+BspOA/vk0iR68MoGGSh9OROMID/GPAWOAFcv3M5Hw+UMZaC8jBwEod3cqoEhW2oJVDuVt6MeuJqOBp4AnoiwCRcFNKmBlkYw5cPHG1jqlQyvZsDniAa+A27AF/EpjTM18D9N+eWEvwHXwVwHvj3YKo/dFE1AgxWSzJBoAduUUvLpMHgXNcPjb4qmDEOiZCvYZpUMz8fgcUVnhprt0UJ1yYWjkN0RVr0HYL8NAqeat/j52kTana3gtesApteEzUKAbqB8TZ7WlIaU2uFyUk+GG+AeUYAiAYoX4GIC7uMtOacLMlvDJX+8wvEAvN3FeYaabb8L1T9Y/cAH9QjQCxRMCNWQCo2C/4MfEMyRw+AndhCvdOjNuwoAAAAASUVORK5CYII='\n    };\n  },\n  watch: {\n    value: {\n      handler() {\n        this.fileList = this.isArray(this.value) ? this.value : this.value ? [{ url: this.value }] : [];\n        if (!this.multiple) {\n          this.fileList = this.fileList.slice(-1);\n        }\n        if (!this.action) {\n          this.fileList.map((val, i) => {\n            if (JSON.stringify(val) !== '{}') {\n              this.$set(val, 'status', 'success');\n            } else {\n              this.fileList.splice(i, 1);\n            }\n          });\n        }\n      },\n      deep: true\n    },\n    fileList: {\n      handler(v) {\n        // console.log(v, 'fileList');\n        if (v.length) {\n          this.$emit('update:waiting', true);\n        } else {\n          this.$emit('update:waiting', false);\n        }\n      },\n      deep: true\n    }\n  },\n  computed: {\n    // name值校验\n    uploadContent() {\n      if (!(this.autoUpload && this.autoupload)) {\n        return this.fileList.filter((val) => {\n          return val.status == 'success';\n        });\n      }\n      return this.fileList;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      // 默认回显值\n      this.fileList = this.isArray(this.value) ? this.value : this.value ? [{ url: this.value }] : [];\n      this.fileList.map((val, i) => {\n        if (JSON.stringify(val) !== '{}' && val) {\n          this.$set(val, 'status', 'success');\n        } else {\n          this.value.splice(i, 1);\n        }\n      });\n    });\n  },\n  methods: {\n    onDragover() {\n      if (!this.disabled) {\n        this.dragover = true;\n      }\n    },\n    drop(e) {\n      if (this.disabled) return;\n      if (!this.multiple) {\n        this.$emit('input', []);\n      }\n      const dataFileList = e.dataTransfer.files; // 获取文件对象\n      if (dataFileList.length < 1) {\n        return; // 检测是否有文件拖拽到页面\n      }\n      const fileListLen = this.value?.length || 0;\n      const targetFilesLen = dataFileList.length;\n      // 如果 现有的文件数 + 选中的文件数 > limit限制数 触发\n      if (this.limit && fileListLen + targetFilesLen > this.limit) {\n        if (this.$listeners.onMessage) {\n          this.$emit('onMessage', 'limitNum', this.fileList);\n        } else {\n          const warn = message.warning;\n          warn(\n            `当前限制选择 ${this.limit} 个文件，本次选择了 ${targetFilesLen} 个文件，共选择了 ${\n              fileListLen + targetFilesLen\n            } 个文件`\n          );\n        }\n        return;\n      }\n      // if (this.limit && this.fileList.length==this.limit){\n      //   if (this.$listeners.onMessage) {\n      //     this.$emit('onMessage', 'limitNum', this.fileList);\n      //   } else {\n      //     message.error('最多允许上传'+this.limit+'个文件');\n      //   }\n      //   return;\n      // }\n      const data = new FormData();\n      if (this.params) {\n        Object.keys(this.params).forEach((key) => {\n          data.append(key, this.params[key]);\n        });\n      }\n      for (let i = 0; i < dataFileList.length; i++) {\n        this.file = dataFileList[i];\n        data.append(this.fileName, dataFileList[i]);\n        this.onUpload(data, dataFileList[i], i);\n      }\n    },\n    sort() {\n      // 拖拽改变位置\n      this.$emit('input', this.fileList);\n    },\n    /**\n     * 点击上传（未确定仅打开弹窗）时触发，\n     */\n    upload(event) {\n      let selectFile = () => {\n        this.$el.children[0].value = ''; // 解决两次上传同样文件不触发change问题\n        if (!this.disabled) {\n          this.$el.children[0].click();\n        }\n      };\n      if (this.$listeners.click) {\n        this.$emit('click', event, selectFile);\n      } else {\n        selectFile();\n      }\n    },\n    /**\n     * 点击确认上传时触发\n     */\n    change(event) {\n      if (this.$listeners.change) {\n        this.$emit('change', event, this.changeFile);\n      }\n      this.changeFile(event);\n    },\n    changeFile(event) {\n      if (this.autoupload && this.autoUpload) {\n        if (this.fileList.length == 0 || this.fileList.filter((val) => val.status == 'success').length == 0) {\n          this.fileList = [];\n        }\n      }\n      if (!this.multiple && (!(this.autoUpload && this.autoupload) || this.type == 'img' || this.type == 'file')) {\n        this.$emit('input', []);\n      }\n      const fileListLen = this.value?.length || 0;\n      const targetFilesLen = event.target.files?.length;\n      // 如果 现有的文件数 + 选中的文件数 > limit限制数 触发\n      if (this.limit && fileListLen + targetFilesLen > this.limit) {\n        if (this.$listeners.onMessage) {\n          this.$emit('onMessage', 'limitNum', this.fileList);\n        } else {\n          // 兼容运营平台和商家中心的warn，UI库的是warning\n          const warn = message.warning;\n          warn(\n            `当前限制选择 ${this.limit} 个文件，本次选择了 ${targetFilesLen} 个文件，共选择了 ${\n              fileListLen + targetFilesLen\n            } 个文件`\n          );\n        }\n        return;\n      }\n      // 如果 现有的文件数 = limit限制数 触发\n      // if (this.limit && fileListLen == this.limit) {\n      //   if (this.$listeners.onMessage) {\n      //     this.$emit('onMessage', 'limitNum', this.fileList);\n      //   } else {\n      //     message.error('最多允许上传'+this.limit+'个文件');\n      //   }\n      //   return;\n      // }\n      var data = new FormData();\n      var file = event.target.files[0];\n      var files = event.target.files;\n      // 上传且校验成功两个以上文件，进入\n      // let filesCopy = [];\n      if (files.length > 1) {\n        for (let i = 0; i < files.length; i++) {\n          let data1 = new FormData();\n          let r = new FileReader();\n          r.readAsDataURL(files[i]);\n          r.onload = (e) => {\n            // 上传的为文件（非图片）\n            if (this.type == 'file') {\n              if (this.size && parseFloat(this.size) < (file.size / 1000).toFixed(2)) {\n                if (this.$listeners.onMessage) {\n                  this.$emit('onMessage', 'fileSize', file);\n                } else {\n                  message.error(`文件应小于等于${this.size}KB,现为：${(file.size / 1000).toFixed(2)}KB`);\n                }\n                return;\n              }\n              this.fileList = [...this.fileList, {name: files[i].name}];\n              this.readyUploadArray.push({\n                data: data1,\n                file: files[i]\n              });\n              // console.log(this.readyUploadArray);\n              if (this.autoupload && this.autoUpload) {\n                this.$emit('onUpload', files[i], files);\n                if (this.action) {\n                  data1.append(this.fileName, files[i]);\n                  this.onUpload(data1, files[i]);\n                }\n              }\n            } else {\n              let acceptTypeArray = this.suffix?.split(',');\n              let fileType = files[i]?.type?.split('/')[1]?.toLowerCase();\n              if (acceptTypeArray?.length > 0 && acceptTypeArray.indexOf(fileType) < 0) {\n                if (this.$listeners.onMessage) {\n                  this.$emit('onMessage', 'fileType', files[i]);\n                } else {\n                  message.error(`请上传类型为${this.suffix}的文件!`);\n                }\n                return;\n              }\n              // 上传图片\n              var img = new Image();\n              var base64Url = e.currentTarget.result;\n              img.src = base64Url;\n              const imgLoadFunc = (e) => {\n                var _w = e.currentTarget.width;\n                var _h = e.currentTarget.height;\n                // 查看大图弹窗图片宽高比\n                if (_w < _h) {\n                  this.modalImgStyle = { width: 'auto', height: '100%' };\n                } else {\n                  this.modalImgStyle = { width: '100%', height: 'auto' };\n                }\n                // 判断宽高是否符合规定\n                if (this.width && this.height && (_w != this.width || _h != this.height)) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'width&height', files[i]);\n                  } else {\n                    message.error(`图片应为${this.width}px*${this.height}px,现为${_w}px*${_h}px`);\n                  }\n                  return;\n                }\n                // 判断宽度是否符合规定\n                if (this.width && _w != this.width) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'width', files[i]);\n                  } else {\n                    message.error(`图片宽度应为${this.width}px,现为${_w}px`);\n                  }\n                  return;\n                }\n                // 判断高度是否符合规定\n                if (this.height && _h != this.height) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'height', files[i]);\n                  } else {\n                    message.error(`图片高度应为${this.height}px,现为${_h}px`);\n                  }\n                  return;\n                }\n                // 判断文件大小是否符合规定\n                if (this.size && parseFloat(this.size) < (files[i].size / 1024).toFixed(2)) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'fileSize', files[i]);\n                  } else {\n                    message.error(`图片应小于${this.size}KB,现为：${(files[i].size / 1024).toFixed(2)}KB`);\n                  }\n                  return;\n                }\n                // filesCopy.push(files[i]);\n                // this.fileList.push({name: files[i].name});\n                if (this.autoupload && this.autoUpload) {\n                  this.$emit('onUpload', files[i], files);\n                  if (this.action) {\n                    data1.append(this.fileName, files[i]);\n                    this.onUpload(data1, files[i]);\n                  }\n                }\n              };\n              img.onload = (e) => {\n                imgLoadFunc(e);\n              };\n              img.onerror = (e) => {\n                imgLoadFunc(e);\n              };\n            }\n          };\n        }\n        // this.$emit('input', this.fileList);\n        return;\n      }\n      data.append(this.fileName, file);\n      this.file = file;\n      if (this.params) {\n        Object.keys(this.params).forEach((key) => {\n          data.append(key, this.params[key]);\n        });\n      }\n      let r = new FileReader();\n      r.readAsDataURL(file);\n      r.onload = (e) => {\n        // 上传的为文件（非图片）\n        if (this.type == 'file') {\n          // 判断文件大小是否符合规定\n          if (this.size && parseFloat(this.size) < (file.size / 1000).toFixed(2)) {\n            if (this.$listeners.onMessage) {\n              this.$emit('onMessage', 'fileSize', file);\n            } else {\n              message.error(`文件应小于等于${this.size}KB,现为：${(file.size / 1000).toFixed(2)}KB`);\n            }\n            return;\n          }\n          if (this.autoUpload && this.autoupload) {\n            // 自动上传的情况\n            this.onUpload(data, file);\n          } else if (this.multiple) {\n            // 若是手动上传\n            this.fileList.push({ name: file.name });\n            this.readyUploadArray.push({\n              data: data,\n              file: file\n            });\n          } else {\n            this.fileList = [{ name: file.name }];\n            this.readyUploadArray = [\n              {\n                data: data,\n                file: file\n              }\n            ];\n          }\n          // this.$emit('input', this.fileList);\n        } else {\n          let acceptTypeArray = this.suffix?.split(',');\n          let fileType = file?.type?.split('/')[1]?.toLowerCase();\n          // 判断文件类型是否符合规定\n          if (acceptTypeArray?.length > 0 && acceptTypeArray.indexOf(fileType) < 0) {\n            if (this.$listeners.onMessage) {\n              this.$emit('onMessage', 'fileType', file);\n            } else {\n              message.error(`请上传类型为${this.suffix}的文件!`);\n            }\n            return;\n          }\n          // 上传图片\n          var img = new Image();\n          var base64Url = e.currentTarget.result;\n          img.src = base64Url;\n          // 图片加载的监听函数\n          const imgLoadFunc = (e) => {\n            var _w = e.currentTarget.width;\n            var _h = e.currentTarget.height;\n            // 查看大图弹窗图片宽高比\n            if (_w < _h) {\n              this.modalImgStyle = { width: 'auto', height: '100%' };\n            } else {\n              this.modalImgStyle = { width: '100%', height: 'auto' };\n            }\n            // 判断宽高是否符合规定\n            if (this.width && this.height && (_w != this.width || _h != this.height)) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'width&height', file);\n              } else {\n                message.error(`图片应为${this.width}px*${this.height}px,现为${_w}px*${_h}px`);\n              }\n              return;\n            }\n            // 判断宽度是否符合规定\n            if (this.width && _w != this.width) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'width', file);\n              } else {\n                message.error(`图片宽度应为${this.width}px,现为${_w}px`);\n              }\n              return;\n            }\n            // 判断高度是否符合规定\n            if (this.height && _h != this.height) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'height', file);\n              } else {\n                message.error(`图片高度应为${this.height}px,现为${_h}px`);\n              }\n              return;\n            }\n            // 判断文件大小是否符合规定\n            if (this.size && parseFloat(this.size) < (file.size / 1024).toFixed(2)) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'fileSize', file);\n              } else {\n                message.error(`图片应小于${this.size}KB,现为：${(file.size / 1024).toFixed(2)}KB`);\n              }\n              return;\n            }\n            this.onUpload(data, file);\n          };\n          img.onload = (e) => {\n            imgLoadFunc(e);\n          };\n          img.onerror = (e) => {\n            imgLoadFunc(e);\n          };\n        }\n      };\n    },\n    onUpload(data, file, i) {\n      let that = this;\n      let el = this.$el;\n      if (this.dragUpload) {\n        el = this.$refs.dragUpload;\n      }\n      let upload = () => {\n        let params = {};\n        if (this.params) {\n          Object.keys(this.params).forEach((key) => {\n            params[key] = this.params[key];\n          });\n        }\n        if (this.action) {\n          this.$el.querySelector && loading.methods.showLoading({ el, white: true });\n          // let httpRequest = this.httpRequest || ajax;\n          // const isDj = window.location.host.endsWith('jddj.com');\n          // if (isDj) {\n          let httpRequest = this.httpRequest || axios.upload;\n          // }\n          httpRequest(this.action, this.separate ? params : data, this.separate ? file : null).then(\n            (result) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              if (result.code == 0) {\n                message.success(result.msg);\n                that.fileDetailArray.push(file);\n                that.$emit('onSuccess', result, file, that.fileDetailArray);\n                if (this.autoupload && this.autoUpload || this.dragUpload) {\n                  this.$nextTick(() => {\n                    this.fileList.map((item, i) => {\n                      if (JSON.stringify(item) !== '{}' && item) {\n                        this.$set(item, 'status', 'success');\n                      }\n                    });\n                  });\n                } else {\n                  this.fileList = this.fileList.pop();\n                  this.$nextTick(() => {\n                    if (JSON.stringify(this.fileList[i]) !== '{}' && this.fileList[i]) {\n                      this.$set(this.fileList[i], 'status', 'success');\n                    }\n                  });\n                }\n              } else {\n                message.error(result.msg);\n              }\n            },\n            (err) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              this.fileList\n                .filter((val) => val.status != 'success')\n                .map((val) => {\n                  this.$set(val, 'status', 'error');\n                });\n              that.$emit('onError', err, file, that.fileList);\n            }\n          );\n          const options = {\n            headers: this.headers,\n            withCredentials: this.withCredentials,\n            file: file,\n            data: this.params,\n            filename: this.fileName,\n            action: this.action,\n            onSuccess: (result) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              if (this.onSuccess) {\n                const sorf = this.onSuccess(result, file);\n                if (sorf || sorf === void 0) {\n                  this.afterSuccessFun(file);\n                  return;\n                }\n                return;\n              }\n\n              // 兼容到家业务\n              if (result.code == 0) {\n                message.success(result.msg);\n                that.$emit('onSuccess', result, file, that.fileDetailArray);\n                this.afterSuccessFun(file);\n              } else {\n                message.error(result.msg);\n              }\n            },\n            onError: (err) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              this.fileList\n                .filter((val) => val.status != 'success')\n                .map((val) => {\n                  this.$set(val, 'status', 'error');\n                });\n              this.$emit('input', this.fileList);\n              if (this.onError) {\n                this.onError(err, file);\n                return;\n              }\n              that.$emit('onError', err, file, that.fileList);\n            }\n          };\n          const req = httpRequest(options);\n          if (req && req.then) {\n            req.then(options.onSuccess, options.onError);\n          }\n        } else {\n          this.$emit('onUpload', this.file);\n        }\n      };\n      if (this.beforeUpload && typeof this.beforeUpload === 'function' && !this.beforeUpload(file, upload)) {\n        return false;\n      }\n      upload();\n    },\n    afterSuccessFun(file) {\n      this.fileDetailArray.push(file);\n      if (this.autoupload && this.autoUpload || this.dragUpload) {\n        this.$nextTick(() => {\n          this.fileList.map((item) => {\n            if (JSON.stringify(item) !== '{}' && item) {\n              this.$set(item, 'status', 'success');\n            }\n          });\n        });\n      } else {\n        this.fileList = this.fileList.pop();\n        this.$nextTick(() => {\n          if (JSON.stringify(this.fileList[i]) !== '{}' && this.fileList[i]) {\n            this.$set(this.fileList[i], 'status', 'success');\n          }\n        });\n      }\n      this.$emit('input', this.fileList);\n    },\n    // 手动上传\n    handUpload() {\n      let readyUploadFileList = this.fileList.filter((item) => {\n        return item.status != 'success';\n      });\n      for (let i = 0; i < readyUploadFileList.length; i++) {\n        this.onUpload(\n          this.readyUploadArray[i].data,\n          this.readyUploadArray[i].file,\n          this.fileList.indexOf(readyUploadFileList[i])\n        );\n      }\n    },\n    handlePictureRemove(i) {\n      // 如果通过props传入了onRemove，执行此逻辑\n      if (this.onRemove) {\n        // onRemove函数中return false则取消删除操作\n        const bool = this.onRemove(this.fileList[i], i);\n        if (bool !== false) {\n          this.fileList.splice(i, 1);\n          this.fileDetailArray.splice(i, 1);\n          if (Array.isArray(this.value)) {\n            this.$emit('input', this.fileList);\n          } else {\n            this.$emit('input', '');\n          }\n        }\n        // 没传props：onRemove，执行此逻辑\n      } else {\n        this.fileList.splice(i, 1);\n        this.$emit('onRemove', this.fileDetailArray[i], this.fileList);\n        this.fileDetailArray.splice(i, 1);\n        if (Array.isArray(this.value)) {\n          this.$emit('input', this.fileList);\n        } else {\n          this.$emit('input', '');\n        }\n      }\n    },\n    /**\n     * @desc 列表形式删除回调\n     * @param {Number} index 索引\n     */\n    handleListRemove(i) {\n      const bool = this.onRemove(this.fileList[i], i);\n      if (bool !== false) {\n        this.fileList.splice(i, 1);\n        this.fileDetailArray.splice(i, 1);\n        if (Array.isArray(this.value)) {\n          this.$emit('input', this.fileList);\n        } else {\n          this.$emit('input', '');\n        }\n      }\n    },\n    handlePicturePreview(i) {\n      if (i !== null) {\n        this.$refs['img' + i][0].imagePreviewFun();\n      } else {\n        this.$refs['img'].imagePreviewFun();\n      }\n    },\n    isArray(o) {\n      return Object.prototype.toString.call(o) == '[object Array]';\n    },\n    onDownload(file, index) {\n      this.$emit('onDownload', file, index);\n    },\n    onListImageError(index) {\n      this.$set(this.fileList[index], 'imgStatus', false);\n    }\n  }\n};\n</script>\n<style scope lang=\"less\"></style>\n"]}]}