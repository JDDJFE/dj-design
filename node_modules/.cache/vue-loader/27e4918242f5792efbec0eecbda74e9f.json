{"remainingRequest":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangjunxia/work-github/dj-design/packages/upload/src/upload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangjunxia/work-github/dj-design/packages/upload/src/upload.vue","mtime":1675737648908},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBkcmFnZ2FibGUgZnJvbSAndnVlZHJhZ2dhYmxlJzsKaW1wb3J0IGxvYWRpbmcgZnJvbSAnQC9taXhpbnMvbG9hZGluZyc7Ci8vIGltcG9ydCBhamF4IGZyb20gJy4vYWpheCc7CmltcG9ydCBtZXNzYWdlIGZyb20gJy4uLy4uL21lc3NhZ2UvaW5kZXgnOwppbXBvcnQgYXhpb3MgZnJvbSAnLi9heGlvcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnZGpVcGxvYWQnLAogIGNvbXBvbmVudHM6IHsKICAgIGRyYWdnYWJsZQogIH0sCiAgcHJvcHM6IHsKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEFycmF5XQogICAgfSwKICAgIGZpdDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdmaWxsJwogICAgfSwKICAgIGxpbWl0OiBbTnVtYmVyLCBTdHJpbmddLCAvLyDpmZDliLbkuKrmlbAKICAgIHR5cGU6IHsKICAgICAgLy8g5paH5Lu257G75Z6L6L+Y5piv5Zu+54mHCiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ2ZpbGUnCiAgICB9LAogICAgYWN0aW9uOiB7CiAgICAgIC8vIOS4iuS8oOWcsOWdgAogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICcnCiAgICB9LAogICAgZmlsZU5hbWU6IHsKICAgICAgLy8g5LiK5Lyg5paH5Lu25ZCN5Y+C5pWwCiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ2ZpbGUnCiAgICB9LAogICAgcGFyYW1zOiB7CiAgICAgIC8vIOS4iuS8oOWPguaVsAogICAgICB0eXBlOiBPYmplY3QKICAgIH0sCiAgICB3aWR0aDogewogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBoZWlnaHQ6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgc2l6ZTogewogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBtdWx0aXBsZTogewogICAgICAvLyDmmK/lkKblj6/ku6XkuIrkvKDlpJrkuKoKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBkaXNhYmxlZDogewogICAgICAvLyDmmK/lkKbnpoHnlKgKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBhY2NlcHQ6IHsKICAgICAgLy8g5LiK5Lyg57G75Z6L6ZmQ5Yi2CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJycKICAgIH0sCiAgICBzdWZmaXg6IHsKICAgICAgLy8g5LiK5Lyg5ZCO57yA6ZmQ5Yi2CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ2pwZyxwbmcsZ2lmLGpwZWcnCiAgICB9LAogICAgYm94d2lkdGg6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgYm94V2lkdGg6IHsKICAgICAgdHlwZTogTnVtYmVyCiAgICB9LAogICAgYm94aGVpZ2h0OiB7CiAgICAgIHR5cGU6IE51bWJlcgogICAgfSwKICAgIGJveEhlaWdodDogewogICAgICB0eXBlOiBOdW1iZXIKICAgIH0sCiAgICBhdXRvdXBsb2FkOiB7CiAgICAgIC8vIOaYr+WQpuiHquWKqOS4iuS8oAogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgYXV0b1VwbG9hZDogewogICAgICAvLyDmmK/lkKboh6rliqjkuIrkvKAKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIGRyYWdnYWJsZTogewogICAgICAvLyDmmK/lkKblj6/ku6Xlt6blj7Pmi5bmi73np7vliqgKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBkcmFnVXBsb2FkOiB7CiAgICAgIC8vIOaYr+WQpuW8gOWQr+aLluaLveS4iuS8oAogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIHNob3dVcGxvYWRMaXN0OiB7CiAgICAgIC8vIOaWh+S7tuS4iuS8oOWQjuS4iuS8oOWIl+ihqOaYr+WQpuWxleekugogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgbmFtZTogewogICAgICAvLwogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBzZXBhcmF0ZTogewogICAgICAvLyDmmK/lkKbmlK/mjIHliY3lkI7liIbnprsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBiZWZvcmVVcGxvYWQ6IHsKICAgICAgdHlwZTogRnVuY3Rpb24sCiAgICAgIGRlZmF1bHQ6ICgpID0+IHRydWUKICAgIH0sCiAgICAvLyDmiYvliqjkuIrkvKDvvIzliKTmlq3mjInpkq7mmK/lkKZkaXNhYmxlZAogICAgd2FpdGluZzogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGh0dHBSZXF1ZXN0OiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uCiAgICB9LAogICAgb25TdWNjZXNzOiB7CiAgICAgIHR5cGU6IEZ1bmN0aW9uCiAgICB9LAogICAgb25FcnJvcjogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfSwKICAgIHdpdGhDcmVkZW50aWFsczogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGhlYWRlcnM6IHsKICAgICAgdHlwZTogT2JqZWN0CiAgICB9LAogICAgYXV0b1RvYXN0OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICBzaG93RG93bmxvYWQ6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBzaG93RGVsZXRlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICBvblJlbW92ZTogewogICAgICB0eXBlOiBGdW5jdGlvbgogICAgfQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGltZ1N0eWxlOiB7CiAgICAgICAgd2lkdGg6IHRoaXMuYm94V2lkdGggfHwgdGhpcy5ib3h3aWR0aCA/ICh0aGlzLmJveFdpZHRoIHx8IHRoaXMuYm94d2lkdGgpICsgJ3B4JyA6ICcxMjBweCcsCiAgICAgICAgaGVpZ2h0OiB0aGlzLmJveEhlaWdodCB8fCB0aGlzLmJveGhlaWdodCA/ICh0aGlzLmJveEhlaWdodCB8fCB0aGlzLmJveGhlaWdodCkgKyAncHgnIDogJzEyMHB4JywKICAgICAgICBsaW5lSGVpZ2h0OiB0aGlzLmJveEhlaWdodCB8fCB0aGlzLmJveGhlaWdodCA/ICh0aGlzLmJveEhlaWdodCB8fCB0aGlzLmJveGhlaWdodCkgKyAncHgnIDogJzEyMHB4JwogICAgICB9LAogICAgICBmaWxlRGV0YWlsQXJyYXk6IFtdLAogICAgICByZWFkeVVwbG9hZEFycmF5OiBbXSwKICAgICAgaGFuZGxlUGljdHVyZVVybDogJycsCiAgICAgIGZpbGVMaXN0OiBBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpID8gdGhpcy52YWx1ZSA6IFt0aGlzLnZhbHVlXSB8fCBbXSwKICAgICAgZHJhZ292ZXI6IGZhbHNlLAogICAgICBtb2RhbEltZ1N0eWxlOiB7CiAgICAgICAgd2lkdGg6ICcnLAogICAgICAgIGhlaWdodDogJycKICAgICAgfSwKICAgICAgZmlsZTogbnVsbCwKICAgICAgSVNFTUlUT05VUExPQUQ6IGZhbHNlLAogICAgICBmaWxlSWNvbjogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCxpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBQlFBQUFBV0NBWUFBQURBUWJ3R0FBQUFBWE5TUjBJQXJzNGM2UUFBQWJSSlJFRlVPRStsbFVzb1JHRVV4MytmR0RNU00xS1lRcEhGYkx3VkVndGtvMnhaeUVwaVk2SEVXalpXTEpTd3M3R3owS3dvOGxpTVBFYVJ5V01hSW8vR2F5YU5FbGQzYm1QbUdzWTE5NnU3dU9mKy83L3ZuTzk4M1NPa1F3eGNNNFpFSjFudEdhUVVRY0FETjNQRVhDNGN2TkFpaG5pTzFBbHBtWEVrK29QQnlrMHcxNExmQ1k2eTJNQmR3TThPVnBwRkg0OGhzWkNXdUFjeWdvR0tWYkEwZ0c4YnRxcitCc3BPQS92azBpUjY4TW9HR1NoOU9ST01JRC9HUEFXT0FGY3YzTTVIdytVTVphQzhqQndFb2QzY3FvRWhXMm9KVkR1VnQ2TWV1SnFPQnA0QW5vaXdDUmNGTkttQmxrWXc1Y1BIRzFqcWxReXZac0RuaUFhK0EyN0FGL0VwalRNMThEOU4rZVdFdndIWHdWd0h2ajNZS28vZEZFMUFneFdTekpCb0FkdVVVdkxwTUhnWE5jUGpiNHFtREVPaVpDdllacFVNejhmZ2NVVm5ocHJ0MFVKMXlZV2prTjBSVnIwSFlMOE5BcWVhdC9qNTJrVGFuYTNndGVzQXB0ZUV6VUtBYnFCOFRaN1dsSWFVMnVGeVVrK0dHK0FlVVlBaUFZb1g0R0lDN3VNdE9hY0xNbHZESlgrOHd2RUF2TjNGZVlhYWJiOEwxVDlZL2NBSDlRalFDeFJNQ05XUUNvMkMvNE1mRU15UncrQW5kaEN2ZE9qTnV3b0FBQUFBU1VWT1JLNUNZSUk9JwogICAgfTsKICB9LAogIHdhdGNoOiB7CiAgICB2YWx1ZTogewogICAgICBoYW5kbGVyKCkgewogICAgICAgIHRoaXMuZmlsZUxpc3QgPSB0aGlzLmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlIDogdGhpcy52YWx1ZSA/IFt7IHVybDogdGhpcy52YWx1ZSB9XSA6IFtdOwogICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkgewogICAgICAgICAgdGhpcy5maWxlTGlzdCA9IHRoaXMuZmlsZUxpc3Quc2xpY2UoLTEpOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuYWN0aW9uKSB7CiAgICAgICAgICB0aGlzLmZpbGVMaXN0Lm1hcCgodmFsLCBpKSA9PiB7CiAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh2YWwpICE9PSAne30nKSB7CiAgICAgICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSwKICAgICAgZGVlcDogdHJ1ZQogICAgfSwKICAgIGZpbGVMaXN0OiB7CiAgICAgIGhhbmRsZXIodikgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHYsICdmaWxlTGlzdCcpOwogICAgICAgIGlmICh2Lmxlbmd0aCkgewogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOndhaXRpbmcnLCB0cnVlKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOndhaXRpbmcnLCBmYWxzZSk7CiAgICAgICAgfQogICAgICB9LAogICAgICBkZWVwOiB0cnVlCiAgICB9CiAgfSwKICBjb21wdXRlZDogewogICAgLy8gbmFtZeWAvOagoemqjAogICAgdXBsb2FkQ29udGVudCgpIHsKICAgICAgaWYgKCEodGhpcy5hdXRvVXBsb2FkICYmIHRoaXMuYXV0b3VwbG9hZCkpIHsKICAgICAgICByZXR1cm4gdGhpcy5maWxlTGlzdC5maWx0ZXIoKHZhbCkgPT4gewogICAgICAgICAgcmV0dXJuIHZhbC5zdGF0dXMgPT0gJ3N1Y2Nlc3MnOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmZpbGVMaXN0OwogICAgfQogIH0sCiAgbW91bnRlZCgpIHsKICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgLy8g6buY6K6k5Zue5pi+5YC8CiAgICAgIHRoaXMuZmlsZUxpc3QgPSB0aGlzLmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlIDogdGhpcy52YWx1ZSA/IFt7IHVybDogdGhpcy52YWx1ZSB9XSA6IFtdOwogICAgICB0aGlzLmZpbGVMaXN0Lm1hcCgodmFsLCBpKSA9PiB7CiAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KHZhbCkgIT09ICd7fScgJiYgdmFsKSB7CiAgICAgICAgICB0aGlzLiRzZXQodmFsLCAnc3RhdHVzJywgJ3N1Y2Nlc3MnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy52YWx1ZS5zcGxpY2UoaSwgMSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0sCiAgbWV0aG9kczogewogICAgb25EcmFnb3ZlcigpIHsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7CiAgICAgICAgdGhpcy5kcmFnb3ZlciA9IHRydWU7CiAgICAgIH0KICAgIH0sCiAgICBkcm9wKGUpIHsKICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHJldHVybjsKICAgICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7CiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBbXSk7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YUZpbGVMaXN0ID0gZS5kYXRhVHJhbnNmZXIuZmlsZXM7IC8vIOiOt+WPluaWh+S7tuWvueixoQogICAgICBpZiAoZGF0YUZpbGVMaXN0Lmxlbmd0aCA8IDEpIHsKICAgICAgICByZXR1cm47IC8vIOajgOa1i+aYr+WQpuacieaWh+S7tuaLluaLveWIsOmhtemdogogICAgICB9CiAgICAgIGNvbnN0IGZpbGVMaXN0TGVuID0gdGhpcy52YWx1ZT8ubGVuZ3RoIHx8IDA7CiAgICAgIGNvbnN0IHRhcmdldEZpbGVzTGVuID0gZGF0YUZpbGVMaXN0Lmxlbmd0aDsKICAgICAgLy8g5aaC5p6cIOeOsOacieeahOaWh+S7tuaVsCArIOmAieS4reeahOaWh+S7tuaVsCA+IGxpbWl06ZmQ5Yi25pWwIOinpuWPkQogICAgICBpZiAodGhpcy5saW1pdCAmJiBmaWxlTGlzdExlbiArIHRhcmdldEZpbGVzTGVuID4gdGhpcy5saW1pdCkgewogICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnbGltaXROdW0nLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3Qgd2FybiA9IG1lc3NhZ2Uud2FybmluZzsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgIGDlvZPliY3pmZDliLbpgInmi6kgJHt0aGlzLmxpbWl0fSDkuKrmlofku7bvvIzmnKzmrKHpgInmi6nkuoYgJHt0YXJnZXRGaWxlc0xlbn0g5Liq5paH5Lu277yM5YWx6YCJ5oup5LqGICR7CiAgICAgICAgICAgICAgZmlsZUxpc3RMZW4gKyB0YXJnZXRGaWxlc0xlbgogICAgICAgICAgICB9IOS4quaWh+S7tmAKICAgICAgICAgICk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICAvLyBpZiAodGhpcy5saW1pdCAmJiB0aGlzLmZpbGVMaXN0Lmxlbmd0aD09dGhpcy5saW1pdCl7CiAgICAgIC8vICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgLy8gICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdsaW1pdE51bScsIHRoaXMuZmlsZUxpc3QpOwogICAgICAvLyAgIH0gZWxzZSB7CiAgICAgIC8vICAgICBtZXNzYWdlLmVycm9yKCfmnIDlpJrlhYHorrjkuIrkvKAnK3RoaXMubGltaXQrJ+S4quaWh+S7ticpOwogICAgICAvLyAgIH0KICAgICAgLy8gICByZXR1cm47CiAgICAgIC8vIH0KICAgICAgY29uc3QgZGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICBpZiAodGhpcy5wYXJhbXMpIHsKICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnBhcmFtcykuZm9yRWFjaCgoa2V5KSA9PiB7CiAgICAgICAgICBkYXRhLmFwcGVuZChrZXksIHRoaXMucGFyYW1zW2tleV0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUZpbGVMaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5maWxlID0gZGF0YUZpbGVMaXN0W2ldOwogICAgICAgIGRhdGEuYXBwZW5kKHRoaXMuZmlsZU5hbWUsIGRhdGFGaWxlTGlzdFtpXSk7CiAgICAgICAgdGhpcy5vblVwbG9hZChkYXRhLCBkYXRhRmlsZUxpc3RbaV0sIGkpOwogICAgICB9CiAgICB9LAogICAgc29ydCgpIHsKICAgICAgLy8g5ouW5ou95pS55Y+Y5L2N572uCiAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdGhpcy5maWxlTGlzdCk7CiAgICB9LAogICAgLyoqCiAgICAgKiDngrnlh7vkuIrkvKDvvIjmnKrnoa7lrprku4XmiZPlvIDlvLnnqpfvvInml7bop6blj5HvvIwKICAgICAqLwogICAgdXBsb2FkKGV2ZW50KSB7CiAgICAgIGxldCBzZWxlY3RGaWxlID0gKCkgPT4gewogICAgICAgIHRoaXMuJGVsLmNoaWxkcmVuWzBdLnZhbHVlID0gJyc7IC8vIOino+WGs+S4pOasoeS4iuS8oOWQjOagt+aWh+S7tuS4jeinpuWPkWNoYW5nZemXrumimAogICAgICAgIGlmICghdGhpcy5kaXNhYmxlZCkgewogICAgICAgICAgdGhpcy4kZWwuY2hpbGRyZW5bMF0uY2xpY2soKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMuY2xpY2spIHsKICAgICAgICB0aGlzLiRlbWl0KCdjbGljaycsIGV2ZW50LCBzZWxlY3RGaWxlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzZWxlY3RGaWxlKCk7CiAgICAgIH0KICAgIH0sCiAgICAvKioKICAgICAqIOeCueWHu+ehruiupOS4iuS8oOaXtuinpuWPkQogICAgICovCiAgICBjaGFuZ2UoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5jaGFuZ2UpIHsKICAgICAgICB0aGlzLiRlbWl0KCdjaGFuZ2UnLCBldmVudCwgdGhpcy5jaGFuZ2VGaWxlKTsKICAgICAgfQogICAgICB0aGlzLmNoYW5nZUZpbGUoZXZlbnQpOwogICAgfSwKICAgIGNoYW5nZUZpbGUoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuYXV0b3VwbG9hZCAmJiB0aGlzLmF1dG9VcGxvYWQpIHsKICAgICAgICBpZiAodGhpcy5maWxlTGlzdC5sZW5ndGggPT0gMCB8fCB0aGlzLmZpbGVMaXN0LmZpbHRlcigodmFsKSA9PiB2YWwuc3RhdHVzID09ICdzdWNjZXNzJykubGVuZ3RoID09IDApIHsKICAgICAgICAgIHRoaXMuZmlsZUxpc3QgPSBbXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLm11bHRpcGxlICYmICghKHRoaXMuYXV0b1VwbG9hZCAmJiB0aGlzLmF1dG91cGxvYWQpIHx8IHRoaXMudHlwZSA9PSAnaW1nJyB8fCB0aGlzLnR5cGUgPT0gJ2ZpbGUnKSkgewogICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgW10pOwogICAgICB9CiAgICAgIGNvbnN0IGZpbGVMaXN0TGVuID0gdGhpcy52YWx1ZT8ubGVuZ3RoIHx8IDA7CiAgICAgIGNvbnN0IHRhcmdldEZpbGVzTGVuID0gZXZlbnQudGFyZ2V0LmZpbGVzPy5sZW5ndGg7CiAgICAgIC8vIOWmguaenCDnjrDmnInnmoTmlofku7bmlbAgKyDpgInkuK3nmoTmlofku7bmlbAgPiBsaW1pdOmZkOWItuaVsCDop6blj5EKICAgICAgaWYgKHRoaXMubGltaXQgJiYgZmlsZUxpc3RMZW4gKyB0YXJnZXRGaWxlc0xlbiA+IHRoaXMubGltaXQpIHsKICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2xpbWl0TnVtJywgdGhpcy5maWxlTGlzdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOWFvOWuuei/kOiQpeW5s+WPsOWSjOWVhuWutuS4reW/g+eahHdhcm7vvIxVSeW6k+eahOaYr3dhcm5pbmcKICAgICAgICAgIGNvbnN0IHdhcm4gPSBtZXNzYWdlLndhcm5pbmc7CiAgICAgICAgICB3YXJuKAogICAgICAgICAgICBg5b2T5YmN6ZmQ5Yi26YCJ5oupICR7dGhpcy5saW1pdH0g5Liq5paH5Lu277yM5pys5qyh6YCJ5oup5LqGICR7dGFyZ2V0RmlsZXNMZW59IOS4quaWh+S7tu+8jOWFsemAieaLqeS6hiAkewogICAgICAgICAgICAgIGZpbGVMaXN0TGVuICsgdGFyZ2V0RmlsZXNMZW4KICAgICAgICAgICAgfSDkuKrmlofku7ZgCiAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g5aaC5p6cIOeOsOacieeahOaWh+S7tuaVsCA9IGxpbWl06ZmQ5Yi25pWwIOinpuWPkQogICAgICAvLyBpZiAodGhpcy5saW1pdCAmJiBmaWxlTGlzdExlbiA9PSB0aGlzLmxpbWl0KSB7CiAgICAgIC8vICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgLy8gICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdsaW1pdE51bScsIHRoaXMuZmlsZUxpc3QpOwogICAgICAvLyAgIH0gZWxzZSB7CiAgICAgIC8vICAgICBtZXNzYWdlLmVycm9yKCfmnIDlpJrlhYHorrjkuIrkvKAnK3RoaXMubGltaXQrJ+S4quaWh+S7ticpOwogICAgICAvLyAgIH0KICAgICAgLy8gICByZXR1cm47CiAgICAgIC8vIH0KICAgICAgdmFyIGRhdGEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgdmFyIGZpbGUgPSBldmVudC50YXJnZXQuZmlsZXNbMF07CiAgICAgIHZhciBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlczsKICAgICAgLy8g5LiK5Lyg5LiU5qCh6aqM5oiQ5Yqf5Lik5Liq5Lul5LiK5paH5Lu277yM6L+b5YWlCiAgICAgIC8vIGxldCBmaWxlc0NvcHkgPSBbXTsKICAgICAgaWYgKGZpbGVzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBsZXQgZGF0YTEgPSBuZXcgRm9ybURhdGEoKTsKICAgICAgICAgIGxldCByID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgIHIucmVhZEFzRGF0YVVSTChmaWxlc1tpXSk7CiAgICAgICAgICByLm9ubG9hZCA9IChlKSA9PiB7CiAgICAgICAgICAgIC8vIOS4iuS8oOeahOS4uuaWh+S7tu+8iOmdnuWbvueJh++8iQogICAgICAgICAgICBpZiAodGhpcy50eXBlID09ICdmaWxlJykgewogICAgICAgICAgICAgIGlmICh0aGlzLnNpemUgJiYgcGFyc2VGbG9hdCh0aGlzLnNpemUpIDwgKGZpbGUuc2l6ZSAvIDEwMDApLnRvRml4ZWQoMikpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdmaWxlU2l6ZScsIGZpbGUpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5paH5Lu25bqU5bCP5LqO562J5LqOJHt0aGlzLnNpemV9S0Is546w5Li677yaJHsoZmlsZS5zaXplIC8gMTAwMCkudG9GaXhlZCgyKX1LQmApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gWy4uLnRoaXMuZmlsZUxpc3QsIHtuYW1lOiBmaWxlc1tpXS5uYW1lfV07CiAgICAgICAgICAgICAgdGhpcy5yZWFkeVVwbG9hZEFycmF5LnB1c2goewogICAgICAgICAgICAgICAgZGF0YTogZGF0YTEsCiAgICAgICAgICAgICAgICBmaWxlOiBmaWxlc1tpXQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucmVhZHlVcGxvYWRBcnJheSk7CiAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0b3VwbG9hZCAmJiB0aGlzLmF1dG9VcGxvYWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uVXBsb2FkJywgZmlsZXNbaV0sIGZpbGVzKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvbikgewogICAgICAgICAgICAgICAgICBkYXRhMS5hcHBlbmQodGhpcy5maWxlTmFtZSwgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICB0aGlzLm9uVXBsb2FkKGRhdGExLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxldCBhY2NlcHRUeXBlQXJyYXkgPSB0aGlzLnN1ZmZpeD8uc3BsaXQoJywnKTsKICAgICAgICAgICAgICBsZXQgZmlsZVR5cGUgPSBmaWxlc1tpXT8udHlwZT8uc3BsaXQoJy8nKVsxXT8udG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBpZiAoYWNjZXB0VHlwZUFycmF5Py5sZW5ndGggPiAwICYmIGFjY2VwdFR5cGVBcnJheS5pbmRleE9mKGZpbGVUeXBlKSA8IDApIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdmaWxlVHlwZScsIGZpbGVzW2ldKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOivt+S4iuS8oOexu+Wei+S4uiR7dGhpcy5zdWZmaXh955qE5paH5Lu2IWApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAvLyDkuIrkvKDlm77niYcKICAgICAgICAgICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7CiAgICAgICAgICAgICAgdmFyIGJhc2U2NFVybCA9IGUuY3VycmVudFRhcmdldC5yZXN1bHQ7CiAgICAgICAgICAgICAgaW1nLnNyYyA9IGJhc2U2NFVybDsKICAgICAgICAgICAgICBjb25zdCBpbWdMb2FkRnVuYyA9IChlKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgX3cgPSBlLmN1cnJlbnRUYXJnZXQud2lkdGg7CiAgICAgICAgICAgICAgICB2YXIgX2ggPSBlLmN1cnJlbnRUYXJnZXQuaGVpZ2h0OwogICAgICAgICAgICAgICAgLy8g5p+l55yL5aSn5Zu+5by556qX5Zu+54mH5a696auY5q+UCiAgICAgICAgICAgICAgICBpZiAoX3cgPCBfaCkgewogICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsSW1nU3R5bGUgPSB7IHdpZHRoOiAnYXV0bycsIGhlaWdodDogJzEwMCUnIH07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsSW1nU3R5bGUgPSB7IHdpZHRoOiAnMTAwJScsIGhlaWdodDogJ2F1dG8nIH07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyDliKTmlq3lrr3pq5jmmK/lkKbnrKblkIjop4TlrpoKICAgICAgICAgICAgICAgIGlmICh0aGlzLndpZHRoICYmIHRoaXMuaGVpZ2h0ICYmIChfdyAhPSB0aGlzLndpZHRoIHx8IF9oICE9IHRoaXMuaGVpZ2h0KSkgewogICAgICAgICAgICAgICAgICB0aGlzLklTRU1JVE9OVVBMT0FEID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnd2lkdGgmaGVpZ2h0JywgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+W6lOS4uiR7dGhpcy53aWR0aH1weCoke3RoaXMuaGVpZ2h0fXB4LOeOsOS4uiR7X3d9cHgqJHtfaH1weGApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIOWIpOaWreWuveW6puaYr+WQpuespuWQiOinhOWumgogICAgICAgICAgICAgICAgaWYgKHRoaXMud2lkdGggJiYgX3cgIT0gdGhpcy53aWR0aCkgewogICAgICAgICAgICAgICAgICB0aGlzLklTRU1JVE9OVVBMT0FEID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnd2lkdGgnLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH5a695bqm5bqU5Li6JHt0aGlzLndpZHRofXB4LOeOsOS4uiR7X3d9cHhgKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyDliKTmlq3pq5jluqbmmK/lkKbnrKblkIjop4TlrpoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmhlaWdodCAmJiBfaCAhPSB0aGlzLmhlaWdodCkgewogICAgICAgICAgICAgICAgICB0aGlzLklTRU1JVE9OVVBMT0FEID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnaGVpZ2h0JywgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+mrmOW6puW6lOS4uiR7dGhpcy5oZWlnaHR9cHgs546w5Li6JHtfaH1weGApOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIOWIpOaWreaWh+S7tuWkp+Wwj+aYr+WQpuespuWQiOinhOWumgogICAgICAgICAgICAgICAgaWYgKHRoaXMuc2l6ZSAmJiBwYXJzZUZsb2F0KHRoaXMuc2l6ZSkgPCAoZmlsZXNbaV0uc2l6ZSAvIDEwMjQpLnRvRml4ZWQoMikpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5JU0VNSVRPTlVQTE9BRCA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2ZpbGVTaXplJywgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+W6lOWwj+S6jiR7dGhpcy5zaXplfUtCLOeOsOS4uu+8miR7KGZpbGVzW2ldLnNpemUgLyAxMDI0KS50b0ZpeGVkKDIpfUtCYCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gZmlsZXNDb3B5LnB1c2goZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgLy8gdGhpcy5maWxlTGlzdC5wdXNoKHtuYW1lOiBmaWxlc1tpXS5uYW1lfSk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5hdXRvdXBsb2FkICYmIHRoaXMuYXV0b1VwbG9hZCkgewogICAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvblVwbG9hZCcsIGZpbGVzW2ldLCBmaWxlcyk7CiAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmFjdGlvbikgewogICAgICAgICAgICAgICAgICAgIGRhdGExLmFwcGVuZCh0aGlzLmZpbGVOYW1lLCBmaWxlc1tpXSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblVwbG9hZChkYXRhMSwgZmlsZXNbaV0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBpbWcub25sb2FkID0gKGUpID0+IHsKICAgICAgICAgICAgICAgIGltZ0xvYWRGdW5jKGUpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgaW1nLm9uZXJyb3IgPSAoZSkgPT4gewogICAgICAgICAgICAgICAgaW1nTG9hZEZ1bmMoZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgICAgLy8gdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZGF0YS5hcHBlbmQodGhpcy5maWxlTmFtZSwgZmlsZSk7CiAgICAgIHRoaXMuZmlsZSA9IGZpbGU7CiAgICAgIGlmICh0aGlzLnBhcmFtcykgewogICAgICAgIE9iamVjdC5rZXlzKHRoaXMucGFyYW1zKS5mb3JFYWNoKChrZXkpID0+IHsKICAgICAgICAgIGRhdGEuYXBwZW5kKGtleSwgdGhpcy5wYXJhbXNba2V5XSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgbGV0IHIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICByLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgIHIub25sb2FkID0gKGUpID0+IHsKICAgICAgICAvLyDkuIrkvKDnmoTkuLrmlofku7bvvIjpnZ7lm77niYfvvIkKICAgICAgICBpZiAodGhpcy50eXBlID09ICdmaWxlJykgewogICAgICAgICAgLy8g5Yik5pat5paH5Lu25aSn5bCP5piv5ZCm56ym5ZCI6KeE5a6aCiAgICAgICAgICBpZiAodGhpcy5zaXplICYmIHBhcnNlRmxvYXQodGhpcy5zaXplKSA8IChmaWxlLnNpemUgLyAxMDAwKS50b0ZpeGVkKDIpKSB7CiAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ2ZpbGVTaXplJywgZmlsZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5paH5Lu25bqU5bCP5LqO562J5LqOJHt0aGlzLnNpemV9S0Is546w5Li677yaJHsoZmlsZS5zaXplIC8gMTAwMCkudG9GaXhlZCgyKX1LQmApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmF1dG9VcGxvYWQgJiYgdGhpcy5hdXRvdXBsb2FkKSB7CiAgICAgICAgICAgIC8vIOiHquWKqOS4iuS8oOeahOaDheWGtQogICAgICAgICAgICB0aGlzLm9uVXBsb2FkKGRhdGEsIGZpbGUpOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLm11bHRpcGxlKSB7CiAgICAgICAgICAgIC8vIOiLpeaYr+aJi+WKqOS4iuS8oAogICAgICAgICAgICB0aGlzLmZpbGVMaXN0LnB1c2goeyBuYW1lOiBmaWxlLm5hbWUgfSk7CiAgICAgICAgICAgIHRoaXMucmVhZHlVcGxvYWRBcnJheS5wdXNoKHsKICAgICAgICAgICAgICBkYXRhOiBkYXRhLAogICAgICAgICAgICAgIGZpbGU6IGZpbGUKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gW3sgbmFtZTogZmlsZS5uYW1lIH1dOwogICAgICAgICAgICB0aGlzLnJlYWR5VXBsb2FkQXJyYXkgPSBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgIGZpbGU6IGZpbGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF07CiAgICAgICAgICB9CiAgICAgICAgICAvLyB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMuZmlsZUxpc3QpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZXQgYWNjZXB0VHlwZUFycmF5ID0gdGhpcy5zdWZmaXg/LnNwbGl0KCcsJyk7CiAgICAgICAgICBsZXQgZmlsZVR5cGUgPSBmaWxlPy50eXBlPy5zcGxpdCgnLycpWzFdPy50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgLy8g5Yik5pat5paH5Lu257G75Z6L5piv5ZCm56ym5ZCI6KeE5a6aCiAgICAgICAgICBpZiAoYWNjZXB0VHlwZUFycmF5Py5sZW5ndGggPiAwICYmIGFjY2VwdFR5cGVBcnJheS5pbmRleE9mKGZpbGVUeXBlKSA8IDApIHsKICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnZmlsZVR5cGUnLCBmaWxlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKGDor7fkuIrkvKDnsbvlnovkuLoke3RoaXMuc3VmZml4feeahOaWh+S7tiFgKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICAvLyDkuIrkvKDlm77niYcKICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgIHZhciBiYXNlNjRVcmwgPSBlLmN1cnJlbnRUYXJnZXQucmVzdWx0OwogICAgICAgICAgaW1nLnNyYyA9IGJhc2U2NFVybDsKICAgICAgICAgIC8vIOWbvueJh+WKoOi9veeahOebkeWQrOWHveaVsAogICAgICAgICAgY29uc3QgaW1nTG9hZEZ1bmMgPSAoZSkgPT4gewogICAgICAgICAgICB2YXIgX3cgPSBlLmN1cnJlbnRUYXJnZXQud2lkdGg7CiAgICAgICAgICAgIHZhciBfaCA9IGUuY3VycmVudFRhcmdldC5oZWlnaHQ7CiAgICAgICAgICAgIC8vIOafpeeci+Wkp+WbvuW8ueeql+WbvueJh+WuvemrmOavlAogICAgICAgICAgICBpZiAoX3cgPCBfaCkgewogICAgICAgICAgICAgIHRoaXMubW9kYWxJbWdTdHlsZSA9IHsgd2lkdGg6ICdhdXRvJywgaGVpZ2h0OiAnMTAwJScgfTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLm1vZGFsSW1nU3R5bGUgPSB7IHdpZHRoOiAnMTAwJScsIGhlaWdodDogJ2F1dG8nIH07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g5Yik5pat5a696auY5piv5ZCm56ym5ZCI6KeE5a6aCiAgICAgICAgICAgIGlmICh0aGlzLndpZHRoICYmIHRoaXMuaGVpZ2h0ICYmIChfdyAhPSB0aGlzLndpZHRoIHx8IF9oICE9IHRoaXMuaGVpZ2h0KSkgewogICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnd2lkdGgmaGVpZ2h0JywgZmlsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+W6lOS4uiR7dGhpcy53aWR0aH1weCoke3RoaXMuaGVpZ2h0fXB4LOeOsOS4uiR7X3d9cHgqJHtfaH1weGApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g5Yik5pat5a695bqm5piv5ZCm56ym5ZCI6KeE5a6aCiAgICAgICAgICAgIGlmICh0aGlzLndpZHRoICYmIF93ICE9IHRoaXMud2lkdGgpIHsKICAgICAgICAgICAgICBpZiAodGhpcy4kbGlzdGVuZXJzLm9uTWVzc2FnZSkgewogICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnb25NZXNzYWdlJywgJ3dpZHRoJywgZmlsZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2UuZXJyb3IoYOWbvueJh+WuveW6puW6lOS4uiR7dGhpcy53aWR0aH1weCznjrDkuLoke193fXB4YCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDliKTmlq3pq5jluqbmmK/lkKbnrKblkIjop4TlrpoKICAgICAgICAgICAgaWYgKHRoaXMuaGVpZ2h0ICYmIF9oICE9IHRoaXMuaGVpZ2h0KSB7CiAgICAgICAgICAgICAgaWYgKHRoaXMuJGxpc3RlbmVycy5vbk1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHRoaXMuJGVtaXQoJ29uTWVzc2FnZScsICdoZWlnaHQnLCBmaWxlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH6auY5bqm5bqU5Li6JHt0aGlzLmhlaWdodH1weCznjrDkuLoke19ofXB4YCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDliKTmlq3mlofku7blpKflsI/mmK/lkKbnrKblkIjop4TlrpoKICAgICAgICAgICAgaWYgKHRoaXMuc2l6ZSAmJiBwYXJzZUZsb2F0KHRoaXMuc2l6ZSkgPCAoZmlsZS5zaXplIC8gMTAyNCkudG9GaXhlZCgyKSkgewogICAgICAgICAgICAgIGlmICh0aGlzLiRsaXN0ZW5lcnMub25NZXNzYWdlKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRlbWl0KCdvbk1lc3NhZ2UnLCAnZmlsZVNpemUnLCBmaWxlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihg5Zu+54mH5bqU5bCP5LqOJHt0aGlzLnNpemV9S0Is546w5Li677yaJHsoZmlsZS5zaXplIC8gMTAyNCkudG9GaXhlZCgyKX1LQmApOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5vblVwbG9hZChkYXRhLCBmaWxlKTsKICAgICAgICAgIH07CiAgICAgICAgICBpbWcub25sb2FkID0gKGUpID0+IHsKICAgICAgICAgICAgaW1nTG9hZEZ1bmMoZSk7CiAgICAgICAgICB9OwogICAgICAgICAgaW1nLm9uZXJyb3IgPSAoZSkgPT4gewogICAgICAgICAgICBpbWdMb2FkRnVuYyhlKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICB9OwogICAgfSwKICAgIG9uVXBsb2FkKGRhdGEsIGZpbGUsIGkpIHsKICAgICAgbGV0IHRoYXQgPSB0aGlzOwogICAgICBsZXQgZWwgPSB0aGlzLiRlbDsKICAgICAgaWYgKHRoaXMuZHJhZ1VwbG9hZCkgewogICAgICAgIGVsID0gdGhpcy4kcmVmcy5kcmFnVXBsb2FkOwogICAgICB9CiAgICAgIGxldCB1cGxvYWQgPSAoKSA9PiB7CiAgICAgICAgbGV0IHBhcmFtcyA9IHt9OwogICAgICAgIGlmICh0aGlzLnBhcmFtcykgewogICAgICAgICAgT2JqZWN0LmtleXModGhpcy5wYXJhbXMpLmZvckVhY2goKGtleSkgPT4gewogICAgICAgICAgICBwYXJhbXNba2V5XSA9IHRoaXMucGFyYW1zW2tleV07CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMuYWN0aW9uKSB7CiAgICAgICAgICB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yICYmIGxvYWRpbmcubWV0aG9kcy5zaG93TG9hZGluZyh7IGVsLCB3aGl0ZTogdHJ1ZSB9KTsKICAgICAgICAgIC8vIGxldCBodHRwUmVxdWVzdCA9IHRoaXMuaHR0cFJlcXVlc3QgfHwgYWpheDsKICAgICAgICAgIC8vIGNvbnN0IGlzRGogPSB3aW5kb3cubG9jYXRpb24uaG9zdC5lbmRzV2l0aCgnamRkai5jb20nKTsKICAgICAgICAgIC8vIGlmIChpc0RqKSB7CiAgICAgICAgICBsZXQgaHR0cFJlcXVlc3QgPSB0aGlzLmh0dHBSZXF1ZXN0IHx8IGF4aW9zLnVwbG9hZDsKICAgICAgICAgIC8vIH0KICAgICAgICAgIGh0dHBSZXF1ZXN0KHRoaXMuYWN0aW9uLCB0aGlzLnNlcGFyYXRlID8gcGFyYW1zIDogZGF0YSwgdGhpcy5zZXBhcmF0ZSA/IGZpbGUgOiBudWxsKS50aGVuKAogICAgICAgICAgICAocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgdGhhdC4kZWwucXVlcnlTZWxlY3RvciAmJiBsb2FkaW5nLm1ldGhvZHMuY2xvc2VMb2FkaW5nKHsgZWwgfSk7CiAgICAgICAgICAgICAgaWYgKHJlc3VsdC5jb2RlID09IDApIHsKICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc3VjY2VzcyhyZXN1bHQubXNnKTsKICAgICAgICAgICAgICAgIHRoYXQuZmlsZURldGFpbEFycmF5LnB1c2goZmlsZSk7CiAgICAgICAgICAgICAgICB0aGF0LiRlbWl0KCdvblN1Y2Nlc3MnLCByZXN1bHQsIGZpbGUsIHRoYXQuZmlsZURldGFpbEFycmF5KTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dG91cGxvYWQgJiYgdGhpcy5hdXRvVXBsb2FkIHx8IHRoaXMuZHJhZ1VwbG9hZCkgewogICAgICAgICAgICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5tYXAoKGl0ZW0sIGkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShpdGVtKSAhPT0gJ3t9JyAmJiBpdGVtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuJHNldChpdGVtLCAnc3RhdHVzJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy5maWxlTGlzdC5wb3AoKTsKICAgICAgICAgICAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLmZpbGVMaXN0W2ldKSAhPT0gJ3t9JyAmJiB0aGlzLmZpbGVMaXN0W2ldKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5maWxlTGlzdFtpXSwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWVzc2FnZS5lcnJvcihyZXN1bHQubXNnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIChlcnIpID0+IHsKICAgICAgICAgICAgICB0aGF0LiRlbC5xdWVyeVNlbGVjdG9yICYmIGxvYWRpbmcubWV0aG9kcy5jbG9zZUxvYWRpbmcoeyBlbCB9KTsKICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0CiAgICAgICAgICAgICAgICAuZmlsdGVyKCh2YWwpID0+IHZhbC5zdGF0dXMgIT0gJ3N1Y2Nlc3MnKQogICAgICAgICAgICAgICAgLm1hcCgodmFsKSA9PiB7CiAgICAgICAgICAgICAgICAgIHRoaXMuJHNldCh2YWwsICdzdGF0dXMnLCAnZXJyb3InKTsKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHRoYXQuJGVtaXQoJ29uRXJyb3InLCBlcnIsIGZpbGUsIHRoYXQuZmlsZUxpc3QpOwogICAgICAgICAgICB9CiAgICAgICAgICApOwogICAgICAgICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLAogICAgICAgICAgICB3aXRoQ3JlZGVudGlhbHM6IHRoaXMud2l0aENyZWRlbnRpYWxzLAogICAgICAgICAgICBmaWxlOiBmaWxlLAogICAgICAgICAgICBkYXRhOiB0aGlzLnBhcmFtcywKICAgICAgICAgICAgZmlsZW5hbWU6IHRoaXMuZmlsZU5hbWUsCiAgICAgICAgICAgIGFjdGlvbjogdGhpcy5hY3Rpb24sCiAgICAgICAgICAgIG9uU3VjY2VzczogKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgIHRoYXQuJGVsLnF1ZXJ5U2VsZWN0b3IgJiYgbG9hZGluZy5tZXRob2RzLmNsb3NlTG9hZGluZyh7IGVsIH0pOwogICAgICAgICAgICAgIGlmICh0aGlzLm9uU3VjY2VzcykgewogICAgICAgICAgICAgICAgY29uc3Qgc29yZiA9IHRoaXMub25TdWNjZXNzKHJlc3VsdCwgZmlsZSk7CiAgICAgICAgICAgICAgICBpZiAoc29yZiB8fCBzb3JmID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5hZnRlclN1Y2Nlc3NGdW4oZmlsZSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIC8vIOWFvOWuueWIsOWutuS4muWKoQogICAgICAgICAgICAgIGlmIChyZXN1bHQuY29kZSA9PSAwKSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlLnN1Y2Nlc3MocmVzdWx0Lm1zZyk7CiAgICAgICAgICAgICAgICB0aGF0LiRlbWl0KCdvblN1Y2Nlc3MnLCByZXN1bHQsIGZpbGUsIHRoYXQuZmlsZURldGFpbEFycmF5KTsKICAgICAgICAgICAgICAgIHRoaXMuYWZ0ZXJTdWNjZXNzRnVuKGZpbGUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlLmVycm9yKHJlc3VsdC5tc2cpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgb25FcnJvcjogKGVycikgPT4gewogICAgICAgICAgICAgIHRoYXQuJGVsLnF1ZXJ5U2VsZWN0b3IgJiYgbG9hZGluZy5tZXRob2RzLmNsb3NlTG9hZGluZyh7IGVsIH0pOwogICAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QKICAgICAgICAgICAgICAgIC5maWx0ZXIoKHZhbCkgPT4gdmFsLnN0YXR1cyAhPSAnc3VjY2VzcycpCiAgICAgICAgICAgICAgICAubWFwKCh2YWwpID0+IHsKICAgICAgICAgICAgICAgICAgdGhpcy4kc2V0KHZhbCwgJ3N0YXR1cycsICdlcnJvcicpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICAgICAgICBpZiAodGhpcy5vbkVycm9yKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoZXJyLCBmaWxlKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhhdC4kZW1pdCgnb25FcnJvcicsIGVyciwgZmlsZSwgdGhhdC5maWxlTGlzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICBjb25zdCByZXEgPSBodHRwUmVxdWVzdChvcHRpb25zKTsKICAgICAgICAgIGlmIChyZXEgJiYgcmVxLnRoZW4pIHsKICAgICAgICAgICAgcmVxLnRoZW4ob3B0aW9ucy5vblN1Y2Nlc3MsIG9wdGlvbnMub25FcnJvcik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ29uVXBsb2FkJywgdGhpcy5maWxlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIGlmICh0aGlzLmJlZm9yZVVwbG9hZCAmJiB0eXBlb2YgdGhpcy5iZWZvcmVVcGxvYWQgPT09ICdmdW5jdGlvbicgJiYgIXRoaXMuYmVmb3JlVXBsb2FkKGZpbGUsIHVwbG9hZCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgdXBsb2FkKCk7CiAgICB9LAogICAgYWZ0ZXJTdWNjZXNzRnVuKGZpbGUpIHsKICAgICAgdGhpcy5maWxlRGV0YWlsQXJyYXkucHVzaChmaWxlKTsKICAgICAgaWYgKHRoaXMuYXV0b3VwbG9hZCAmJiB0aGlzLmF1dG9VcGxvYWQgfHwgdGhpcy5kcmFnVXBsb2FkKSB7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgdGhpcy5maWxlTGlzdC5tYXAoKGl0ZW0pID0+IHsKICAgICAgICAgICAgaWYgKEpTT04uc3RyaW5naWZ5KGl0ZW0pICE9PSAne30nICYmIGl0ZW0pIHsKICAgICAgICAgICAgICB0aGlzLiRzZXQoaXRlbSwgJ3N0YXR1cycsICdzdWNjZXNzJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsZUxpc3QgPSB0aGlzLmZpbGVMaXN0LnBvcCgpOwogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeSh0aGlzLmZpbGVMaXN0W2ldKSAhPT0gJ3t9JyAmJiB0aGlzLmZpbGVMaXN0W2ldKSB7CiAgICAgICAgICAgIHRoaXMuJHNldCh0aGlzLmZpbGVMaXN0W2ldLCAnc3RhdHVzJywgJ3N1Y2Nlc3MnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHRoaXMuZmlsZUxpc3QpOwogICAgfSwKICAgIC8vIOaJi+WKqOS4iuS8oAogICAgaGFuZFVwbG9hZCgpIHsKICAgICAgbGV0IHJlYWR5VXBsb2FkRmlsZUxpc3QgPSB0aGlzLmZpbGVMaXN0LmZpbHRlcigoaXRlbSkgPT4gewogICAgICAgIHJldHVybiBpdGVtLnN0YXR1cyAhPSAnc3VjY2Vzcyc7CiAgICAgIH0pOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJlYWR5VXBsb2FkRmlsZUxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICB0aGlzLm9uVXBsb2FkKAogICAgICAgICAgdGhpcy5yZWFkeVVwbG9hZEFycmF5W2ldLmRhdGEsCiAgICAgICAgICB0aGlzLnJlYWR5VXBsb2FkQXJyYXlbaV0uZmlsZSwKICAgICAgICAgIHRoaXMuZmlsZUxpc3QuaW5kZXhPZihyZWFkeVVwbG9hZEZpbGVMaXN0W2ldKQogICAgICAgICk7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVQaWN0dXJlUmVtb3ZlKGkpIHsKICAgICAgLy8g5aaC5p6c6YCa6L+HcHJvcHPkvKDlhaXkuoZvblJlbW92Ze+8jOaJp+ihjOatpOmAu+i+kQogICAgICBpZiAodGhpcy5vblJlbW92ZSkgewogICAgICAgIC8vIG9uUmVtb3Zl5Ye95pWw5LitcmV0dXJuIGZhbHNl5YiZ5Y+W5raI5Yig6Zmk5pON5L2cCiAgICAgICAgY29uc3QgYm9vbCA9IHRoaXMub25SZW1vdmUodGhpcy5maWxlTGlzdFtpXSwgaSk7CiAgICAgICAgaWYgKGJvb2wgIT09IGZhbHNlKSB7CiAgICAgICAgICB0aGlzLmZpbGVMaXN0LnNwbGljZShpLCAxKTsKICAgICAgICAgIHRoaXMuZmlsZURldGFpbEFycmF5LnNwbGljZShpLCAxKTsKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpKSB7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdGhpcy5maWxlTGlzdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsICcnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8g5rKh5LygcHJvcHPvvJpvblJlbW92Ze+8jOaJp+ihjOatpOmAu+i+kQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZmlsZUxpc3Quc3BsaWNlKGksIDEpOwogICAgICAgIHRoaXMuJGVtaXQoJ29uUmVtb3ZlJywgdGhpcy5maWxlRGV0YWlsQXJyYXlbaV0sIHRoaXMuZmlsZUxpc3QpOwogICAgICAgIHRoaXMuZmlsZURldGFpbEFycmF5LnNwbGljZShpLCAxKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkgewogICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCB0aGlzLmZpbGVMaXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCAnJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLyoqCiAgICAgKiBAZGVzYyDliJfooajlvaLlvI/liKDpmaTlm57osIMKICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCDntKLlvJUKICAgICAqLwogICAgaGFuZGxlTGlzdFJlbW92ZShpKSB7CiAgICAgIGNvbnN0IGJvb2wgPSB0aGlzLm9uUmVtb3ZlKHRoaXMuZmlsZUxpc3RbaV0sIGkpOwogICAgICBpZiAoYm9vbCAhPT0gZmFsc2UpIHsKICAgICAgICB0aGlzLmZpbGVMaXN0LnNwbGljZShpLCAxKTsKICAgICAgICB0aGlzLmZpbGVEZXRhaWxBcnJheS5zcGxpY2UoaSwgMSk7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkpIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgdGhpcy5maWxlTGlzdCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuJGVtaXQoJ2lucHV0JywgJycpOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGhhbmRsZVBpY3R1cmVQcmV2aWV3KGkpIHsKICAgICAgaWYgKGkgIT09IG51bGwpIHsKICAgICAgICB0aGlzLiRyZWZzWydpbWcnICsgaV1bMF0uaW1hZ2VQcmV2aWV3RnVuKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy4kcmVmc1snaW1nJ10uaW1hZ2VQcmV2aWV3RnVuKCk7CiAgICAgIH0KICAgIH0sCiAgICBpc0FycmF5KG8pIHsKICAgICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKSA9PSAnW29iamVjdCBBcnJheV0nOwogICAgfSwKICAgIG9uRG93bmxvYWQoZmlsZSwgaW5kZXgpIHsKICAgICAgdGhpcy4kZW1pdCgnb25Eb3dubG9hZCcsIGZpbGUsIGluZGV4KTsKICAgIH0sCiAgICBvbkxpc3RJbWFnZUVycm9yKGluZGV4KSB7CiAgICAgIHRoaXMuJHNldCh0aGlzLmZpbGVMaXN0W2luZGV4XSwgJ2ltZ1N0YXR1cycsIGZhbHNlKTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["upload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload.vue","sourceRoot":"packages/upload/src","sourcesContent":["<template>\n  <div class=\"dj-upload\">\n    <input type=\"file\" :accept=\"accept\" class=\"hide\" @change=\"change($event)\" :multiple=\"multiple\" />\n    <input v-model=\"uploadContent\" type=\"hidden\" :name=\"name\" />\n    <div v-if=\"type == 'file'\" class=\"dj-upload-demo\">\n      <div v-if=\"!dragUpload\">\n        <span @click=\"upload($event)\">\n          <slot>\n            <dj-button type=\"primary\" :class=\"disabled ? 'is-disabled' : ''\">{{\n              autoUpload && autoupload ? '上传' : '选择文件'\n            }}</dj-button>\n          </slot>\n        </span>\n        <slot name=\"handupload\" v-if=\"!(autoUpload && autoupload)\">\n          <dj-button type=\"success\" @click=\"handUpload\" :disabled=\"fileList.length == 0\" style=\"margin-left: 20px\">\n            <dj-icon icon=\"upload\"></dj-icon> 上传文件\n          </dj-button>\n        </slot>\n      </div>\n      <div\n        v-else\n        ref=\"dragUpload\"\n        class=\"dj-dragger\"\n        :class=\"disabled ? 'is-disabled' : ''\"\n        @drop.stop.prevent=\"drop\"\n        @dragleave.stop.prevent=\"dragover = false\"\n        @dragover.stop.prevent=\"onDragover\"\n        @click=\"upload($event)\"\n      >\n        <slot>\n          <dj-icon class=\"dj-icon-upload\" icon=\"cloud-upload\"></dj-icon>\n          <div class=\"dj-upload__text\">将文件拖到此处或者<a :class=\"disabled ? 'is-disabled' : ''\">点击上传</a></div>\n        </slot>\n      </div>\n      <ul v-if=\"showUploadList\">\n        <draggable v-model=\"fileList\" :options=\"{ disabled: !draggable }\" class=\"draggable\" @sort=\"sort\">\n          <li\n            v-for=\"(val, i) in fileList\"\n            :key=\"i\"\n            :class=\"[`dj-upload-item`, `line`, `dj-upload-item-${val.status}`, `dj-upload-draggable`]\"\n          >\n            <dj-icon class=\"linkIcon\" icon=\"enclosure\" fontSize=\"14px\"></dj-icon>\n            <a class=\"dj-upload-file_name\">{{ val.name }}</a>\n            <dj-icon icon=\"check-solid\" fontSize=\"14px\" v-if=\"val.status == 'success'\" class=\"success\"></dj-icon>\n            <dj-icon icon=\"garbage\" fontSize=\"14px\" v-if=\"val.status == 'error'\" class=\"error\"></dj-icon>\n            <dj-icon\n              icon=\"garbage\"\n              class=\"delete\"\n              v-if=\"!disabled\"\n              fontSize=\"14px\"\n              @click=\"handlePictureRemove(i)\"\n            ></dj-icon>\n          </li>\n        </draggable>\n      </ul>\n    </div>\n    <div v-if=\"type == 'img'\">\n      <ul class=\"imglist\">\n        <draggable v-model=\"fileList\" :options=\"{ disabled: !draggable }\" class=\"draggable\" @sort=\"sort\">\n          <li\n            v-if=\"multiple\"\n            v-for=\"(val, i) in fileList\"\n            :key=\"i\"\n            class=\"dj-upload-imgs dj-upload-draggable\"\n            :style=\"imgStyle\"\n            :class=\"val.url ? 'noborder' : 'border'\"\n          >\n            <dj-image\n              :src=\"val.url\"\n              :fit=\"fit\"\n              :preview-src-list=\"[val.url]\"\n              style=\"height: 100%; width: 100%\"\n              :ref=\"'img' + i\"\n            >\n              <slot name=\"imageMask\" :ind=\"i\" :file=\"val\">\n                <dj-image-mask>\n                  <dj-icon\n                    class=\"zoom-in\"\n                    @click=\"handlePicturePreview(i)\"\n                    font-color=\"#fff\"\n                    font-size=\"20px\"\n                    style=\"margin-right: 20px\"\n                  ></dj-icon>\n                  <dj-icon\n                    v-if=\"!disabled\"\n                    class=\"garbage\"\n                    @click=\"handlePictureRemove(i)\"\n                    font-size=\"20px\"\n                    font-color=\"#fff\"\n                  ></dj-icon>\n                </dj-image-mask>\n              </slot>\n            </dj-image>\n          </li>\n          <!-- 添加图片按钮 -->\n          <li\n            @click=\"upload($event)\"\n            v-if=\"(multiple && (fileList.length < limit || !limit)) || !multiple\"\n            :style=\"imgStyle\"\n            class=\"dj-upload-img\"\n            :class=\"`${disabled ? 'is-disabled' : ''} ${\n              multiple ? 'border' : !multiple && fileList.length > 0 && fileList[0].url ? 'noborder' : 'border'\n            }`\"\n          >\n            <dj-image\n              style=\"height: 100%; width: 100%\"\n              :fit=\"fit\"\n              :preview-src-list=\"[fileList[0].url]\"\n              v-if=\"!multiple && fileList.length > 0 && fileList[0].url\"\n              :src=\"fileList[0].url\"\n              ref=\"img\"\n            >\n              <slot name=\"imageMask\" :ind=\"null\" :file=\"value\">\n                <dj-image-mask>\n                  <label @click.stop=\"handlePicturePreview(null)\">\n                    <dj-icon class=\"zoom-in\" font-color=\"#fff\" font-size=\"20px\" style=\"margin-right: 20px\"></dj-icon>\n                  </label>\n                  <label @click.stop=\"handlePictureRemove(null)\" v-if=\"!disabled\">\n                    <dj-icon class=\"garbage\" font-color=\"#fff\" font-size=\"20px\"></dj-icon>\n                  </label>\n                </dj-image-mask>\n              </slot>\n            </dj-image>\n            <div\n              style=\"line-height: normal; text-align: center\"\n              v-if=\"!(!multiple && fileList.length > 0 && fileList[0].url)\"\n            >\n              <slot>\n                <dj-icon class=\"add icon\" style=\"position: inherit\" font-size=\"20px\"></dj-icon>\n              </slot>\n            </div>\n          </li>\n        </draggable>\n      </ul>\n    </div>\n    <div v-if=\"type == 'list'\">\n      <div>\n        <span @click=\"upload($event)\">\n          <slot>\n            <dj-button type=\"primary\" :class=\"disabled ? 'is-disabled' : ''\">{{\n              autoUpload && autoupload ? '上传' : '选择文件'\n            }}</dj-button>\n          </slot>\n        </span>\n        <slot name=\"handupload\" v-if=\"!(autoUpload && autoupload)\">\n          <dj-button type=\"success\" @click=\"handUpload\" :disabled=\"fileList.length == 0\" style=\"margin-left: 20px\">\n            <dj-icon icon=\"upload\"></dj-icon> 上传文件\n          </dj-button>\n        </slot>\n      </div>\n      <slot name=\"tips\">\n        <div v-if=\"suffix && size\" class=\"dj-upload-tips\">\n          <span>只能上传{{suffix.split(',').join('/')}}文件</span>\n          <span>，且不超过{{size}}KB</span>\n        </div>\n        <div v-else-if=\"suffix\" class=\"dj-upload-tips\">\n          <span>只能上传{{suffix.split(',').join('/')}}文件</span>\n        </div>\n        <div v-else-if=\"size\" class=\"dj-upload-tips\">\n          <span>只能上传不超过{{size}}KB的文件</span>\n        </div>\n      </slot>\n      <div class=\"dj-upload-list\">\n        <div v-for=\"(file, index) in fileList\" :key=\"index\" class=\"dj-upload-list-item\">\n          <dj-image\n            class=\"dj-upload-list-img\"\n            :src=\"file.url\"\n            :fit=\"fit\"\n            :preview-src-list=\"file.imgStatus === false ? [] : file.url ? [file.url] : []\"\n            style=\"height: 48px; width: 48px;\"\n            :ref=\"'img' + index\"\n            @onError=\"onListImageError(index)\"\n          >\n            <div slot=\"error\"\n              style=\"display: flex;justify-content: center;align-items: center;width: 100%;height: 100%;background: #f5f7fa;color: #909399;font-size: 14px;\">\n              <img :src=\"file.icon || fileIcon\" alt=\"\">\n            </div>\n          </dj-image>\n          <!-- <img class=\"dj-upload-list-img\" :src=\"file.url\" width=\"48\" height=\"48\" alt=\"\"> -->\n          <div class=\"dj-upload-list-font\" :title=\"file.name\">\n            <span class=\"dj-upload-list-font-name\">{{file.name}}</span>\n            <div class=\"dj-upload-list-slot\">\n              <slot name=\"after\" :row=\"{file, index}\">\n                <dj-link v-if=\"showDownload\" @click=\"onDownload(file, index)\" :disabled=\"disabled\" type=\"primary\">\n                  下载<dj-icon icon=\"download\" fontSize=\"14px\" style=\"verticalAlign: baseline;\"></dj-icon>\n                </dj-link>\n              </slot>\n            </div>\n          </div>\n          <div class=\"dj-upload-list-icon\">\n            <dj-icon v-if=\"showDelete && !disabled\" icon=\"garbage\" fontSize=\"12px\" @click=\"handleListRemove(index)\"></dj-icon>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n<script>\nimport draggable from 'vuedraggable';\nimport loading from '@/mixins/loading';\n// import ajax from './ajax';\nimport message from '../../message/index';\nimport axios from './axios';\nexport default {\n  name: 'djUpload',\n  components: {\n    draggable\n  },\n  props: {\n    value: {\n      type: [String, Array]\n    },\n    fit: {\n      type: String,\n      default: 'fill'\n    },\n    limit: [Number, String], // 限制个数\n    type: {\n      // 文件类型还是图片\n      type: String,\n      default: 'file'\n    },\n    action: {\n      // 上传地址\n      type: String,\n      default: ''\n    },\n    fileName: {\n      // 上传文件名参数\n      type: String,\n      default: 'file'\n    },\n    params: {\n      // 上传参数\n      type: Object\n    },\n    width: {\n      type: Number\n    },\n    height: {\n      type: Number\n    },\n    size: {\n      type: Number\n    },\n    multiple: {\n      // 是否可以上传多个\n      type: Boolean,\n      default: false\n    },\n    disabled: {\n      // 是否禁用\n      type: Boolean,\n      default: false\n    },\n    accept: {\n      // 上传类型限制\n      type: String,\n      default: ''\n    },\n    suffix: {\n      // 上传后缀限制\n      type: String,\n      default: 'jpg,png,gif,jpeg'\n    },\n    boxwidth: {\n      type: Number\n    },\n    boxWidth: {\n      type: Number\n    },\n    boxheight: {\n      type: Number\n    },\n    boxHeight: {\n      type: Number\n    },\n    autoupload: {\n      // 是否自动上传\n      type: Boolean,\n      default: true\n    },\n    autoUpload: {\n      // 是否自动上传\n      type: Boolean,\n      default: true\n    },\n    draggable: {\n      // 是否可以左右拖拽移动\n      type: Boolean,\n      default: false\n    },\n    dragUpload: {\n      // 是否开启拖拽上传\n      type: Boolean,\n      default: false\n    },\n    showUploadList: {\n      // 文件上传后上传列表是否展示\n      type: Boolean,\n      default: true\n    },\n    name: {\n      //\n      type: String\n    },\n    separate: {\n      // 是否支持前后分离\n      type: Boolean,\n      default: false\n    },\n    beforeUpload: {\n      type: Function,\n      default: () => true\n    },\n    // 手动上传，判断按钮是否disabled\n    waiting: {\n      type: Boolean,\n      default: false\n    },\n    httpRequest: {\n      type: Function\n    },\n    onSuccess: {\n      type: Function\n    },\n    onError: {\n      type: Function\n    },\n    withCredentials: {\n      type: Boolean,\n      default: false\n    },\n    headers: {\n      type: Object\n    },\n    autoToast: {\n      type: Boolean,\n      default: true\n    },\n    showDownload: {\n      type: Boolean,\n      default: false\n    },\n    showDelete: {\n      type: Boolean,\n      default: true\n    },\n    onRemove: {\n      type: Function\n    }\n  },\n  data() {\n    return {\n      imgStyle: {\n        width: this.boxWidth || this.boxwidth ? (this.boxWidth || this.boxwidth) + 'px' : '120px',\n        height: this.boxHeight || this.boxheight ? (this.boxHeight || this.boxheight) + 'px' : '120px',\n        lineHeight: this.boxHeight || this.boxheight ? (this.boxHeight || this.boxheight) + 'px' : '120px'\n      },\n      fileDetailArray: [],\n      readyUploadArray: [],\n      handlePictureUrl: '',\n      fileList: Array.isArray(this.value) ? this.value : [this.value] || [],\n      dragover: false,\n      modalImgStyle: {\n        width: '',\n        height: ''\n      },\n      file: null,\n      ISEMITONUPLOAD: false,\n      fileIcon: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAAAXNSR0IArs4c6QAAAbRJREFUOE+llUsoRGEUx3+fGDMSM1KYQpHFbLwVEgtko2xZyEpiY6HEWjZWLJSws7Gz0Kwo8liMPEaRyWMaIo/GayaNEld3bmPmGsY196u7uOf+/7/vnO983SOkQwxcM4ZEJ1ntGaQUQcADN3PEXC4cvNAihniO1AlpmXEk+oPByk0w14LfCY6y2MBdwM8OVppFH48hsZCWuAcygoGKVbA0gG8btqr+BspOA/vk0iR68MoGGSh9OROMID/GPAWOAFcv3M5Hw+UMZaC8jBwEod3cqoEhW2oJVDuVt6MeuJqOBp4AnoiwCRcFNKmBlkYw5cPHG1jqlQyvZsDniAa+A27AF/EpjTM18D9N+eWEvwHXwVwHvj3YKo/dFE1AgxWSzJBoAduUUvLpMHgXNcPjb4qmDEOiZCvYZpUMz8fgcUVnhprt0UJ1yYWjkN0RVr0HYL8NAqeat/j52kTana3gtesApteEzUKAbqB8TZ7WlIaU2uFyUk+GG+AeUYAiAYoX4GIC7uMtOacLMlvDJX+8wvEAvN3FeYaabb8L1T9Y/cAH9QjQCxRMCNWQCo2C/4MfEMyRw+AndhCvdOjNuwoAAAAASUVORK5CYII='\n    };\n  },\n  watch: {\n    value: {\n      handler() {\n        this.fileList = this.isArray(this.value) ? this.value : this.value ? [{ url: this.value }] : [];\n        if (!this.multiple) {\n          this.fileList = this.fileList.slice(-1);\n        }\n        if (!this.action) {\n          this.fileList.map((val, i) => {\n            if (JSON.stringify(val) !== '{}') {\n              this.$set(val, 'status', 'success');\n            } else {\n              this.fileList.splice(i, 1);\n            }\n          });\n        }\n      },\n      deep: true\n    },\n    fileList: {\n      handler(v) {\n        // console.log(v, 'fileList');\n        if (v.length) {\n          this.$emit('update:waiting', true);\n        } else {\n          this.$emit('update:waiting', false);\n        }\n      },\n      deep: true\n    }\n  },\n  computed: {\n    // name值校验\n    uploadContent() {\n      if (!(this.autoUpload && this.autoupload)) {\n        return this.fileList.filter((val) => {\n          return val.status == 'success';\n        });\n      }\n      return this.fileList;\n    }\n  },\n  mounted() {\n    this.$nextTick(() => {\n      // 默认回显值\n      this.fileList = this.isArray(this.value) ? this.value : this.value ? [{ url: this.value }] : [];\n      this.fileList.map((val, i) => {\n        if (JSON.stringify(val) !== '{}' && val) {\n          this.$set(val, 'status', 'success');\n        } else {\n          this.value.splice(i, 1);\n        }\n      });\n    });\n  },\n  methods: {\n    onDragover() {\n      if (!this.disabled) {\n        this.dragover = true;\n      }\n    },\n    drop(e) {\n      if (this.disabled) return;\n      if (!this.multiple) {\n        this.$emit('input', []);\n      }\n      const dataFileList = e.dataTransfer.files; // 获取文件对象\n      if (dataFileList.length < 1) {\n        return; // 检测是否有文件拖拽到页面\n      }\n      const fileListLen = this.value?.length || 0;\n      const targetFilesLen = dataFileList.length;\n      // 如果 现有的文件数 + 选中的文件数 > limit限制数 触发\n      if (this.limit && fileListLen + targetFilesLen > this.limit) {\n        if (this.$listeners.onMessage) {\n          this.$emit('onMessage', 'limitNum', this.fileList);\n        } else {\n          const warn = message.warning;\n          warn(\n            `当前限制选择 ${this.limit} 个文件，本次选择了 ${targetFilesLen} 个文件，共选择了 ${\n              fileListLen + targetFilesLen\n            } 个文件`\n          );\n        }\n        return;\n      }\n      // if (this.limit && this.fileList.length==this.limit){\n      //   if (this.$listeners.onMessage) {\n      //     this.$emit('onMessage', 'limitNum', this.fileList);\n      //   } else {\n      //     message.error('最多允许上传'+this.limit+'个文件');\n      //   }\n      //   return;\n      // }\n      const data = new FormData();\n      if (this.params) {\n        Object.keys(this.params).forEach((key) => {\n          data.append(key, this.params[key]);\n        });\n      }\n      for (let i = 0; i < dataFileList.length; i++) {\n        this.file = dataFileList[i];\n        data.append(this.fileName, dataFileList[i]);\n        this.onUpload(data, dataFileList[i], i);\n      }\n    },\n    sort() {\n      // 拖拽改变位置\n      this.$emit('input', this.fileList);\n    },\n    /**\n     * 点击上传（未确定仅打开弹窗）时触发，\n     */\n    upload(event) {\n      let selectFile = () => {\n        this.$el.children[0].value = ''; // 解决两次上传同样文件不触发change问题\n        if (!this.disabled) {\n          this.$el.children[0].click();\n        }\n      };\n      if (this.$listeners.click) {\n        this.$emit('click', event, selectFile);\n      } else {\n        selectFile();\n      }\n    },\n    /**\n     * 点击确认上传时触发\n     */\n    change(event) {\n      if (this.$listeners.change) {\n        this.$emit('change', event, this.changeFile);\n      }\n      this.changeFile(event);\n    },\n    changeFile(event) {\n      if (this.autoupload && this.autoUpload) {\n        if (this.fileList.length == 0 || this.fileList.filter((val) => val.status == 'success').length == 0) {\n          this.fileList = [];\n        }\n      }\n      if (!this.multiple && (!(this.autoUpload && this.autoupload) || this.type == 'img' || this.type == 'file')) {\n        this.$emit('input', []);\n      }\n      const fileListLen = this.value?.length || 0;\n      const targetFilesLen = event.target.files?.length;\n      // 如果 现有的文件数 + 选中的文件数 > limit限制数 触发\n      if (this.limit && fileListLen + targetFilesLen > this.limit) {\n        if (this.$listeners.onMessage) {\n          this.$emit('onMessage', 'limitNum', this.fileList);\n        } else {\n          // 兼容运营平台和商家中心的warn，UI库的是warning\n          const warn = message.warning;\n          warn(\n            `当前限制选择 ${this.limit} 个文件，本次选择了 ${targetFilesLen} 个文件，共选择了 ${\n              fileListLen + targetFilesLen\n            } 个文件`\n          );\n        }\n        return;\n      }\n      // 如果 现有的文件数 = limit限制数 触发\n      // if (this.limit && fileListLen == this.limit) {\n      //   if (this.$listeners.onMessage) {\n      //     this.$emit('onMessage', 'limitNum', this.fileList);\n      //   } else {\n      //     message.error('最多允许上传'+this.limit+'个文件');\n      //   }\n      //   return;\n      // }\n      var data = new FormData();\n      var file = event.target.files[0];\n      var files = event.target.files;\n      // 上传且校验成功两个以上文件，进入\n      // let filesCopy = [];\n      if (files.length > 1) {\n        for (let i = 0; i < files.length; i++) {\n          let data1 = new FormData();\n          let r = new FileReader();\n          r.readAsDataURL(files[i]);\n          r.onload = (e) => {\n            // 上传的为文件（非图片）\n            if (this.type == 'file') {\n              if (this.size && parseFloat(this.size) < (file.size / 1000).toFixed(2)) {\n                if (this.$listeners.onMessage) {\n                  this.$emit('onMessage', 'fileSize', file);\n                } else {\n                  message.error(`文件应小于等于${this.size}KB,现为：${(file.size / 1000).toFixed(2)}KB`);\n                }\n                return;\n              }\n              this.fileList = [...this.fileList, {name: files[i].name}];\n              this.readyUploadArray.push({\n                data: data1,\n                file: files[i]\n              });\n              // console.log(this.readyUploadArray);\n              if (this.autoupload && this.autoUpload) {\n                this.$emit('onUpload', files[i], files);\n                if (this.action) {\n                  data1.append(this.fileName, files[i]);\n                  this.onUpload(data1, files[i]);\n                }\n              }\n            } else {\n              let acceptTypeArray = this.suffix?.split(',');\n              let fileType = files[i]?.type?.split('/')[1]?.toLowerCase();\n              if (acceptTypeArray?.length > 0 && acceptTypeArray.indexOf(fileType) < 0) {\n                if (this.$listeners.onMessage) {\n                  this.$emit('onMessage', 'fileType', files[i]);\n                } else {\n                  message.error(`请上传类型为${this.suffix}的文件!`);\n                }\n                return;\n              }\n              // 上传图片\n              var img = new Image();\n              var base64Url = e.currentTarget.result;\n              img.src = base64Url;\n              const imgLoadFunc = (e) => {\n                var _w = e.currentTarget.width;\n                var _h = e.currentTarget.height;\n                // 查看大图弹窗图片宽高比\n                if (_w < _h) {\n                  this.modalImgStyle = { width: 'auto', height: '100%' };\n                } else {\n                  this.modalImgStyle = { width: '100%', height: 'auto' };\n                }\n                // 判断宽高是否符合规定\n                if (this.width && this.height && (_w != this.width || _h != this.height)) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'width&height', files[i]);\n                  } else {\n                    message.error(`图片应为${this.width}px*${this.height}px,现为${_w}px*${_h}px`);\n                  }\n                  return;\n                }\n                // 判断宽度是否符合规定\n                if (this.width && _w != this.width) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'width', files[i]);\n                  } else {\n                    message.error(`图片宽度应为${this.width}px,现为${_w}px`);\n                  }\n                  return;\n                }\n                // 判断高度是否符合规定\n                if (this.height && _h != this.height) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'height', files[i]);\n                  } else {\n                    message.error(`图片高度应为${this.height}px,现为${_h}px`);\n                  }\n                  return;\n                }\n                // 判断文件大小是否符合规定\n                if (this.size && parseFloat(this.size) < (files[i].size / 1024).toFixed(2)) {\n                  this.ISEMITONUPLOAD = true;\n                  if (this.$listeners.onMessage) {\n                    this.$emit('onMessage', 'fileSize', files[i]);\n                  } else {\n                    message.error(`图片应小于${this.size}KB,现为：${(files[i].size / 1024).toFixed(2)}KB`);\n                  }\n                  return;\n                }\n                // filesCopy.push(files[i]);\n                // this.fileList.push({name: files[i].name});\n                if (this.autoupload && this.autoUpload) {\n                  this.$emit('onUpload', files[i], files);\n                  if (this.action) {\n                    data1.append(this.fileName, files[i]);\n                    this.onUpload(data1, files[i]);\n                  }\n                }\n              };\n              img.onload = (e) => {\n                imgLoadFunc(e);\n              };\n              img.onerror = (e) => {\n                imgLoadFunc(e);\n              };\n            }\n          };\n        }\n        // this.$emit('input', this.fileList);\n        return;\n      }\n      data.append(this.fileName, file);\n      this.file = file;\n      if (this.params) {\n        Object.keys(this.params).forEach((key) => {\n          data.append(key, this.params[key]);\n        });\n      }\n      let r = new FileReader();\n      r.readAsDataURL(file);\n      r.onload = (e) => {\n        // 上传的为文件（非图片）\n        if (this.type == 'file') {\n          // 判断文件大小是否符合规定\n          if (this.size && parseFloat(this.size) < (file.size / 1000).toFixed(2)) {\n            if (this.$listeners.onMessage) {\n              this.$emit('onMessage', 'fileSize', file);\n            } else {\n              message.error(`文件应小于等于${this.size}KB,现为：${(file.size / 1000).toFixed(2)}KB`);\n            }\n            return;\n          }\n          if (this.autoUpload && this.autoupload) {\n            // 自动上传的情况\n            this.onUpload(data, file);\n          } else if (this.multiple) {\n            // 若是手动上传\n            this.fileList.push({ name: file.name });\n            this.readyUploadArray.push({\n              data: data,\n              file: file\n            });\n          } else {\n            this.fileList = [{ name: file.name }];\n            this.readyUploadArray = [\n              {\n                data: data,\n                file: file\n              }\n            ];\n          }\n          // this.$emit('input', this.fileList);\n        } else {\n          let acceptTypeArray = this.suffix?.split(',');\n          let fileType = file?.type?.split('/')[1]?.toLowerCase();\n          // 判断文件类型是否符合规定\n          if (acceptTypeArray?.length > 0 && acceptTypeArray.indexOf(fileType) < 0) {\n            if (this.$listeners.onMessage) {\n              this.$emit('onMessage', 'fileType', file);\n            } else {\n              message.error(`请上传类型为${this.suffix}的文件!`);\n            }\n            return;\n          }\n          // 上传图片\n          var img = new Image();\n          var base64Url = e.currentTarget.result;\n          img.src = base64Url;\n          // 图片加载的监听函数\n          const imgLoadFunc = (e) => {\n            var _w = e.currentTarget.width;\n            var _h = e.currentTarget.height;\n            // 查看大图弹窗图片宽高比\n            if (_w < _h) {\n              this.modalImgStyle = { width: 'auto', height: '100%' };\n            } else {\n              this.modalImgStyle = { width: '100%', height: 'auto' };\n            }\n            // 判断宽高是否符合规定\n            if (this.width && this.height && (_w != this.width || _h != this.height)) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'width&height', file);\n              } else {\n                message.error(`图片应为${this.width}px*${this.height}px,现为${_w}px*${_h}px`);\n              }\n              return;\n            }\n            // 判断宽度是否符合规定\n            if (this.width && _w != this.width) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'width', file);\n              } else {\n                message.error(`图片宽度应为${this.width}px,现为${_w}px`);\n              }\n              return;\n            }\n            // 判断高度是否符合规定\n            if (this.height && _h != this.height) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'height', file);\n              } else {\n                message.error(`图片高度应为${this.height}px,现为${_h}px`);\n              }\n              return;\n            }\n            // 判断文件大小是否符合规定\n            if (this.size && parseFloat(this.size) < (file.size / 1024).toFixed(2)) {\n              if (this.$listeners.onMessage) {\n                this.$emit('onMessage', 'fileSize', file);\n              } else {\n                message.error(`图片应小于${this.size}KB,现为：${(file.size / 1024).toFixed(2)}KB`);\n              }\n              return;\n            }\n            this.onUpload(data, file);\n          };\n          img.onload = (e) => {\n            imgLoadFunc(e);\n          };\n          img.onerror = (e) => {\n            imgLoadFunc(e);\n          };\n        }\n      };\n    },\n    onUpload(data, file, i) {\n      let that = this;\n      let el = this.$el;\n      if (this.dragUpload) {\n        el = this.$refs.dragUpload;\n      }\n      let upload = () => {\n        let params = {};\n        if (this.params) {\n          Object.keys(this.params).forEach((key) => {\n            params[key] = this.params[key];\n          });\n        }\n        if (this.action) {\n          this.$el.querySelector && loading.methods.showLoading({ el, white: true });\n          // let httpRequest = this.httpRequest || ajax;\n          // const isDj = window.location.host.endsWith('jddj.com');\n          // if (isDj) {\n          let httpRequest = this.httpRequest || axios.upload;\n          // }\n          httpRequest(this.action, this.separate ? params : data, this.separate ? file : null).then(\n            (result) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              if (result.code == 0) {\n                message.success(result.msg);\n                that.fileDetailArray.push(file);\n                that.$emit('onSuccess', result, file, that.fileDetailArray);\n                if (this.autoupload && this.autoUpload || this.dragUpload) {\n                  this.$nextTick(() => {\n                    this.fileList.map((item, i) => {\n                      if (JSON.stringify(item) !== '{}' && item) {\n                        this.$set(item, 'status', 'success');\n                      }\n                    });\n                  });\n                } else {\n                  this.fileList = this.fileList.pop();\n                  this.$nextTick(() => {\n                    if (JSON.stringify(this.fileList[i]) !== '{}' && this.fileList[i]) {\n                      this.$set(this.fileList[i], 'status', 'success');\n                    }\n                  });\n                }\n              } else {\n                message.error(result.msg);\n              }\n            },\n            (err) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              this.fileList\n                .filter((val) => val.status != 'success')\n                .map((val) => {\n                  this.$set(val, 'status', 'error');\n                });\n              that.$emit('onError', err, file, that.fileList);\n            }\n          );\n          const options = {\n            headers: this.headers,\n            withCredentials: this.withCredentials,\n            file: file,\n            data: this.params,\n            filename: this.fileName,\n            action: this.action,\n            onSuccess: (result) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              if (this.onSuccess) {\n                const sorf = this.onSuccess(result, file);\n                if (sorf || sorf === void 0) {\n                  this.afterSuccessFun(file);\n                  return;\n                }\n                return;\n              }\n\n              // 兼容到家业务\n              if (result.code == 0) {\n                message.success(result.msg);\n                that.$emit('onSuccess', result, file, that.fileDetailArray);\n                this.afterSuccessFun(file);\n              } else {\n                message.error(result.msg);\n              }\n            },\n            onError: (err) => {\n              that.$el.querySelector && loading.methods.closeLoading({ el });\n              this.fileList\n                .filter((val) => val.status != 'success')\n                .map((val) => {\n                  this.$set(val, 'status', 'error');\n                });\n              this.$emit('input', this.fileList);\n              if (this.onError) {\n                this.onError(err, file);\n                return;\n              }\n              that.$emit('onError', err, file, that.fileList);\n            }\n          };\n          const req = httpRequest(options);\n          if (req && req.then) {\n            req.then(options.onSuccess, options.onError);\n          }\n        } else {\n          this.$emit('onUpload', this.file);\n        }\n      };\n      if (this.beforeUpload && typeof this.beforeUpload === 'function' && !this.beforeUpload(file, upload)) {\n        return false;\n      }\n      upload();\n    },\n    afterSuccessFun(file) {\n      this.fileDetailArray.push(file);\n      if (this.autoupload && this.autoUpload || this.dragUpload) {\n        this.$nextTick(() => {\n          this.fileList.map((item) => {\n            if (JSON.stringify(item) !== '{}' && item) {\n              this.$set(item, 'status', 'success');\n            }\n          });\n        });\n      } else {\n        this.fileList = this.fileList.pop();\n        this.$nextTick(() => {\n          if (JSON.stringify(this.fileList[i]) !== '{}' && this.fileList[i]) {\n            this.$set(this.fileList[i], 'status', 'success');\n          }\n        });\n      }\n      this.$emit('input', this.fileList);\n    },\n    // 手动上传\n    handUpload() {\n      let readyUploadFileList = this.fileList.filter((item) => {\n        return item.status != 'success';\n      });\n      for (let i = 0; i < readyUploadFileList.length; i++) {\n        this.onUpload(\n          this.readyUploadArray[i].data,\n          this.readyUploadArray[i].file,\n          this.fileList.indexOf(readyUploadFileList[i])\n        );\n      }\n    },\n    handlePictureRemove(i) {\n      // 如果通过props传入了onRemove，执行此逻辑\n      if (this.onRemove) {\n        // onRemove函数中return false则取消删除操作\n        const bool = this.onRemove(this.fileList[i], i);\n        if (bool !== false) {\n          this.fileList.splice(i, 1);\n          this.fileDetailArray.splice(i, 1);\n          if (Array.isArray(this.value)) {\n            this.$emit('input', this.fileList);\n          } else {\n            this.$emit('input', '');\n          }\n        }\n        // 没传props：onRemove，执行此逻辑\n      } else {\n        this.fileList.splice(i, 1);\n        this.$emit('onRemove', this.fileDetailArray[i], this.fileList);\n        this.fileDetailArray.splice(i, 1);\n        if (Array.isArray(this.value)) {\n          this.$emit('input', this.fileList);\n        } else {\n          this.$emit('input', '');\n        }\n      }\n    },\n    /**\n     * @desc 列表形式删除回调\n     * @param {Number} index 索引\n     */\n    handleListRemove(i) {\n      const bool = this.onRemove(this.fileList[i], i);\n      if (bool !== false) {\n        this.fileList.splice(i, 1);\n        this.fileDetailArray.splice(i, 1);\n        if (Array.isArray(this.value)) {\n          this.$emit('input', this.fileList);\n        } else {\n          this.$emit('input', '');\n        }\n      }\n    },\n    handlePicturePreview(i) {\n      if (i !== null) {\n        this.$refs['img' + i][0].imagePreviewFun();\n      } else {\n        this.$refs['img'].imagePreviewFun();\n      }\n    },\n    isArray(o) {\n      return Object.prototype.toString.call(o) == '[object Array]';\n    },\n    onDownload(file, index) {\n      this.$emit('onDownload', file, index);\n    },\n    onListImageError(index) {\n      this.$set(this.fileList[index], 'imgStatus', false);\n    }\n  }\n};\n</script>\n<style scope lang=\"less\"></style>\n"]}]}