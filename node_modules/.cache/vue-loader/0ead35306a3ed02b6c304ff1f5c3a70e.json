{"remainingRequest":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangjunxia/work-github/dj-design/packages/modal/src/modal.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangjunxia/work-github/dj-design/packages/modal/src/modal.vue","mtime":1676257891923},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIGRvbSBmcm9tICdAL3V0aWxzL2RvbSc7CmltcG9ydCBsb2FkaW5nIGZyb20gJ0AvbWl4aW5zL2xvYWRpbmcnOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdkak1vZGFsJywKICBjb21wb25lbnRzOiB7CiAgfSwKICBwcm9wczogewogICAgdGl0bGU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAn5qCH6aKYJwogICAgfSwKICAgIHZpc2libGU6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogZmFsc2UKICAgIH0sCiAgICBzaXplOiB7IC8vIOeql+WPo+WwuuWvuAogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdtaW5pJyAvLyBtaW5pIHRpbnkgc21hbGwgbGFyZ2UgZnVsbAogICAgfSwKICAgIHdpZHRoOiBTdHJpbmcsCiAgICBoZWlnaHQ6IFN0cmluZywKICAgIG1heGhlaWdodDogU3RyaW5nLAogICAgc2hvd2Zvb3RlcjogewogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiB0cnVlCiAgICB9LAogICAgc2hvd29rOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IHRydWUKICAgIH0sCiAgICBvazogRnVuY3Rpb24sCiAgICBva3RleHQ6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAn56Gu5a6aJwogICAgfSwKICAgIHNob3djYW5jZWw6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIGNhbmNlbDogRnVuY3Rpb24sCiAgICBjYW5jZWx0ZXh0OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ+WPlua2iCcKICAgIH0sCiAgICBzaG93Y2xvc2U6IHsKICAgICAgdHlwZTogQm9vbGVhbiwKICAgICAgZGVmYXVsdDogdHJ1ZQogICAgfSwKICAgIGJlZm9yZUNsb3NlOiBGdW5jdGlvbiwKICAgIGNsb3NhYmxlOiB7IC8vIOeCueWHu+mBrue9qeWxguWFs+mXrQogICAgICB0eXBlOiBCb29sZWFuLAogICAgICBkZWZhdWx0OiBmYWxzZQogICAgfSwKICAgIGJhc2ljOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgYm9yZGVyOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgbG9hZGluZzogewogICAgICB0eXBlOiBCb29sZWFuCiAgICB9LAogICAgYmFja2dyb3VuZDogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdibGFjaycgLy8gYmxhY2sgd2hpdGUKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93TW9kYWw6IHRoaXMudmlzaWJsZSwKICAgICAgZmlyc3RNb2RhbDogdHJ1ZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBnZXRCYWNrZ3JvdW5kKCkgewogICAgICByZXR1cm4gYGRqLW1vZGFsLWJhY2tncm91bmQtJHt0aGlzLmJhY2tncm91bmR9YDsKICAgIH0sCiAgICBnZXRTaXplKCkgewogICAgICByZXR1cm4gYGRqLW1vZGFsLSR7dGhpcy5zaXplfWA7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgdmlzaWJsZTogZnVuY3Rpb24obiwgbykgewogICAgICBpZiAodGhpcy52aXNpYmxlKSB7CiAgICAgICAgdGhpcy5zaG93KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5oaWRlKCk7CiAgICAgIH0KICAgIH0sCiAgICBsb2FkaW5nOiBmdW5jdGlvbihuLCBvKSB7CiAgICAgIHRoaXMuaW5pdExvYWRpbmcoKTsKICAgIH0KICB9LAogIGNyZWF0ZWQoKXsKICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIHRoaXMucG9wc3RhdGUsIGZhbHNlKTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmluaXRNb2RhbCgpOwogIH0sCiAgbWV0aG9kczogewogICAgcG9wc3RhdGUoKSB7CiAgICAgIGxldCBlbHM9ZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnZGotbW9kYWwtYmFja2dyb3VuZCcpOwogICAgICBpZiAoZWxzKXsKICAgICAgICBmb3IgKGxldCBpPTA7aTxlbHMubGVuZ3RoO2krKyl7CiAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGVsc1tpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgaW5pdE1vZGFsKCkgewogICAgICBpZiAodGhpcy5zaG93TW9kYWwpIHsKICAgICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwogICAgICAgIGJvZHkucXVlcnlTZWxlY3RvckFsbChgLmRqLW1vZGFsLWJhY2tncm91bmQuJHt0aGlzLmdldEJhY2tncm91bmR9LmRqLW1vZGFsLXZpc2libGVgKS5mb3JFYWNoKGVsID0+IHsKICAgICAgICAgIGlmICh0aGlzLiRlbCAhPSBlbCkgewogICAgICAgICAgICBkb20ucmVtb3ZlQ2xhc3MoZWwsIHRoaXMuZ2V0QmFja2dyb3VuZCk7CiAgICAgICAgICAgIGRvbS5yZW1vdmVDbGFzcyhlbCwgJ2RqLW1vZGFsLXNob3cnKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBib2R5LmFwcGVuZCh0aGlzLiRlbCk7CiAgICAgIH0KICAgIH0sCiAgICBzaG93KGNhbGxiYWNrKSB7CiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuZmlyc3RNb2RhbCA9ICFkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5IC5kai1tb2RhbC1iYWNrZ3JvdW5kLmRqLW1vZGFsLXZpc2libGUnKTsKICAgICAgICB0aGlzLnNob3dNb2RhbCA9IHRydWU7CiAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnZpc2libGUnLCB0cnVlKTsKICAgICAgICB0aGlzLmluaXRNb2RhbCgpOwogICAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsKICAgICAgICAgIHRoaXMuc2hvd0xvYWRpbmcoKTsKICAgICAgICB9CiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTsKICAgICAgfSwgMCk7CiAgICB9LAogICAgY2xvc2UoJGV2ZW50KSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdjbG9zZScpOwogICAgICBpZiAoJGV2ZW50ICYmICRldmVudC50YXJnZXQgIT0gdGhpcy4kZWwpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLnNob3dNb2RhbCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAodGhpcy5iZWZvcmVDbG9zZSAmJiB0aGlzLmJlZm9yZUNsb3NlKHRoaXMuY2xvc2UpID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLiRlbWl0KCdjbG9zZScpOwogICAgICBjb25zdCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOwogICAgICBsZXQgbW9kYWwgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCcuZGotbW9kYWwnKTsKICAgICAgZG9tLmFkZENsYXNzKG1vZGFsLCAnZGotbW9kYWwtaGlkZScpOwogICAgICBpZiAoYm9keS5xdWVyeVNlbGVjdG9yQWxsKCcuZGotbW9kYWwtYmFja2dyb3VuZC5kai1tb2RhbC12aXNpYmxlJykubGVuZ3RoIDw9IDEpIHsKICAgICAgICBkb20uYWRkQ2xhc3ModGhpcy4kZWwsICdkai1tb2RhbC1oaWRlJyk7CiAgICAgIH0KCiAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgIHRoaXMuJGVtaXQoJ2Nsb3NlZCcpOwogICAgICAgIHRoaXMuc2hvd01vZGFsID0gZmFsc2U7CiAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnZpc2libGUnLCBmYWxzZSk7CiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgICAgbGV0IGxhc3RNb2RhbCA9IGJvZHkucXVlcnlTZWxlY3RvckFsbCgnLmRqLW1vZGFsLWJhY2tncm91bmQuZGotbW9kYWwtdmlzaWJsZScpOwogICAgICAgICAgaWYgKGxhc3RNb2RhbC5sZW5ndGgpIHsKICAgICAgICAgICAgZG9tLmFkZENsYXNzKGxhc3RNb2RhbFtsYXN0TW9kYWwubGVuZ3RoIC0gMV0sIHRoaXMuZ2V0QmFja2dyb3VuZCk7CiAgICAgICAgICB9CiAgICAgICAgICAvLyBkb20ucmVtb3ZlQ2hpbGQoZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLCB0aGlzLiRlbCk7CiAgICAgICAgfSk7CiAgICAgIH0sIDMwMCk7CiAgICB9LAogICAgaGlkZSgpIHsKICAgICAgdGhpcy5jbG9zZSgpOwogICAgfSwKICAgIG9uT2soKSB7CiAgICAgIGlmICh0aGlzLm9rICYmIHRoaXMub2sodGhpcy5jbG9zZSkgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMuY2xvc2UoKTsKICAgIH0sCiAgICBvbkNhbmNlbCgpIHsKICAgICAgaWYgKHRoaXMuY2FuY2VsICYmIHRoaXMuY2FuY2VsKHRoaXMuY2xvc2UpID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICB0aGlzLmNsb3NlKCk7CiAgICB9LAogICAgaW5pdExvYWRpbmcoKSB7CiAgICAgIGlmICh0aGlzLmxvYWRpbmcpIHsKICAgICAgICB0aGlzLnNob3dMb2FkaW5nKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5jbG9zZUxvYWRpbmcoKTsKICAgICAgfQogICAgfSwKICAgIHNob3dMb2FkaW5nKCkgewogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6bG9hZGluZycsIHRydWUpOwogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yICYmIGxvYWRpbmcubWV0aG9kcy5zaG93TG9hZGluZyh7ZWw6IHRoaXMuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5kai1tb2RhbCcpLCB3aGl0ZTogdHJ1ZX0pOwogICAgICB9LCAxMCk7CiAgICB9LAogICAgY2xvc2VMb2FkaW5nKCkgewogICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6bG9hZGluZycsIGZhbHNlKTsKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy4kZWwucXVlcnlTZWxlY3RvciAmJiBsb2FkaW5nLm1ldGhvZHMuY2xvc2VMb2FkaW5nKHtlbDogdGhpcy4kZWwucXVlcnlTZWxlY3RvcignLmRqLW1vZGFsJyl9KTsKICAgICAgfSwgMTApOwogICAgfQogIH0KfTsK"},{"version":3,"sources":["modal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"modal.vue","sourceRoot":"packages/modal/src","sourcesContent":["<template>\n  <div v-if=\"showModal\" class=\"dj-modal-background\" :class=\"(showModal && 'dj-modal-visible ' || '') + (firstModal && 'dj-modal-show ' || '') + getBackground\" @click=\"(closable !== false && close($event))\">\n    <transition>\n      <div class=\"dj-modal\" :class=\"(border !== false && 'dj-modal-border ' || '') + (basic !== false && 'dj-modal-basic ' || '') + getSize\" :style=\"(width && `width: ${width};` || '') + (height && `height: ${height};` || '') + (maxheight && `max-height: ${maxheight};` || '')\">\n        <div class=\"dj-modal-header\" :class=\"showclose && 'dj-modal-close' || ''\">\n          <slot name=\"header\">{{title}}</slot>\n          <div v-if=\"showclose\" class=\"dj-modal-close\" @click=\"close()\"><dj-icon icon=\"close\"></dj-icon></div>\n        </div>\n        <div class=\"dj-modal-content\" :style=\"(width && `width: ${width};` || '') + (height && `height: calc(${height} - 105px);`) + (maxheight && `max-height: calc(${maxheight} - 105px);` || '')\">\n          <slot></slot>\n        </div>\n        <div v-if=\"showfooter\" class=\"dj-modal-footer\">\n          <slot name=\"footer\">\n            <dj-button v-if=\"showcancel\" @click=\"onCancel\">{{canceltext}}</dj-button>\n            <span v-if=\"showcancel && showok\" class=\"spacing\"></span>\n            <dj-button v-if=\"showok\" type=\"primary\" @click=\"onOk\">{{oktext}}</dj-button>\n          </slot>\n        </div>\n      </div>\n    </transition>\n  </div>\n</template>\n\n<script>\nimport * as dom from '@/utils/dom';\nimport loading from '@/mixins/loading';\n\nexport default {\n  name: 'djModal',\n  components: {\n  },\n  props: {\n    title: {\n      type: String,\n      default: '标题'\n    },\n    visible: {\n      type: Boolean,\n      default: false\n    },\n    size: { // 窗口尺寸\n      type: String,\n      default: 'mini' // mini tiny small large full\n    },\n    width: String,\n    height: String,\n    maxheight: String,\n    showfooter: {\n      type: Boolean,\n      default: true\n    },\n    showok: {\n      type: Boolean,\n      default: true\n    },\n    ok: Function,\n    oktext: {\n      type: String,\n      default: '确定'\n    },\n    showcancel: {\n      type: Boolean,\n      default: true\n    },\n    cancel: Function,\n    canceltext: {\n      type: String,\n      default: '取消'\n    },\n    showclose: {\n      type: Boolean,\n      default: true\n    },\n    beforeClose: Function,\n    closable: { // 点击遮罩层关闭\n      type: Boolean,\n      default: false\n    },\n    basic: {\n      type: Boolean,\n      default: false\n    },\n    border: {\n      type: Boolean,\n      default: false\n    },\n    loading: {\n      type: Boolean\n    },\n    background: {\n      type: String,\n      default: 'black' // black white\n    }\n  },\n  data() {\n    return {\n      showModal: this.visible,\n      firstModal: true\n    };\n  },\n  computed: {\n    getBackground() {\n      return `dj-modal-background-${this.background}`;\n    },\n    getSize() {\n      return `dj-modal-${this.size}`;\n    }\n  },\n  watch: {\n    visible: function(n, o) {\n      if (this.visible) {\n        this.show();\n      } else {\n        this.hide();\n      }\n    },\n    loading: function(n, o) {\n      this.initLoading();\n    }\n  },\n  created(){\n    window.addEventListener('popstate', this.popstate, false);\n  },\n  mounted() {\n    this.initModal();\n  },\n  methods: {\n    popstate() {\n      let els=document.getElementsByClassName('dj-modal-background');\n      if (els){\n        for (let i=0;i<els.length;i++){\n          document.body.removeChild(els[i]);\n        }\n      }\n    },\n    initModal() {\n      if (this.showModal) {\n        const body = document.querySelector('body');\n        body.querySelectorAll(`.dj-modal-background.${this.getBackground}.dj-modal-visible`).forEach(el => {\n          if (this.$el != el) {\n            dom.removeClass(el, this.getBackground);\n            dom.removeClass(el, 'dj-modal-show');\n          }\n        });\n        body.append(this.$el);\n      }\n    },\n    show(callback) {\n      setTimeout(() => {\n        this.firstModal = !document.querySelector('body .dj-modal-background.dj-modal-visible');\n        this.showModal = true;\n        this.$emit('update:visible', true);\n        this.initModal();\n        if (this.loading) {\n          this.showLoading();\n        }\n        callback && callback();\n      }, 0);\n    },\n    close($event) {\n      // console.log('close');\n      if ($event && $event.target != this.$el) {\n        return false;\n      }\n      if (!this.showModal) {\n        return false;\n      }\n      if (this.beforeClose && this.beforeClose(this.close) === false) {\n        return false;\n      }\n      this.$emit('close');\n      const body = document.querySelector('body');\n      let modal = this.$el.querySelector('.dj-modal');\n      dom.addClass(modal, 'dj-modal-hide');\n      if (body.querySelectorAll('.dj-modal-background.dj-modal-visible').length <= 1) {\n        dom.addClass(this.$el, 'dj-modal-hide');\n      }\n\n      setTimeout(() => {\n        this.$emit('closed');\n        this.showModal = false;\n        this.$emit('update:visible', false);\n        this.$nextTick(() => {\n          let lastModal = body.querySelectorAll('.dj-modal-background.dj-modal-visible');\n          if (lastModal.length) {\n            dom.addClass(lastModal[lastModal.length - 1], this.getBackground);\n          }\n          // dom.removeChild(document.querySelector('body'), this.$el);\n        });\n      }, 300);\n    },\n    hide() {\n      this.close();\n    },\n    onOk() {\n      if (this.ok && this.ok(this.close) === false) {\n        return false;\n      }\n      this.close();\n    },\n    onCancel() {\n      if (this.cancel && this.cancel(this.close) === false) {\n        return false;\n      }\n      this.close();\n    },\n    initLoading() {\n      if (this.loading) {\n        this.showLoading();\n      } else {\n        this.closeLoading();\n      }\n    },\n    showLoading() {\n      this.$emit('update:loading', true);\n      setTimeout(() => {\n        this.$el.querySelector && loading.methods.showLoading({el: this.$el.querySelector('.dj-modal'), white: true});\n      }, 10);\n    },\n    closeLoading() {\n      this.$emit('update:loading', false);\n      setTimeout(() => {\n        this.$el.querySelector && loading.methods.closeLoading({el: this.$el.querySelector('.dj-modal')});\n      }, 10);\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n</style>\n"]}]}