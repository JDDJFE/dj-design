{"remainingRequest":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/wangjunxia/work-github/dj-design/packages/popover/src/popover.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/wangjunxia/work-github/dj-design/packages/popover/src/popover.vue","mtime":1676537858400},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/wangjunxia/work-github/dj-design/node_modules/vue-loader/lib/index.js","mtime":1655715099000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmZ1bmN0aW9uIHJlbW92ZVBvcChzZWxmKSB7CiAgLy8gY29uc29sZS5sb2codGhpcywgc2VsZiwndGhpcycpOwogIC8vIGNvbnNvbGUubG9nKHNlbGYudG9vbHRpcElkLCBzZWxmLnRvb2x0aXBJZFBhcmVudCwgJ2hhbmRsZURvY3VtZW50Q2xpY2snKTsKICAvLyBjb25zb2xlLmxvZyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxmLnRvb2x0aXBJZFBhcmVudCksICdoYW5kbGVEb2N1bWVudENsaWNrJyk7CiAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzZWxmLnRvb2x0aXBJZFBhcmVudCkgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoc2VsZi50b29sdGlwSWQpKSB7CiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHNlbGYudG9vbHRpcElkKSk7CiAgICAvLyBjb25zb2xlLmxvZygncmVtb3ZlRXZlbnRMaXN0ZW5lcicpOwogICAgLy8gZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCByZW1vdmVQb3Aoc2VsZiksIGZhbHNlKTsKICB9Cn0KCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnZGpQb3BvdmVyJywKICBwcm9wczogewogICAgdGl0bGU6IFN0cmluZywKICAgIGNvbnRlbnQ6IFN0cmluZywKICAgIHJlZmVyZW5jZToge30sCiAgICBwb3BwZXI6IHt9LAogICAgZGlzYWJsZWQ6IEJvb2xlYW4sCiAgICB3aWR0aDoge30sCiAgICBjbGFzc05hbWU6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICBkZWZhdWx0OiAnJwogICAgfSwKICAgIHpJbmRleDogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDc5CiAgICB9LAogICAgcGxhY2VtZW50OiB7CiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJ3RvcCcKICAgIH0sCiAgICB2aXNpYmxlOiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgdHJpZ2dlcjogewogICAgICB0eXBlOiBTdHJpbmcsCiAgICAgIGRlZmF1bHQ6ICdjbGljaycsCiAgICAgIHZhbGlkYXRvcjogdmFsdWUgPT4gWydjbGljaycsICdmb2N1cycsICdob3ZlcicsICdtYW51YWwnXS5pbmRleE9mKHZhbHVlKSA+IC0xIHx8IHZhbHVlID09PSAnJwogICAgfSwKICAgIG9wZW5EZWxheTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIGRlZmF1bHQ6IDAKICAgIH0sCiAgICBjbG9zZURlbGF5OiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgZGVmYXVsdDogMjAwCiAgICB9LAogICAgLy8g5piv5ZCm5o+S5YWl5YiwYm9keQogICAgYXBwZW5kVG9Cb2R5OiB7CiAgICAgIHR5cGU6IEJvb2xlYW4sCiAgICAgIGRlZmF1bHQ6IGZhbHNlCiAgICB9LAogICAgdGFiaW5kZXg6IHsKICAgICAgdHlwZTogTnVtYmVyLAogICAgICBkZWZhdWx0OiAwCiAgICB9LAogICAgbm90UGFyZW50Q2xhc3M6IHsvLyDkuLrkuoborqnoh6rlrprkuYnnmoTniLbnuqfmnIlvdmVyZmxvdyBhdXRv5pe277yM6K6p5LuW5LiN5Li654i257qn5YWD57SgCiAgICAgIHR5cGU6IFN0cmluZywKICAgICAgZGVmYXVsdDogJycKICAgIH0KICAgIC8vIGNvbnRyYXJ5VmVydGljYWw6IHsKICAgIC8vICAgdHlwZTogTnVtYmVyLAogICAgLy8gICBkZWZhdWx0OiAxMDAKICAgIC8vIH0sCiAgICAvLyBjb250cmFyeUhvcml6b250YWw6IHsKICAgIC8vICAgdHlwZTogTnVtYmVyLAogICAgLy8gICBkZWZhdWx0OiAyNTAKICAgIC8vIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwb3BTdHlsZToge30sCiAgICAgIHBvcFdIU3R5bGU6IHt9LAogICAgICBhcnJvd1N0eWxlOiB7fSwKICAgICAgc2hvd1BvcHBlcjogZmFsc2UsCiAgICAgIG9wYWNpdHk6IDAsCiAgICAgIGRpc3BsYXlTdGF0dXM6ICdub25lJywKICAgICAgY29udGVudE1heEhlaWdodDogJycsCiAgICAgIHBsYWNlbWVudFN0cjogJycsCiAgICAgIHRhZ05hbWU6ICcnLAogICAgICB0YXJnZXQ6IG51bGwsCiAgICAgIGNvbnRyYXJ5VmVydGljYWw6IDEwMCwKICAgICAgY29udHJhcnlIb3Jpem9udGFsOiAyNTAsCiAgICAgIHBvcHBlckluaXRpYWxXaWR0aDogJycsCiAgICAgIHBvcHBlckluaXRpYWxIZWlnaHQ6ICcnCiAgICB9OwogIH0sCiAgY29tcG9uZW50czoge30sCiAgY29tcHV0ZWQ6IHsKICAgIHRvb2x0aXBJZCgpIHsKICAgICAgcmV0dXJuIGBkai1wb3BvdmVyLSR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApfWA7CiAgICB9LAogICAgdG9vbHRpcElkUGFyZW50KCkgewogICAgICByZXR1cm4gYGRqLXBvcG92ZXItJHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCl9LXBhcmVudGA7CiAgICB9CiAgfSwKICB3YXRjaDogewogICAgdmlzaWJsZTogewogICAgICBpbW1lZGlhdGU6IHRydWUsCiAgICAgIGhhbmRsZXIodmFsKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2codmFsLCAndmlzaWJsZScpOwogICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRoaXMuc2hvd1BvcHBlciA9IHZhbDsKICAgICAgfQogICAgfSwKICAgIHNob3dQb3BwZXI6IHsKICAgICAgaW1tZWRpYXRlOiB0cnVlLAogICAgICBoYW5kbGVyKHZhbCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHZhbCwgJ3Nob3dQb3BwZXInKTsKICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICB0aGlzLiRlbWl0KCd1cGRhdGU6dmlzaWJsZScsIHZhbCk7CiAgICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5KSB7CiAgICAgICAgICBpZiAodmFsKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRET00oKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8qIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgdGhpcy5yZW1vdmVET00oKTsKICAgICAgICAgICAgIH0sIDMwMCk7Ki8KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIHZhbCkgewogICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSB0aGlzLnBsYWNlbWVudDsKICAgICAgICAgIHRoaXMuZGlzcGxheVN0YXR1cyA9ICdibG9jayc7CiAgICAgICAgICBsZXQgcmVmZXJlbmNlOwogICAgICAgICAgY29uc3QgcG9wcGVyID0gdGhpcy5wb3BwZXIgfHwgdGhpcy4kcmVmcy5wb3BwZXI7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgcmVmZXJlbmNlID0gdGhpcy5nZXRSZWZlcmVuY2UoKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocmVmZXJlbmNlLCdyZWZlcmVuY2Xov5nph4zllYonKTsKICAgICAgICAgICAgaWYgKCF0aGlzLnBvcHBlckluaXRpYWxXaWR0aCAmJiAhdGhpcy5wb3BwZXJJbml0aWFsSGVpZ2h0KSB7CiAgICAgICAgICAgICAgdGhpcy5wb3BwZXJJbml0aWFsV2lkdGggPSBwb3BwZXI/Lm9mZnNldFdpZHRoOwogICAgICAgICAgICAgIHRoaXMucG9wcGVySW5pdGlhbEhlaWdodCA9IHBvcHBlcj8ub2Zmc2V0SGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucG9wcGVySW5pdGlhbFdpZHRoLCB0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQsICdwb3BwZXJJbml0aWFsV2lkdGgnKTsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2cocG9wcGVyLmNsaWVudEhlaWdodCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIC8vIHJldHVybjsKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ckZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgICB9LCAyKTsKICAgICAgICAgIGlmICh0aGlzLmFwcGVuZFRvQm9keSkgewogICAgICAgICAgICAvLyB0aGlzLm9wYWNpdHkgPSAxOwogICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgICB0aGlzLnBvcFdpZHRoSGVpZ2h0RnVuKHJlZmVyZW5jZSwgcG9wcGVyKTsKICAgICAgICAgICAgfSwgNSk7CiAgICAgICAgICB9CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgdGhpcy5vcGFjaXR5ID0gMTsKICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgICB9LCAxMCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMub3BhY2l0eSA9IDA7CiAgICAgICAgICAvKiBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICB0aGlzLmRpc3BsYXlTdGF0dXMgPSAnbm9uZSc7CiAgICAgICAgICAgLy8gY29uc29sZS5sb2codmFsLCdkaXNwbGF5Om5vbmUnKTsKICAgICAgICAgICB9LCAzMDApOyovCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkKCkgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgdGhpcy5wb3BzdGF0ZSwgZmFsc2UpOwogIH0sCiAgbW91bnRlZCgpIHsKICAgIC8vIGNvbnNvbGUubG9nKCdtb3VudGVkJyk7CiAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgIGxldCByZWZlcmVuY2UgPSB0aGlzLmdldFJlZmVyZW5jZSgpOwogICAgbGV0IHRhcmdldCA9IHRoaXMuZ2V0U2Nyb2xsUGFyZW50KHJlZmVyZW5jZSk7CiAgICAvLyBjb25zb2xlLmxvZyhyZWZlcmVuY2UsIHBvcHBlciwgJz09PT0gbW91bnRlZCcpOwogICAgLy8gY29uc29sZS5sb2codGFyZ2V0LCB0YXJnZXQ/LnRhZ05hbWUsIHRoaXMuJHNsb3RzLCAnPT09PSBtb3VudGVkJyk7CiAgICB0aGlzLnRhZ05hbWUgPSB0YXJnZXQ/LnRhZ05hbWUgfHwgJyc7CiAgICB0aGlzLnRhcmdldCA9IHRhcmdldCB8fCBudWxsOwogICAgaWYgKHRoaXMudGFnTmFtZSA9PT0gJ0hUTUwnKSB7CiAgICAgIHRhcmdldCA9IHdpbmRvdzsKICAgICAgLy8gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpLmNsYXNzTGlzdC5hZGQoInBvc0EiKTsKICAgIH0KICAgIC8vIGNvbnNvbGUubG9nKHRhcmdldCwgdGhpcy50YXJnZXQsICc9PT09IG1vdW50ZWQyMicpOwogICAgLy8g5Y+v6K6/6Zeu5oCnCiAgICBpZiAocmVmZXJlbmNlKSB7CiAgICAgIC8vIHJlZmVyZW5jZS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgdGhpcy50YWJpbmRleCk7IC8vIHRhYuW6j+WIlwogICAgICB0aGlzLnBvc2l0aW9uRnVuKHJlZmVyZW5jZSwgcG9wcGVyKTsKICAgICAgaWYgKHRoaXMudHJpZ2dlciAhPT0gJ2NsaWNrJykgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlZmVyZW5jZSwgJ+a1i+ivlTAwMDAnKTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2ZvY3VzaW4nLCAoKSA9PiB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMjIyMjIyMjIyJyk7CiAgICAgICAgICB0aGlzLmhhbmRsZUZvY3VzKCk7CiAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHJlZmVyZW5jZS5fX3Z1ZV9fOwogICAgICAgICAgaWYgKGluc3RhbmNlICYmIHR5cGVvZiBpbnN0YW5jZS5mb2N1cyA9PT0gJ2Z1bmN0aW9uJykgewogICAgICAgICAgICBpbnN0YW5jZS5mb2N1cygpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHRoaXMub24ocG9wcGVyLCAnZm9jdXNpbicsIHRoaXMuaGFuZGxlRm9jdXMpOwogICAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnZm9jdXNvdXQnLCB0aGlzLmhhbmRsZUJsdXIpOwogICAgICAgIHRoaXMub24ocG9wcGVyLCAnZm9jdXNvdXQnLCB0aGlzLmhhbmRsZUJsdXIpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKCfmtYvor5UxMTExJyk7CiAgICAgIH0KICAgICAgdGhpcy5vbihyZWZlcmVuY2UsICdrZXlkb3duJywgdGhpcy5oYW5kbGVLZXlkb3duKTsKICAgICAgdGhpcy5vbihyZWZlcmVuY2UsICdjbGljaycsIHRoaXMuaGFuZGxlQ2xpY2spOwogICAgfQogICAgdGhpcy5vbih0YXJnZXQsICdzY3JvbGwnLCAoKSA9PiB0aGlzLmhhbmRsZVNjcm9sbChyZWZlcmVuY2UsIHBvcHBlcikpOwogICAgaWYgKHRoaXMudHJpZ2dlciA9PT0gJ2NsaWNrJykgewogICAgICAvLyBjb25zb2xlLmxvZygnMTExMScpOwogICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2NsaWNrJywgdGhpcy5kb1RvZ2dsZSk7CiAgICAgIC8vIGNvbnNvbGUubG9nKDIyMjIsZG9jdW1lbnQsdGhpcyk7CiAgICAgIHRoaXMub24oZG9jdW1lbnQsICdjbGljaycsIHRoaXMuaGFuZGxlRG9jdW1lbnRDbGljayk7CiAgICAgIC8vIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcmVtb3ZlUG9wKHRoaXMpLCBmYWxzZSk7CiAgICB9IGVsc2UgaWYgKHRoaXMudHJpZ2dlciA9PT0gJ2hvdmVyJykgewogICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgICB0aGlzLm9uKHBvcHBlciwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ21vdXNlbGVhdmUnLCB0aGlzLmhhbmRsZU1vdXNlTGVhdmUpOwogICAgICB0aGlzLm9uKHBvcHBlciwgJ21vdXNlbGVhdmUnLCB0aGlzLmhhbmRsZU1vdXNlTGVhdmUpOwogICAgfSBlbHNlIGlmICh0aGlzLnRyaWdnZXIgPT09ICdmb2N1cycpIHsKICAgICAgaWYgKHJlZmVyZW5jZS5xdWVyeVNlbGVjdG9yKCdpbnB1dCwgdGV4dGFyZWEnKSkgewogICAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnZm9jdXNpbicsIHRoaXMuZG9TaG93KTsKICAgICAgICB0aGlzLm9uKHJlZmVyZW5jZSwgJ2ZvY3Vzb3V0JywgdGhpcy5kb0Nsb3NlKTsKICAgICAgICAvLyBjb25zb2xlLmxvZygnaW5wdXQsIHRleHRhcmVhJyk7CiAgICAgICAgLy8gY29uc29sZS5sb2coJzExMTExMScpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnbW91c2Vkb3duJywgdGhpcy5kb1Nob3cpOwogICAgICAgIHRoaXMub24ocmVmZXJlbmNlLCAnbW91c2V1cCcsIHRoaXMuZG9DbG9zZSk7CiAgICAgICAgLy8gY29uc29sZS5sb2coJzIyMjIyMicpOwogICAgICB9CiAgICB9CiAgfSwKICBiZWZvcmVEZXN0cm95KCkgewogICAgdGhpcy5jbGVhbnVwKCk7CiAgICByZW1vdmVQb3AodGhpcyk7CiAgICBsZXQgcmVmZXJlbmNlID0gdGhpcy5nZXRSZWZlcmVuY2UoKTsKICAgIC8vIGNvbnNvbGUubG9nKHJlZmVyZW5jZSwncmVmZXJlbmNlJyk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdjbGljaycsIHRoaXMuZG9Ub2dnbGUpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2V1cCcsIHRoaXMuZG9DbG9zZSk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdtb3VzZWRvd24nLCB0aGlzLmRvU2hvdyk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdmb2N1c2luJywgdGhpcy5kb1Nob3cpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnZm9jdXNvdXQnLCB0aGlzLmRvQ2xvc2UpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2Vkb3duJywgdGhpcy5kb1Nob3cpOwogICAgdGhpcy5vZmYocmVmZXJlbmNlLCAnbW91c2V1cCcsIHRoaXMuZG9DbG9zZSk7CiAgICB0aGlzLm9mZihyZWZlcmVuY2UsICdtb3VzZWxlYXZlJywgdGhpcy5oYW5kbGVNb3VzZUxlYXZlKTsKICAgIHRoaXMub2ZmKHJlZmVyZW5jZSwgJ21vdXNlZW50ZXInLCB0aGlzLmhhbmRsZU1vdXNlRW50ZXIpOwogICAgdGhpcy5vZmYoZG9jdW1lbnQsICdjbGljaycsIHRoaXMuaGFuZGxlRG9jdW1lbnRDbGljayk7CiAgICAvLyBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHJlbW92ZVBvcCh0aGlzKSwgZmFsc2UpOwogICAgdGhpcy5vZmYod2luZG93LCAnc2Nyb2xsJywgdGhpcy5oYW5kbGVTY3JvbGwpOwogIH0sCiAgbWV0aG9kczogewogICAgLy8g6I635Y+WcmVmZXJlbmNlCiAgICBnZXRSZWZlcmVuY2UoKSB7CiAgICAgIGxldCByZWZlcmVuY2UgPSB0aGlzLnJlZmVyZW5jZSB8fCB0aGlzLiRyZWZzLnJlZmVyZW5jZTsKICAgICAgaWYgKCFyZWZlcmVuY2UgJiYgdGhpcy4kc2xvdHMuZGVmYXVsdCAmJiB0aGlzLiRzbG90cy5kZWZhdWx0WzBdKSB7CiAgICAgICAgLy8gcmVmZXJlbmNlID0gdGhpcy4kc2xvdHMuZGVmYXVsdFswXS5lbG07CiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLiRzbG90cy5kZWZhdWx0KSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLiRzbG90cy5kZWZhdWx0W2ldLmVsbSBpbnN0YW5jZW9mIEVsZW1lbnQsICdzc3NzJyxpKTsKICAgICAgICAgIGlmICh0aGlzLiRzbG90cy5kZWZhdWx0W2ldLmVsbSBpbnN0YW5jZW9mIEVsZW1lbnQpIHsKICAgICAgICAgICAgcmVmZXJlbmNlID0gdGhpcy4kc2xvdHMuZGVmYXVsdFtpXS5lbG07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gcmVmZXJlbmNlOwogICAgfSwKICAgIHBvcHN0YXRlKCkgewogICAgICAvLyB0aGlzLnNob3dQb3BwZXI9ZmFsc2U7CiAgICAgIGxldCBlbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdkai1wb3BvdmVyLXBvc0YnKTsKICAgICAgLy8gY29uc29sZS5sb2coZWxzLCdlbHMnKTsKICAgICAgaWYgKGVscykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhlbHNbaV0ucGFyZW50Tm9kZSwn54i257qnJyk7CiAgICAgICAgICBpZiAoZWxzW2ldLnBhcmVudE5vZGUudGFnTmFtZSA9PT0gJ0JPRFknKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdib2R554i257qnJyk7CiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxzW2ldKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICAvLyDojrflj5bmn5DlhYPntKDku6XmtY/op4jlmajlt6bkuIrop5LkuLrljp/ngrnnmoTlnZDmoIcKICAgIGdldFBvaW50KGVsKSB7CiAgICAgIGxldCBvZmZzZXRUb3AgPSAwOwogICAgICBsZXQgb2Zmc2V0TGVmdCA9IDA7CiAgICAgIHdoaWxlIChlbCAmJiBlbC50YWdOYW1lICE9PSAnQk9EWScpIHsKICAgICAgICBvZmZzZXRUb3AgKz0gZWwub2Zmc2V0VG9wOwogICAgICAgIG9mZnNldExlZnQgKz0gZWwub2Zmc2V0TGVmdDsKICAgICAgICBlbCA9IGVsLm9mZnNldFBhcmVudDsKICAgICAgfQogICAgICBsZXQgb2Zmc2V0T2JqID0gewogICAgICAgIG9mZnNldFRvcDogb2Zmc2V0VG9wLAogICAgICAgIG9mZnNldExlZnQ6IG9mZnNldExlZnQKICAgICAgfTsKICAgICAgLy8gY29uc29sZS5sb2cob2Zmc2V0T2JqLCAnZ2V0UG9pbnQnKTsKICAgICAgcmV0dXJuIG9mZnNldE9iajsKICAgIH0sCiAgICAvLyDnlKjkuo7ojrflj5bmn5DkuKrlhYPntKDnm7jlr7nkuo5wYXJlbnTnmoTkvY3nva7pm4blkIgKICAgIGdldE9mZnNldFJlY3RSZWxhdGl2ZVRvQ3VzdG9tUGFyZW50KGVsZW1lbnQsIHBhcmVudCwgZml4ZWQpIHsKICAgICAgdmFyIGVsZW1lbnRSZWN0ID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QyKGVsZW1lbnQpOwogICAgICB2YXIgcGFyZW50UmVjdCA9IHRoaXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihwYXJlbnQpOwoKICAgICAgaWYgKGZpeGVkKSB7CiAgICAgICAgdmFyIHNjcm9sbFBhcmVudCA9IHRoaXMuZ2V0U2Nyb2xsUGFyZW50KHBhcmVudCk7CiAgICAgICAgcGFyZW50UmVjdC50b3AgKz0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcDsKICAgICAgICBwYXJlbnRSZWN0LmJvdHRvbSArPSBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wOwogICAgICAgIHBhcmVudFJlY3QubGVmdCArPSBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdDsKICAgICAgICBwYXJlbnRSZWN0LnJpZ2h0ICs9IHNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0OwogICAgICB9CgogICAgICB2YXIgcmVjdCA9IHsKICAgICAgICB0b3A6IGVsZW1lbnRSZWN0LnRvcCAtIHBhcmVudFJlY3QudG9wLAogICAgICAgIGxlZnQ6IGVsZW1lbnRSZWN0LmxlZnQgLSBwYXJlbnRSZWN0LmxlZnQsCiAgICAgICAgYm90dG9tOiBlbGVtZW50UmVjdC50b3AgLSBwYXJlbnRSZWN0LnRvcCArIGVsZW1lbnRSZWN0LmhlaWdodCwKICAgICAgICByaWdodDogZWxlbWVudFJlY3QubGVmdCAtIHBhcmVudFJlY3QubGVmdCArIGVsZW1lbnRSZWN0LndpZHRoLAogICAgICAgIHdpZHRoOiBlbGVtZW50UmVjdC53aWR0aCwKICAgICAgICBoZWlnaHQ6IGVsZW1lbnRSZWN0LmhlaWdodAogICAgICB9OwogICAgICAvLyBjb25zb2xlLmxvZyhyZWN0LCBlbGVtZW50UmVjdCwgcGFyZW50UmVjdCwgJ2dldE9mZnNldFJlY3RSZWxhdGl2ZVRvQ3VzdG9tUGFyZW50Jyk7CiAgICAgIHJldHVybiByZWN0OwogICAgfSwKICAgIC8vIOiOt+WPlua7muWKqOeItue6pwogICAgZ2V0U2Nyb2xsUGFyZW50KGVsZW1lbnQpIHsKICAgICAgdmFyIHJvb3QgPSB3aW5kb3c7CiAgICAgIHZhciBwYXJlbnQgPSBlbGVtZW50Py5wYXJlbnROb2RlOwogICAgICAvLyBjb25zb2xlLmxvZyhlbGVtZW50LCBwYXJlbnQsICdnZXRTY3JvbGxQYXJlbnQnKTsKCiAgICAgIGlmICghcGFyZW50KSB7CiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICAgIH0KCiAgICAgIGlmIChwYXJlbnQgPT09IHJvb3QuZG9jdW1lbnQpIHsKICAgICAgICAvLyBGaXJlZm94IHB1dHMgdGhlIHNjcm9sbFRPcCB2YWx1ZSBvbiBgZG9jdW1lbnRFbGVtZW50YCBpbnN0ZWFkIG9mIGBib2R5YCwgd2UgdGhlbiBjaGVjayB3aGljaCBvZiB0aGVtIGlzCiAgICAgICAgLy8gZ3JlYXRlciB0aGFuIDAgYW5kIHJldHVybiB0aGUgcHJvcGVyIGVsZW1lbnQKICAgICAgICBpZiAocm9vdC5kb2N1bWVudC5ib2R5LnNjcm9sbFRvcCB8fCByb290LmRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCkgewogICAgICAgICAgcmV0dXJuIHJvb3QuZG9jdW1lbnQuYm9keTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJvb3QuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwogICAgICB9CgogICAgICAvLyBGaXJlZm94IHdhbnQgdXMgdG8gY2hlY2sgYC14YCBhbmQgYC15YCB2YXJpYXRpb25zIGFzIHdlbGwKICAgICAgaWYgKAogICAgICAgIFsnc2Nyb2xsJywgJ2F1dG8nXS5pbmRleE9mKHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KHBhcmVudCwgJ292ZXJmbG93JykpICE9PSAtMSB8fAogICAgICAgIFsnc2Nyb2xsJywgJ2F1dG8nXS5pbmRleE9mKHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KHBhcmVudCwgJ292ZXJmbG93LXgnKSkgIT09IC0xIHx8CiAgICAgICAgWydzY3JvbGwnLCAnYXV0byddLmluZGV4T2YodGhpcy5nZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkocGFyZW50LCAnb3ZlcmZsb3cteScpKSAhPT0gLTEKICAgICAgKSB7CiAgICAgICAgLy8gSWYgdGhlIGRldGVjdGVkIHNjcm9sbFBhcmVudCBpcyBib2R5LCB3ZSBwZXJmb3JtIGFuIGFkZGl0aW9uYWwgY2hlY2sgb24gaXRzIHBhcmVudE5vZGUKICAgICAgICAvLyBpbiB0aGlzIHdheSB3ZSdsbCBnZXQgYm9keSBpZiB0aGUgYnJvd3NlciBpcyBDaHJvbWUtaXNoLCBvciBkb2N1bWVudEVsZW1lbnQgb3RoZXJ3aXNlCiAgICAgICAgLy8gZml4ZXMgaXNzdWUgIzY1CiAgICAgICAgLy8gY29uc29sZS5sb2coIHBhcmVudD8uY2xhc3NOYW1lLCdwYXJlbnQgY2xhc3NOYW1lJyk7CiAgICAgICAgLy8gY29uc29sZS5sb2coIHBhcmVudD8uY2xhc3NMaXN0LCdwYXJlbnQgY2xhc3NMaXN0Jyk7CiAgICAgICAgbGV0IGNsYXNzTmFtZSA9IHBhcmVudD8uZ2V0QXR0cmlidXRlKCdjbGFzcycpOwogICAgICAgIGlmIChjbGFzc05hbWU/LmluZGV4T2YoJ2RqLXRhYmxlLXBhbmVsJykgPiAtMSB8fCBjbGFzc05hbWU/LmluZGV4T2YoJ2RqLW1vZGFsLWNvbnRlbnQnKSA+IC0xKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnPT09PT0nKTsKICAgICAgICAgIHJldHVybiB0aGlzLmdldFNjcm9sbFBhcmVudChwYXJlbnQpOwogICAgICAgIH0KICAgICAgICBpZiAodGhpcy5ub3RQYXJlbnRDbGFzcyAmJiBwYXJlbnQ/LmdldEF0dHJpYnV0ZSgnY2xhc3MnKSA9PT0gdGhpcy5ub3RQYXJlbnRDbGFzcykgewogICAgICAgICAgLy8gY29uc29sZS5sb2coJz09PT09Jyk7CiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxQYXJlbnQocGFyZW50KTsKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2cocGFyZW50LCAncGFyZW50MjIyJyk7CiAgICAgICAgcmV0dXJuIHBhcmVudDsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGxQYXJlbnQoZWxlbWVudD8ucGFyZW50Tm9kZSk7CiAgICB9LAogICAgLy8g6I635Y+W6Led56a76K+l5a2Q5YWD57Sg5pyA6L+R55qE6L+b6KGM6L+H5a6a5L2N55qE54i25YWD57SgCiAgICBnZXRPZmZzZXRQYXJlbnQoZWxlbWVudCkgewogICAgICAvLyBOT1RFOiAxIERPTSBhY2Nlc3MgaGVyZQogICAgICB2YXIgcm9vdCA9IHdpbmRvdzsKICAgICAgdmFyIG9mZnNldFBhcmVudCA9IGVsZW1lbnQ/Lm9mZnNldFBhcmVudDsKICAgICAgLy8gY29uc29sZS5sb2coZWxlbWVudCwgb2Zmc2V0UGFyZW50LCBvZmZzZXRQYXJlbnQgPT09IHJvb3QuZG9jdW1lbnQuYm9keSB8fCAhb2Zmc2V0UGFyZW50ID8gcm9vdC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBvZmZzZXRQYXJlbnQsICdnZXRPZmZzZXRQYXJlbnQnKTsKICAgICAgcmV0dXJuIG9mZnNldFBhcmVudCA9PT0gcm9vdD8uZG9jdW1lbnQ/LmJvZHkgfHwgIW9mZnNldFBhcmVudCA/IHJvb3Q/LmRvY3VtZW50Py5kb2N1bWVudEVsZW1lbnQgOiBvZmZzZXRQYXJlbnQ7CiAgICB9LAogICAgLy8g6I635Y+W5YWD57Sg5pyA57uI5qC35byP77yM5YyF5ous5LqG5YaF6IGU5qC35byP44CB5bWM5YWl5qC35byP5ZKM5aSW6YOo5qC35byPCiAgICBnZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZWxlbWVudCwgcHJvcGVydHkpIHsKICAgICAgLy8gTk9URTogMSBET00gYWNjZXNzIGhlcmUKICAgICAgdmFyIHJvb3QgPSB3aW5kb3c7CiAgICAgIHZhciBjc3MgPSByb290LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCwgbnVsbCk7CiAgICAgIHJldHVybiBjc3NbcHJvcGVydHldOwogICAgfSwKICAgIC8vIOeUqOS6juiOt+WPluafkOS4quWFg+e0oOebuOWvueS6juinhueql+eahOS9jee9rumbhuWQiAogICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0MihlbGVtZW50KSB7CiAgICAgIGxldCByZWN0ID0gZWxlbWVudD8uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGVsZW1lbnQsIHJlY3QsICdyZWN0Jyk7CiAgICAgIC8vIHdoZXRoZXIgdGhlIElFIHZlcnNpb24gaXMgbG93ZXIgdGhhbiAxMQogICAgICBsZXQgaXNJRSA9IG5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignTVNJRScpICE9IC0xOwoKICAgICAgLy8gZml4IGllIGRvY3VtZW50IGJvdW5kaW5nIHRvcCBhbHdheXMgMCBidWcKICAgICAgbGV0IHJlY3RUb3AgPSBpc0lFICYmIGVsZW1lbnQ/LnRhZ05hbWUgPT09ICdIVE1MJyA/IC1lbGVtZW50Py5zY3JvbGxUb3AgOiByZWN0Py50b3A7CgogICAgICBsZXQgcGFyYW0gPSB7CiAgICAgICAgbGVmdDogcmVjdD8ubGVmdCwKICAgICAgICB0b3A6IHJlY3RUb3AsCiAgICAgICAgcmlnaHQ6IHJlY3Q/LnJpZ2h0LAogICAgICAgIGJvdHRvbTogcmVjdD8uYm90dG9tLAogICAgICAgIHdpZHRoOiByZWN0Py5yaWdodCAtIHJlY3Q/LmxlZnQsCiAgICAgICAgaGVpZ2h0OiByZWN0Py5ib3R0b20gLSByZWN0VG9wCiAgICAgIH07CiAgICAgIC8vIGNvbnNvbGUubG9nKHBhcmFtLCAnZ2V0Qm91bmRpbmdDbGllbnRSZWN0MicpOwogICAgICAvLyBjb25zb2xlLmxvZyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsIHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQsICdnZXRCb3VuZGluZ0NsaWVudFJlY3QnKTsKICAgICAgcmV0dXJuIHBhcmFtOwogICAgfSwKICAgIC8vIOiOt+WPlnRpdGxl5a696auYCiAgICBnZXRUaXRsZVN0eWxlKCkgewogICAgICBsZXQgZG9tID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLXRpdGxlJyk7CiAgICAgIGlmIChkb20pIHsKICAgICAgICBsZXQgZGl2T2Zmc2V0V2lkdGggPSBkb20ub2Zmc2V0V2lkdGg7IC8vIOWFg+e0oOeahOWuveW6puWMheWQq3BhZGRpbmflkoxib3JkZXIKICAgICAgICBsZXQgZGl2T2Zmc2V0SGVpZ2h0ID0gZG9tLm9mZnNldEhlaWdodDsgLy8g5YWD57Sg55qE5a695bqm5YyF5ZCrcGFkZGluZ+WSjGJvcmRlcgogICAgICAgIC8vIGNvbnNvbGUubG9nKGRpdk9mZnNldFdpZHRoLCBkaXZPZmZzZXRIZWlnaHQsICdnZXRUaXRsZVN0eWxlJyk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHdpZHRoOiBkaXZPZmZzZXRXaWR0aCwKICAgICAgICAgIGhlaWdodDogZGl2T2Zmc2V0SGVpZ2h0CiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIC8vIOiOt+WPlnBvcOacgOWkp+acgOWwj+WuveW6pgogICAgcG9wV2lkdGhIZWlnaHRGdW4ocmVmZXJlbmNlLCBwb3BwZXIpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ3BvcFdpZHRoSGVpZ2h0RnVuJyk7CiAgICAgIGxldCBvZmZzZXRPYmoyID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QyKHJlZmVyZW5jZSk7CiAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09ICdIVE1MJykgewogICAgICAgIG9mZnNldE9iajIgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocmVmZXJlbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBvZmZzZXRPYmoyID0gZ2V0T2Zmc2V0UmVjdFJlbGF0aXZlVG9DdXN0b21QYXJlbnQocmVmZXJlbmNlLCBnZXRPZmZzZXRQYXJlbnQocG9wcGVyKSwgZmFsc2UpOwogICAgICAgIG9mZnNldE9iajIgPSB0aGlzLmdldE9mZnNldFJlY3RSZWxhdGl2ZVRvQ3VzdG9tUGFyZW50KHJlZmVyZW5jZSwgdGhpcy50YXJnZXQsIGZhbHNlKTsKICAgICAgfQogICAgICBsZXQgbWF4V2lkdGgsIG1heEhlaWdodDsKICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0Qm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRUb3AnKSB7CiAgICAgICAgbWF4V2lkdGggPSBvZmZzZXRPYmoyLmxlZnQgLSAxMDsKICAgICAgICBtYXhIZWlnaHQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gMTA7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRCb3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRUb3AnKSB7CiAgICAgICAgbWF4V2lkdGggPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSBvZmZzZXRPYmoyLnJpZ2h0IC0gMTA7CiAgICAgICAgbWF4SGVpZ2h0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCAtIDEwOwogICAgICB9CiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgIG1heFdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gMTA7CiAgICAgICAgbWF4SGVpZ2h0ID0gb2Zmc2V0T2JqMi50b3AgLSAxNTsKICAgICAgfQogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICBtYXhXaWR0aCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIDEwOwogICAgICAgIG1heEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSBvZmZzZXRPYmoyLmJvdHRvbSAtIDEwOwogICAgICB9CiAgICAgIHRoaXMucG9wV0hTdHlsZSA9IHsKICAgICAgICBtYXhXaWR0aDogbWF4V2lkdGgsCiAgICAgICAgbWF4SGVpZ2h0OiBtYXhIZWlnaHQKICAgICAgfTsKICAgIH0sCiAgICAvLyDojrflj5Zwb3AgY29udGVudOW6lOivpeWHj+eahOWAvAogICAgZ2V0Q29udGVudENoYSgpIHsKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5nZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKS5wYXJlbnROb2RlLnBhcmVudE5vZGUsJ2JvcmRlci1ib3R0b20td2lkdGgnKSwnLS0tJyk7CiAgICAgIGxldCBQVCA9IHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKSwgJ3BhZGRpbmctdG9wJykKICAgICAgICA/LnNwbGl0KCdweCcpWzBdIHx8IDA7CiAgICAgIGxldCBQQiA9IHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKSwgJ3BhZGRpbmctYm90dG9tJykKICAgICAgICA/LnNwbGl0KCdweCcpWzBdIHx8IDA7CiAgICAgIGxldCBjb250ZW50UFQgPSB0aGlzLmdldFN0eWxlQ29tcHV0ZWRQcm9wZXJ0eShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2x0aXBJZCArICctY29udGVudCcpPy5wYXJlbnROb2RlLCAncGFkZGluZy10b3AnKQogICAgICAgID8uc3BsaXQoJ3B4JylbMF0gfHwgMDsKICAgICAgbGV0IGNvbnRlbnRQQiA9IHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50Jyk/LnBhcmVudE5vZGUsICdwYWRkaW5nLWJvdHRvbScpCiAgICAgICAgPy5zcGxpdCgncHgnKVswXSB8fCAwOwogICAgICBsZXQgYmJ3ID0gdGhpcy5nZXRTdHlsZUNvbXB1dGVkUHJvcGVydHkoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKT8ucGFyZW50Tm9kZT8ucGFyZW50Tm9kZSwgJ2JvcmRlci1ib3R0b20td2lkdGgnKQogICAgICAgID8uc3BsaXQoJ3B4JylbMF0gfHwgMDsKICAgICAgbGV0IGJ0dyA9IHRoaXMuZ2V0U3R5bGVDb21wdXRlZFByb3BlcnR5KGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50Jyk/LnBhcmVudE5vZGU/LnBhcmVudE5vZGUsICdib3JkZXItdG9wLXdpZHRoJykKICAgICAgICA/LnNwbGl0KCdweCcpWzBdIHx8IDA7CiAgICAgIGxldCBjb250ZW50Q2hhID0gTnVtYmVyKFBUKSArIE51bWJlcihQQikgKyBOdW1iZXIoY29udGVudFBUKSArIE51bWJlcihjb250ZW50UEIpICsgTnVtYmVyKGJidykgKyBOdW1iZXIoYnR3KTsKICAgICAgLy8gY29uc29sZS5sb2coUFQsUEIsY29udGVudENoYSwgJ2NvbnRlbnRDaGEnKTsKICAgICAgcmV0dXJuIGNvbnRlbnRDaGE7CiAgICB9LAogICAgLy8g5a6a5L2NCiAgICBwb3NpdGlvbkZ1bihyZWZlcmVuY2UsIHBvcHBlciwgc2Nyb2xsVG9wLCBzY3JvbGxMZWZ0KSB7CiAgICAgIGlmICghcmVmZXJlbmNlIHx8ICFwb3BwZXIpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5ICYmIHRoaXMudGFnTmFtZSAhPT0gJ0hUTUwnKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpLCAnY2xhc3NMaXN0Jyk7CiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpPy5jbGFzc0xpc3Q/LmFkZCgncG9zQScpOwogICAgICB9CiAgICAgIGxldCBvZmZzZXRPYmogPSB0aGlzLmdldFBvaW50KHJlZmVyZW5jZSk7CiAgICAgIGxldCBvZmZzZXRPYmozID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QyKHJlZmVyZW5jZSk7CiAgICAgIGxldCBvZmZzZXRPYmoyOwogICAgICBpZiAodGhpcy50YWdOYW1lID09PSAnSFRNTCcpIHsKICAgICAgICBvZmZzZXRPYmoyID0gdGhpcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QyKHJlZmVyZW5jZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2Zmc2V0T2JqMiA9IHRoaXMuZ2V0T2Zmc2V0UmVjdFJlbGF0aXZlVG9DdXN0b21QYXJlbnQocmVmZXJlbmNlLCB0aGlzLmdldE9mZnNldFBhcmVudChwb3BwZXIpLCBmYWxzZSk7CiAgICAgIH0KICAgICAgLy8gY29uc29sZS5sb2cob2Zmc2V0T2JqMywgJ29mZnNldE9iajMnKTsKICAgICAgLy8gY29uc29sZS5sb2cob2Zmc2V0T2JqMiwgJ29mZnNldE9iajInKTsKICAgICAgbGV0IHJlZmVyZW5jZU9mZnNldExlZnQgPSB0aGlzLmFwcGVuZFRvQm9keSA/IG9mZnNldE9iajIubGVmdCA6IHJlZmVyZW5jZS5vZmZzZXRMZWZ0OwogICAgICBsZXQgcmVmZXJlbmNlT2Zmc2V0VG9wID0gdGhpcy5hcHBlbmRUb0JvZHkgPyBvZmZzZXRPYmoyLnRvcCA6IHJlZmVyZW5jZS5vZmZzZXRUb3A7CiAgICAgIC8vIGNvbnNvbGUubG9nKGBcbiByZWZlcmVuY2U6IG9mZnNldExlZnTvvJpvZmZzZXRMZWZ077yaJHtyZWZlcmVuY2Uub2Zmc2V0TGVmdH0sJHtvZmZzZXRPYmoub2Zmc2V0TGVmdH0sICBvZmZzZXRPYmoyLmxlZnTvvJoke29mZnNldE9iajIubGVmdH1gKTsKICAgICAgLy8gY29uc29sZS5sb2coYFxuIHJlZmVyZW5jZTogb2Zmc2V0VG9w77yab2Zmc2V0VG9w77yaJHtyZWZlcmVuY2Uub2Zmc2V0VG9wfSwke29mZnNldE9iai5vZmZzZXRUb3B9LCAgb2Zmc2V0T2JqMi50b3DvvJoke29mZnNldE9iajIudG9wfWApOwogICAgICAvLyBjb25zb2xlLmxvZyhyZWZlcmVuY2VPZmZzZXRUb3AsIHJlZmVyZW5jZU9mZnNldExlZnQsICc9PT09PT09PT09PT09PT09PT09PT0nKTsKICAgICAgbGV0IGxlZnQsIHRvcDsKICAgICAgLy8gY29uc29sZS5sb2codGhpcy5wb3BXSFN0eWxlLm1heEhlaWdodCwgdGhpcy5wb3BXSFN0eWxlLm1heFdpZHRoLCBwb3BwZXIub2Zmc2V0V2lkdGgsICd0aGlzLnBvcFdIU3R5bGUubWF4SGVpZ2h0Jyk7CiAgICAgIGxldCBjb250ZW50Q2hhID0gdGhpcy5nZXRDb250ZW50Q2hhKCk7CiAgICAgIGxldCBoZWlnaHQxOwogICAgICBpZiAodGhpcy50aXRsZSkgewogICAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRUb3AnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0Qm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0Qm90dG9tJykgewogICAgICAgICAgaGVpZ2h0MSA9IE51bWJlcih0aGlzLmdldFRpdGxlU3R5bGUoKS5oZWlnaHQgKyAyNCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGhlaWdodDEgPSBOdW1iZXIodGhpcy5nZXRUaXRsZVN0eWxlKCkuaGVpZ2h0ICsgY29udGVudENoYSk7CiAgICAgICAgfQogICAgICAgIC8vIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50Jykuc3R5bGUubWF4SGVpZ2h0ID0gJ2NhbGMoMTAwdmggLSAnICsgaGVpZ2h0MSArICdweCc7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaGVpZ2h0MSA9IGNvbnRlbnRDaGE7CiAgICAgIH0KICAgICAgLy8gaGVpZ2h0MSA9IDE1OwogICAgICBpZiAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQgKyAnLWNvbnRlbnQnKSkgewogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkICsgJy1jb250ZW50Jykuc3R5bGUubWF4SGVpZ2h0ID0gdGhpcy5wb3BXSFN0eWxlLm1heEhlaWdodCAtIGhlaWdodDEgPCBjb250ZW50Q2hhID8gY29udGVudENoYSArICdweCcgOiB0aGlzLnBvcFdIU3R5bGUubWF4SGVpZ2h0IC0gaGVpZ2h0MSArICdweCc7CiAgICAgIH0KICAgICAgbGV0IHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCA9IHBvcHBlci5vZmZzZXRXaWR0aDsKICAgICAgbGV0IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgPSBwb3BwZXIub2Zmc2V0SGVpZ2h0OwogICAgICBsZXQgd2lkdGhEaWZmZXJlbmNlID0gTWF0aC5hYnMocmVmZXJlbmNlLm9mZnNldFdpZHRoIC0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoKTsKICAgICAgbGV0IGhlaWdodERpZmZlcmVuY2UgPSBNYXRoLmFicyhyZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCk7CiAgICAgIC8vIGNvbnNvbGUubG9nKGBwb3BwZXI6IG9mZnNldExlZnTvvJoke3BvcHBlci5vZmZzZXRMZWZ0fSAgb2Zmc2V0VG9w77yaJHtwb3BwZXIub2Zmc2V0VG9wfSAgb2Zmc2V0V2lkdGjvvJoke3BvcHBlci5vZmZzZXRXaWR0aH0scG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoOiAke3BvcHBlclJlYWxpdHlPZmZzZXRXaWR0aH0sICBvZmZzZXRIZWlnaHTvvJoke3BvcHBlci5vZmZzZXRIZWlnaHR9LCBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0OiR7cG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodH1gKTsKICAgICAgLy8gY29uc29sZS5sb2coYFxuIHJlZmVyZW5jZTogb2Zmc2V0TGVmdO+8miR7cmVmZXJlbmNlT2Zmc2V0TGVmdH0gIG9mZnNldFRvcO+8miR7cmVmZXJlbmNlT2Zmc2V0VG9wfSAgb2Zmc2V0V2lkdGjvvJoke3JlZmVyZW5jZS5vZmZzZXRXaWR0aH0gIG9mZnNldEhlaWdodO+8miR7cmVmZXJlbmNlLm9mZnNldEhlaWdodH1gKTsKICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wUmlnaHQnKSB7CiAgICAgICAgdG9wID0gcmVmZXJlbmNlT2Zmc2V0VG9wIC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodDsKICAgICAgfQogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICB0b3AgPSByZWZlcmVuY2VPZmZzZXRUb3AgKyByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0OwogICAgICB9CiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b20nKSB7CiAgICAgICAgbGVmdCA9IHJlZmVyZW5jZU9mZnNldExlZnQgLSBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggLyAyICsgcmVmZXJlbmNlLm9mZnNldFdpZHRoIC8gMjsKICAgICAgfQogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbUxlZnQnKSB7CiAgICAgICAgbGVmdCA9IHJlZmVyZW5jZU9mZnNldExlZnQ7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wUmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgaWYgKHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCA+IHJlZmVyZW5jZS5vZmZzZXRXaWR0aCkgewogICAgICAgICAgbGVmdCA9IHJlZmVyZW5jZU9mZnNldExlZnQgLSB3aWR0aERpZmZlcmVuY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxlZnQgPSByZWZlcmVuY2VPZmZzZXRMZWZ0ICsgd2lkdGhEaWZmZXJlbmNlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0VG9wJykgewogICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcDsKICAgICAgfQogICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICdyaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0JykgewogICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcCAtIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgLyAyICsgcmVmZXJlbmNlLm9mZnNldEhlaWdodCAvIDI7CiAgICAgIH0KICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRCb3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScpIHsKICAgICAgICBpZiAocG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCA+IHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQpIHsKICAgICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcCAtIGhlaWdodERpZmZlcmVuY2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRvcCA9IHJlZmVyZW5jZU9mZnNldFRvcCArIGhlaWdodERpZmZlcmVuY2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0VG9wJyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3JpZ2h0Qm90dG9tJykgewogICAgICAgIGxlZnQgPSByZWZlcmVuY2VPZmZzZXRMZWZ0ICsgcmVmZXJlbmNlLm9mZnNldFdpZHRoOwogICAgICB9CiAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRUb3AnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0Qm90dG9tJykgewogICAgICAgIGxlZnQgPSByZWZlcmVuY2VPZmZzZXRMZWZ0IC0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoOwogICAgICB9CiAgICAgIC8vIOWKqOaAgeiuoeeul+WuvemrmOaXtu+8jOWuvS/pq5jnmoTpnIDopoHliqDkuIrnmoTlt67lgLwKICAgICAgbGV0IGhlaWdodENoYUxSID0gMDsKICAgICAgbGV0IGxlZnRDaGFMUiA9IDA7CiAgICAgIGxldCB0b3AxLCBsZWZ0MTsKICAgICAgaWYgKHRoaXMudGFnTmFtZSAhPT0gJ0hUTUwnKSB7CiAgICAgICAgdG9wMSA9IG9mZnNldE9iajMudG9wIC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCAvIDIgKyByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMjsKICAgICAgICAvLyBsZWZ0MSA9IG9mZnNldE9iajMubGVmdCAtIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCAvIDIgKyByZWZlcmVuY2Uub2Zmc2V0V2lkdGggLyAyOwogICAgICAgIGxlZnQxID0gbGVmdDsKICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbUxlZnQnKSB7CiAgICAgICAgICBsZWZ0MSA9IGxlZnQgLSA1OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0b3AxID0gdG9wOwogICAgICAgIGxlZnQxID0gbGVmdDsKICAgICAgfQogICAgICBsZXQgdG9wUG9zID0gdGhpcy50YWdOYW1lID09PSAnSFRNTCcgPyB0b3AgOiB0b3AxOwogICAgICBsZXQgbGVmdFBvcyA9IHRoaXMudGFnTmFtZSA9PT0gJ0hUTUwnID8gbGVmdCA6IGxlZnQxOwogICAgICBpZiAodGhpcy5hcHBlbmRUb0JvZHkpIHsKICAgICAgICBpZiAodG9wUG9zICsgcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gNCkgewogICAgICAgICAgaGVpZ2h0Q2hhTFIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gdG9wUG9zIC0gcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCAtIDU7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnaGVpZ2h0Q2hhTFIgMTExJyk7CiAgICAgICAgfSBlbHNlIGlmICh0b3BQb3MgPD0gNCkgewogICAgICAgICAgaGVpZ2h0Q2hhTFIgPSBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0IC8gMiAtIHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQgLyAyIC0gb2Zmc2V0T2JqMy50b3AgKyA1OwogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2hlaWdodENoYUxSIDIyMicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoZWlnaHRDaGFMUiA9IDA7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnaGVpZ2h0Q2hhTFIgMzMzJyk7CiAgICAgICAgfQogICAgICAgIGlmIChsZWZ0UG9zICsgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSB7CiAgICAgICAgICBsZWZ0Q2hhTFIgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSBsZWZ0UG9zIC0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC0gNTsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGxlZnRDaGFMUiwnbGVmdENoYUxSIDExJykKICAgICAgICB9IGVsc2UgaWYgKGxlZnRQb3MgPD0gMCkgewogICAgICAgICAgbGVmdENoYUxSID0gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC8gMiAtIHJlZmVyZW5jZS5vZmZzZXRXaWR0aCAvIDIgLSBvZmZzZXRPYmozLmxlZnQgKyA1OwogICAgICAgICAgLyogIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMTExMS0tJykKICAgICAgICAgICBsZWZ0Q2hhTFIgPSAtIG9mZnNldE9iajMubGVmdCArIDUgLy8g5bem5L6ncG9w6KKr6YGu5oyh55qE6Led56a7KzUKICAgICAgICAgICB9Ki8KICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BSaWdodCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzExMTEtLScpCiAgICAgICAgICAgIGxlZnRDaGFMUiA9IC1sZWZ0UG9zICsgNTsvLyDlt6bkvqdwb3Dooqvpga7mjKHnmoTot53nprsrNQogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2cob2Zmc2V0T2JqMy5sZWZ0LGxlZnRQb3MsbGVmdENoYUxSLCdsZWZ0Q2hhTFIgMjInKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBsZWZ0Q2hhTFIgPSAwOwogICAgICAgICAgLy8gY29uc29sZS5sb2cobGVmdENoYUxSLGxlZnRQb3MsJ2xlZnRDaGFMUiAzMycpCiAgICAgICAgfQogICAgICB9CiAgICAgIC8vIGNvbnNvbGUubG9nKGhlaWdodENoYUxSLCBsZWZ0Q2hhTFIsICdoZWlnaHRDaGFMUixsZWZ0Q2hhTFInKTsKICAgICAgbGV0IG92ZXJGbG93SGVpZ2h0ID0gb2Zmc2V0T2JqMy50b3AgPj0gMTAgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IC0gb2Zmc2V0T2JqMy50b3AgOiBvZmZzZXRPYmozLmJvdHRvbTsKICAgICAgbGV0IG92ZXJGbG93V2lkdGggPSBvZmZzZXRPYmozLmxlZnQgPj0gMTAgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSBvZmZzZXRPYmozLmxlZnQgOiBvZmZzZXRPYmozLnJpZ2h0OwogICAgICAvLyBjb25zb2xlLmxvZygnZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCcsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsICdvZmZzZXRPYmoyLnRvcO+8micsIG9mZnNldE9iajIudG9wLCAnb3ZlckZsb3dIZWlnaHTvvJonLCBvdmVyRmxvd0hlaWdodCwgJ292ZXJGbG93V2lkdGjvvJonLCBvdmVyRmxvd1dpZHRoLCAncG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodO+8micsIHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQsICdwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGjvvJonLCBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGgsICcwMDAnLCBvdmVyRmxvd0hlaWdodCA8IHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQpOwogICAgICAvLyByZWZlcmVuY2Xooqvpga7nm5bnmoTpq5jluqYKICAgICAgbGV0IGhpZGVIZWlnaHQgPSBvZmZzZXRPYmozLnRvcCA+PSAwID8gb2Zmc2V0T2JqMy5ib3R0b20gLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0IDogLW9mZnNldE9iajMudG9wOwogICAgICBsZXQgaGlkZVdpZHRoID0gb2Zmc2V0T2JqMy5sZWZ0ID49IDAgPyBvZmZzZXRPYmozLnJpZ2h0IC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIDogLW9mZnNldE9iajMubGVmdDsKICAgICAgLy8gY29uc29sZS5sb2coaGlkZUhlaWdodCwgaGlkZVdpZHRoLCAnaGlkZUhlaWdodCcpOwogICAgICAvLyDmlofmoaPpobbpg6jliLByZWZlcmVuY2XlupXpg6jnmoTot53nprsKICAgICAgbGV0IHNjcm9sbEhlaWdodFVwID0gb2Zmc2V0T2JqLm9mZnNldFRvcCArIHJlZmVyZW5jZS5vZmZzZXRIZWlnaHQ7CiAgICAgIC8vIOaWh+aho+mhtumDqOWIsHJlZmVyZW5jZemhtumDqC3lj6/op4bljLrln5/nmoTpq5jluqYKICAgICAgbGV0IHNjcm9sbEhlaWdodERvd24gPSBvZmZzZXRPYmoub2Zmc2V0VG9wIC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKICAgICAgLy8g5paH5qGj5bem5L6n5YiwcmVmZXJlbmNl5pyA5Y+z5L6n55qE6Led56a7CiAgICAgIGxldCBzY3JvbGxXaWR0aFVwID0gb2Zmc2V0T2JqLm9mZnNldExlZnQgKyByZWZlcmVuY2Uub2Zmc2V0V2lkdGg7CiAgICAgIC8vIOaWh+aho+mhtumDqOWIsHJlZmVyZW5jZeW3puS+py3lj6/op4bljLrln5/nmoTlrr3luqYKICAgICAgbGV0IHNjcm9sbFdpZHRoRG93biA9IG9mZnNldE9iai5vZmZzZXRMZWZ0IC0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwogICAgICBsZXQgc2Nyb2xsSGVpZ2h0LCBzY3JvbGxXaWR0aDsKICAgICAgaWYgKG9mZnNldE9iajMudG9wIDwgLXJlZmVyZW5jZS5vZmZzZXRIZWlnaHQpIHsKICAgICAgICBzY3JvbGxIZWlnaHQgPSBzY3JvbGxUb3AgLSBzY3JvbGxIZWlnaHRVcCB8fCAwOwogICAgICB9IGVsc2UgewogICAgICAgIHNjcm9sbEhlaWdodCA9IHNjcm9sbFRvcCAtIHNjcm9sbEhlaWdodERvd24gfHwgMDsKICAgICAgfQogICAgICBpZiAob2Zmc2V0T2JqMy5sZWZ0IDwgLXJlZmVyZW5jZS5vZmZzZXRXaWR0aCArIDIwKSB7CiAgICAgICAgc2Nyb2xsV2lkdGggPSBzY3JvbGxMZWZ0IC0gc2Nyb2xsV2lkdGhVcCB8fCAwOwogICAgICB9IGVsc2UgewogICAgICAgIHNjcm9sbFdpZHRoID0gc2Nyb2xsTGVmdCAtIHNjcm9sbFdpZHRoRG93biB8fCAwOwogICAgICB9CiAgICAgIC8vIGNvbnNvbGUubG9nKGxlZnQsIGxlZnQxLCAnbGVmdCxsZWZ0MScpOwogICAgICAvLyBjb25zb2xlLmxvZyh0b3AsIHRvcDEsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsJ3RvcCx0b3AxJyk7CiAgICAgIC8vIGNvbnNvbGUubG9nKHNjcm9sbFRvcCwgc2Nyb2xsSGVpZ2h0VXAsIHNjcm9sbEhlaWdodERvd24sIHNjcm9sbEhlaWdodCwgJ3Njcm9sbFRvcCxzY3JvbGxIZWlnaHQnKTsKICAgICAgLy8gY29uc29sZS5sb2cobGVmdCArIGxlZnRDaGFMUiAtIHNjcm9sbFdpZHRoLCBsZWZ0ICsgbGVmdENoYUxSLCBsZWZ0Q2hhTFIsIHNjcm9sbFdpZHRoLCBsZWZ0LCAnPT09MDAnKTsKICAgICAgbGV0IGxlZnROdW0sIHRvcE51bTsKICAgICAgaWYgKHRoaXMuYXBwZW5kVG9Cb2R5KSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3BsYWNlbWVudFN0cicsdGhpcy5wbGFjZW1lbnRTdHIpCiAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRUb3AnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRCb3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRCb3R0b20nKSB7CiAgICAgICAgICBsZWZ0TnVtID0gbGVmdDsKICAgICAgICAgIGlmIChvZmZzZXRPYmozLnRvcCA8IC1yZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IHx8IG9mZnNldE9iajMudG9wID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkgewogICAgICAgICAgICBpZiAodGhpcy50YWdOYW1lICE9PSAnSFRNTCcpIHsKICAgICAgICAgICAgICB0b3BOdW0gPSB0b3AxICsgaGVpZ2h0Q2hhTFIgLSBzY3JvbGxIZWlnaHQgKyAncHgnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvcE51bSA9IHRvcCArIGhlaWdodENoYUxSIC0gc2Nyb2xsSGVpZ2h0ICsgJ3B4JzsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygndG9wTnVtMTExPT09JywgdG9wTnVtKQogICAgICAgICAgfSBlbHNlIGlmIChvdmVyRmxvd0hlaWdodCA8IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgfHwgdGhpcy5hcHBlbmRUb0JvZHkgJiYgdG9wIDwgMCB8fCB0aGlzLmFwcGVuZFRvQm9keSAmJiB0b3AxIDwgMCB8fCB0b3AgKyBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCB0b3AxICsgcG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCA+IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgb2Zmc2V0T2JqMy50b3AgPD0gMCB8fCBvZmZzZXRPYmozLmJvdHRvbSA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0KSB7CiAgICAgICAgICAgIC8vIGlmICh0aGlzLnRhZ05hbWUgIT09ICdIVE1MJykgewogICAgICAgICAgICAvLyAgIHRvcE51bSA9IHRvcDEgKyBoZWlnaHRDaGFMUiArICdweCc7CiAgICAgICAgICAgIC8vIH1lbHNlIHsKICAgICAgICAgICAgdG9wTnVtID0gdG9wICsgaGVpZ2h0Q2hhTFIgKyAncHgnOwogICAgICAgICAgICAvLyB9CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCd0b3BOdW0yMicsIHRvcE51bSkKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRvcE51bSA9IHRvcCArICdweCc7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCczMycpCiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcFJpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbScgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdib3R0b21MZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgdG9wTnVtID0gdG9wICsgJ3B4JzsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKG92ZXJGbG93V2lkdGgscG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoLGxlZnQpCiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgb3ZlckZsb3dXaWR0aO+8miR7b3ZlckZsb3dXaWR0aH0gIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aO+8miR7cG9wcGVyUmVhbGl0eU9mZnNldFdpZHRofSAgbGVmdO+8miR7bGVmdH0sbGVmdDE6ICR7bGVmdDF9LGApOwogICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA8IC1yZWZlcmVuY2Uub2Zmc2V0V2lkdGggKyAyMCB8fCBvZmZzZXRPYmozLmxlZnQgPiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggLSAxMykgewogICAgICAgICAgICAvKiBpZiAodGhpcy50YWdOYW1lICE9PSAnSFRNTCcpIHsKICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0MSArIGxlZnRDaGFMUiAtIHNjcm9sbFdpZHRoOwogICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0ICsgbGVmdENoYUxSIC0gc2Nyb2xsV2lkdGg7CiAgICAgICAgICAgICB9Ki8KICAgICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA8IC1yZWZlcmVuY2Uub2Zmc2V0V2lkdGggKyAyMCkgewogICAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0ICsgbGVmdENoYUxSIC0gc2Nyb2xsV2lkdGggLSAyMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob2Zmc2V0T2JqMy5sZWZ0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIC0gMTMpIHsKICAgICAgICAgICAgICBsZWZ0TnVtID0gbGVmdCArIGxlZnRDaGFMUiAtIHNjcm9sbFdpZHRoICsgMTM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY29uc29sZS5sb2cobGVmdCxsZWZ0Q2hhTFIsc2Nyb2xsV2lkdGgsJ2xlZnROdW0gMTExPT09PT09PT09PT09PScpOwogICAgICAgICAgfSBlbHNlIGlmIChvdmVyRmxvd1dpZHRoIDwgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIHx8IHRoaXMuYXBwZW5kVG9Cb2R5ICYmIGxlZnQgPCAwIHx8IHRoaXMuYXBwZW5kVG9Cb2R5ICYmIGxlZnQxIDwgMCB8fCBsZWZ0ICsgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IGxlZnQxICsgcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IG9mZnNldE9iajMubGVmdCA8PSAwIHx8IG9mZnNldE9iajMucmlnaHQgPj0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoKSB7CiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGxlZnQsbGVmdENoYUxSLCdsZWZ0TnVtIDIyPT09PT09PT09PT09PScpCiAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0ICsgbGVmdENoYUxSOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMjInLGxlZnROdW0pCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnbGVmdE51bSAzMycpCiAgICAgICAgICAgIGxlZnROdW0gPSBsZWZ0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aGlzLnBvcFN0eWxlID0gewogICAgICAgICAgbGVmdDogbGVmdE51bSArICdweCcsCiAgICAgICAgICB0b3A6IHRvcE51bQogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJ3BwcHBwcHAnKQogICAgICAgIHRoaXMucG9wU3R5bGUgPSB7CiAgICAgICAgICBsZWZ0OiBsZWZ0ICsgJ3B4JywKICAgICAgICAgIHRvcDogdG9wICsgJ3B4JwogICAgICAgIH07CiAgICAgIH0KICAgICAgLy8gY29uc29sZS5sb2coJzExMScsb3ZlckZsb3dIZWlnaHQsZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCxvZmZzZXRPYmozLnRvcCA8PSAwLG9mZnNldE9iajMuYm90dG9tID49IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpCiAgICAgIGlmICh0aGlzLmFwcGVuZFRvQm9keSAmJiAob3ZlckZsb3dIZWlnaHQgPCBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0IHx8IG92ZXJGbG93V2lkdGggPCBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggfHwgdG9wMSA8IDAgfHwgbGVmdDEgPCAwIHx8IHRvcDEgKyBwb3BwZXJSZWFsaXR5T2Zmc2V0SGVpZ2h0IDwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCB8fCBsZWZ0MSArIHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCA8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCB8fCBvZmZzZXRPYmozLnRvcCA8PSAwIHx8IG9mZnNldE9iajMubGVmdCA8PSAwIHx8IG9mZnNldE9iajMuYm90dG9tID49IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgfHwgb2Zmc2V0T2JqMy5yaWdodCA+PSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgpKSB7CiAgICAgICAgLy8gY29uc29sZS5sb2coJzExMeeureWktCcpCiAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdFRvcCcgfHwgdGhpcy5wbGFjZW1lbnRTdHIgPT09ICdsZWZ0JyB8fCB0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ2xlZnRCb3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRUb3AnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRCb3R0b20nKSB7CiAgICAgICAgICBsZXQgYXJyb3dIZWlnaHRMUjsKICAgICAgICAgIGlmIChvZmZzZXRPYmozLnRvcCA+PSAwKSB7CiAgICAgICAgICAgIGFycm93SGVpZ2h0TFIgPSBoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSA/IC0ocG9wcGVyUmVhbGl0eU9mZnNldEhlaWdodCAvIDIgLSAxMCkgOiBoZWlnaHRDaGFMUjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGFycm93SGVpZ2h0TFIgPSBoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSA/IHBvcHBlclJlYWxpdHlPZmZzZXRIZWlnaHQgLyAyIC0gMTAgOiBoZWlnaHRDaGFMUjsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzIyMicsaGlkZUhlaWdodCxoaWRlSGVpZ2h0ID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0IC8gMiAtIGhpZGVIZWlnaHQgPCAxNSxoZWlnaHRDaGFMUikKICAgICAgICAgIH0KICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGhpZGVIZWlnaHQgPiAyMCwgb3ZlckZsb3dIZWlnaHQgPCByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0LCBhcnJvd0hlaWdodExSLCAnYXJyb3dIZWlnaHRMUicpOwogICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAncmlnaHRCb3R0b20nIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnbGVmdEJvdHRvbScpIHsKICAgICAgICAgICAgdGhpcy5hcnJvd1N0eWxlID0gewogICAgICAgICAgICAgIGJvdHRvbTogb3ZlckZsb3dIZWlnaHQgPCByZWZlcmVuY2Uub2Zmc2V0SGVpZ2h0ID8gYGNhbGMoNTAlIC0gJHthcnJvd0hlaWdodExSfXB4KWAgOiBgY2FsYyg1MCUgLSAke2hlaWdodENoYUxSfXB4KWAKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuYXJyb3dTdHlsZSA9IHsKICAgICAgICAgICAgICB0b3A6IG92ZXJGbG93SGVpZ2h0IDwgcmVmZXJlbmNlLm9mZnNldEhlaWdodCA/IGBjYWxjKDUwJSAtICR7YXJyb3dIZWlnaHRMUn1weClgIDogYGNhbGMoNTAlIC0gJHtoZWlnaHRDaGFMUn1weClgCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxldCBhcnJvd0Rpc3BsYWNlbWVudDsKICAgICAgICAgIGxldCBsZWZ0VW5jaGFuZ2VkOwogICAgICAgICAgaWYgKG9mZnNldE9iajMubGVmdCA+PSAwKSB7CiAgICAgICAgICAgIGFycm93RGlzcGxhY2VtZW50ID0gaGlkZVdpZHRoID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0V2lkdGggLyAyIC0gaGlkZVdpZHRoIDwgMTUgPyAtKHBvcHBlclJlYWxpdHlPZmZzZXRXaWR0aCAvIDIgLSAxMCkgOiBsZWZ0Q2hhTFI7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBhcnJvd0Rpc3BsYWNlbWVudCA9IGhpZGVXaWR0aCA+IDAgJiYgcmVmZXJlbmNlLm9mZnNldFdpZHRoIC8gMiAtIGhpZGVXaWR0aCA8IDE1ID8gcG9wcGVyUmVhbGl0eU9mZnNldFdpZHRoIC8gMiAtIDEwIDogbGVmdENoYUxSOwogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMjIyJyxoaWRlV2lkdGgsaGlkZVdpZHRoID4gMCAmJiByZWZlcmVuY2Uub2Zmc2V0V2lkdGggLyAyIC0gaGlkZVdpZHRoIDwgMTUsbGVmdENoYUxSKQogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2coYGhpZGVXaWR0aDogJHtoaWRlV2lkdGh9IGxlZnROdW06JHtsZWZ0TnVtfSxvdmVyRmxvd1dpZHRoOiR7b3ZlckZsb3dXaWR0aH0scmVmZXJlbmNlLm9mZnNldFdpZHRoOiR7cmVmZXJlbmNlLm9mZnNldFdpZHRofSxsZWZ0Q2hhTFI6JHtsZWZ0Q2hhTFJ9LCBhcnJvd0Rpc3BsYWNlbWVudDoke2Fycm93RGlzcGxhY2VtZW50fWAsICc9PT09Jyk7CiAgICAgICAgICBsZXQgaW5pdGlhbExlZnQgPSAnNTAlJzsKICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudFN0ciA9PT0gJ3RvcExlZnQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAgbGV0IGluaXRpYWxMZWZ0MSA9IDE2OwogICAgICAgICAgICBpbml0aWFsTGVmdCA9IGluaXRpYWxMZWZ0MSArICdweCc7CiAgICAgICAgICAgIGFycm93RGlzcGxhY2VtZW50ID0gaGlkZVdpZHRoID4gMCAmJiBsZWZ0TnVtIDwgMTUgPyBpbml0aWFsTGVmdDEgLSAxMCA6IGxlZnRDaGFMUjsKICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJzIyMi0tLScsIG92ZXJGbG93V2lkdGggPCBpbml0aWFsTGVmdDEgKyAxICsgNSxoaWRlV2lkdGgsIGhpZGVXaWR0aCA+IDAgJiYgbGVmdE51bSA8IDE1LCBsZWZ0Q2hhTFIpOwogICAgICAgICAgICAvLyDlhYPntKDotoXov4fmn5Dlj6/op4bojIPlm7TljLrln5/nrq3lpLTkuI3np7vliqgKICAgICAgICAgICAgaWYgKG92ZXJGbG93V2lkdGggPCBpbml0aWFsTGVmdDEgKyAxMiArIDEgKyA1KSB7CiAgICAgICAgICAgICAgbGVmdFVuY2hhbmdlZCA9IGluaXRpYWxMZWZ0MTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50U3RyID09PSAndG9wUmlnaHQnIHx8IHRoaXMucGxhY2VtZW50U3RyID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICAgIGxldCBpbml0aWFsTGVmdDEgPSBwb3BwZXJSZWFsaXR5T2Zmc2V0V2lkdGggLSAxNiAtIDEyOwogICAgICAgICAgICBpbml0aWFsTGVmdCA9IGluaXRpYWxMZWZ0MSArICdweCc7CiAgICAgICAgICAgIGFycm93RGlzcGxhY2VtZW50ID0gbGVmdENoYUxSOwogICAgICAgICAgICAvLyDlhYPntKDlj7PkvqfotoXov4flj6/op4bojIPlm7TljLrln5/miJblt6bkvqfljLrln5/lhoXlrr3luqblsI/kuo7mn5DlgLzml7Yg566t5aS05LiN56e75YqoCiAgICAgICAgICAgIGlmIChvZmZzZXRPYmozLnJpZ2h0ID4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoIHx8IG92ZXJGbG93V2lkdGggPCA1ICsgMTYgKyAxMiArIDEwKSB7CiAgICAgICAgICAgICAgbGVmdFVuY2hhbmdlZCA9IGluaXRpYWxMZWZ0MTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2luaXRpYWxMZWZ0JywgaW5pdGlhbExlZnQsICcgbGVmdFVuY2hhbmdlZDonLCBsZWZ0VW5jaGFuZ2VkLCAnIGFycm93RGlzcGxhY2VtZW50OicsIGFycm93RGlzcGxhY2VtZW50LCBvdmVyRmxvd1dpZHRoIDwgcmVmZXJlbmNlLm9mZnNldFdpZHRoLCBoaWRlV2lkdGggPiAwICYmIGxlZnROdW0gPCAxNSk7CiAgICAgICAgICBsZXQgYXJyb3dMZWZ0ID0gbGVmdFVuY2hhbmdlZCA/IGxlZnRVbmNoYW5nZWQgOiBvdmVyRmxvd1dpZHRoIDwgcmVmZXJlbmNlLm9mZnNldFdpZHRoID8gYGNhbGMoJHtpbml0aWFsTGVmdH0gLSAke2Fycm93RGlzcGxhY2VtZW50fXB4KWAgOiBgY2FsYygke2luaXRpYWxMZWZ0fSAtICR7bGVmdENoYUxSfXB4KWA7CiAgICAgICAgICBpZiAobGVmdFBvcykgewogICAgICAgICAgICB0aGlzLmFycm93U3R5bGUgPSB7CiAgICAgICAgICAgICAgbGVmdDogYXJyb3dMZWZ0CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgLy8g5Yqo5oCB5Yik5patcGxhY2VtZW506K+l5Li65LuA5LmI5YC8CiAgICBwbGFjZW1lbnRTdHJGdW4ocmVmZXJlbmNlLCBwb3BwZXIpIHsKICAgICAgLy8gY29uc29sZS5sb2cocG9wcGVyLCAncG9wcGVyLS0nKTsKICAgICAgLy8gbGV0IG9mZnNldE9iajIgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocmVmZXJlbmNlKTsKICAgICAgbGV0IG9mZnNldE9iajI7CiAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09ICdIVE1MJykgewogICAgICAgIG9mZnNldE9iajIgPSB0aGlzLmdldEJvdW5kaW5nQ2xpZW50UmVjdDIocmVmZXJlbmNlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvZmZzZXRPYmoyID0gdGhpcy5nZXRPZmZzZXRSZWN0UmVsYXRpdmVUb0N1c3RvbVBhcmVudChyZWZlcmVuY2UsIHRoaXMuZ2V0T2Zmc2V0UGFyZW50KHBvcHBlciksIGZhbHNlKTsKICAgICAgfQogICAgICBsZXQgc3BhY2VUb3AgPSBvZmZzZXRPYmoyPy50b3A7CiAgICAgIGxldCBzcGFjZUJvdHRvbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLSBvZmZzZXRPYmoyPy5ib3R0b207CiAgICAgIGxldCBzcGFjZUxlZnQgPSBvZmZzZXRPYmoyPy5sZWZ0OwogICAgICBsZXQgc3BhY2VSaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIG9mZnNldE9iajI/LnJpZ2h0OwogICAgICAvLyBjb25zb2xlLmxvZyhvZmZzZXRPYmoyLCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGgsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsICdvZmZzZXRPYmoyJyk7CiAgICAgIC8vIGNvbnNvbGUubG9nKCcgc3BhY2VUb3A6Jywgc3BhY2VUb3AsICcgc3BhY2VCb3R0b206Jywgc3BhY2VCb3R0b20sICcgc3BhY2VMZWZ0OicsIHNwYWNlTGVmdCwgJyBzcGFjZVJpZ2h0OicsIHNwYWNlUmlnaHQsICcgdGhpcy5wb3BwZXJJbml0aWFsV2lkdGg6JywgdGhpcy5wb3BwZXJJbml0aWFsV2lkdGgsICcgdGhpcy5wb3BwZXJJbml0aWFsSGVpZ2h0OicsIHRoaXMucG9wcGVySW5pdGlhbEhlaWdodCwgJy0tLS0tJyk7CiAgICAgIGlmICh0aGlzLmFwcGVuZFRvQm9keSkgewogICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3JpZ2h0VG9wJyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ3JpZ2h0JyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ3JpZ2h0Qm90dG9tJykgewogICAgICAgICAgLy8gdGhpcy5wbGFjZW1lbnRTdHIgPSAncmlnaHQnOwogICAgICAgICAgLy8gaWYgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aCAtIG9mZnNldE9iajIucmlnaHQgPCB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCkgewogICAgICAgICAgLy8gICB0aGlzLnBsYWNlbWVudFN0ciA9ICdsZWZ0JzsKICAgICAgICAgIC8vIH0KICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxXaWR0aCA+IHNwYWNlUmlnaHQgLSAxNSkgewogICAgICAgICAgICBpZiAodGhpcy5wb3BwZXJJbml0aWFsV2lkdGggPD0gc3BhY2VMZWZ0ICsgMTUpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCA9IHNwYWNlTGVmdDsKICAgICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdsZWZ0JzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzcGFjZUxlZnQgPiBzcGFjZVJpZ2h0KSB7CiAgICAgICAgICAgICAgdGhpcy5jb250cmFyeUhvcml6b250YWwgPSBzcGFjZUxlZnQ7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnbGVmdCc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5jb250cmFyeUhvcml6b250YWwgPSBzcGFjZVJpZ2h0OwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3JpZ2h0JzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdsZWZ0VG9wJyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ2xlZnQnIHx8IHRoaXMucGxhY2VtZW50ID09PSAnbGVmdEJvdHRvbScpIHsKICAgICAgICAgIC8vIHRoaXMucGxhY2VtZW50U3RyID0gJ2xlZnQnOwogICAgICAgICAgLy8gaWYgKG9mZnNldE9iajIubGVmdCA8IHRoaXMuY29udHJhcnlIb3Jpem9udGFsKSB7CiAgICAgICAgICAvLyAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3JpZ2h0JzsKICAgICAgICAgIC8vIH0KICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxXaWR0aCA+IHNwYWNlTGVmdCAtIDE1KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxXaWR0aCA8PSBzcGFjZVJpZ2h0ICsgMTUpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCA9IHNwYWNlUmlnaHQ7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAncmlnaHQnOwogICAgICAgICAgICB9IGVsc2UgaWYgKHNwYWNlUmlnaHQgPiBzcGFjZUxlZnQpIHsKICAgICAgICAgICAgICB0aGlzLmNvbnRyYXJ5SG9yaXpvbnRhbCA9IHNwYWNlUmlnaHQ7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAncmlnaHQnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlIb3Jpem9udGFsID0gc3BhY2VMZWZ0OwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2xlZnQnOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcCcgfHwgdGhpcy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0JyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wJzsKICAgICAgICAgIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcExlZnQnKSB7CiAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcExlZnQnOwogICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICd0b3BSaWdodCc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodGhpcy5wb3BwZXJJbml0aWFsSGVpZ2h0ID4gc3BhY2VUb3AgLSAxNSkgewogICAgICAgICAgICBpZiAodGhpcy5wb3BwZXJJbml0aWFsSGVpZ2h0IDw9IHNwYWNlQm90dG9tICsgMTUpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMTExLS0tLS0tLS0tLS0tLS0tLT09PT09PT09PT09PT0nKQogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlQm90dG9tOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbSc7CiAgICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAndG9wTGVmdCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbUxlZnQnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BSaWdodCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbVJpZ2h0JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BhY2VCb3R0b20gPiBzcGFjZVRvcCkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCcyMjItLS0tLS0tLS0tLS0tLS0tPT09PT09PT09PT09PScpCiAgICAgICAgICAgICAgdGhpcy5jb250cmFyeVZlcnRpY2FsID0gc3BhY2VCb3R0b207CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tJzsKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BMZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ3RvcFJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnMzMzLS0tLS0tLS0tLS0tLS0tLT09PT09PT09PT09PT0nKQogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlVG9wOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcCc7CiAgICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAndG9wTGVmdCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcExlZnQnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICd0b3BSaWdodCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcFJpZ2h0JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tJyB8fCB0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbUxlZnQnIHx8IHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICB0aGlzLnBsYWNlbWVudFN0ciA9ICdib3R0b20nOwogICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAnYm90dG9tTGVmdCc7CiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tUmlnaHQnKSB7CiAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbVJpZ2h0JzsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQgPiBzcGFjZUJvdHRvbSAtIDE1KSB7CiAgICAgICAgICAgIGlmICh0aGlzLnBvcHBlckluaXRpYWxIZWlnaHQgPD0gc3BhY2VUb3AgKyAxNSkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlVG9wOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcCc7CiAgICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcExlZnQnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ3RvcFJpZ2h0JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3BhY2VCb3R0b20gPiBzcGFjZVRvcCkgewogICAgICAgICAgICAgIHRoaXMuY29udHJhcnlWZXJ0aWNhbCA9IHNwYWNlQm90dG9tOwogICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbSc7CiAgICAgICAgICAgICAgaWYgKHRoaXMucGxhY2VtZW50ID09PSAnYm90dG9tTGVmdCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbUxlZnQnOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21SaWdodCcpIHsKICAgICAgICAgICAgICAgIHRoaXMucGxhY2VtZW50U3RyID0gJ2JvdHRvbVJpZ2h0JzsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5jb250cmFyeVZlcnRpY2FsID0gc3BhY2VUb3A7CiAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wJzsKICAgICAgICAgICAgICBpZiAodGhpcy5wbGFjZW1lbnQgPT09ICdib3R0b21MZWZ0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wTGVmdCc7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnBsYWNlbWVudCA9PT0gJ2JvdHRvbVJpZ2h0JykgewogICAgICAgICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHIgPSAndG9wUmlnaHQnOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnBsYWNlbWVudFN0ciwgJ3RoaXMucGxhY2VtZW50U3RyJyk7CiAgICAgICAgaWYgKG9mZnNldE9iajIucmlnaHQgPj0gMCAmJiBvZmZzZXRPYmoyLmxlZnQgPD0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoICYmIG9mZnNldE9iajIudG9wIDw9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgJiYgb2Zmc2V0T2JqMi5ib3R0b20gPj0gMCkgewogICAgICAgICAgdGhpcy5wb3BXaWR0aEhlaWdodEZ1bihyZWZlcmVuY2UsIHBvcHBlcik7CiAgICAgICAgfQogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMucGxhY2VtZW50U3RyLCAncGxhY2VtZW50U3RyJyk7CiAgICAgIH0KICAgIH0sCiAgICBjb21wdXRlUG9zaXRpb24oKSB7CiAgICAgIGxldCByZWZlcmVuY2UgPSB0aGlzLmdldFJlZmVyZW5jZSgpOwogICAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgICAgdGhpcy5oYW5kbGVTY3JvbGwocmVmZXJlbmNlLCBwb3BwZXIpOwogICAgfSwKICAgIC8vIOa1j+iniOWZqOa7muWKqOS6i+S7tgogICAgaGFuZGxlU2Nyb2xsKHJlZmVyZW5jZSwgcG9wcGVyKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdoYW5kbGVTY3JvbGwnLHJlZmVyZW5jZSwgcG9wcGVyKTsKICAgICAgaWYgKCF0aGlzLmRpc2FibGVkICYmIHRoaXMuc2hvd1BvcHBlcikgewogICAgICAgIGxldCBzY3JvbGxUb3AgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wOwogICAgICAgIGxldCBzY3JvbGxMZWZ0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0OwogICAgICAgIGlmICh0aGlzLnRhZ05hbWUgPT09ICdESVYnKSB7CiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh0aGlzLnRhcmdldC5zY3JvbGxUb3AsdGhpcy50YXJnZXQuc2Nyb2xsTGVmdCwnaGFuZGxlU2Nyb2xsJyk7CiAgICAgICAgICBzY3JvbGxUb3AgPSB0aGlzLnRhcmdldC5zY3JvbGxUb3A7CiAgICAgICAgICBzY3JvbGxMZWZ0ID0gdGhpcy50YXJnZXQuc2Nyb2xsTGVmdDsKICAgICAgICB9CiAgICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZVNjcm9sbCcsICBzY3JvbGxUb3AsIHNjcm9sbExlZnQpOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5wbGFjZW1lbnRTdHJGdW4ocmVmZXJlbmNlLCBwb3BwZXIpOwogICAgICAgIH0sIDApOwogICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZVNjcm9sbCcsZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sdGlwSWQpKTsKICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2x0aXBJZCkpIHsKICAgICAgICAgICAgdGhpcy5wb3NpdGlvbkZ1bihyZWZlcmVuY2UsIHBvcHBlciwgc2Nyb2xsVG9wLCBzY3JvbGxMZWZ0KTsKICAgICAgICAgIH0KICAgICAgICB9LCA1KTsKICAgICAgfQogICAgfSwKICAgIGRvVG9nZ2xlKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZG9Ub2dnbGUnKTsKICAgICAgdGhpcy5zaG93UG9wcGVyID0gIXRoaXMuc2hvd1BvcHBlcjsKICAgIH0sCiAgICBjcmVhdERPTSgpIHsKICAgICAgY29uc3QgYU5vZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRvb2x0aXBJZCk7CiAgICAgIC8vIOeEtuWQjuWIpOaWreivpeWFg+e0oOiKgueCueaYr+S4jeaYr+W9k+WJjeaWh+aho+mhtemdomJvZHnoioLngrnnmoTlkI7ku6MKICAgICAgLy8gY29uc29sZS5sb2coYU5vZGUsIGFOb2RlLnBhcmVudE5vZGUudGFnTmFtZSwgJ2FOb2RlJyk7CiAgICAgIGlmIChhTm9kZS5wYXJlbnROb2RlLnRhZ05hbWUudG9VcHBlckNhc2UoKSAhPT0gJ0JPRFknKSB7CiAgICAgICAgY29uc3QgcG9wcGVyID0gdGhpcy5wb3BwZXIgfHwgdGhpcy4kcmVmcy5wb3BwZXI7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChwb3BwZXIpOwogICAgICB9CiAgICB9LAogICAgcmVtb3ZlRE9NKCkgewogICAgICBjb25zdCBwb3BwZXIgPSB0aGlzLnBvcHBlciB8fCB0aGlzLiRyZWZzLnBvcHBlcjsKICAgICAgLy8gY29uc29sZS5sb2cocG9wcGVyLCAncG9wcGVyIHJlbW92ZURPTScpOwogICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHBvcHBlcik7CiAgICB9LAogICAgZG9TaG93KCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZG9TaG93LS0tLS0tLS0nKTsKICAgICAgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgIH0sCiAgICBkb0Nsb3NlKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnZG9DbG9zZS0tLS0tLS0tJyk7CiAgICAgIHRoaXMuc2hvd1BvcHBlciA9IGZhbHNlOwogICAgfSwKICAgIGhhbmRsZUZvY3VzKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlRm9jdXMtLS0tLS0tLScpOwogICAgICBpZiAodGhpcy50cmlnZ2VyID09PSAnY2xpY2snIHx8IHRoaXMudHJpZ2dlciA9PT0gJ2ZvY3VzJykgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgIH0sCiAgICBoYW5kbGVDbGljaygpIHsKICAgIH0sCiAgICBoYW5kbGVCbHVyKCkgewogICAgICAvLyBjb25zb2xlLmxvZygnaGFuZGxlQmx1ci0tLS0tLS0tJyk7CiAgICAgIGlmICh0aGlzLnRyaWdnZXIgPT09ICdjbGljaycgfHwgdGhpcy50cmlnZ2VyID09PSAnZm9jdXMnKSB0aGlzLnNob3dQb3BwZXIgPSBmYWxzZTsKICAgIH0sCiAgICBoYW5kbGVLZXlkb3duKGV2KSB7CiAgICAgIGlmIChldi5rZXlDb2RlID09PSAyNyAmJiB0aGlzLnRyaWdnZXIgIT09ICdtYW51YWwnKSB7IC8vIGVzYwogICAgICAgIHRoaXMuZG9DbG9zZSgpOwogICAgICB9CiAgICB9LAogICAgaGFuZGxlTW91c2VFbnRlcigpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZU1vdXNlRW50ZXItLS0tLS0tLScpOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpOwogICAgICBpZiAodGhpcy5vcGVuRGVsYXkpIHsKICAgICAgICB0aGlzLl90aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgICAgICB9LCB0aGlzLm9wZW5EZWxheSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIGhhbmRsZU1vdXNlTGVhdmUoKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCdoYW5kbGVNb3VzZUxlYXZlLS0tLS0tLScpOwogICAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZXIpOwogICAgICBpZiAodGhpcy5jbG9zZURlbGF5KSB7CiAgICAgICAgdGhpcy5fdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIHRoaXMuc2hvd1BvcHBlciA9IGZhbHNlOwogICAgICAgIH0sIHRoaXMuY2xvc2VEZWxheSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93UG9wcGVyID0gZmFsc2U7CiAgICAgIH0KICAgIH0sCiAgICBoYW5kbGVEb2N1bWVudENsaWNrKGUpIHsKICAgICAgLy8gY29uc29sZS5sb2coJ2hhbmRsZURvY3VtZW50Q2xpY2snKTsKICAgICAgbGV0IHJlZmVyZW5jZSA9IHRoaXMuZ2V0UmVmZXJlbmNlKCk7CiAgICAgIGNvbnN0IHBvcHBlciA9IHRoaXMucG9wcGVyIHx8IHRoaXMuJHJlZnMucG9wcGVyOwogICAgICBpZiAoIXRoaXMuJGVsIHx8CiAgICAgICAgIXJlZmVyZW5jZSB8fAogICAgICAgIHRoaXMuJGVsLmNvbnRhaW5zKGUudGFyZ2V0KSB8fAogICAgICAgIHJlZmVyZW5jZS5jb250YWlucyhlLnRhcmdldCkgfHwKICAgICAgICAhcG9wcGVyIHx8CiAgICAgICAgcG9wcGVyLmNvbnRhaW5zKGUudGFyZ2V0KSkgcmV0dXJuOwogICAgICB0aGlzLnNob3dQb3BwZXIgPSBmYWxzZTsKICAgIH0sCiAgICBjbGVhbnVwKCkgewogICAgICBpZiAodGhpcy5vcGVuRGVsYXkgfHwgdGhpcy5jbG9zZURlbGF5KSB7CiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3RpbWVyKTsKICAgICAgfQogICAgfSwKICAgIG9mZihlbGVtZW50LCBldmVudCwgaGFuZGxlcikgewogICAgICAvLyBjb25zb2xlLmxvZyhlbGVtZW50LCdvZmYnKTsKICAgICAgaWYgKGVsZW1lbnQgJiYgZXZlbnQpIHsKICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIGZhbHNlKTsKICAgICAgfQogICAgfSwKICAgIG9uKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyLCAnb24nKTsKICAgICAgaWYgKGVsZW1lbnQgJiYgZXZlbnQgJiYgaGFuZGxlcikgewogICAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlciwgZmFsc2UpOwogICAgICB9CiAgICB9CiAgfQp9Owo="},{"version":3,"sources":["popover.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"popover.vue","sourceRoot":"packages/popover/src","sourcesContent":["<template>\n  <div :class=\"['disInB', appendToBody ? '' : 'posR']\" :id=\"tooltipIdParent\">\n    <div\n      :id=\"tooltipId\" ref=\"popper\"\n      :class=\"[\n          'dj-popover',\n          'dj-popover-placement-' + placementStr,\n          appendToBody ? 'posF dj-popover-posF' : '',\n          className\n        ]\"\n      :style=\"{\n        width: width + 'px',\n        ...popStyle ,\n        maxWidth:popWHStyle.maxWidth + 'px',\n        maxHeight:popWHStyle.maxHeight + 'px',\n        visibility: !disabled && showPopper? 'unset' : 'hidden',\n        display: displayStatus,\n        opacity: opacity,\n        zIndex: zIndex,\n        pointerEvents: opacity ? 'auto' : 'none'\n      }\"\n    >\n      <!--opacity: !disabled && showPopper ? 1 : 0-->\n      <div class=\"dj-popover-content\"\n           :style=\"{\n             maxWidth:popWHStyle.maxWidth + 'px',\n             maxHeight:popWHStyle.maxHeight - 10 + 'px'\n           }\"\n      >\n        <div class=\"dj-popover-arrow\" :style=\"{...arrowStyle}\"><span class=\"dj-popover-arrow-content\"></span></div>\n        <div class=\"dj-popover-inner\" role=\"tooltip\"\n             :style=\"{\n               maxWidth:popWHStyle.maxWidth + 'px',\n               maxHeight:popWHStyle.maxHeight - 10 + 'px'\n             }\"\n        >\n          <!--<div class=\"dj-popover-title\">{{title}}</div>-->\n          <div class=\"dj-popover-title\" :id=\"tooltipId + '-title'\" v-if=\"title\" v-text=\"title\"></div>\n          <div class=\"dj-popover-inner-content\">\n            <div class=\"overY\" :id=\"tooltipId + '-content'\">\n              <slot name=\"content\">\n                <div class=\"dj-popover-desc\">{{content}}</div>\n              </slot>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <slot name=\"default\"></slot>\n  </div>\n</template>\n\n<script>\nfunction removePop(self) {\n  // console.log(this, self,'this');\n  // console.log(self.tooltipId, self.tooltipIdParent, 'handleDocumentClick');\n  // console.log(document.getElementById(self.tooltipIdParent), 'handleDocumentClick');\n  if (!document.getElementById(self.tooltipIdParent) && document.getElementById(self.tooltipId)) {\n    document.body.removeChild(document.getElementById(self.tooltipId));\n    // console.log('removeEventListener');\n    // document.removeEventListener('click', removePop(self), false);\n  }\n}\n\nexport default {\n  name: 'djPopover',\n  props: {\n    title: String,\n    content: String,\n    reference: {},\n    popper: {},\n    disabled: Boolean,\n    width: {},\n    className: {\n      type: String,\n      default: ''\n    },\n    zIndex: {\n      type: Number,\n      default: 79\n    },\n    placement: {\n      type: String,\n      default: 'top'\n    },\n    visible: {\n      type: Boolean,\n      default: false\n    },\n    trigger: {\n      type: String,\n      default: 'click',\n      validator: value => ['click', 'focus', 'hover', 'manual'].indexOf(value) > -1 || value === ''\n    },\n    openDelay: {\n      type: Number,\n      default: 0\n    },\n    closeDelay: {\n      type: Number,\n      default: 200\n    },\n    // 是否插入到body\n    appendToBody: {\n      type: Boolean,\n      default: false\n    },\n    tabindex: {\n      type: Number,\n      default: 0\n    },\n    notParentClass: {// 为了让自定义的父级有overflow auto时，让他不为父级元素\n      type: String,\n      default: ''\n    }\n    // contraryVertical: {\n    //   type: Number,\n    //   default: 100\n    // },\n    // contraryHorizontal: {\n    //   type: Number,\n    //   default: 250\n    // }\n  },\n  data() {\n    return {\n      popStyle: {},\n      popWHStyle: {},\n      arrowStyle: {},\n      showPopper: false,\n      opacity: 0,\n      displayStatus: 'none',\n      contentMaxHeight: '',\n      placementStr: '',\n      tagName: '',\n      target: null,\n      contraryVertical: 100,\n      contraryHorizontal: 250,\n      popperInitialWidth: '',\n      popperInitialHeight: ''\n    };\n  },\n  components: {},\n  computed: {\n    tooltipId() {\n      return `dj-popover-${Math.floor(Math.random() * 10000)}`;\n    },\n    tooltipIdParent() {\n      return `dj-popover-${Math.floor(Math.random() * 10000)}-parent`;\n    }\n  },\n  watch: {\n    visible: {\n      immediate: true,\n      handler(val) {\n        // console.log(val, 'visible');\n        if (this.disabled) {\n          return;\n        }\n        this.showPopper = val;\n      }\n    },\n    showPopper: {\n      immediate: true,\n      handler(val) {\n        // console.log(val, 'showPopper');\n        if (this.disabled) {\n          return;\n        }\n        this.$emit('update:visible', val);\n        if (this.appendToBody) {\n          if (val) {\n            this.creatDOM();\n          } else {\n            /* setTimeout(() => {\n             this.removeDOM();\n             }, 300);*/\n          }\n        }\n        if (!this.disabled && val) {\n          this.placementStr = this.placement;\n          this.displayStatus = 'block';\n          let reference;\n          const popper = this.popper || this.$refs.popper;\n          setTimeout(() => {\n            reference = this.getReference();\n            // console.log(reference,'reference这里啊');\n            if (!this.popperInitialWidth && !this.popperInitialHeight) {\n              this.popperInitialWidth = popper?.offsetWidth;\n              this.popperInitialHeight = popper?.offsetHeight;\n            }\n            // console.log(this.popperInitialWidth, this.popperInitialHeight, 'popperInitialWidth');\n            // console.log(popper.clientHeight);\n          });\n          // return;\n          setTimeout(() => {\n            this.placementStrFun(reference, popper);\n          }, 2);\n          if (this.appendToBody) {\n            // this.opacity = 1;\n            setTimeout(() => {\n              this.popWidthHeightFun(reference, popper);\n            }, 5);\n          }\n          setTimeout(() => {\n            this.opacity = 1;\n            this.positionFun(reference, popper);\n          }, 10);\n        } else {\n          this.opacity = 0;\n          /* setTimeout(() => {\n           this.displayStatus = 'none';\n           // console.log(val,'display:none');\n           }, 300);*/\n        }\n      }\n    }\n  },\n  created() {\n    window.addEventListener('popstate', this.popstate, false);\n  },\n  mounted() {\n    // console.log('mounted');\n    const popper = this.popper || this.$refs.popper;\n    let reference = this.getReference();\n    let target = this.getScrollParent(reference);\n    // console.log(reference, popper, '==== mounted');\n    // console.log(target, target?.tagName, this.$slots, '==== mounted');\n    this.tagName = target?.tagName || '';\n    this.target = target || null;\n    if (this.tagName === 'HTML') {\n      target = window;\n      // document.getElementById(this.tooltipId).classList.add(\"posA\");\n    }\n    // console.log(target, this.target, '==== mounted22');\n    // 可访问性\n    if (reference) {\n      // reference.setAttribute('tabindex', this.tabindex); // tab序列\n      this.positionFun(reference, popper);\n      if (this.trigger !== 'click') {\n        // console.log(reference, '测试0000');\n        this.on(reference, 'focusin', () => {\n          // console.log('222222222');\n          this.handleFocus();\n          const instance = reference.__vue__;\n          if (instance && typeof instance.focus === 'function') {\n            instance.focus();\n          }\n        });\n        this.on(popper, 'focusin', this.handleFocus);\n        this.on(reference, 'focusout', this.handleBlur);\n        this.on(popper, 'focusout', this.handleBlur);\n        // console.log('测试1111');\n      }\n      this.on(reference, 'keydown', this.handleKeydown);\n      this.on(reference, 'click', this.handleClick);\n    }\n    this.on(target, 'scroll', () => this.handleScroll(reference, popper));\n    if (this.trigger === 'click') {\n      // console.log('1111');\n      this.on(reference, 'click', this.doToggle);\n      // console.log(2222,document,this);\n      this.on(document, 'click', this.handleDocumentClick);\n      // document.addEventListener('click', removePop(this), false);\n    } else if (this.trigger === 'hover') {\n      this.on(reference, 'mouseenter', this.handleMouseEnter);\n      this.on(popper, 'mouseenter', this.handleMouseEnter);\n      this.on(reference, 'mouseleave', this.handleMouseLeave);\n      this.on(popper, 'mouseleave', this.handleMouseLeave);\n    } else if (this.trigger === 'focus') {\n      if (reference.querySelector('input, textarea')) {\n        this.on(reference, 'focusin', this.doShow);\n        this.on(reference, 'focusout', this.doClose);\n        // console.log('input, textarea');\n        // console.log('111111');\n      } else {\n        this.on(reference, 'mousedown', this.doShow);\n        this.on(reference, 'mouseup', this.doClose);\n        // console.log('222222');\n      }\n    }\n  },\n  beforeDestroy() {\n    this.cleanup();\n    removePop(this);\n    let reference = this.getReference();\n    // console.log(reference,'reference');\n    this.off(reference, 'click', this.doToggle);\n    this.off(reference, 'mouseup', this.doClose);\n    this.off(reference, 'mousedown', this.doShow);\n    this.off(reference, 'focusin', this.doShow);\n    this.off(reference, 'focusout', this.doClose);\n    this.off(reference, 'mousedown', this.doShow);\n    this.off(reference, 'mouseup', this.doClose);\n    this.off(reference, 'mouseleave', this.handleMouseLeave);\n    this.off(reference, 'mouseenter', this.handleMouseEnter);\n    this.off(document, 'click', this.handleDocumentClick);\n    // document.removeEventListener('click', removePop(this), false);\n    this.off(window, 'scroll', this.handleScroll);\n  },\n  methods: {\n    // 获取reference\n    getReference() {\n      let reference = this.reference || this.$refs.reference;\n      if (!reference && this.$slots.default && this.$slots.default[0]) {\n        // reference = this.$slots.default[0].elm;\n        for (let i in this.$slots.default) {\n          // console.log(this.$slots.default[i].elm instanceof Element, 'ssss',i);\n          if (this.$slots.default[i].elm instanceof Element) {\n            reference = this.$slots.default[i].elm;\n            break;\n          }\n        }\n      }\n      return reference;\n    },\n    popstate() {\n      // this.showPopper=false;\n      let els = document.getElementsByClassName('dj-popover-posF');\n      // console.log(els,'els');\n      if (els) {\n        for (let i = 0; i < els.length; i++) {\n          // console.log(els[i].parentNode,'父级');\n          if (els[i].parentNode.tagName === 'BODY') {\n            // console.log('body父级');\n            document.body.removeChild(els[i]);\n          }\n        }\n      }\n    },\n    // 获取某元素以浏览器左上角为原点的坐标\n    getPoint(el) {\n      let offsetTop = 0;\n      let offsetLeft = 0;\n      while (el && el.tagName !== 'BODY') {\n        offsetTop += el.offsetTop;\n        offsetLeft += el.offsetLeft;\n        el = el.offsetParent;\n      }\n      let offsetObj = {\n        offsetTop: offsetTop,\n        offsetLeft: offsetLeft\n      };\n      // console.log(offsetObj, 'getPoint');\n      return offsetObj;\n    },\n    // 用于获取某个元素相对于parent的位置集合\n    getOffsetRectRelativeToCustomParent(element, parent, fixed) {\n      var elementRect = this.getBoundingClientRect2(element);\n      var parentRect = this.getBoundingClientRect2(parent);\n\n      if (fixed) {\n        var scrollParent = this.getScrollParent(parent);\n        parentRect.top += scrollParent.scrollTop;\n        parentRect.bottom += scrollParent.scrollTop;\n        parentRect.left += scrollParent.scrollLeft;\n        parentRect.right += scrollParent.scrollLeft;\n      }\n\n      var rect = {\n        top: elementRect.top - parentRect.top,\n        left: elementRect.left - parentRect.left,\n        bottom: elementRect.top - parentRect.top + elementRect.height,\n        right: elementRect.left - parentRect.left + elementRect.width,\n        width: elementRect.width,\n        height: elementRect.height\n      };\n      // console.log(rect, elementRect, parentRect, 'getOffsetRectRelativeToCustomParent');\n      return rect;\n    },\n    // 获取滚动父级\n    getScrollParent(element) {\n      var root = window;\n      var parent = element?.parentNode;\n      // console.log(element, parent, 'getScrollParent');\n\n      if (!parent) {\n        return element;\n      }\n\n      if (parent === root.document) {\n        // Firefox puts the scrollTOp value on `documentElement` instead of `body`, we then check which of them is\n        // greater than 0 and return the proper element\n        if (root.document.body.scrollTop || root.document.body.scrollLeft) {\n          return root.document.body;\n        }\n        return root.document.documentElement;\n      }\n\n      // Firefox want us to check `-x` and `-y` variations as well\n      if (\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow')) !== -1 ||\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow-x')) !== -1 ||\n        ['scroll', 'auto'].indexOf(this.getStyleComputedProperty(parent, 'overflow-y')) !== -1\n      ) {\n        // If the detected scrollParent is body, we perform an additional check on its parentNode\n        // in this way we'll get body if the browser is Chrome-ish, or documentElement otherwise\n        // fixes issue #65\n        // console.log( parent?.className,'parent className');\n        // console.log( parent?.classList,'parent classList');\n        let className = parent?.getAttribute('class');\n        if (className?.indexOf('dj-table-panel') > -1 || className?.indexOf('dj-modal-content') > -1) {\n          // console.log('=====');\n          return this.getScrollParent(parent);\n        }\n        if (this.notParentClass && parent?.getAttribute('class') === this.notParentClass) {\n          // console.log('=====');\n          return this.getScrollParent(parent);\n        }\n        // console.log(parent, 'parent222');\n        return parent;\n      }\n      return this.getScrollParent(element?.parentNode);\n    },\n    // 获取距离该子元素最近的进行过定位的父元素\n    getOffsetParent(element) {\n      // NOTE: 1 DOM access here\n      var root = window;\n      var offsetParent = element?.offsetParent;\n      // console.log(element, offsetParent, offsetParent === root.document.body || !offsetParent ? root.document.documentElement : offsetParent, 'getOffsetParent');\n      return offsetParent === root?.document?.body || !offsetParent ? root?.document?.documentElement : offsetParent;\n    },\n    // 获取元素最终样式，包括了内联样式、嵌入样式和外部样式\n    getStyleComputedProperty(element, property) {\n      // NOTE: 1 DOM access here\n      var root = window;\n      var css = root.getComputedStyle(element, null);\n      return css[property];\n    },\n    // 用于获取某个元素相对于视窗的位置集合\n    getBoundingClientRect2(element) {\n      let rect = element?.getBoundingClientRect();\n      // console.log(element, rect, 'rect');\n      // whether the IE version is lower than 11\n      let isIE = navigator.userAgent.indexOf('MSIE') != -1;\n\n      // fix ie document bounding top always 0 bug\n      let rectTop = isIE && element?.tagName === 'HTML' ? -element?.scrollTop : rect?.top;\n\n      let param = {\n        left: rect?.left,\n        top: rectTop,\n        right: rect?.right,\n        bottom: rect?.bottom,\n        width: rect?.right - rect?.left,\n        height: rect?.bottom - rectTop\n      };\n      // console.log(param, 'getBoundingClientRect2');\n      // console.log(document.documentElement.clientWidth, document.documentElement.clientHeight, window.innerWidth, window.innerHeight, 'getBoundingClientRect');\n      return param;\n    },\n    // 获取title宽高\n    getTitleStyle() {\n      let dom = document.getElementById(this.tooltipId + '-title');\n      if (dom) {\n        let divOffsetWidth = dom.offsetWidth; // 元素的宽度包含padding和border\n        let divOffsetHeight = dom.offsetHeight; // 元素的宽度包含padding和border\n        // console.log(divOffsetWidth, divOffsetHeight, 'getTitleStyle');\n        return {\n          width: divOffsetWidth,\n          height: divOffsetHeight\n        };\n      }\n    },\n    // 获取pop最大最小宽度\n    popWidthHeightFun(reference, popper) {\n      // console.log('popWidthHeightFun');\n      let offsetObj2 = this.getBoundingClientRect2(reference);\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        // offsetObj2 = getOffsetRectRelativeToCustomParent(reference, getOffsetParent(popper), false);\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.target, false);\n      }\n      let maxWidth, maxHeight;\n      if (this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'leftTop') {\n        maxWidth = offsetObj2.left - 10;\n        maxHeight = document.documentElement.clientHeight - 10;\n      }\n      if (this.placementStr === 'right' || this.placementStr === 'rightBottom' || this.placementStr === 'rightTop') {\n        maxWidth = document.documentElement.clientWidth - offsetObj2.right - 10;\n        maxHeight = document.documentElement.clientHeight - 10;\n      }\n      if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight') {\n        maxWidth = document.documentElement.clientWidth - 10;\n        maxHeight = offsetObj2.top - 15;\n      }\n      if (this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n        maxWidth = document.documentElement.clientWidth - 10;\n        maxHeight = document.documentElement.clientHeight - offsetObj2.bottom - 10;\n      }\n      this.popWHStyle = {\n        maxWidth: maxWidth,\n        maxHeight: maxHeight\n      };\n    },\n    // 获取pop content应该减的值\n    getContentCha() {\n      // console.log(this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content').parentNode.parentNode,'border-bottom-width'),'---');\n      let PT = this.getStyleComputedProperty(document.getElementById(this.tooltipId), 'padding-top')\n        ?.split('px')[0] || 0;\n      let PB = this.getStyleComputedProperty(document.getElementById(this.tooltipId), 'padding-bottom')\n        ?.split('px')[0] || 0;\n      let contentPT = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode, 'padding-top')\n        ?.split('px')[0] || 0;\n      let contentPB = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode, 'padding-bottom')\n        ?.split('px')[0] || 0;\n      let bbw = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode?.parentNode, 'border-bottom-width')\n        ?.split('px')[0] || 0;\n      let btw = this.getStyleComputedProperty(document.getElementById(this.tooltipId + '-content')?.parentNode?.parentNode, 'border-top-width')\n        ?.split('px')[0] || 0;\n      let contentCha = Number(PT) + Number(PB) + Number(contentPT) + Number(contentPB) + Number(bbw) + Number(btw);\n      // console.log(PT,PB,contentCha, 'contentCha');\n      return contentCha;\n    },\n    // 定位\n    positionFun(reference, popper, scrollTop, scrollLeft) {\n      if (!reference || !popper) {\n        return false;\n      }\n      if (this.appendToBody && this.tagName !== 'HTML') {\n        // console.log(document.getElementById(this.tooltipId), 'classList');\n        document.getElementById(this.tooltipId)?.classList?.add('posA');\n      }\n      let offsetObj = this.getPoint(reference);\n      let offsetObj3 = this.getBoundingClientRect2(reference);\n      let offsetObj2;\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.getOffsetParent(popper), false);\n      }\n      // console.log(offsetObj3, 'offsetObj3');\n      // console.log(offsetObj2, 'offsetObj2');\n      let referenceOffsetLeft = this.appendToBody ? offsetObj2.left : reference.offsetLeft;\n      let referenceOffsetTop = this.appendToBody ? offsetObj2.top : reference.offsetTop;\n      // console.log(`\\n reference: offsetLeft：offsetLeft：${reference.offsetLeft},${offsetObj.offsetLeft},  offsetObj2.left：${offsetObj2.left}`);\n      // console.log(`\\n reference: offsetTop：offsetTop：${reference.offsetTop},${offsetObj.offsetTop},  offsetObj2.top：${offsetObj2.top}`);\n      // console.log(referenceOffsetTop, referenceOffsetLeft, '=====================');\n      let left, top;\n      // console.log(this.popWHStyle.maxHeight, this.popWHStyle.maxWidth, popper.offsetWidth, 'this.popWHStyle.maxHeight');\n      let contentCha = this.getContentCha();\n      let height1;\n      if (this.title) {\n        if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n          height1 = Number(this.getTitleStyle().height + 24);\n        } else {\n          height1 = Number(this.getTitleStyle().height + contentCha);\n        }\n        // document.getElementById(this.tooltipId + '-content').style.maxHeight = 'calc(100vh - ' + height1 + 'px';\n      } else {\n        height1 = contentCha;\n      }\n      // height1 = 15;\n      if (document.getElementById(this.tooltipId + '-content')) {\n        document.getElementById(this.tooltipId + '-content').style.maxHeight = this.popWHStyle.maxHeight - height1 < contentCha ? contentCha + 'px' : this.popWHStyle.maxHeight - height1 + 'px';\n      }\n      let popperRealityOffsetWidth = popper.offsetWidth;\n      let popperRealityOffsetHeight = popper.offsetHeight;\n      let widthDifference = Math.abs(reference.offsetWidth - popperRealityOffsetWidth);\n      let heightDifference = Math.abs(reference.offsetHeight - popperRealityOffsetHeight);\n      // console.log(`popper: offsetLeft：${popper.offsetLeft}  offsetTop：${popper.offsetTop}  offsetWidth：${popper.offsetWidth},popperRealityOffsetWidth: ${popperRealityOffsetWidth},  offsetHeight：${popper.offsetHeight}, popperRealityOffsetHeight:${popperRealityOffsetHeight}`);\n      // console.log(`\\n reference: offsetLeft：${referenceOffsetLeft}  offsetTop：${referenceOffsetTop}  offsetWidth：${reference.offsetWidth}  offsetHeight：${reference.offsetHeight}`);\n      if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight') {\n        top = referenceOffsetTop - popperRealityOffsetHeight;\n      }\n      if (this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n        top = referenceOffsetTop + reference.offsetHeight;\n      }\n      if (this.placementStr === 'top' || this.placementStr === 'bottom') {\n        left = referenceOffsetLeft - popperRealityOffsetWidth / 2 + reference.offsetWidth / 2;\n      }\n      if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n        left = referenceOffsetLeft;\n      }\n      if (this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n        if (popperRealityOffsetWidth > reference.offsetWidth) {\n          left = referenceOffsetLeft - widthDifference;\n        } else {\n          left = referenceOffsetLeft + widthDifference;\n        }\n      }\n      if (this.placementStr === 'rightTop' || this.placementStr === 'leftTop') {\n        top = referenceOffsetTop;\n      }\n      if (this.placementStr === 'right' || this.placementStr === 'left') {\n        top = referenceOffsetTop - popperRealityOffsetHeight / 2 + reference.offsetHeight / 2;\n      }\n      if (this.placementStr === 'rightBottom' || this.placementStr === 'leftBottom') {\n        if (popperRealityOffsetHeight > reference.offsetHeight) {\n          top = referenceOffsetTop - heightDifference;\n        } else {\n          top = referenceOffsetTop + heightDifference;\n        }\n      }\n      if (this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n        left = referenceOffsetLeft + reference.offsetWidth;\n      }\n      if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom') {\n        left = referenceOffsetLeft - popperRealityOffsetWidth;\n      }\n      // 动态计算宽高时，宽/高的需要加上的差值\n      let heightChaLR = 0;\n      let leftChaLR = 0;\n      let top1, left1;\n      if (this.tagName !== 'HTML') {\n        top1 = offsetObj3.top - popperRealityOffsetHeight / 2 + reference.offsetHeight / 2;\n        // left1 = offsetObj3.left - popperRealityOffsetWidth / 2 + reference.offsetWidth / 2;\n        left1 = left;\n        if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n          left1 = left - 5;\n        }\n      } else {\n        top1 = top;\n        left1 = left;\n      }\n      let topPos = this.tagName === 'HTML' ? top : top1;\n      let leftPos = this.tagName === 'HTML' ? left : left1;\n      if (this.appendToBody) {\n        if (topPos + popperRealityOffsetHeight >= document.documentElement.clientHeight - 4) {\n          heightChaLR = document.documentElement.clientHeight - topPos - popperRealityOffsetHeight - 5;\n          // console.log('heightChaLR 111');\n        } else if (topPos <= 4) {\n          heightChaLR = popperRealityOffsetHeight / 2 - reference.offsetHeight / 2 - offsetObj3.top + 5;\n          // console.log('heightChaLR 222');\n        } else {\n          heightChaLR = 0;\n          // console.log('heightChaLR 333');\n        }\n        if (leftPos + popperRealityOffsetWidth > document.documentElement.clientWidth) {\n          leftChaLR = document.documentElement.clientWidth - leftPos - popperRealityOffsetWidth - 5;\n          // console.log(leftChaLR,'leftChaLR 11')\n        } else if (leftPos <= 0) {\n          leftChaLR = popperRealityOffsetWidth / 2 - reference.offsetWidth / 2 - offsetObj3.left + 5;\n          /*  if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n           // console.log('1111--')\n           leftChaLR = - offsetObj3.left + 5 // 左侧pop被遮挡的距离+5\n           }*/\n          if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft' || this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n            // console.log('1111--')\n            leftChaLR = -leftPos + 5;// 左侧pop被遮挡的距离+5\n          }\n          // console.log(offsetObj3.left,leftPos,leftChaLR,'leftChaLR 22')\n        } else {\n          leftChaLR = 0;\n          // console.log(leftChaLR,leftPos,'leftChaLR 33')\n        }\n      }\n      // console.log(heightChaLR, leftChaLR, 'heightChaLR,leftChaLR');\n      let overFlowHeight = offsetObj3.top >= 10 ? document.documentElement.clientHeight - offsetObj3.top : offsetObj3.bottom;\n      let overFlowWidth = offsetObj3.left >= 10 ? document.documentElement.clientWidth - offsetObj3.left : offsetObj3.right;\n      // console.log('document.documentElement.clientHeight', document.documentElement.clientHeight, 'offsetObj2.top：', offsetObj2.top, 'overFlowHeight：', overFlowHeight, 'overFlowWidth：', overFlowWidth, 'popperRealityOffsetHeight：', popperRealityOffsetHeight, 'popperRealityOffsetWidth：', popperRealityOffsetWidth, '000', overFlowHeight < reference.offsetHeight);\n      // reference被遮盖的高度\n      let hideHeight = offsetObj3.top >= 0 ? offsetObj3.bottom - document.documentElement.clientHeight : -offsetObj3.top;\n      let hideWidth = offsetObj3.left >= 0 ? offsetObj3.right - document.documentElement.clientWidth : -offsetObj3.left;\n      // console.log(hideHeight, hideWidth, 'hideHeight');\n      // 文档顶部到reference底部的距离\n      let scrollHeightUp = offsetObj.offsetTop + reference.offsetHeight;\n      // 文档顶部到reference顶部-可视区域的高度\n      let scrollHeightDown = offsetObj.offsetTop - document.documentElement.clientHeight;\n      // 文档左侧到reference最右侧的距离\n      let scrollWidthUp = offsetObj.offsetLeft + reference.offsetWidth;\n      // 文档顶部到reference左侧-可视区域的宽度\n      let scrollWidthDown = offsetObj.offsetLeft - document.documentElement.clientWidth;\n      let scrollHeight, scrollWidth;\n      if (offsetObj3.top < -reference.offsetHeight) {\n        scrollHeight = scrollTop - scrollHeightUp || 0;\n      } else {\n        scrollHeight = scrollTop - scrollHeightDown || 0;\n      }\n      if (offsetObj3.left < -reference.offsetWidth + 20) {\n        scrollWidth = scrollLeft - scrollWidthUp || 0;\n      } else {\n        scrollWidth = scrollLeft - scrollWidthDown || 0;\n      }\n      // console.log(left, left1, 'left,left1');\n      // console.log(top, top1, document.documentElement.clientHeight,'top,top1');\n      // console.log(scrollTop, scrollHeightUp, scrollHeightDown, scrollHeight, 'scrollTop,scrollHeight');\n      // console.log(left + leftChaLR - scrollWidth, left + leftChaLR, leftChaLR, scrollWidth, left, '===00');\n      let leftNum, topNum;\n      if (this.appendToBody) {\n        // console.log('placementStr',this.placementStr)\n        if (this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom' || this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom') {\n          leftNum = left;\n          if (offsetObj3.top < -reference.offsetHeight || offsetObj3.top > document.documentElement.clientHeight) {\n            if (this.tagName !== 'HTML') {\n              topNum = top1 + heightChaLR - scrollHeight + 'px';\n            } else {\n              topNum = top + heightChaLR - scrollHeight + 'px';\n            }\n            // console.log('topNum111===', topNum)\n          } else if (overFlowHeight < popperRealityOffsetHeight || this.appendToBody && top < 0 || this.appendToBody && top1 < 0 || top + popperRealityOffsetHeight > document.documentElement.clientHeight || top1 + popperRealityOffsetHeight > document.documentElement.clientHeight || offsetObj3.top <= 0 || offsetObj3.bottom >= document.documentElement.clientHeight) {\n            // if (this.tagName !== 'HTML') {\n            //   topNum = top1 + heightChaLR + 'px';\n            // }else {\n            topNum = top + heightChaLR + 'px';\n            // }\n            // console.log('topNum22', topNum)\n          } else {\n            topNum = top + 'px';\n            // console.log('33')\n          }\n        } else if (this.placementStr === 'top' || this.placementStr === 'topLeft' || this.placementStr === 'topRight' || this.placementStr === 'bottom' || this.placementStr === 'bottomLeft' || this.placementStr === 'bottomRight') {\n          topNum = top + 'px';\n          // console.log(overFlowWidth,popperRealityOffsetWidth,left)\n          // console.log(`overFlowWidth：${overFlowWidth}  popperRealityOffsetWidth：${popperRealityOffsetWidth}  left：${left},left1: ${left1},`);\n          if (offsetObj3.left < -reference.offsetWidth + 20 || offsetObj3.left > document.documentElement.clientWidth - 13) {\n            /* if (this.tagName !== 'HTML') {\n             leftNum = left1 + leftChaLR - scrollWidth;\n             } else {\n             leftNum = left + leftChaLR - scrollWidth;\n             }*/\n            if (offsetObj3.left < -reference.offsetWidth + 20) {\n              leftNum = left + leftChaLR - scrollWidth - 20;\n            }\n            if (offsetObj3.left > document.documentElement.clientWidth - 13) {\n              leftNum = left + leftChaLR - scrollWidth + 13;\n            }\n            // console.log(left,leftChaLR,scrollWidth,'leftNum 111=============');\n          } else if (overFlowWidth < popperRealityOffsetWidth || this.appendToBody && left < 0 || this.appendToBody && left1 < 0 || left + popperRealityOffsetWidth > document.documentElement.clientWidth || left1 + popperRealityOffsetWidth > document.documentElement.clientWidth || offsetObj3.left <= 0 || offsetObj3.right >= document.documentElement.clientWidth) {\n            // console.log(left,leftChaLR,'leftNum 22=============')\n            leftNum = left + leftChaLR;\n            // console.log('22',leftNum)\n          } else {\n            // console.log('leftNum 33')\n            leftNum = left;\n          }\n        }\n        this.popStyle = {\n          left: leftNum + 'px',\n          top: topNum\n        };\n      } else {\n        // console.log('ppppppp')\n        this.popStyle = {\n          left: left + 'px',\n          top: top + 'px'\n        };\n      }\n      // console.log('111',overFlowHeight,document.documentElement.clientHeight,offsetObj3.top <= 0,offsetObj3.bottom >= document.documentElement.clientHeight)\n      if (this.appendToBody && (overFlowHeight < popperRealityOffsetHeight || overFlowWidth < popperRealityOffsetWidth || top1 < 0 || left1 < 0 || top1 + popperRealityOffsetHeight < document.documentElement.clientHeight || left1 + popperRealityOffsetWidth < document.documentElement.clientWidth || offsetObj3.top <= 0 || offsetObj3.left <= 0 || offsetObj3.bottom >= document.documentElement.clientHeight || offsetObj3.right >= document.documentElement.clientWidth)) {\n        // console.log('111箭头')\n        if (this.placementStr === 'leftTop' || this.placementStr === 'left' || this.placementStr === 'leftBottom' || this.placementStr === 'rightTop' || this.placementStr === 'right' || this.placementStr === 'rightBottom') {\n          let arrowHeightLR;\n          if (offsetObj3.top >= 0) {\n            arrowHeightLR = hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15 ? -(popperRealityOffsetHeight / 2 - 10) : heightChaLR;\n          } else {\n            arrowHeightLR = hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15 ? popperRealityOffsetHeight / 2 - 10 : heightChaLR;\n            // console.log('222',hideHeight,hideHeight > 0 && reference.offsetHeight / 2 - hideHeight < 15,heightChaLR)\n          }\n          // console.log(hideHeight > 20, overFlowHeight < reference.offsetHeight, arrowHeightLR, 'arrowHeightLR');\n          if (this.placementStr === 'rightBottom' || this.placementStr === 'leftBottom') {\n            this.arrowStyle = {\n              bottom: overFlowHeight < reference.offsetHeight ? `calc(50% - ${arrowHeightLR}px)` : `calc(50% - ${heightChaLR}px)`\n            };\n          } else {\n            this.arrowStyle = {\n              top: overFlowHeight < reference.offsetHeight ? `calc(50% - ${arrowHeightLR}px)` : `calc(50% - ${heightChaLR}px)`\n            };\n          }\n        } else {\n          let arrowDisplacement;\n          let leftUnchanged;\n          if (offsetObj3.left >= 0) {\n            arrowDisplacement = hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15 ? -(popperRealityOffsetWidth / 2 - 10) : leftChaLR;\n          } else {\n            arrowDisplacement = hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15 ? popperRealityOffsetWidth / 2 - 10 : leftChaLR;\n            // console.log('222',hideWidth,hideWidth > 0 && reference.offsetWidth / 2 - hideWidth < 15,leftChaLR)\n          }\n          // console.log(`hideWidth: ${hideWidth} leftNum:${leftNum},overFlowWidth:${overFlowWidth},reference.offsetWidth:${reference.offsetWidth},leftChaLR:${leftChaLR}, arrowDisplacement:${arrowDisplacement}`, '====');\n          let initialLeft = '50%';\n          if (this.placementStr === 'topLeft' || this.placementStr === 'bottomLeft') {\n            let initialLeft1 = 16;\n            initialLeft = initialLeft1 + 'px';\n            arrowDisplacement = hideWidth > 0 && leftNum < 15 ? initialLeft1 - 10 : leftChaLR;\n            // console.log('222---', overFlowWidth < initialLeft1 + 1 + 5,hideWidth, hideWidth > 0 && leftNum < 15, leftChaLR);\n            // 元素超过某可视范围区域箭头不移动\n            if (overFlowWidth < initialLeft1 + 12 + 1 + 5) {\n              leftUnchanged = initialLeft1;\n            }\n          }\n          if (this.placementStr === 'topRight' || this.placementStr === 'bottomRight') {\n            let initialLeft1 = popperRealityOffsetWidth - 16 - 12;\n            initialLeft = initialLeft1 + 'px';\n            arrowDisplacement = leftChaLR;\n            // 元素右侧超过可视范围区域或左侧区域内宽度小于某值时 箭头不移动\n            if (offsetObj3.right > document.documentElement.clientWidth || overFlowWidth < 5 + 16 + 12 + 10) {\n              leftUnchanged = initialLeft1;\n            }\n          }\n          // console.log('initialLeft', initialLeft, ' leftUnchanged:', leftUnchanged, ' arrowDisplacement:', arrowDisplacement, overFlowWidth < reference.offsetWidth, hideWidth > 0 && leftNum < 15);\n          let arrowLeft = leftUnchanged ? leftUnchanged : overFlowWidth < reference.offsetWidth ? `calc(${initialLeft} - ${arrowDisplacement}px)` : `calc(${initialLeft} - ${leftChaLR}px)`;\n          if (leftPos) {\n            this.arrowStyle = {\n              left: arrowLeft\n            };\n          }\n        }\n      }\n    },\n    // 动态判断placement该为什么值\n    placementStrFun(reference, popper) {\n      // console.log(popper, 'popper--');\n      // let offsetObj2 = this.getBoundingClientRect2(reference);\n      let offsetObj2;\n      if (this.tagName === 'HTML') {\n        offsetObj2 = this.getBoundingClientRect2(reference);\n      } else {\n        offsetObj2 = this.getOffsetRectRelativeToCustomParent(reference, this.getOffsetParent(popper), false);\n      }\n      let spaceTop = offsetObj2?.top;\n      let spaceBottom = document.documentElement.clientHeight - offsetObj2?.bottom;\n      let spaceLeft = offsetObj2?.left;\n      let spaceRight = document.documentElement.clientWidth - offsetObj2?.right;\n      // console.log(offsetObj2, document.documentElement.clientWidth, document.documentElement.clientHeight, 'offsetObj2');\n      // console.log(' spaceTop:', spaceTop, ' spaceBottom:', spaceBottom, ' spaceLeft:', spaceLeft, ' spaceRight:', spaceRight, ' this.popperInitialWidth:', this.popperInitialWidth, ' this.popperInitialHeight:', this.popperInitialHeight, '-----');\n      if (this.appendToBody) {\n        if (this.placement === 'rightTop' || this.placement === 'right' || this.placement === 'rightBottom') {\n          // this.placementStr = 'right';\n          // if (document.documentElement.clientWidth - offsetObj2.right < this.contraryHorizontal) {\n          //   this.placementStr = 'left';\n          // }\n          if (this.popperInitialWidth > spaceRight - 15) {\n            if (this.popperInitialWidth <= spaceLeft + 15) {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            } else if (spaceLeft > spaceRight) {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            } else {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            }\n          }\n        } else if (this.placement === 'leftTop' || this.placement === 'left' || this.placement === 'leftBottom') {\n          // this.placementStr = 'left';\n          // if (offsetObj2.left < this.contraryHorizontal) {\n          //   this.placementStr = 'right';\n          // }\n          if (this.popperInitialWidth > spaceLeft - 15) {\n            if (this.popperInitialWidth <= spaceRight + 15) {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            } else if (spaceRight > spaceLeft) {\n              this.contraryHorizontal = spaceRight;\n              this.placementStr = 'right';\n            } else {\n              this.contraryHorizontal = spaceLeft;\n              this.placementStr = 'left';\n            }\n          }\n        } else if (this.placement === 'top' || this.placement === 'topLeft' || this.placement === 'topRight') {\n          this.placementStr = 'top';\n          if (this.placement === 'topLeft') {\n            this.placementStr = 'topLeft';\n          } else if (this.placement === 'topRight') {\n            this.placementStr = 'topRight';\n          }\n          if (this.popperInitialHeight > spaceTop - 15) {\n            if (this.popperInitialHeight <= spaceBottom + 15) {\n              // console.log('111----------------=============')\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else if (spaceBottom > spaceTop) {\n              // console.log('222----------------=============')\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else {\n              // console.log('333----------------=============')\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'topLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'topRight') {\n                this.placementStr = 'topRight';\n              }\n            }\n          }\n        } else if (this.placement === 'bottom' || this.placement === 'bottomLeft' || this.placement === 'bottomRight') {\n          this.placementStr = 'bottom';\n          if (this.placement === 'bottomLeft') {\n            this.placementStr = 'bottomLeft';\n          } else if (this.placement === 'bottomRight') {\n            this.placementStr = 'bottomRight';\n          }\n          if (this.popperInitialHeight > spaceBottom - 15) {\n            if (this.popperInitialHeight <= spaceTop + 15) {\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'topRight';\n              }\n            } else if (spaceBottom > spaceTop) {\n              this.contraryVertical = spaceBottom;\n              this.placementStr = 'bottom';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'bottomLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'bottomRight';\n              }\n            } else {\n              this.contraryVertical = spaceTop;\n              this.placementStr = 'top';\n              if (this.placement === 'bottomLeft') {\n                this.placementStr = 'topLeft';\n              } else if (this.placement === 'bottomRight') {\n                this.placementStr = 'topRight';\n              }\n            }\n          }\n        }\n        // console.log(this.placementStr, 'this.placementStr');\n        if (offsetObj2.right >= 0 && offsetObj2.left <= document.documentElement.clientWidth && offsetObj2.top <= document.documentElement.clientHeight && offsetObj2.bottom >= 0) {\n          this.popWidthHeightFun(reference, popper);\n        }\n        // console.log(this.placementStr, 'placementStr');\n      }\n    },\n    computePosition() {\n      let reference = this.getReference();\n      const popper = this.popper || this.$refs.popper;\n      this.handleScroll(reference, popper);\n    },\n    // 浏览器滚动事件\n    handleScroll(reference, popper) {\n      // console.log('handleScroll',reference, popper);\n      if (!this.disabled && this.showPopper) {\n        let scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n        let scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;\n        if (this.tagName === 'DIV') {\n          // console.log(this.target.scrollTop,this.target.scrollLeft,'handleScroll');\n          scrollTop = this.target.scrollTop;\n          scrollLeft = this.target.scrollLeft;\n        }\n        // console.log('handleScroll',  scrollTop, scrollLeft);\n        setTimeout(() => {\n          this.placementStrFun(reference, popper);\n        }, 0);\n        setTimeout(() => {\n          // console.log('handleScroll',document.getElementById(this.tooltipId));\n          if (document.getElementById(this.tooltipId)) {\n            this.positionFun(reference, popper, scrollTop, scrollLeft);\n          }\n        }, 5);\n      }\n    },\n    doToggle() {\n      // console.log('doToggle');\n      this.showPopper = !this.showPopper;\n    },\n    creatDOM() {\n      const aNode = document.getElementById(this.tooltipId);\n      // 然后判断该元素节点是不是当前文档页面body节点的后代\n      // console.log(aNode, aNode.parentNode.tagName, 'aNode');\n      if (aNode.parentNode.tagName.toUpperCase() !== 'BODY') {\n        const popper = this.popper || this.$refs.popper;\n        document.body.appendChild(popper);\n      }\n    },\n    removeDOM() {\n      const popper = this.popper || this.$refs.popper;\n      // console.log(popper, 'popper removeDOM');\n      document.body.removeChild(popper);\n    },\n    doShow() {\n      // console.log('doShow--------');\n      this.showPopper = true;\n    },\n    doClose() {\n      // console.log('doClose--------');\n      this.showPopper = false;\n    },\n    handleFocus() {\n      // console.log('handleFocus--------');\n      if (this.trigger === 'click' || this.trigger === 'focus') this.showPopper = true;\n    },\n    handleClick() {\n    },\n    handleBlur() {\n      // console.log('handleBlur--------');\n      if (this.trigger === 'click' || this.trigger === 'focus') this.showPopper = false;\n    },\n    handleKeydown(ev) {\n      if (ev.keyCode === 27 && this.trigger !== 'manual') { // esc\n        this.doClose();\n      }\n    },\n    handleMouseEnter() {\n      // console.log('handleMouseEnter--------');\n      clearTimeout(this._timer);\n      if (this.openDelay) {\n        this._timer = setTimeout(() => {\n          this.showPopper = true;\n        }, this.openDelay);\n      } else {\n        this.showPopper = true;\n      }\n    },\n    handleMouseLeave() {\n      // console.log('handleMouseLeave-------');\n      clearTimeout(this._timer);\n      if (this.closeDelay) {\n        this._timer = setTimeout(() => {\n          this.showPopper = false;\n        }, this.closeDelay);\n      } else {\n        this.showPopper = false;\n      }\n    },\n    handleDocumentClick(e) {\n      // console.log('handleDocumentClick');\n      let reference = this.getReference();\n      const popper = this.popper || this.$refs.popper;\n      if (!this.$el ||\n        !reference ||\n        this.$el.contains(e.target) ||\n        reference.contains(e.target) ||\n        !popper ||\n        popper.contains(e.target)) return;\n      this.showPopper = false;\n    },\n    cleanup() {\n      if (this.openDelay || this.closeDelay) {\n        clearTimeout(this._timer);\n      }\n    },\n    off(element, event, handler) {\n      // console.log(element,'off');\n      if (element && event) {\n        element.removeEventListener(event, handler, false);\n      }\n    },\n    on(element, event, handler) {\n      // console.log(element, event, handler, 'on');\n      if (element && event && handler) {\n        element.addEventListener(event, handler, false);\n      }\n    }\n  }\n};\n</script>\n\n<style lang=\"less\" scoped>\n\n</style>\n"]}]}